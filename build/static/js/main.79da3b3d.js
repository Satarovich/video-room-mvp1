/*! For license information please see main.79da3b3d.js.LICENSE.txt */
(()=>{var e={43:(e,t,i)=>{"use strict";e.exports=i(202)},67:(e,t,i)=>{e=i.nmd(e);var n="__lodash_hash_undefined__",r=9007199254740991,s="[object Arguments]",a="[object Array]",o="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",d="[object Map]",h="[object Number]",p="[object Object]",f="[object Promise]",v="[object RegExp]",g="[object Set]",m="[object String]",y="[object Symbol]",b="[object WeakMap]",k="[object ArrayBuffer]",S="[object DataView]",T=/^\[object .+?Constructor\]$/,w=/^(?:0|[1-9]\d*)$/,E={};E["[object Float32Array]"]=E["[object Float64Array]"]=E["[object Int8Array]"]=E["[object Int16Array]"]=E["[object Int32Array]"]=E["[object Uint8Array]"]=E["[object Uint8ClampedArray]"]=E["[object Uint16Array]"]=E["[object Uint32Array]"]=!0,E[s]=E[a]=E[k]=E[o]=E[S]=E[l]=E[c]=E[u]=E[d]=E[h]=E[p]=E[v]=E[g]=E[m]=E[b]=!1;var P="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,C="object"==typeof self&&self&&self.Object===Object&&self,I=P||C||Function("return this")(),_=t&&!t.nodeType&&t,A=_&&e&&!e.nodeType&&e,R=A&&A.exports===_,L=R&&P.process,D=function(){try{return L&&L.binding&&L.binding("util")}catch(e){}}(),M=D&&D.isTypedArray;function N(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1}function O(e){var t=-1,i=Array(e.size);return e.forEach(function(e,n){i[++t]=[n,e]}),i}function x(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}var U,F,j=Array.prototype,B=Function.prototype,G=Object.prototype,V=I["__core-js_shared__"],z=B.toString,W=G.hasOwnProperty,H=function(){var e=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),q=G.toString,K=RegExp("^"+z.call(W).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),J=R?I.Buffer:void 0,Q=I.Symbol,Y=I.Uint8Array,$=G.propertyIsEnumerable,X=j.splice,Z=Q?Q.toStringTag:void 0,ee=Object.getOwnPropertySymbols,te=J?J.isBuffer:void 0,ie=(U=Object.keys,F=Object,function(e){return U(F(e))}),ne=Le(I,"DataView"),re=Le(I,"Map"),se=Le(I,"Promise"),ae=Le(I,"Set"),oe=Le(I,"WeakMap"),le=Le(Object,"create"),ce=Oe(ne),ue=Oe(re),de=Oe(se),he=Oe(ae),pe=Oe(oe),fe=Q?Q.prototype:void 0,ve=fe?fe.valueOf:void 0;function ge(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function me(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function ye(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function be(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new ye;++t<i;)this.add(e[t])}function ke(e){var t=this.__data__=new me(e);this.size=t.size}function Se(e,t){var i=Fe(e),n=!i&&Ue(e),r=!i&&!n&&je(e),s=!i&&!n&&!r&&We(e),a=i||n||r||s,o=a?function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}(e.length,String):[],l=o.length;for(var c in e)!t&&!W.call(e,c)||a&&("length"==c||r&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ne(c,l))||o.push(c);return o}function Te(e,t){for(var i=e.length;i--;)if(xe(e[i][0],t))return i;return-1}function we(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Z&&Z in Object(e)?function(e){var t=W.call(e,Z),i=e[Z];try{e[Z]=void 0;var n=!0}catch(s){}var r=q.call(e);n&&(t?e[Z]=i:delete e[Z]);return r}(e):function(e){return q.call(e)}(e)}function Ee(e){return ze(e)&&we(e)==s}function Pe(e,t,i,n,r){return e===t||(null==e||null==t||!ze(e)&&!ze(t)?e!==e&&t!==t:function(e,t,i,n,r,u){var f=Fe(e),b=Fe(t),T=f?a:Me(e),w=b?a:Me(t),E=(T=T==s?p:T)==p,P=(w=w==s?p:w)==p,C=T==w;if(C&&je(e)){if(!je(t))return!1;f=!0,E=!1}if(C&&!E)return u||(u=new ke),f||We(e)?_e(e,t,i,n,r,u):function(e,t,i,n,r,s,a){switch(i){case S:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case k:return!(e.byteLength!=t.byteLength||!s(new Y(e),new Y(t)));case o:case l:case h:return xe(+e,+t);case c:return e.name==t.name&&e.message==t.message;case v:case m:return e==t+"";case d:var u=O;case g:var p=1&n;if(u||(u=x),e.size!=t.size&&!p)return!1;var f=a.get(e);if(f)return f==t;n|=2,a.set(e,t);var b=_e(u(e),u(t),n,r,s,a);return a.delete(e),b;case y:if(ve)return ve.call(e)==ve.call(t)}return!1}(e,t,T,i,n,r,u);if(!(1&i)){var I=E&&W.call(e,"__wrapped__"),_=P&&W.call(t,"__wrapped__");if(I||_){var A=I?e.value():e,R=_?t.value():t;return u||(u=new ke),r(A,R,i,n,u)}}if(!C)return!1;return u||(u=new ke),function(e,t,i,n,r,s){var a=1&i,o=Ae(e),l=o.length,c=Ae(t),u=c.length;if(l!=u&&!a)return!1;var d=l;for(;d--;){var h=o[d];if(!(a?h in t:W.call(t,h)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var f=!0;s.set(e,t),s.set(t,e);var v=a;for(;++d<l;){var g=e[h=o[d]],m=t[h];if(n)var y=a?n(m,g,h,t,e,s):n(g,m,h,e,t,s);if(!(void 0===y?g===m||r(g,m,i,n,s):y)){f=!1;break}v||(v="constructor"==h)}if(f&&!v){var b=e.constructor,k=t.constructor;b==k||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof k&&k instanceof k||(f=!1)}return s.delete(e),s.delete(t),f}(e,t,i,n,r,u)}(e,t,i,n,Pe,r))}function Ce(e){return!(!Ve(e)||function(e){return!!H&&H in e}(e))&&(Be(e)?K:T).test(Oe(e))}function Ie(e){if(!function(e){var t=e&&e.constructor,i="function"==typeof t&&t.prototype||G;return e===i}(e))return ie(e);var t=[];for(var i in Object(e))W.call(e,i)&&"constructor"!=i&&t.push(i);return t}function _e(e,t,i,n,r,s){var a=1&i,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(e);if(c&&s.get(t))return c==t;var u=-1,d=!0,h=2&i?new be:void 0;for(s.set(e,t),s.set(t,e);++u<o;){var p=e[u],f=t[u];if(n)var v=a?n(f,p,u,t,e,s):n(p,f,u,e,t,s);if(void 0!==v){if(v)continue;d=!1;break}if(h){if(!N(t,function(e,t){if(a=t,!h.has(a)&&(p===e||r(p,e,i,n,s)))return h.push(t);var a})){d=!1;break}}else if(p!==f&&!r(p,f,i,n,s)){d=!1;break}}return s.delete(e),s.delete(t),d}function Ae(e){return function(e,t,i){var n=t(e);return Fe(e)?n:function(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e}(n,i(e))}(e,He,De)}function Re(e,t){var i=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?i["string"==typeof t?"string":"hash"]:i.map}function Le(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return Ce(i)?i:void 0}ge.prototype.clear=function(){this.__data__=le?le(null):{},this.size=0},ge.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ge.prototype.get=function(e){var t=this.__data__;if(le){var i=t[e];return i===n?void 0:i}return W.call(t,e)?t[e]:void 0},ge.prototype.has=function(e){var t=this.__data__;return le?void 0!==t[e]:W.call(t,e)},ge.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=le&&void 0===t?n:t,this},me.prototype.clear=function(){this.__data__=[],this.size=0},me.prototype.delete=function(e){var t=this.__data__,i=Te(t,e);return!(i<0)&&(i==t.length-1?t.pop():X.call(t,i,1),--this.size,!0)},me.prototype.get=function(e){var t=this.__data__,i=Te(t,e);return i<0?void 0:t[i][1]},me.prototype.has=function(e){return Te(this.__data__,e)>-1},me.prototype.set=function(e,t){var i=this.__data__,n=Te(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this},ye.prototype.clear=function(){this.size=0,this.__data__={hash:new ge,map:new(re||me),string:new ge}},ye.prototype.delete=function(e){var t=Re(this,e).delete(e);return this.size-=t?1:0,t},ye.prototype.get=function(e){return Re(this,e).get(e)},ye.prototype.has=function(e){return Re(this,e).has(e)},ye.prototype.set=function(e,t){var i=Re(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this},be.prototype.add=be.prototype.push=function(e){return this.__data__.set(e,n),this},be.prototype.has=function(e){return this.__data__.has(e)},ke.prototype.clear=function(){this.__data__=new me,this.size=0},ke.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},ke.prototype.get=function(e){return this.__data__.get(e)},ke.prototype.has=function(e){return this.__data__.has(e)},ke.prototype.set=function(e,t){var i=this.__data__;if(i instanceof me){var n=i.__data__;if(!re||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new ye(n)}return i.set(e,t),this.size=i.size,this};var De=ee?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var i=-1,n=null==e?0:e.length,r=0,s=[];++i<n;){var a=e[i];t(a,i,e)&&(s[r++]=a)}return s}(ee(e),function(t){return $.call(e,t)}))}:function(){return[]},Me=we;function Ne(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||w.test(e))&&e>-1&&e%1==0&&e<t}function Oe(e){if(null!=e){try{return z.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function xe(e,t){return e===t||e!==e&&t!==t}(ne&&Me(new ne(new ArrayBuffer(1)))!=S||re&&Me(new re)!=d||se&&Me(se.resolve())!=f||ae&&Me(new ae)!=g||oe&&Me(new oe)!=b)&&(Me=function(e){var t=we(e),i=t==p?e.constructor:void 0,n=i?Oe(i):"";if(n)switch(n){case ce:return S;case ue:return d;case de:return f;case he:return g;case pe:return b}return t});var Ue=Ee(function(){return arguments}())?Ee:function(e){return ze(e)&&W.call(e,"callee")&&!$.call(e,"callee")},Fe=Array.isArray;var je=te||function(){return!1};function Be(e){if(!Ve(e))return!1;var t=we(e);return t==u||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ge(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function Ve(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ze(e){return null!=e&&"object"==typeof e}var We=M?function(e){return function(t){return e(t)}}(M):function(e){return ze(e)&&Ge(e.length)&&!!E[we(e)]};function He(e){return null!=(t=e)&&Ge(t.length)&&!Be(t)?Se(e):Ie(e);var t}e.exports=function(e,t){return Pe(e,t)}},121:function(e,t,i){var n;!function(r,s){"use strict";var a="function",o="undefined",l="object",c="string",u="major",d="model",h="name",p="type",f="vendor",v="version",g="architecture",m="console",y="mobile",b="tablet",k="smarttv",S="wearable",T="embedded",w="Amazon",E="Apple",P="ASUS",C="BlackBerry",I="Browser",_="Chrome",A="Firefox",R="Google",L="Huawei",D="LG",M="Microsoft",N="Motorola",O="Opera",x="Samsung",U="Sharp",F="Sony",j="Xiaomi",B="Zebra",G="Facebook",V="Chromium OS",z="Mac OS",W=" Browser",H=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},q=function(e,t){return typeof e===c&&-1!==K(t).indexOf(K(e))},K=function(e){return e.toLowerCase()},J=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,500)},Q=function(e,t){for(var i,n,r,o,c,u,d=0;d<t.length&&!c;){var h=t[d],p=t[d+1];for(i=n=0;i<h.length&&!c&&h[i];)if(c=h[i++].exec(e))for(r=0;r<p.length;r++)u=c[++n],typeof(o=p[r])===l&&o.length>0?2===o.length?typeof o[1]==a?this[o[0]]=o[1].call(this,u):this[o[0]]=o[1]:3===o.length?typeof o[1]!==a||o[1].exec&&o[1].test?this[o[0]]=u?u.replace(o[1],o[2]):s:this[o[0]]=u?o[1].call(this,u,o[2]):s:4===o.length&&(this[o[0]]=u?o[3].call(this,u.replace(o[1],o[2])):s):this[o]=u||s;d+=2}},Y=function(e,t){for(var i in t)if(typeof t[i]===l&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(q(t[i][n],e))return"?"===i?s:i}else if(q(t[i],e))return"?"===i?s:i;return t.hasOwnProperty("*")?t["*"]:e},$={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},X={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[v,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[v,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,v],[/opios[\/ ]+([\w\.]+)/i],[v,[h,O+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[v,[h,O+" GX"]],[/\bopr\/([\w\.]+)/i],[v,[h,O]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[v,[h,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[v,[h,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,v],[/quark(?:pc)?\/([-\w\.]+)/i],[v,[h,"Quark"]],[/\bddg\/([\w\.]+)/i],[v,[h,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[v,[h,"UC"+I]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[v,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[v,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[v,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[v,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[v,[h,"Smart Lenovo "+I]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+I],v],[/\bfocus\/([\w\.]+)/i],[v,[h,A+" Focus"]],[/\bopt\/([\w\.]+)/i],[v,[h,O+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[v,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[v,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[v,[h,O+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[v,[h,"MIUI"+W]],[/fxios\/([\w\.-]+)/i],[v,[h,A]],[/\bqihoobrowser\/?([\w\.]*)/i],[v,[h,"360"]],[/\b(qq)\/([\w\.]+)/i],[[h,/(.+)/,"$1Browser"],v],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1"+W],v],[/samsungbrowser\/([\w\.]+)/i],[v,[h,x+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[v,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],v],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[h,v],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[h],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[v,h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,G],v],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,v],[/\bgsa\/([\w\.]+) .*safari\//i],[v,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[v,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[v,[h,_+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,_+" WebView"],v],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[v,[h,"Android "+I]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,v],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[v,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[v,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[v,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,v],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],v],[/(wolvic|librewolf)\/([\w\.]+)/i],[h,v],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[v,[h,A+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[h,[v,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[h,[v,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[g,"amd64"]],[/(ia32(?=;))/i],[[g,K]],[/((?:i[346]|x)86)[;\)]/i],[[g,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[g,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[g,"armhf"]],[/windows (ce|mobile); ppc;/i],[[g,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[g,/ower/,"",K]],[/(sun4\w)[;\)]/i],[[g,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[g,K]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[f,x],[p,b]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[d,[f,x],[p,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[f,E],[p,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[f,E],[p,b]],[/(macintosh);/i],[d,[f,E]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[f,U],[p,y]],[/(?:honor)([-\w ]+)[;\)]/i],[d,[f,"Honor"],[p,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[f,L],[p,b]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[f,L],[p,y]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[d,/_/g," "],[f,j],[p,y]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[f,j],[p,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[f,"OPPO"],[p,y]],[/\b(opd2\d{3}a?) bui/i],[d,[f,"OPPO"],[p,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[f,"Vivo"],[p,y]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[f,"Realme"],[p,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[f,N],[p,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[f,N],[p,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[f,D],[p,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[f,D],[p,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[f,"Lenovo"],[p,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[f,"Nokia"],[p,y]],[/(pixel c)\b/i],[d,[f,R],[p,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[f,R],[p,y]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[f,F],[p,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[f,F],[p,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[f,"OnePlus"],[p,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[f,w],[p,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[f,w],[p,y]],[/(playbook);[-\w\),; ]+(rim)/i],[d,f,[p,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[f,C],[p,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[f,P],[p,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[f,P],[p,y]],[/(nexus 9)/i],[d,[f,"HTC"],[p,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[d,/_/g," "],[p,y]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[d,[f,"TCL"],[p,b]],[/(itel) ((\w+))/i],[[f,K],d,[p,Y,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[f,"Acer"],[p,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[f,"Meizu"],[p,y]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[f,"Ulefone"],[p,y]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[d,[f,"Energizer"],[p,y]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[d,[f,"Cat"],[p,y]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[d,[f,"Smartfren"],[p,y]],[/droid.+; (a(?:015|06[35]|142p?))/i],[d,[f,"Nothing"],[p,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,d,[p,y]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,d,[p,b]],[/(surface duo)/i],[d,[f,M],[p,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[f,"Fairphone"],[p,y]],[/(u304aa)/i],[d,[f,"AT&T"],[p,y]],[/\bsie-(\w*)/i],[d,[f,"Siemens"],[p,y]],[/\b(rct\w+) b/i],[d,[f,"RCA"],[p,b]],[/\b(venue[\d ]{2,7}) b/i],[d,[f,"Dell"],[p,b]],[/\b(q(?:mv|ta)\w+) b/i],[d,[f,"Verizon"],[p,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[f,"Barnes & Noble"],[p,b]],[/\b(tm\d{3}\w+) b/i],[d,[f,"NuVision"],[p,b]],[/\b(k88) b/i],[d,[f,"ZTE"],[p,b]],[/\b(nx\d{3}j) b/i],[d,[f,"ZTE"],[p,y]],[/\b(gen\d{3}) b.+49h/i],[d,[f,"Swiss"],[p,y]],[/\b(zur\d{3}) b/i],[d,[f,"Swiss"],[p,b]],[/\b((zeki)?tb.*\b) b/i],[d,[f,"Zeki"],[p,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],d,[p,b]],[/\b(ns-?\w{0,9}) b/i],[d,[f,"Insignia"],[p,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[f,"NextBook"],[p,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],d,[p,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],d,[p,y]],[/\b(ph-1) /i],[d,[f,"Essential"],[p,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[f,"Envizen"],[p,b]],[/\b(trio[-\w\. ]+) b/i],[d,[f,"MachSpeed"],[p,b]],[/\btu_(1491) b/i],[d,[f,"Rotor"],[p,b]],[/(shield[\w ]+) b/i],[d,[f,"Nvidia"],[p,b]],[/(sprint) (\w+)/i],[f,d,[p,y]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[f,M],[p,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[f,B],[p,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[f,B],[p,y]],[/smart-tv.+(samsung)/i],[f,[p,k]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[f,x],[p,k]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,D],[p,k]],[/(apple) ?tv/i],[f,[d,E+" TV"],[p,k]],[/crkey/i],[[d,_+"cast"],[f,R],[p,k]],[/droid.+aft(\w+)( bui|\))/i],[d,[f,w],[p,k]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[f,U],[p,k]],[/(bravia[\w ]+)( bui|\))/i],[d,[f,F],[p,k]],[/(mitv-\w{5}) bui/i],[d,[f,j],[p,k]],[/Hbbtv.*(technisat) (.*);/i],[f,d,[p,k]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,J],[d,J],[p,k]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,k]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,d,[p,m]],[/droid.+; (shield) bui/i],[d,[f,"Nvidia"],[p,m]],[/(playstation [345portablevi]+)/i],[d,[f,F],[p,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[f,M],[p,m]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[d,[f,x],[p,S]],[/((pebble))app/i],[f,d,[p,S]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[f,E],[p,S]],[/droid.+; (glass) \d/i],[d,[f,R],[p,S]],[/droid.+; (wt63?0{2,3})\)/i],[d,[f,B],[p,S]],[/droid.+; (glass) \d/i],[d,[f,R],[p,S]],[/(pico) (4|neo3(?: link|pro)?)/i],[f,d,[p,S]],[/; (quest( \d| pro)?)/i],[d,[f,G],[p,S]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[p,T]],[/(aeobc)\b/i],[d,[f,w],[p,T]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[p,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[p,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,y]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[v,[h,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[h,v],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[v,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,v],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[v,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,v],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[h,[v,Y,$]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,Y,$],[h,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[v,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,z],[v,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[v,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,v],[/\(bb(10);/i],[v,[h,C]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[v,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[v,[h,A+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[v,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[v,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[v,[h,_+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,V],v],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,v],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],v],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,v]]},Z=function(e,t){if(typeof e===l&&(t=e,e=s),!(this instanceof Z))return new Z(e,t).getResult();var i=typeof r!==o&&r.navigator?r.navigator:s,n=e||(i&&i.userAgent?i.userAgent:""),m=i&&i.userAgentData?i.userAgentData:s,k=t?function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2===0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i}(X,t):X,S=i&&i.userAgent==n;return this.getBrowser=function(){var e,t={};return t[h]=s,t[v]=s,Q.call(t,n,k.browser),t[u]=typeof(e=t[v])===c?e.replace(/[^\d\.]/g,"").split(".")[0]:s,S&&i&&i.brave&&typeof i.brave.isBrave==a&&(t[h]="Brave"),t},this.getCPU=function(){var e={};return e[g]=s,Q.call(e,n,k.cpu),e},this.getDevice=function(){var e={};return e[f]=s,e[d]=s,e[p]=s,Q.call(e,n,k.device),S&&!e[p]&&m&&m.mobile&&(e[p]=y),S&&"Macintosh"==e[d]&&i&&typeof i.standalone!==o&&i.maxTouchPoints&&i.maxTouchPoints>2&&(e[d]="iPad",e[p]=b),e},this.getEngine=function(){var e={};return e[h]=s,e[v]=s,Q.call(e,n,k.engine),e},this.getOS=function(){var e={};return e[h]=s,e[v]=s,Q.call(e,n,k.os),S&&!e[h]&&m&&m.platform&&"Unknown"!=m.platform&&(e[h]=m.platform.replace(/chrome os/i,V).replace(/macos/i,z)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=typeof e===c&&e.length>500?J(e,500):e,this},this.setUA(n),this};Z.VERSION="1.0.40",Z.BROWSER=H([h,v,u]),Z.CPU=H([g]),Z.DEVICE=H([d,f,p,m,y,k,b,S,T]),Z.ENGINE=Z.OS=H([h,v]),typeof t!==o?(e.exports&&(t=e.exports=Z),t.UAParser=Z):i.amdO?(n=function(){return Z}.call(t,i,t,e))===s||(e.exports=n):typeof r!==o&&(r.UAParser=Z);var ee=typeof r!==o&&(r.jQuery||r.Zepto);if(ee&&!ee.ua){var te=new Z;ee.ua=te.getResult(),ee.ua.get=function(){return te.getUA()},ee.ua.set=function(e){te.setUA(e);var t=te.getResult();for(var i in t)ee.ua[i]=t[i]}}}("object"===typeof window?window:this)},153:(e,t,i)=>{"use strict";var n=i(43),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var n,s={},c=null,u=null;for(n in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,n)&&!l.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===s[n]&&(s[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:u,props:s,_owner:o.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},202:(e,t)=>{"use strict";var i=Symbol.for("react.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,g={};function m(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}function y(){}function b(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=m.prototype;var k=b.prototype=new y;k.constructor=b,v(k,m.prototype),k.isPureReactComponent=!0;var S=Array.isArray,T=Object.prototype.hasOwnProperty,w={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function P(e,t,n){var r,s={},a=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)T.call(t,r)&&!E.hasOwnProperty(r)&&(s[r]=t[r]);var l=arguments.length-2;if(1===l)s.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:i,type:e,key:a,ref:o,props:s,_owner:w.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var I=/\/+/g;function _(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function A(e,t,r,s,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case n:l=!0}}if(l)return a=a(l=e),e=""===s?"."+_(l,0):s,S(a)?(r="",null!=e&&(r=e.replace(I,"$&/")+"/"),A(a,t,r,"",function(e){return e})):null!=a&&(C(a)&&(a=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(I,"$&/")+"/")+e)),t.push(a)),1;if(l=0,s=""===s?".":s+":",S(e))for(var c=0;c<e.length;c++){var u=s+_(o=e[c],c);l+=A(o,t,r,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=A(o=o.value,t,r,u=s+_(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function R(e,t,i){if(null==e)return e;var n=[],r=0;return A(e,n,"","",function(e){return t.call(i,e,r++)}),n}function L(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},M={transition:null},N={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:M,ReactCurrentOwner:w};function O(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:R,forEach:function(e,t,i){R(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return R(e,function(){t++}),t},toArray:function(e){return R(e,function(e){return e})||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=m,t.Fragment=r,t.Profiler=a,t.PureComponent=b,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N,t.act=O,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=v({},e.props),s=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=w.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)T.call(t,c)&&!E.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:i,type:e.type,key:s,ref:a,props:r,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=P,t.createFactory=function(e){var t=P.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:L}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},t.unstable_act=O,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,i){return D.current.useImperativeHandle(e,t,i)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,i){return D.current.useReducer(e,t,i)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,i){return D.current.useSyncExternalStore(e,t,i)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},234:(e,t)=>{"use strict";function i(e,t){var i=e.length;e.push(t);e:for(;0<i;){var n=i-1>>>1,r=e[n];if(!(0<s(r,t)))break e;e[n]=t,e[i]=r,i=n}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;e:for(var n=0,r=e.length,a=r>>>1;n<a;){var o=2*(n+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,i))c<r&&0>s(u,l)?(e[n]=u,e[c]=i,n=c):(e[n]=l,e[o]=i,n=o);else{if(!(c<r&&0>s(u,i)))break e;e[n]=u,e[c]=i,n=c}}}return t}function s(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,p=3,f=!1,v=!1,g=!1,m="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function k(e){for(var t=n(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,i(c,t)}t=n(u)}}function S(e){if(g=!1,k(e),!v)if(null!==n(c))v=!0,M(T);else{var t=n(u);null!==t&&N(S,t.startTime-e)}}function T(e,i){v=!1,g&&(g=!1,y(C),C=-1),f=!0;var s=p;try{for(k(i),h=n(c);null!==h&&(!(h.expirationTime>i)||e&&!A());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var o=a(h.expirationTime<=i);i=t.unstable_now(),"function"===typeof o?h.callback=o:h===n(c)&&r(c),k(i)}else r(c);h=n(c)}if(null!==h)var l=!0;else{var d=n(u);null!==d&&N(S,d.startTime-i),l=!1}return l}finally{h=null,p=s,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,E=!1,P=null,C=-1,I=5,_=-1;function A(){return!(t.unstable_now()-_<I)}function R(){if(null!==P){var e=t.unstable_now();_=e;var i=!0;try{i=P(!0,e)}finally{i?w():(E=!1,P=null)}}else E=!1}if("function"===typeof b)w=function(){b(R)};else if("undefined"!==typeof MessageChannel){var L=new MessageChannel,D=L.port2;L.port1.onmessage=R,w=function(){D.postMessage(null)}}else w=function(){m(R,0)};function M(e){P=e,E||(E=!0,w())}function N(e,i){C=m(function(){e(t.unstable_now())},i)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||f||(v=!0,M(T))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var i=p;p=t;try{return e()}finally{p=i}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=p;p=e;try{return t()}finally{p=i}},t.unstable_scheduleCallback=function(e,r,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,i(u,e),null===n(c)&&e===n(u)&&(g?(y(C),C=-1):g=!0,N(S,s-a))):(e.sortIndex=o,i(c,e),v||f||(v=!0,M(T))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=p;return function(){var i=p;p=t;try{return e.apply(this,arguments)}finally{p=i}}}},321:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach(function(e){t[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},391:(e,t,i)=>{"use strict";var n=i(950);t.H=n.createRoot,n.hydrateRoot},476:(e,t,i)=>{var n;!function(r){var s=Object.hasOwnProperty,a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o="object"==typeof process&&"function"==typeof process.nextTick,l="function"===typeof Symbol,c="object"===typeof Reflect,u="function"===typeof setImmediate?setImmediate:setTimeout,d=l?c&&"function"===typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function h(){this._events={},this._conf&&p.call(this,this._conf)}function p(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==r&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function f(e,t){var i="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(i+=" Event name: "+t+"."),"undefined"!==typeof process&&process.emitWarning){var n=new Error(i);n.name="MaxListenersExceededWarning",n.emitter=this,n.count=e,process.emitWarning(n)}else console.error(i),console.trace&&console.trace()}var v=function(e,t,i){var n=arguments.length;switch(n){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,i];default:for(var r=new Array(n);n--;)r[n]=arguments[n];return r}};function g(e,t){for(var i={},n=e.length,s=t?t.length:0,a=0;a<n;a++)i[e[a]]=a<s?t[a]:r;return i}function m(e,t,i){var n,r;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(i.on||i.off)&&(n=i.on,r=i.off),t.addEventListener?(n=t.addEventListener,r=t.removeEventListener):t.addListener?(n=t.addListener,r=t.removeListener):t.on&&(n=t.on,r=t.off),!n&&!r)throw Error("target does not implement any known event API");if("function"!==typeof n)throw TypeError("on method must be a function");if("function"!==typeof r)throw TypeError("off method must be a function");this._on=n,this._off=r;var s=e._observers;s?s.push(this):e._observers=[this]}function y(e,t,i,n){var a=Object.assign({},t);if(!e)return a;if("object"!==typeof e)throw TypeError("options must be an object");var o,l,c,u=Object.keys(e),d=u.length;function h(e){throw Error('Invalid "'+o+'" option value'+(e?". Reason: "+e:""))}for(var p=0;p<d;p++){if(o=u[p],!n&&!s.call(t,o))throw Error('Unknown "'+o+'" option');(l=e[o])!==r&&(c=i[o],a[o]=c?c(l,h):l)}return a}function b(e,t){return"function"===typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function k(e){var t="value must be type of "+e.join("|"),i=e.length,n=e[0],r=e[1];return 1===i?function(e,i){if(typeof e===n)return e;i(t)}:2===i?function(e,i){var s=typeof e;if(s===n||s===r)return e;i(t)}:function(n,r){for(var s=typeof n,a=i;a-- >0;)if(s===e[a])return n;r(t)}}Object.assign(m.prototype,{subscribe:function(e,t,i){var n=this,r=this._target,s=this._emitter,a=this._listeners,o=function(){var n=v.apply(null,arguments),a={data:n,name:t,original:e};i?!1!==i.call(r,a)&&s.emit.apply(s,[a.name].concat(n)):s.emit.apply(s,[t].concat(n))};if(a[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,s._newListener&&s._removeListener&&!n._onNewListener?(this._onNewListener=function(i){i===t&&null===a[e]&&(a[e]=o,n._on.call(r,e,o))},s.on("newListener",this._onNewListener),this._onRemoveListener=function(i){i===t&&!s.hasListeners(i)&&a[e]&&(a[e]=null,n._off.call(r,e,o))},a[e]=null,s.on("removeListener",this._onRemoveListener)):(a[e]=o,n._on.call(r,e,o))},unsubscribe:function(e){var t,i,n,r=this,s=this._listeners,a=this._emitter,o=this._off,l=this._target;if(e&&"string"!==typeof e)throw TypeError("event must be a string");function c(){r._onNewListener&&(a.off("newListener",r._onNewListener),a.off("removeListener",r._onRemoveListener),r._onNewListener=null,r._onRemoveListener=null);var e=E.call(a,r);a._observers.splice(e,1)}if(e){if(!(t=s[e]))return;o.call(l,e,t),delete s[e],--this._listenersCount||c()}else{for(n=(i=d(s)).length;n-- >0;)e=i[n],o.call(l,e,s[e]);this._listeners={},this._listenersCount=0,c()}}});var S=k(["function"]),T=k(["object","function"]);function w(e,t,i){var n,r,s,a=0,o=new e(function(l,c,u){function d(){r&&(r=null),a&&(clearTimeout(a),a=0)}i=y(i,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!==typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),n=!i.overload&&"function"===typeof e.prototype.cancel&&"function"===typeof u;var h=function(e){d(),l(e)},p=function(e){d(),c(e)};n?t(h,p,u):(r=[function(e){p(e||Error("canceled"))}],t(h,p,function(e){if(s)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!==typeof e)throw TypeError("onCancel callback must be a function");r.push(e)}),s=!0),i.timeout>0&&(a=setTimeout(function(){var e=Error("timeout");e.code="ETIMEDOUT",a=0,o.cancel(e),c(e)},i.timeout))});return n||(o.cancel=function(e){if(r){for(var t=r.length,i=1;i<t;i++)r[i](e);r[0](e),r=null}}),o}function E(e){var t=this._observers;if(!t)return-1;for(var i=t.length,n=0;n<i;n++)if(t[n]._target===e)return n;return-1}function P(e,t,i,n,r){if(!i)return null;if(0===n){var s=typeof t;if("string"===s){var a,o,l=0,c=0,u=this.delimiter,h=u.length;if(-1!==(o=t.indexOf(u))){a=new Array(5);do{a[l++]=t.slice(c,o),c=o+h}while(-1!==(o=t.indexOf(u,c)));a[l++]=t.slice(c),t=a,r=l}else t=[t],r=1}else"object"===s?r=t.length:(t=[t],r=1)}var p,f,v,g,m,y,b,k=null,S=t[n],T=t[n+1];if(n===r)i._listeners&&("function"===typeof i._listeners?(e&&e.push(i._listeners),k=[i]):(e&&e.push.apply(e,i._listeners),k=[i]));else{if("*"===S){for(o=(y=d(i)).length;o-- >0;)"_listeners"!==(p=y[o])&&(b=P(e,t,i[p],n+1,r))&&(k?k.push.apply(k,b):k=b);return k}if("**"===S){for((m=n+1===r||n+2===r&&"*"===T)&&i._listeners&&(k=P(e,t,i,r,r)),o=(y=d(i)).length;o-- >0;)"_listeners"!==(p=y[o])&&("*"===p||"**"===p?(i[p]._listeners&&!m&&(b=P(e,t,i[p],r,r))&&(k?k.push.apply(k,b):k=b),b=P(e,t,i[p],n,r)):b=P(e,t,i[p],p===T?n+2:n,r),b&&(k?k.push.apply(k,b):k=b));return k}i[S]&&(k=P(e,t,i[S],n+1,r))}if((f=i["*"])&&P(e,t,f,n+1,r),v=i["**"])if(n<r)for(v._listeners&&P(e,t,v,r,r),o=(y=d(v)).length;o-- >0;)"_listeners"!==(p=y[o])&&(p===T?P(e,t,v[p],n+2,r):p===S?P(e,t,v[p],n+1,r):((g={})[p]=v[p],P(e,t,{"**":g},n+1,r)));else v._listeners?P(e,t,v,r,r):v["*"]&&v["*"]._listeners&&P(e,t,v["*"],r,r);return k}function C(e,t,i){var n,r,s=0,a=0,o=this.delimiter,l=o.length;if("string"===typeof e)if(-1!==(n=e.indexOf(o))){r=new Array(5);do{r[s++]=e.slice(a,n),a=n+l}while(-1!==(n=e.indexOf(o,a)));r[s++]=e.slice(a)}else r=[e],s=1;else r=e,s=e.length;if(s>1)for(n=0;n+1<s;n++)if("**"===r[n]&&"**"===r[n+1])return;var c,u=this.listenerTree;for(n=0;n<s;n++)if(u=u[c=r[n]]||(u[c]={}),n===s-1)return u._listeners?("function"===typeof u._listeners&&(u._listeners=[u._listeners]),i?u._listeners.unshift(t):u._listeners.push(t),!u._listeners.warned&&this._maxListeners>0&&u._listeners.length>this._maxListeners&&(u._listeners.warned=!0,f.call(this,u._listeners.length,c))):u._listeners=t,!0;return!0}function I(e,t,i,n){for(var r,s,a,o,l=d(e),c=l.length,u=e._listeners;c-- >0;)r=e[s=l[c]],a="_listeners"===s?i:i?i.concat(s):[s],o=n||"symbol"===typeof s,u&&t.push(o?a:a.join(this.delimiter)),"object"===typeof r&&I.call(this,r,t,a,o);return t}function _(e){for(var t,i,n,r=d(e),s=r.length;s-- >0;)(t=e[i=r[s]])&&(n=!0,"_listeners"===i||_(t)||delete e[i]);return n}function A(e,t,i){this.emitter=e,this.event=t,this.listener=i}function R(e,t,i){if(!0===i)s=!0;else if(!1===i)n=!0;else{if(!i||"object"!==typeof i)throw TypeError("options should be an object or true");var n=i.async,s=i.promisify,a=i.nextTick,l=i.objectify}if(n||a||s){var c=t,d=t._origin||t;if(a&&!o)throw Error("process.nextTick is not supported");s===r&&(s="AsyncFunction"===t.constructor.name),t=function(){var e=arguments,t=this,i=this.event;return s?a?Promise.resolve():new Promise(function(e){u(e)}).then(function(){return t.event=i,c.apply(t,e)}):(a?process.nextTick:u)(function(){t.event=i,c.apply(t,e)})},t._async=!0,t._origin=d}return[t,l?new A(this,e,t):this]}function L(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,p.call(this,e)}A.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},L.EventEmitter2=L,L.prototype.listenTo=function(e,t,i){if("object"!==typeof e)throw TypeError("target musts be an object");var n=this;function s(t){if("object"!==typeof t)throw TypeError("events must be an object");var r,s=i.reducers,a=E.call(n,e);r=-1===a?new m(n,e,i):n._observers[a];for(var o,l=d(t),c=l.length,u="function"===typeof s,h=0;h<c;h++)o=l[h],r.subscribe(o,t[o]||o,u?s:s&&s[o])}return i=y(i,{on:r,off:r,reducers:r},{on:S,off:S,reducers:T}),a(t)?s(g(t)):s("string"===typeof t?g(t.split(/\s+/)):t),this},L.prototype.stopListeningTo=function(e,t){var i=this._observers;if(!i)return!1;var n,r=i.length,s=!1;if(e&&"object"!==typeof e)throw TypeError("target should be an object");for(;r-- >0;)n=i[r],e&&n._target!==e||(n.unsubscribe(t),s=!0);return s},L.prototype.delimiter=".",L.prototype.setMaxListeners=function(e){e!==r&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},L.prototype.getMaxListeners=function(){return this._maxListeners},L.prototype.event="",L.prototype.once=function(e,t,i){return this._once(e,t,!1,i)},L.prototype.prependOnceListener=function(e,t,i){return this._once(e,t,!0,i)},L.prototype._once=function(e,t,i,n){return this._many(e,1,t,i,n)},L.prototype.many=function(e,t,i,n){return this._many(e,t,i,!1,n)},L.prototype.prependMany=function(e,t,i,n){return this._many(e,t,i,!0,n)},L.prototype._many=function(e,t,i,n,r){var s=this;if("function"!==typeof i)throw new Error("many only accepts instances of Function");function a(){return 0===--t&&s.off(e,a),i.apply(this,arguments)}return a._origin=i,this._on(e,a,n,r)},L.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,i,n,r,s,a=arguments[0],o=this.wildcard;if("newListener"===a&&!this._newListener&&!this._events.newListener)return!1;if(o&&(e=a,"newListener"!==a&&"removeListener"!==a&&"object"===typeof a)){if(i=a.length,l)for(n=0;n<i;n++)if("symbol"===typeof a[n]){s=!0;break}s||(a=a.join(this.delimiter))}var c,u=arguments.length;if(this._all&&this._all.length)for(n=0,i=(c=this._all.slice()).length;n<i;n++)switch(this.event=a,u){case 1:c[n].call(this,a);break;case 2:c[n].call(this,a,arguments[1]);break;case 3:c[n].call(this,a,arguments[1],arguments[2]);break;default:c[n].apply(this,arguments)}if(o)c=[],P.call(this,c,e,this.listenerTree,0,i);else{if("function"===typeof(c=this._events[a])){switch(this.event=a,u){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(u-1),r=1;r<u;r++)t[r-1]=arguments[r];c.apply(this,t)}return!0}c&&(c=c.slice())}if(c&&c.length){if(u>3)for(t=new Array(u-1),r=1;r<u;r++)t[r-1]=arguments[r];for(n=0,i=c.length;n<i;n++)switch(this.event=a,u){case 1:c[n].call(this);break;case 2:c[n].call(this,arguments[1]);break;case 3:c[n].call(this,arguments[1],arguments[2]);break;default:c[n].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===a)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},L.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,i,n,r,s,a=arguments[0],o=this.wildcard;if("newListener"===a&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(o&&(e=a,"newListener"!==a&&"removeListener"!==a&&"object"===typeof a)){if(n=a.length,l)for(r=0;r<n;r++)if("symbol"===typeof a[r]){t=!0;break}t||(a=a.join(this.delimiter))}var c,u=[],d=arguments.length;if(this._all)for(r=0,n=this._all.length;r<n;r++)switch(this.event=a,d){case 1:u.push(this._all[r].call(this,a));break;case 2:u.push(this._all[r].call(this,a,arguments[1]));break;case 3:u.push(this._all[r].call(this,a,arguments[1],arguments[2]));break;default:u.push(this._all[r].apply(this,arguments))}if(o?(c=[],P.call(this,c,e,this.listenerTree,0)):c=this._events[a],"function"===typeof c)switch(this.event=a,d){case 1:u.push(c.call(this));break;case 2:u.push(c.call(this,arguments[1]));break;case 3:u.push(c.call(this,arguments[1],arguments[2]));break;default:for(i=new Array(d-1),s=1;s<d;s++)i[s-1]=arguments[s];u.push(c.apply(this,i))}else if(c&&c.length){if(c=c.slice(),d>3)for(i=new Array(d-1),s=1;s<d;s++)i[s-1]=arguments[s];for(r=0,n=c.length;r<n;r++)switch(this.event=a,d){case 1:u.push(c[r].call(this));break;case 2:u.push(c[r].call(this,arguments[1]));break;case 3:u.push(c[r].call(this,arguments[1],arguments[2]));break;default:u.push(c[r].apply(this,i))}}else if(!this.ignoreErrors&&!this._all&&"error"===a)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(u)},L.prototype.on=function(e,t,i){return this._on(e,t,!1,i)},L.prototype.prependListener=function(e,t,i){return this._on(e,t,!0,i)},L.prototype.onAny=function(e){return this._onAny(e,!1)},L.prototype.prependAny=function(e){return this._onAny(e,!0)},L.prototype.addListener=L.prototype.on,L.prototype._onAny=function(e,t){if("function"!==typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},L.prototype._on=function(e,t,i,n){if("function"===typeof e)return this._onAny(e,t),this;if("function"!==typeof t)throw new Error("on only accepts instances of Function");this._events||h.call(this);var s,a=this;return n!==r&&(t=(s=R.call(this,e,t,n))[0],a=s[1]),this._newListener&&this.emit("newListener",e,t),this.wildcard?(C.call(this,e,t,i),a):(this._events[e]?("function"===typeof this._events[e]&&(this._events[e]=[this._events[e]]),i?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,f.call(this,this._events[e].length,e))):this._events[e]=t,a)},L.prototype.off=function(e,t){if("function"!==typeof t)throw new Error("removeListener only takes instances of Function");var i,n=[];if(this.wildcard){var r="string"===typeof e?e.split(this.delimiter):e.slice();if(!(n=P.call(this,null,r,this.listenerTree,0)))return this}else{if(!this._events[e])return this;i=this._events[e],n.push({_listeners:i})}for(var s=0;s<n.length;s++){var o=n[s];if(i=o._listeners,a(i)){for(var l=-1,c=0,u=i.length;c<u;c++)if(i[c]===t||i[c].listener&&i[c].listener===t||i[c]._origin&&i[c]._origin===t){l=c;break}if(l<0)continue;return this.wildcard?o._listeners.splice(l,1):this._events[e].splice(l,1),0===i.length&&(this.wildcard?delete o._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(i===t||i.listener&&i.listener===t||i._origin&&i._origin===t)&&(this.wildcard?delete o._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&_(this.listenerTree),this},L.prototype.offAny=function(e){var t,i=0,n=0;if(e&&this._all&&this._all.length>0){for(i=0,n=(t=this._all).length;i<n;i++)if(e===t[i])return t.splice(i,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(i=0,n=t.length;i<n;i++)this.emit("removeListenerAny",t[i]);this._all=[]}return this},L.prototype.removeListener=L.prototype.off,L.prototype.removeAllListeners=function(e){if(e===r)return!this._events||h.call(this),this;if(this.wildcard){var t,i=P.call(this,null,e,this.listenerTree,0);if(!i)return this;for(t=0;t<i.length;t++)i[t]._listeners=null;this.listenerTree&&_(this.listenerTree)}else this._events&&(this._events[e]=null);return this},L.prototype.listeners=function(e){var t,i,n,s,a,o=this._events;if(e===r){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!o)return[];for(s=(t=d(o)).length,n=[];s-- >0;)"function"===typeof(i=o[t[s]])?n.push(i):n.push.apply(n,i);return n}if(this.wildcard){if(!(a=this.listenerTree))return[];var l=[],c="string"===typeof e?e.split(this.delimiter):e.slice();return P.call(this,l,c,a,0),l}return o&&(i=o[e])?"function"===typeof i?[i]:i:[]},L.prototype.eventNames=function(e){var t=this._events;return this.wildcard?I.call(this,this.listenerTree,[],null,e):t?d(t):[]},L.prototype.listenerCount=function(e){return this.listeners(e).length},L.prototype.hasListeners=function(e){if(this.wildcard){var t=[],i="string"===typeof e?e.split(this.delimiter):e.slice();return P.call(this,t,i,this.listenerTree,0),t.length>0}var n=this._events,s=this._all;return!!(s&&s.length||n&&(e===r?d(n).length:n[e]))},L.prototype.listenersAny=function(){return this._all?this._all:[]},L.prototype.waitFor=function(e,t){var i=this,n=typeof t;return"number"===n?t={timeout:t}:"function"===n&&(t={filter:t}),w((t=y(t,{timeout:0,filter:r,handleError:!1,Promise:Promise,overload:!1},{filter:S,Promise:b})).Promise,function(n,r,s){function a(){var s=t.filter;if(!s||s.apply(i,arguments))if(i.off(e,a),t.handleError){var o=arguments[0];o?r(o):n(v.apply(null,arguments).slice(1))}else n(v.apply(null,arguments))}s(function(){i.off(e,a)}),i._on(e,a,!1)},{timeout:t.timeout,overload:t.overload})};var D=L.prototype;Object.defineProperties(L,{defaultMaxListeners:{get:function(){return D._maxListeners},set:function(e){if("number"!==typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");D._maxListeners=e},enumerable:!0},once:{value:function(e,t,i){return w((i=y(i,{Promise:Promise,timeout:0,overload:!1},{Promise:b})).Promise,function(i,n,r){var s;if("function"===typeof e.addEventListener)return s=function(){i(v.apply(null,arguments))},r(function(){e.removeEventListener(t,s)}),void e.addEventListener(t,s,{once:!0});var a,o=function(){a&&e.removeListener("error",a),i(v.apply(null,arguments))};"error"!==t&&(a=function(i){e.removeListener(t,o),n(i)},e.once("error",a)),r(function(){a&&e.removeListener("error",a),e.removeListener(t,o)}),e.once(t,o)},{timeout:i.timeout,overload:i.overload})},writable:!0,configurable:!0}}),Object.defineProperties(D,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),(n=function(){return L}.call(t,i,t,e))===r||(e.exports=n)}()},579:(e,t,i)=>{"use strict";e.exports=i(153)},605:(e,t,i)=>{var n=i(321),r=/%[sdv%]/g,s=function(e){var t=1,i=arguments,n=i.length;return e.replace(r,function(e){if(t>=n)return e;var r=i[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},a=function(e,t,i){var n=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var a=t.names[r];t.name?n.push(i[t.name][a]):n.push(i[t.names[r]])}else n.push(i[t.name]);return s.apply(null,n)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var i=t.outerOrder||o,r=t.innerOrder||l,s=[];return i.forEach(function(t){n[t].forEach(function(i){i.name in e&&null!=e[i.name]?s.push(a(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach(function(e){s.push(a(t,i,e))})})}),e.media.forEach(function(e){s.push(a("m",n.m[0],e)),r.forEach(function(t){n[t].forEach(function(i){i.name in e&&null!=e[i.name]?s.push(a(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach(function(e){s.push(a(t,i,e))})})})}),s.join("\r\n")+"\r\n"}},640:(e,t,i)=>{var n=i(877),r=i(605);i(321),t.M9=r,t.qg=n.parse,n.parseParams,n.parseFmtpConfig,n.parsePayloads,n.parseRemoteCandidates,n.parseImageAttributes,n.parseSimulcastStreamList},730:(e,t,i)=>{"use strict";var n=i(43),r=i(853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function v(e,t,i,n,r,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new v(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new v(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new v(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new v(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new v(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new v(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)});var m=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,i,n){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,i,n){if(null===t||"undefined"===typeof t||function(e,t,i,n){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,n))return!0;if(n)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,r,n)&&(i=null),n||null===r?function(e){return!!d.call(f,e)||!d.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):r.mustUseProperty?e[r.propertyName]=null===i?3!==r.type&&"":i:(t=r.attributeName,n=r.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(r=r.type)||4===r&&!0===i?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(m,y);g[t]=new v(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(m,y);g[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(m,y);g[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)});var k=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,S=Symbol.for("react.element"),T=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),I=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var M=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var N=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=N&&e[N]||e["@@iterator"])?e:null}var x,U=Object.assign;function F(e){if(void 0===x)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);x=t&&t[1]||""}return"\n"+x+e}var j=!1;function B(e,t){if(!e||j)return"";j=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var n=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){n=c}e.call(t.prototype)}else{try{throw Error()}catch(c){n=c}e()}}catch(c){if(c&&n&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),s=n.stack.split("\n"),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==s[o]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{j=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?F(e):""}function G(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case w:return"Fragment";case T:return"Portal";case P:return"Profiler";case E:return"StrictMode";case A:return"Suspense";case R:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case _:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case L:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return V(e(t))}catch(i){}}return null}function z(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof i&&"function"===typeof i.get&&"function"===typeof i.set){var r=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=H(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function J(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var i=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function Y(e,t){var i=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;i=W(null!=t.value?t.value:i),e._wrapperState={initialChecked:n,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function X(e,t){$(e,t);var i=W(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,i):t.hasOwnProperty("defaultValue")&&ee(e,t.type,W(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function ee(e,t,i){"number"===t&&J(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var te=Array.isArray;function ie(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(i=""+W(i),t=null,r=0;r<e.length;r++){if(e[r].value===i)return e[r].selected=!0,void(n&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(s(92));if(te(i)){if(1<i.length)throw Error(s(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:W(i)}}function se(e,t){var i=W(t.value),n=W(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=n&&(e.defaultValue=""+n)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,n){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function ve(e,t,i){return null==t||"boolean"===typeof t||""===t?"":i||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var n=0===i.indexOf("--"),r=ve(i,t[i],n);"float"===i&&(i="cssFloat"),n?e.setProperty(i,r):e[i]=r}}Object.keys(pe).forEach(function(e){fe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var me=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(me[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ke=null;function Se(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Te=null,we=null,Ee=null;function Pe(e){if(e=br(e)){if("function"!==typeof Te)throw Error(s(280));var t=e.stateNode;t&&(t=Sr(t),Te(e.stateNode,e.type,t))}}function Ce(e){we?Ee?Ee.push(e):Ee=[e]:we=e}function Ie(){if(we){var e=we,t=Ee;if(Ee=we=null,Pe(e),t)for(e=0;e<t.length;e++)Pe(t[e])}}function _e(e,t){return e(t)}function Ae(){}var Re=!1;function Le(e,t,i){if(Re)return e(t,i);Re=!0;try{return _e(e,t,i)}finally{Re=!1,(null!==we||null!==Ee)&&(Ae(),Ie())}}function De(e,t){var i=e.stateNode;if(null===i)return null;var n=Sr(i);if(null===n)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(i&&"function"!==typeof i)throw Error(s(231,t,typeof i));return i}var Me=!1;if(u)try{var Ne={};Object.defineProperty(Ne,"passive",{get:function(){Me=!0}}),window.addEventListener("test",Ne,Ne),window.removeEventListener("test",Ne,Ne)}catch(ue){Me=!1}function Oe(e,t,i,n,r,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(u){this.onError(u)}}var xe=!1,Ue=null,Fe=!1,je=null,Be={onError:function(e){xe=!0,Ue=e}};function Ge(e,t,i,n,r,s,a,o,l){xe=!1,Ue=null,Oe.apply(Be,arguments)}function Ve(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function ze(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(Ve(e)!==e)throw Error(s(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(s(188));return t!==e?null:e}for(var i=e,n=t;;){var r=i.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(n=r.return)){i=n;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===i)return We(r),e;if(a===n)return We(r),t;a=a.sibling}throw Error(s(188))}if(i.return!==n.return)i=r,n=a;else{for(var o=!1,l=r.child;l;){if(l===i){o=!0,i=r,n=a;break}if(l===n){o=!0,n=r,i=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===i){o=!0,i=a,n=r;break}if(l===n){o=!0,n=a,i=r;break}l=l.sibling}if(!o)throw Error(s(189))}}if(i.alternate!==n)throw Error(s(190))}if(3!==i.tag)throw Error(s(188));return i.stateNode.current===i?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Ke=r.unstable_scheduleCallback,Je=r.unstable_cancelCallback,Qe=r.unstable_shouldYield,Ye=r.unstable_requestPaint,$e=r.unstable_now,Xe=r.unstable_getCurrentPriorityLevel,Ze=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,it=r.unstable_LowPriority,nt=r.unstable_IdlePriority,rt=null,st=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var i=e.pendingLanes;if(0===i)return 0;var n=0,r=e.suspendedLanes,s=e.pingedLanes,a=268435455&i;if(0!==a){var o=a&~r;0!==o?n=dt(o):0!==(s&=a)&&(n=dt(s))}else 0!==(a=i&~r)?n=dt(a):0!==s&&(n=dt(s));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&r)&&((r=n&-n)>=(s=t&-t)||16===r&&0!==(4194240&s)))return t;if(0!==(4&n)&&(n|=16&i),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)r=1<<(i=31-at(t)),n|=e[i],t&=~r;return n}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function mt(e,t,i){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=i}function yt(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-at(i),r=1<<n;r&t|e[n]&t&&(e[n]|=t),i&=~r}}var bt=0;function kt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var St,Tt,wt,Et,Pt,Ct=!1,It=[],_t=null,At=null,Rt=null,Lt=new Map,Dt=new Map,Mt=[],Nt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":_t=null;break;case"dragenter":case"dragleave":At=null;break;case"mouseover":case"mouseout":Rt=null;break;case"pointerover":case"pointerout":Lt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function xt(e,t,i,n,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=br(t))&&Tt(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ut(e){var t=yr(e.target);if(null!==t){var i=Ve(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=ze(i)))return e.blockedOn=t,void Pt(e.priority,function(){wt(i)})}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=br(i))&&Tt(t),e.blockedOn=i,!1;var n=new(i=e.nativeEvent).constructor(i.type,i);ke=n,i.target.dispatchEvent(n),ke=null,t.shift()}return!0}function jt(e,t,i){Ft(e)&&i.delete(t)}function Bt(){Ct=!1,null!==_t&&Ft(_t)&&(_t=null),null!==At&&Ft(At)&&(At=null),null!==Rt&&Ft(Rt)&&(Rt=null),Lt.forEach(jt),Dt.forEach(jt)}function Gt(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Bt)))}function Vt(e){function t(t){return Gt(t,e)}if(0<It.length){Gt(It[0],e);for(var i=1;i<It.length;i++){var n=It[i];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==_t&&Gt(_t,e),null!==At&&Gt(At,e),null!==Rt&&Gt(Rt,e),Lt.forEach(t),Dt.forEach(t),i=0;i<Mt.length;i++)(n=Mt[i]).blockedOn===e&&(n.blockedOn=null);for(;0<Mt.length&&null===(i=Mt[0]).blockedOn;)Ut(i),null===i.blockedOn&&Mt.shift()}var zt=k.ReactCurrentBatchConfig,Wt=!0;function Ht(e,t,i,n){var r=bt,s=zt.transition;zt.transition=null;try{bt=1,Kt(e,t,i,n)}finally{bt=r,zt.transition=s}}function qt(e,t,i,n){var r=bt,s=zt.transition;zt.transition=null;try{bt=4,Kt(e,t,i,n)}finally{bt=r,zt.transition=s}}function Kt(e,t,i,n){if(Wt){var r=Qt(e,t,i,n);if(null===r)Wn(e,t,n,Jt,i),Ot(e,n);else if(function(e,t,i,n,r){switch(t){case"focusin":return _t=xt(_t,e,t,i,n,r),!0;case"dragenter":return At=xt(At,e,t,i,n,r),!0;case"mouseover":return Rt=xt(Rt,e,t,i,n,r),!0;case"pointerover":var s=r.pointerId;return Lt.set(s,xt(Lt.get(s)||null,e,t,i,n,r)),!0;case"gotpointercapture":return s=r.pointerId,Dt.set(s,xt(Dt.get(s)||null,e,t,i,n,r)),!0}return!1}(r,e,t,i,n))n.stopPropagation();else if(Ot(e,n),4&t&&-1<Nt.indexOf(e)){for(;null!==r;){var s=br(r);if(null!==s&&St(s),null===(s=Qt(e,t,i,n))&&Wn(e,t,n,Jt,i),s===r)break;r=s}null!==r&&n.stopPropagation()}else Wn(e,t,n,null,i)}}var Jt=null;function Qt(e,t,i,n){if(Jt=null,null!==(e=yr(e=Se(n))))if(null===(t=Ve(e)))e=null;else if(13===(i=t.tag)){if(null!==(e=ze(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Jt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case it:return 16;case nt:return 536870912;default:return 16}default:return 16}}var $t=null,Xt=null,Zt=null;function ei(){if(Zt)return Zt;var e,t,i=Xt,n=i.length,r="value"in $t?$t.value:$t.textContent,s=r.length;for(e=0;e<n&&i[e]===r[e];e++);var a=n-e;for(t=1;t<=a&&i[n-t]===r[s-t];t++);return Zt=r.slice(e,1<t?1-t:void 0)}function ti(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ii(){return!0}function ni(){return!1}function ri(e){function t(t,i,n,r,s){for(var a in this._reactName=t,this._targetInst=n,this.type=i,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?ii:ni,this.isPropagationStopped=ni,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ii)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ii)},persist:function(){},isPersistent:ii}),t}var si,ai,oi,li={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ci=ri(li),ui=U({},li,{view:0,detail:0}),di=ri(ui),hi=U({},ui,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ei,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==oi&&(oi&&"mousemove"===e.type?(si=e.screenX-oi.screenX,ai=e.screenY-oi.screenY):ai=si=0,oi=e),si)},movementY:function(e){return"movementY"in e?e.movementY:ai}}),pi=ri(hi),fi=ri(U({},hi,{dataTransfer:0})),vi=ri(U({},ui,{relatedTarget:0})),gi=ri(U({},li,{animationName:0,elapsedTime:0,pseudoElement:0})),mi=U({},li,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yi=ri(mi),bi=ri(U({},li,{data:0})),ki={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Si={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ti={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wi(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Ti[e])&&!!t[e]}function Ei(){return wi}var Pi=U({},ui,{key:function(e){if(e.key){var t=ki[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ti(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Si[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ei,charCode:function(e){return"keypress"===e.type?ti(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ti(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Ci=ri(Pi),Ii=ri(U({},hi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),_i=ri(U({},ui,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ei})),Ai=ri(U({},li,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ri=U({},hi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Li=ri(Ri),Di=[9,13,27,32],Mi=u&&"CompositionEvent"in window,Ni=null;u&&"documentMode"in document&&(Ni=document.documentMode);var Oi=u&&"TextEvent"in window&&!Ni,xi=u&&(!Mi||Ni&&8<Ni&&11>=Ni),Ui=String.fromCharCode(32),Fi=!1;function ji(e,t){switch(e){case"keyup":return-1!==Di.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bi(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gi=!1;var Vi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vi[e.type]:"textarea"===t}function Wi(e,t,i,n){Ce(n),0<(t=qn(t,"onChange")).length&&(i=new ci("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Hi=null,qi=null;function Ki(e){Fn(e,0)}function Ji(e){if(K(kr(e)))return e}function Qi(e,t){if("change"===e)return t}var Yi=!1;if(u){var $i;if(u){var Xi="oninput"in document;if(!Xi){var Zi=document.createElement("div");Zi.setAttribute("oninput","return;"),Xi="function"===typeof Zi.oninput}$i=Xi}else $i=!1;Yi=$i&&(!document.documentMode||9<document.documentMode)}function en(){Hi&&(Hi.detachEvent("onpropertychange",tn),qi=Hi=null)}function tn(e){if("value"===e.propertyName&&Ji(qi)){var t=[];Wi(t,qi,e,Se(e)),Le(Ki,t)}}function nn(e,t,i){"focusin"===e?(en(),qi=i,(Hi=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function rn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ji(qi)}function sn(e,t){if("click"===e)return Ji(t)}function an(e,t){if("input"===e||"change"===e)return Ji(t)}var on="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ln(e,t){if(on(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!d.call(t,r)||!on(e[r],t[r]))return!1}return!0}function cn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function un(e,t){var i,n=cn(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=cn(n)}}function dn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hn(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var i="string"===typeof t.contentWindow.location.href}catch(n){i=!1}if(!i)break;t=J((e=t.contentWindow).document)}return t}function pn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fn(e){var t=hn(),i=e.focusedElem,n=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&dn(i.ownerDocument.documentElement,i)){if(null!==n&&pn(i))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if((e=(t=i.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=i.textContent.length,s=Math.min(n.start,r);n=void 0===n.end?s:Math.min(n.end,r),!e.extend&&s>n&&(r=n,n=s,s=r),r=un(i,s);var a=un(i,n);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),s>n?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=i;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof i.focus&&i.focus(),i=0;i<t.length;i++)(e=t[i]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vn=u&&"documentMode"in document&&11>=document.documentMode,gn=null,mn=null,yn=null,bn=!1;function kn(e,t,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;bn||null==gn||gn!==J(n)||("selectionStart"in(n=gn)&&pn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},yn&&ln(yn,n)||(yn=n,0<(n=qn(mn,"onSelect")).length&&(t=new ci("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=gn)))}function Sn(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var Tn={animationend:Sn("Animation","AnimationEnd"),animationiteration:Sn("Animation","AnimationIteration"),animationstart:Sn("Animation","AnimationStart"),transitionend:Sn("Transition","TransitionEnd")},wn={},En={};function Pn(e){if(wn[e])return wn[e];if(!Tn[e])return e;var t,i=Tn[e];for(t in i)if(i.hasOwnProperty(t)&&t in En)return wn[e]=i[t];return e}u&&(En=document.createElement("div").style,"AnimationEvent"in window||(delete Tn.animationend.animation,delete Tn.animationiteration.animation,delete Tn.animationstart.animation),"TransitionEvent"in window||delete Tn.transitionend.transition);var Cn=Pn("animationend"),In=Pn("animationiteration"),_n=Pn("animationstart"),An=Pn("transitionend"),Rn=new Map,Ln="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dn(e,t){Rn.set(e,t),l(t,[e])}for(var Mn=0;Mn<Ln.length;Mn++){var Nn=Ln[Mn];Dn(Nn.toLowerCase(),"on"+(Nn[0].toUpperCase()+Nn.slice(1)))}Dn(Cn,"onAnimationEnd"),Dn(In,"onAnimationIteration"),Dn(_n,"onAnimationStart"),Dn("dblclick","onDoubleClick"),Dn("focusin","onFocus"),Dn("focusout","onBlur"),Dn(An,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var On="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xn=new Set("cancel close invalid load scroll toggle".split(" ").concat(On));function Un(e,t,i){var n=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,n,r,a,o,l,c){if(Ge.apply(this,arguments),xe){if(!xe)throw Error(s(198));var u=Ue;xe=!1,Ue=null,Fe||(Fe=!0,je=u)}}(n,t,void 0,e),e.currentTarget=null}function Fn(e,t){t=0!==(4&t);for(var i=0;i<e.length;i++){var n=e[i],r=n.event;n=n.listeners;e:{var s=void 0;if(t)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;Un(r,o,c),s=l}else for(a=0;a<n.length;a++){if(l=(o=n[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;Un(r,o,c),s=l}}}if(Fe)throw e=je,Fe=!1,je=null,e}function jn(e,t){var i=t[vr];void 0===i&&(i=t[vr]=new Set);var n=e+"__bubble";i.has(n)||(zn(t,e,2,!1),i.add(n))}function Bn(e,t,i){var n=0;t&&(n|=4),zn(i,e,n,t)}var Gn="_reactListening"+Math.random().toString(36).slice(2);function Vn(e){if(!e[Gn]){e[Gn]=!0,a.forEach(function(t){"selectionchange"!==t&&(xn.has(t)||Bn(t,!1,e),Bn(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Gn]||(t[Gn]=!0,Bn("selectionchange",!1,t))}}function zn(e,t,i,n){switch(Yt(t)){case 1:var r=Ht;break;case 4:r=qt;break;default:r=Kt}i=r.bind(null,t,i,e),r=void 0,!Me||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),n?void 0!==r?e.addEventListener(t,i,{capture:!0,passive:r}):e.addEventListener(t,i,!0):void 0!==r?e.addEventListener(t,i,{passive:r}):e.addEventListener(t,i,!1)}function Wn(e,t,i,n,r){var s=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var o=n.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=n.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=yr(o)))return;if(5===(l=a.tag)||6===l){n=s=a;continue e}o=o.parentNode}}n=n.return}Le(function(){var n=s,r=Se(i),a=[];e:{var o=Rn.get(e);if(void 0!==o){var l=ci,c=e;switch(e){case"keypress":if(0===ti(i))break e;case"keydown":case"keyup":l=Ci;break;case"focusin":c="focus",l=vi;break;case"focusout":c="blur",l=vi;break;case"beforeblur":case"afterblur":l=vi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=_i;break;case Cn:case In:case _n:l=gi;break;case An:l=Ai;break;case"scroll":l=di;break;case"wheel":l=Li;break;case"copy":case"cut":case"paste":l=yi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Ii}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==o?o+"Capture":null:o;u=[];for(var p,f=n;null!==f;){var v=(p=f).stateNode;if(5===p.tag&&null!==v&&(p=v,null!==h&&(null!=(v=De(f,h))&&u.push(Hn(f,v,p)))),d)break;f=f.return}0<u.length&&(o=new l(o,c,null,i,r),a.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||i===ke||!(c=i.relatedTarget||i.fromElement)||!yr(c)&&!c[fr])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=n,null!==(c=(c=i.relatedTarget||i.toElement)?yr(c):null)&&(c!==(d=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(u=pi,v="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Ii,v="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?o:kr(l),p=null==c?o:kr(c),(o=new u(v,f+"leave",l,i,r)).target=d,o.relatedTarget=p,v=null,yr(r)===n&&((u=new u(h,f+"enter",c,i,r)).target=p,u.relatedTarget=d,v=u),d=v,l&&c)e:{for(h=c,f=0,p=u=l;p;p=Kn(p))f++;for(p=0,v=h;v;v=Kn(v))p++;for(;0<f-p;)u=Kn(u),f--;for(;0<p-f;)h=Kn(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=Kn(u),h=Kn(h)}u=null}else u=null;null!==l&&Jn(a,o,l,u,!1),null!==c&&null!==d&&Jn(a,d,c,u,!0)}if("select"===(l=(o=n?kr(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Qi;else if(zi(o))if(Yi)g=an;else{g=rn;var m=nn}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=sn);switch(g&&(g=g(e,n))?Wi(a,g,i,r):(m&&m(e,o,n),"focusout"===e&&(m=o._wrapperState)&&m.controlled&&"number"===o.type&&ee(o,"number",o.value)),m=n?kr(n):window,e){case"focusin":(zi(m)||"true"===m.contentEditable)&&(gn=m,mn=n,yn=null);break;case"focusout":yn=mn=gn=null;break;case"mousedown":bn=!0;break;case"contextmenu":case"mouseup":case"dragend":bn=!1,kn(a,i,r);break;case"selectionchange":if(vn)break;case"keydown":case"keyup":kn(a,i,r)}var y;if(Mi)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Gi?ji(e,i)&&(b="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(b="onCompositionStart");b&&(xi&&"ko"!==i.locale&&(Gi||"onCompositionStart"!==b?"onCompositionEnd"===b&&Gi&&(y=ei()):(Xt="value"in($t=r)?$t.value:$t.textContent,Gi=!0)),0<(m=qn(n,b)).length&&(b=new bi(b,e,null,i,r),a.push({event:b,listeners:m}),y?b.data=y:null!==(y=Bi(i))&&(b.data=y))),(y=Oi?function(e,t){switch(e){case"compositionend":return Bi(t);case"keypress":return 32!==t.which?null:(Fi=!0,Ui);case"textInput":return(e=t.data)===Ui&&Fi?null:e;default:return null}}(e,i):function(e,t){if(Gi)return"compositionend"===e||!Mi&&ji(e,t)?(e=ei(),Zt=Xt=$t=null,Gi=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return xi&&"ko"!==t.locale?null:t.data}}(e,i))&&(0<(n=qn(n,"onBeforeInput")).length&&(r=new bi("onBeforeInput","beforeinput",null,i,r),a.push({event:r,listeners:n}),r.data=y))}Fn(a,t)})}function Hn(e,t,i){return{instance:e,listener:t,currentTarget:i}}function qn(e,t){for(var i=t+"Capture",n=[];null!==e;){var r=e,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=De(e,i))&&n.unshift(Hn(e,s,r)),null!=(s=De(e,t))&&n.push(Hn(e,s,r))),e=e.return}return n}function Kn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Jn(e,t,i,n,r){for(var s=t._reactName,a=[];null!==i&&i!==n;){var o=i,l=o.alternate,c=o.stateNode;if(null!==l&&l===n)break;5===o.tag&&null!==c&&(o=c,r?null!=(l=De(i,s))&&a.unshift(Hn(i,l,o)):r||null!=(l=De(i,s))&&a.push(Hn(i,l,o))),i=i.return}0!==a.length&&e.push({event:t,listeners:a})}var Qn=/\r\n?/g,Yn=/\u0000|\uFFFD/g;function $n(e){return("string"===typeof e?e:""+e).replace(Qn,"\n").replace(Yn,"")}function Xn(e,t,i){if(t=$n(t),$n(e)!==t&&i)throw Error(s(425))}function Zn(){}var er=null,tr=null;function ir(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var nr="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,sr="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sr?function(e){return sr.resolve(null).then(e).catch(or)}:nr;function or(e){setTimeout(function(){throw e})}function lr(e,t){var i=t,n=0;do{var r=i.nextSibling;if(e.removeChild(i),r&&8===r.nodeType)if("/$"===(i=r.data)){if(0===n)return e.removeChild(r),void Vt(t);n--}else"$"!==i&&"$?"!==i&&"$!"!==i||n++;i=r}while(i);Vt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),hr="__reactFiber$"+dr,pr="__reactProps$"+dr,fr="__reactContainer$"+dr,vr="__reactEvents$"+dr,gr="__reactListeners$"+dr,mr="__reactHandles$"+dr;function yr(e){var t=e[hr];if(t)return t;for(var i=e.parentNode;i;){if(t=i[fr]||i[hr]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=ur(e);null!==e;){if(i=e[hr])return i;e=ur(e)}return t}i=(e=i).parentNode}return null}function br(e){return!(e=e[hr]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function kr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function Sr(e){return e[pr]||null}var Tr=[],wr=-1;function Er(e){return{current:e}}function Pr(e){0>wr||(e.current=Tr[wr],Tr[wr]=null,wr--)}function Cr(e,t){wr++,Tr[wr]=e.current,e.current=t}var Ir={},_r=Er(Ir),Ar=Er(!1),Rr=Ir;function Lr(e,t){var i=e.type.contextTypes;if(!i)return Ir;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in i)s[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Dr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Mr(){Pr(Ar),Pr(_r)}function Nr(e,t,i){if(_r.current!==Ir)throw Error(s(168));Cr(_r,t),Cr(Ar,i)}function Or(e,t,i){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return i;for(var r in n=n.getChildContext())if(!(r in t))throw Error(s(108,z(e)||"Unknown",r));return U({},i,n)}function xr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ir,Rr=_r.current,Cr(_r,e),Cr(Ar,Ar.current),!0}function Ur(e,t,i){var n=e.stateNode;if(!n)throw Error(s(169));i?(e=Or(e,t,Rr),n.__reactInternalMemoizedMergedChildContext=e,Pr(Ar),Pr(_r),Cr(_r,e)):Pr(Ar),Cr(Ar,i)}var Fr=null,jr=!1,Br=!1;function Gr(e){null===Fr?Fr=[e]:Fr.push(e)}function Vr(){if(!Br&&null!==Fr){Br=!0;var e=0,t=bt;try{var i=Fr;for(bt=1;e<i.length;e++){var n=i[e];do{n=n(!0)}while(null!==n)}Fr=null,jr=!1}catch(r){throw null!==Fr&&(Fr=Fr.slice(e+1)),Ke(Ze,Vr),r}finally{bt=t,Br=!1}}return null}var zr=[],Wr=0,Hr=null,qr=0,Kr=[],Jr=0,Qr=null,Yr=1,$r="";function Xr(e,t){zr[Wr++]=qr,zr[Wr++]=Hr,Hr=e,qr=t}function Zr(e,t,i){Kr[Jr++]=Yr,Kr[Jr++]=$r,Kr[Jr++]=Qr,Qr=e;var n=Yr;e=$r;var r=32-at(n)-1;n&=~(1<<r),i+=1;var s=32-at(t)+r;if(30<s){var a=r-r%5;s=(n&(1<<a)-1).toString(32),n>>=a,r-=a,Yr=1<<32-at(t)+r|i<<r|n,$r=s+e}else Yr=1<<s|i<<r|n,$r=e}function es(e){null!==e.return&&(Xr(e,1),Zr(e,1,0))}function ts(e){for(;e===Hr;)Hr=zr[--Wr],zr[Wr]=null,qr=zr[--Wr],zr[Wr]=null;for(;e===Qr;)Qr=Kr[--Jr],Kr[Jr]=null,$r=Kr[--Jr],Kr[Jr]=null,Yr=Kr[--Jr],Kr[Jr]=null}var is=null,ns=null,rs=!1,ss=null;function as(e,t){var i=Lc(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,null===(t=e.deletions)?(e.deletions=[i],e.flags|=16):t.push(i)}function os(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,is=e,ns=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,is=e,ns=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(i=null!==Qr?{id:Yr,overflow:$r}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},(i=Lc(18,null,null,0)).stateNode=t,i.return=e,e.child=i,is=e,ns=null,!0);default:return!1}}function ls(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cs(e){if(rs){var t=ns;if(t){var i=t;if(!os(e,t)){if(ls(e))throw Error(s(418));t=cr(i.nextSibling);var n=is;t&&os(e,t)?as(n,i):(e.flags=-4097&e.flags|2,rs=!1,is=e)}}else{if(ls(e))throw Error(s(418));e.flags=-4097&e.flags|2,rs=!1,is=e}}}function us(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;is=e}function ds(e){if(e!==is)return!1;if(!rs)return us(e),rs=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ir(e.type,e.memoizedProps)),t&&(t=ns)){if(ls(e))throw hs(),Error(s(418));for(;t;)as(e,t),t=cr(t.nextSibling)}if(us(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){ns=cr(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}ns=null}}else ns=is?cr(e.stateNode.nextSibling):null;return!0}function hs(){for(var e=ns;e;)e=cr(e.nextSibling)}function ps(){ns=is=null,rs=!1}function fs(e){null===ss?ss=[e]:ss.push(e)}var vs=k.ReactCurrentBatchConfig;function gs(e,t,i){if(null!==(e=i.ref)&&"function"!==typeof e&&"object"!==typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(s(309));var n=i.stateNode}if(!n)throw Error(s(147,e));var r=n,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(s(284));if(!i._owner)throw Error(s(290,e))}return e}function ms(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ys(e){return(0,e._init)(e._payload)}function bs(e){function t(t,i){if(e){var n=t.deletions;null===n?(t.deletions=[i],t.flags|=16):n.push(i)}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Mc(e,t)).index=0,e.sibling=null,e}function a(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<i?(t.flags|=2,i):n:(t.flags|=2,i):(t.flags|=1048576,i)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,i,n){return null===t||6!==t.tag?((t=Uc(i,e.mode,n)).return=e,t):((t=r(t,i)).return=e,t)}function c(e,t,i,n){var s=i.type;return s===w?d(e,t,i.props.children,n,i.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===D&&ys(s)===t.type)?((n=r(t,i.props)).ref=gs(e,t,i),n.return=e,n):((n=Nc(i.type,i.key,i.props,null,e.mode,n)).ref=gs(e,t,i),n.return=e,n)}function u(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=Fc(i,e.mode,n)).return=e,t):((t=r(t,i.children||[])).return=e,t)}function d(e,t,i,n,s){return null===t||7!==t.tag?((t=Oc(i,e.mode,n,s)).return=e,t):((t=r(t,i)).return=e,t)}function h(e,t,i){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Uc(""+t,e.mode,i)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case S:return(i=Nc(t.type,t.key,t.props,null,e.mode,i)).ref=gs(e,null,t),i.return=e,i;case T:return(t=Fc(t,e.mode,i)).return=e,t;case D:return h(e,(0,t._init)(t._payload),i)}if(te(t)||O(t))return(t=Oc(t,e.mode,i,null)).return=e,t;ms(e,t)}return null}function p(e,t,i,n){var r=null!==t?t.key:null;if("string"===typeof i&&""!==i||"number"===typeof i)return null!==r?null:l(e,t,""+i,n);if("object"===typeof i&&null!==i){switch(i.$$typeof){case S:return i.key===r?c(e,t,i,n):null;case T:return i.key===r?u(e,t,i,n):null;case D:return p(e,t,(r=i._init)(i._payload),n)}if(te(i)||O(i))return null!==r?null:d(e,t,i,n,null);ms(e,i)}return null}function f(e,t,i,n,r){if("string"===typeof n&&""!==n||"number"===typeof n)return l(t,e=e.get(i)||null,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case S:return c(t,e=e.get(null===n.key?i:n.key)||null,n,r);case T:return u(t,e=e.get(null===n.key?i:n.key)||null,n,r);case D:return f(e,t,i,(0,n._init)(n._payload),r)}if(te(n)||O(n))return d(t,e=e.get(i)||null,n,r,null);ms(t,n)}return null}function v(r,s,o,l){for(var c=null,u=null,d=s,v=s=0,g=null;null!==d&&v<o.length;v++){d.index>v?(g=d,d=null):g=d.sibling;var m=p(r,d,o[v],l);if(null===m){null===d&&(d=g);break}e&&d&&null===m.alternate&&t(r,d),s=a(m,s,v),null===u?c=m:u.sibling=m,u=m,d=g}if(v===o.length)return i(r,d),rs&&Xr(r,v),c;if(null===d){for(;v<o.length;v++)null!==(d=h(r,o[v],l))&&(s=a(d,s,v),null===u?c=d:u.sibling=d,u=d);return rs&&Xr(r,v),c}for(d=n(r,d);v<o.length;v++)null!==(g=f(d,r,v,o[v],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?v:g.key),s=a(g,s,v),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(r,e)}),rs&&Xr(r,v),c}function g(r,o,l,c){var u=O(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var d=u=null,v=o,g=o=0,m=null,y=l.next();null!==v&&!y.done;g++,y=l.next()){v.index>g?(m=v,v=null):m=v.sibling;var b=p(r,v,y.value,c);if(null===b){null===v&&(v=m);break}e&&v&&null===b.alternate&&t(r,v),o=a(b,o,g),null===d?u=b:d.sibling=b,d=b,v=m}if(y.done)return i(r,v),rs&&Xr(r,g),u;if(null===v){for(;!y.done;g++,y=l.next())null!==(y=h(r,y.value,c))&&(o=a(y,o,g),null===d?u=y:d.sibling=y,d=y);return rs&&Xr(r,g),u}for(v=n(r,v);!y.done;g++,y=l.next())null!==(y=f(v,r,g,y.value,c))&&(e&&null!==y.alternate&&v.delete(null===y.key?g:y.key),o=a(y,o,g),null===d?u=y:d.sibling=y,d=y);return e&&v.forEach(function(e){return t(r,e)}),rs&&Xr(r,g),u}return function e(n,s,a,l){if("object"===typeof a&&null!==a&&a.type===w&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case S:e:{for(var c=a.key,u=s;null!==u;){if(u.key===c){if((c=a.type)===w){if(7===u.tag){i(n,u.sibling),(s=r(u,a.props.children)).return=n,n=s;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&ys(c)===u.type){i(n,u.sibling),(s=r(u,a.props)).ref=gs(n,u,a),s.return=n,n=s;break e}i(n,u);break}t(n,u),u=u.sibling}a.type===w?((s=Oc(a.props.children,n.mode,l,a.key)).return=n,n=s):((l=Nc(a.type,a.key,a.props,null,n.mode,l)).ref=gs(n,s,a),l.return=n,n=l)}return o(n);case T:e:{for(u=a.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){i(n,s.sibling),(s=r(s,a.children||[])).return=n,n=s;break e}i(n,s);break}t(n,s),s=s.sibling}(s=Fc(a,n.mode,l)).return=n,n=s}return o(n);case D:return e(n,s,(u=a._init)(a._payload),l)}if(te(a))return v(n,s,a,l);if(O(a))return g(n,s,a,l);ms(n,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==s&&6===s.tag?(i(n,s.sibling),(s=r(s,a)).return=n,n=s):(i(n,s),(s=Uc(a,n.mode,l)).return=n,n=s),o(n)):i(n,s)}}var ks=bs(!0),Ss=bs(!1),Ts=Er(null),ws=null,Es=null,Ps=null;function Cs(){Ps=Es=ws=null}function Is(e){var t=Ts.current;Pr(Ts),e._currentValue=t}function _s(e,t,i){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function As(e,t){ws=e,Ps=Es=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function Rs(e){var t=e._currentValue;if(Ps!==e)if(e={context:e,memoizedValue:t,next:null},null===Es){if(null===ws)throw Error(s(308));Es=e,ws.dependencies={lanes:0,firstContext:e}}else Es=Es.next=e;return t}var Ls=null;function Ds(e){null===Ls?Ls=[e]:Ls.push(e)}function Ms(e,t,i,n){var r=t.interleaved;return null===r?(i.next=i,Ds(t)):(i.next=r.next,r.next=i),t.interleaved=i,Ns(e,n)}function Ns(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}var Os=!1;function xs(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Us(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function js(e,t,i){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&_l)){var r=n.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),n.pending=t,Ns(e,i)}return null===(r=n.interleaved)?(t.next=t,Ds(n)):(t.next=r.next,r.next=t),n.interleaved=t,Ns(e,i)}function Bs(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&i))){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,yt(e,i)}}function Gs(e,t){var i=e.updateQueue,n=e.alternate;if(null!==n&&i===(n=n.updateQueue)){var r=null,s=null;if(null!==(i=i.firstBaseUpdate)){do{var a={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===s?r=s=a:s=s.next=a,i=i.next}while(null!==i);null===s?r=s=t:s=s.next=t}else r=s=t;return i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,effects:n.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function Vs(e,t,i,n){var r=e.updateQueue;Os=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==s){var d=r.baseState;for(a=0,u=c=l=null,o=s;;){var h=o.lane,p=o.eventTime;if((n&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,v=o;switch(h=t,p=i,v.tag){case 1:if("function"===typeof(f=v.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=v.payload)?f.call(p,d,h):f)||void 0===h)break e;d=U({},d,h);break e;case 2:Os=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=r.effects)?r.effects=[o]:h.push(o))}else p={eventTime:p,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,a|=h;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(h=o).next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}if(null===u&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===s&&(r.shared.lanes=0);xl|=a,e.lanes=a,e.memoizedState=d}}function zs(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],r=n.callback;if(null!==r){if(n.callback=null,n=i,"function"!==typeof r)throw Error(s(191,r));r.call(n)}}}var Ws={},Hs=Er(Ws),qs=Er(Ws),Ks=Er(Ws);function Js(e){if(e===Ws)throw Error(s(174));return e}function Qs(e,t){switch(Cr(Ks,t),Cr(qs,e),Cr(Hs,Ws),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Pr(Hs),Cr(Hs,t)}function Ys(){Pr(Hs),Pr(qs),Pr(Ks)}function $s(e){Js(Ks.current);var t=Js(Hs.current),i=le(t,e.type);t!==i&&(Cr(qs,e),Cr(Hs,i))}function Xs(e){qs.current===e&&(Pr(Hs),Pr(qs))}var Zs=Er(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function ia(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var na=k.ReactCurrentDispatcher,ra=k.ReactCurrentBatchConfig,sa=0,aa=null,oa=null,la=null,ca=!1,ua=!1,da=0,ha=0;function pa(){throw Error(s(321))}function fa(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!on(e[i],t[i]))return!1;return!0}function va(e,t,i,n,r,a){if(sa=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,na.current=null===e||null===e.memoizedState?Xa:Za,e=i(n,r),ua){a=0;do{if(ua=!1,da=0,25<=a)throw Error(s(301));a+=1,la=oa=null,t.updateQueue=null,na.current=eo,e=i(n,r)}while(ua)}if(na.current=$a,t=null!==oa&&null!==oa.next,sa=0,la=oa=aa=null,ca=!1,t)throw Error(s(300));return e}function ga(){var e=0!==da;return da=0,e}function ma(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(s(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function ba(e,t){return"function"===typeof t?t(e):t}function ka(e){var t=ya(),i=t.queue;if(null===i)throw Error(s(311));i.lastRenderedReducer=e;var n=oa,r=n.baseQueue,a=i.pending;if(null!==a){if(null!==r){var o=r.next;r.next=a.next,a.next=o}n.baseQueue=r=a,i.pending=null}if(null!==r){a=r.next,n=n.baseState;var l=o=null,c=null,u=a;do{var d=u.lane;if((sa&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:e(n,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,o=n):c=c.next=h,aa.lanes|=d,xl|=d}u=u.next}while(null!==u&&u!==a);null===c?o=n:c.next=l,on(n,t.memoizedState)||(bo=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=c,i.lastRenderedState=n}if(null!==(e=i.interleaved)){r=e;do{a=r.lane,aa.lanes|=a,xl|=a,r=r.next}while(r!==e)}else null===r&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function Sa(e){var t=ya(),i=t.queue;if(null===i)throw Error(s(311));i.lastRenderedReducer=e;var n=i.dispatch,r=i.pending,a=t.memoizedState;if(null!==r){i.pending=null;var o=r=r.next;do{a=e(a,o.action),o=o.next}while(o!==r);on(a,t.memoizedState)||(bo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),i.lastRenderedState=a}return[a,n]}function Ta(){}function wa(e,t){var i=aa,n=ya(),r=t(),a=!on(n.memoizedState,r);if(a&&(n.memoizedState=r,bo=!0),n=n.queue,Oa(Ca.bind(null,i,n,e),[e]),n.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(i.flags|=2048,Ra(9,Pa.bind(null,i,n,r,t),void 0,null),null===Al)throw Error(s(349));0!==(30&sa)||Ea(i,t,r)}return r}function Ea(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function Pa(e,t,i,n){t.value=i,t.getSnapshot=n,Ia(t)&&_a(e)}function Ca(e,t,i){return i(function(){Ia(t)&&_a(e)})}function Ia(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!on(e,i)}catch(n){return!0}}function _a(e){var t=Ns(e,1);null!==t&&ic(t,e,1,-1)}function Aa(e){var t=ma();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:e},t.queue=e,e=e.dispatch=Ka.bind(null,aa,e),[t.memoizedState,e]}function Ra(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function La(){return ya().memoizedState}function Da(e,t,i,n){var r=ma();aa.flags|=e,r.memoizedState=Ra(1|t,i,void 0,void 0===n?null:n)}function Ma(e,t,i,n){var r=ya();n=void 0===n?null:n;var s=void 0;if(null!==oa){var a=oa.memoizedState;if(s=a.destroy,null!==n&&fa(n,a.deps))return void(r.memoizedState=Ra(t,i,s,n))}aa.flags|=e,r.memoizedState=Ra(1|t,i,s,n)}function Na(e,t){return Da(8390656,8,e,t)}function Oa(e,t){return Ma(2048,8,e,t)}function xa(e,t){return Ma(4,2,e,t)}function Ua(e,t){return Ma(4,4,e,t)}function Fa(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ja(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Ma(4,4,Fa.bind(null,t,e),i)}function Ba(){}function Ga(e,t){var i=ya();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&fa(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Va(e,t){var i=ya();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&fa(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)}function za(e,t,i){return 0===(21&sa)?(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=i):(on(i,t)||(i=vt(),aa.lanes|=i,xl|=i,e.baseState=!0),t)}function Wa(e,t){var i=bt;bt=0!==i&&4>i?i:4,e(!0);var n=ra.transition;ra.transition={};try{e(!1),t()}finally{bt=i,ra.transition=n}}function Ha(){return ya().memoizedState}function qa(e,t,i){var n=tc(e);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},Ja(e))Qa(t,i);else if(null!==(i=Ms(e,t,i,n))){ic(i,e,n,ec()),Ya(i,t,n)}}function Ka(e,t,i){var n=tc(e),r={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(Ja(e))Qa(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,i);if(r.hasEagerState=!0,r.eagerState=o,on(o,a)){var l=t.interleaved;return null===l?(r.next=r,Ds(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(i=Ms(e,t,r,n))&&(ic(i,e,n,r=ec()),Ya(i,t,n))}}function Ja(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Qa(e,t){ua=ca=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Ya(e,t,i){if(0!==(4194240&i)){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,yt(e,i)}}var $a={readContext:Rs,useCallback:pa,useContext:pa,useEffect:pa,useImperativeHandle:pa,useInsertionEffect:pa,useLayoutEffect:pa,useMemo:pa,useReducer:pa,useRef:pa,useState:pa,useDebugValue:pa,useDeferredValue:pa,useTransition:pa,useMutableSource:pa,useSyncExternalStore:pa,useId:pa,unstable_isNewReconciler:!1},Xa={readContext:Rs,useCallback:function(e,t){return ma().memoizedState=[e,void 0===t?null:t],e},useContext:Rs,useEffect:Na,useImperativeHandle:function(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Da(4194308,4,Fa.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Da(4194308,4,e,t)},useInsertionEffect:function(e,t){return Da(4,2,e,t)},useMemo:function(e,t){var i=ma();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=ma();return t=void 0!==i?i(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=qa.bind(null,aa,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},ma().memoizedState=e},useState:Aa,useDebugValue:Ba,useDeferredValue:function(e){return ma().memoizedState=e},useTransition:function(){var e=Aa(!1),t=e[0];return e=Wa.bind(null,e[1]),ma().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var n=aa,r=ma();if(rs){if(void 0===i)throw Error(s(407));i=i()}else{if(i=t(),null===Al)throw Error(s(349));0!==(30&sa)||Ea(n,t,i)}r.memoizedState=i;var a={value:i,getSnapshot:t};return r.queue=a,Na(Ca.bind(null,n,a,e),[e]),n.flags|=2048,Ra(9,Pa.bind(null,n,a,i,t),void 0,null),i},useId:function(){var e=ma(),t=Al.identifierPrefix;if(rs){var i=$r;t=":"+t+"R"+(i=(Yr&~(1<<32-at(Yr)-1)).toString(32)+i),0<(i=da++)&&(t+="H"+i.toString(32)),t+=":"}else t=":"+t+"r"+(i=ha++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Za={readContext:Rs,useCallback:Ga,useContext:Rs,useEffect:Oa,useImperativeHandle:ja,useInsertionEffect:xa,useLayoutEffect:Ua,useMemo:Va,useReducer:ka,useRef:La,useState:function(){return ka(ba)},useDebugValue:Ba,useDeferredValue:function(e){return za(ya(),oa.memoizedState,e)},useTransition:function(){return[ka(ba)[0],ya().memoizedState]},useMutableSource:Ta,useSyncExternalStore:wa,useId:Ha,unstable_isNewReconciler:!1},eo={readContext:Rs,useCallback:Ga,useContext:Rs,useEffect:Oa,useImperativeHandle:ja,useInsertionEffect:xa,useLayoutEffect:Ua,useMemo:Va,useReducer:Sa,useRef:La,useState:function(){return Sa(ba)},useDebugValue:Ba,useDeferredValue:function(e){var t=ya();return null===oa?t.memoizedState=e:za(t,oa.memoizedState,e)},useTransition:function(){return[Sa(ba)[0],ya().memoizedState]},useMutableSource:Ta,useSyncExternalStore:wa,useId:Ha,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var i in t=U({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}function io(e,t,i,n){i=null===(i=i(n,t=e.memoizedState))||void 0===i?t:U({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var no={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var n=ec(),r=tc(e),s=Fs(n,r);s.payload=t,void 0!==i&&null!==i&&(s.callback=i),null!==(t=js(e,s,r))&&(ic(t,e,r,n),Bs(t,e,r))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=ec(),r=tc(e),s=Fs(n,r);s.tag=1,s.payload=t,void 0!==i&&null!==i&&(s.callback=i),null!==(t=js(e,s,r))&&(ic(t,e,r,n),Bs(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ec(),n=tc(e),r=Fs(i,n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=js(e,r,n))&&(ic(t,e,n,i),Bs(t,e,n))}};function ro(e,t,i,n,r,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!ln(i,n)||!ln(r,s))}function so(e,t,i){var n=!1,r=Ir,s=t.contextType;return"object"===typeof s&&null!==s?s=Rs(s):(r=Dr(t)?Rr:_r.current,s=(n=null!==(n=t.contextTypes)&&void 0!==n)?Lr(e,r):Ir),t=new t(i,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=no,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function ao(e,t,i,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&no.enqueueReplaceState(t,t.state,null)}function oo(e,t,i,n){var r=e.stateNode;r.props=i,r.state=e.memoizedState,r.refs={},xs(e);var s=t.contextType;"object"===typeof s&&null!==s?r.context=Rs(s):(s=Dr(t)?Rr:_r.current,r.context=Lr(e,s)),r.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(io(e,t,s,i),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&no.enqueueReplaceState(r,r.state,null),Vs(e,i,r,n),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var i="",n=t;do{i+=G(n),n=n.return}while(n);var r=i}catch(s){r="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:r,digest:null}}function co(e,t,i){return{value:e,source:null,stack:null!=i?i:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var ho="function"===typeof WeakMap?WeakMap:Map;function po(e,t,i){(i=Fs(-1,i)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){Wl||(Wl=!0,Hl=n),uo(0,t)},i}function fo(e,t,i){(i=Fs(-1,i)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var r=t.value;i.payload=function(){return n(r)},i.callback=function(){uo(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(i.callback=function(){uo(0,t),"function"!==typeof n&&(null===ql?ql=new Set([this]):ql.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),i}function vo(e,t,i){var n=e.pingCache;if(null===n){n=e.pingCache=new ho;var r=new Set;n.set(t,r)}else void 0===(r=n.get(t))&&(r=new Set,n.set(t,r));r.has(i)||(r.add(i),e=Pc.bind(null,e,t,i),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function mo(e,t,i,n,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((t=Fs(-1,1)).tag=2,js(i,t,1))),i.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var yo=k.ReactCurrentOwner,bo=!1;function ko(e,t,i,n){t.child=null===e?Ss(t,null,i,n):ks(t,e.child,i,n)}function So(e,t,i,n,r){i=i.render;var s=t.ref;return As(t,r),n=va(e,t,i,n,s,r),i=ga(),null===e||bo?(rs&&i&&es(t),t.flags|=1,ko(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Wo(e,t,r))}function To(e,t,i,n,r){if(null===e){var s=i.type;return"function"!==typeof s||Dc(s)||void 0!==s.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=Nc(i.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,wo(e,t,s,n,r))}if(s=e.child,0===(e.lanes&r)){var a=s.memoizedProps;if((i=null!==(i=i.compare)?i:ln)(a,n)&&e.ref===t.ref)return Wo(e,t,r)}return t.flags|=1,(e=Mc(s,n)).ref=t.ref,e.return=t,t.child=e}function wo(e,t,i,n,r){if(null!==e){var s=e.memoizedProps;if(ln(s,n)&&e.ref===t.ref){if(bo=!1,t.pendingProps=n=s,0===(e.lanes&r))return t.lanes=e.lanes,Wo(e,t,r);0!==(131072&e.flags)&&(bo=!0)}}return Co(e,t,i,n,r)}function Eo(e,t,i){var n=t.pendingProps,r=n.children,s=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cr(Ml,Dl),Dl|=i;else{if(0===(1073741824&i))return e=null!==s?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Cr(Ml,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==s?s.baseLanes:i,Cr(Ml,Dl),Dl|=n}else null!==s?(n=s.baseLanes|i,t.memoizedState=null):n=i,Cr(Ml,Dl),Dl|=n;return ko(e,t,r,i),t.child}function Po(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,i,n,r){var s=Dr(i)?Rr:_r.current;return s=Lr(t,s),As(t,r),i=va(e,t,i,n,s,r),n=ga(),null===e||bo?(rs&&n&&es(t),t.flags|=1,ko(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Wo(e,t,r))}function Io(e,t,i,n,r){if(Dr(i)){var s=!0;xr(t)}else s=!1;if(As(t,r),null===t.stateNode)zo(e,t),so(t,i,n),oo(t,i,n,r),n=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=i.contextType;"object"===typeof c&&null!==c?c=Rs(c):c=Lr(t,c=Dr(i)?Rr:_r.current);var u=i.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==n||l!==c)&&ao(t,a,n,c),Os=!1;var h=t.memoizedState;a.state=h,Vs(t,n,a,r),l=t.memoizedState,o!==n||h!==l||Ar.current||Os?("function"===typeof u&&(io(t,i,u,n),l=t.memoizedState),(o=Os||ro(t,i,o,n,h,l,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=c,n=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,Us(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,d=t.pendingProps,h=a.context,"object"===typeof(l=i.contextType)&&null!==l?l=Rs(l):l=Lr(t,l=Dr(i)?Rr:_r.current);var p=i.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==d||h!==l)&&ao(t,a,n,l),Os=!1,h=t.memoizedState,a.state=h,Vs(t,n,a,r);var f=t.memoizedState;o!==d||h!==f||Ar.current||Os?("function"===typeof p&&(io(t,i,p,n),f=t.memoizedState),(c=Os||ro(t,i,c,n,h,f,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(n,f,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,f,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=f),a.props=n,a.state=f,a.context=l,n=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return _o(e,t,i,n,s,r)}function _o(e,t,i,n,r,s){Po(e,t);var a=0!==(128&t.flags);if(!n&&!a)return r&&Ur(t,i,!1),Wo(e,t,s);n=t.stateNode,yo.current=t;var o=a&&"function"!==typeof i.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&a?(t.child=ks(t,e.child,null,s),t.child=ks(t,null,o,s)):ko(e,t,o,s),t.memoizedState=n.state,r&&Ur(t,i,!0),t.child}function Ao(e){var t=e.stateNode;t.pendingContext?Nr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Nr(0,t.context,!1),Qs(e,t.containerInfo)}function Ro(e,t,i,n,r){return ps(),fs(r),t.flags|=256,ko(e,t,i,n),t.child}var Lo,Do,Mo,No,Oo={dehydrated:null,treeContext:null,retryLane:0};function xo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Uo(e,t,i){var n,r=t.pendingProps,a=Zs.current,o=!1,l=0!==(128&t.flags);if((n=l)||(n=(null===e||null!==e.memoizedState)&&0!==(2&a)),n?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Cr(Zs,1&a),null===e)return cs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=xc(l,r,0,null),e=Oc(e,r,i,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=xo(i),t.memoizedState=Oo,e):Fo(t,l));if(null!==(a=e.memoizedState)&&null!==(n=a.dehydrated))return function(e,t,i,n,r,a,o){if(i)return 256&t.flags?(t.flags&=-257,jo(e,t,o,n=co(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=n.fallback,r=t.mode,n=xc({mode:"visible",children:n.children},r,0,null),(a=Oc(a,r,o,null)).flags|=2,n.return=t,a.return=t,n.sibling=a,t.child=n,0!==(1&t.mode)&&ks(t,e.child,null,o),t.child.memoizedState=xo(o),t.memoizedState=Oo,a);if(0===(1&t.mode))return jo(e,t,o,null);if("$!"===r.data){if(n=r.nextSibling&&r.nextSibling.dataset)var l=n.dgst;return n=l,jo(e,t,o,n=co(a=Error(s(419)),n,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(n=Al)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(n.suspendedLanes|o))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Ns(e,r),ic(n,e,r,-1))}return vc(),jo(e,t,o,n=co(Error(s(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Ic.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,ns=cr(r.nextSibling),is=t,rs=!0,ss=null,null!==e&&(Kr[Jr++]=Yr,Kr[Jr++]=$r,Kr[Jr++]=Qr,Yr=e.id,$r=e.overflow,Qr=t),t=Fo(t,n.children),t.flags|=4096,t)}(e,t,l,r,n,a,i);if(o){o=r.fallback,l=t.mode,n=(a=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Mc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==n?o=Mc(n,o):(o=Oc(o,l,i,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=null===(l=e.child.memoizedState)?xo(i):{baseLanes:l.baseLanes|i,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~i,t.memoizedState=Oo,r}return e=(o=e.child).sibling,r=Mc(o,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=i),r.return=t,r.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function Fo(e,t){return(t=xc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function jo(e,t,i,n){return null!==n&&fs(n),ks(t,e.child,null,i),(e=Fo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bo(e,t,i){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),_s(e.return,t,i)}function Go(e,t,i,n,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=i,s.tailMode=r)}function Vo(e,t,i){var n=t.pendingProps,r=n.revealOrder,s=n.tail;if(ko(e,t,n.children,i),0!==(2&(n=Zs.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bo(e,i,t);else if(19===e.tag)Bo(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Cr(Zs,n),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(i=t.child,r=null;null!==i;)null!==(e=i.alternate)&&null===ea(e)&&(r=i),i=i.sibling;null===(i=r)?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),Go(t,!1,r,i,s);break;case"backwards":for(i=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ea(e)){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}Go(t,!0,i,null,s);break;case"together":Go(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function zo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wo(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),xl|=t.lanes,0===(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(i=Mc(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Mc(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function Ho(e,t){if(!rs)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function qo(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,n=0;if(t)for(var r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=14680064&r.subtreeFlags,n|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function Ko(e,t,i){var n=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qo(t),null;case 1:case 17:return Dr(t.type)&&Mr(),qo(t),null;case 3:return n=t.stateNode,Ys(),Pr(Ar),Pr(_r),ia(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ds(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ss&&(ac(ss),ss=null))),Do(e,t),qo(t),null;case 5:Xs(t);var r=Js(Ks.current);if(i=t.type,null!==e&&null!=t.stateNode)Mo(e,t,i,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(s(166));return qo(t),null}if(e=Js(Hs.current),ds(t)){n=t.stateNode,i=t.type;var a=t.memoizedProps;switch(n[hr]=t,n[pr]=a,e=0!==(1&t.mode),i){case"dialog":jn("cancel",n),jn("close",n);break;case"iframe":case"object":case"embed":jn("load",n);break;case"video":case"audio":for(r=0;r<On.length;r++)jn(On[r],n);break;case"source":jn("error",n);break;case"img":case"image":case"link":jn("error",n),jn("load",n);break;case"details":jn("toggle",n);break;case"input":Y(n,a),jn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},jn("invalid",n);break;case"textarea":re(n,a),jn("invalid",n)}for(var l in ye(i,a),r=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?n.textContent!==c&&(!0!==a.suppressHydrationWarning&&Xn(n.textContent,c,e),r=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Xn(n.textContent,c,e),r=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&jn("scroll",n)}switch(i){case"input":q(n),Z(n,a,!0);break;case"textarea":q(n),ae(n);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(n.onclick=Zn)}n=r,t.updateQueue=n,null!==n&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=l.createElement(i,{is:n.is}):(e=l.createElement(i),"select"===i&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,i),e[hr]=t,e[pr]=n,Lo(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(i,n),i){case"dialog":jn("cancel",e),jn("close",e),r=n;break;case"iframe":case"object":case"embed":jn("load",e),r=n;break;case"video":case"audio":for(r=0;r<On.length;r++)jn(On[r],e);r=n;break;case"source":jn("error",e),r=n;break;case"img":case"image":case"link":jn("error",e),jn("load",e),r=n;break;case"details":jn("toggle",e),r=n;break;case"input":Y(e,n),r=Q(e,n),jn("invalid",e);break;case"option":default:r=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},r=U({},n,{value:void 0}),jn("invalid",e);break;case"textarea":re(e,n),r=ne(e,n),jn("invalid",e)}for(a in ye(i,r),c=r)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?ge(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===a?"string"===typeof u?("textarea"!==i||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=u&&"onScroll"===a&&jn("scroll",e):null!=u&&b(e,a,u,l))}switch(i){case"input":q(e),Z(e,n,!1);break;case"textarea":q(e),ae(e);break;case"option":null!=n.value&&e.setAttribute("value",""+W(n.value));break;case"select":e.multiple=!!n.multiple,null!=(a=n.value)?ie(e,!!n.multiple,a,!1):null!=n.defaultValue&&ie(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Zn)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qo(t),null;case 6:if(e&&null!=t.stateNode)No(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(s(166));if(i=Js(Ks.current),Js(Hs.current),ds(t)){if(n=t.stateNode,i=t.memoizedProps,n[hr]=t,(a=n.nodeValue!==i)&&null!==(e=is))switch(e.tag){case 3:Xn(n.nodeValue,i,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xn(n.nodeValue,i,0!==(1&e.mode))}a&&(t.flags|=4)}else(n=(9===i.nodeType?i:i.ownerDocument).createTextNode(n))[hr]=t,t.stateNode=n}return qo(t),null;case 13:if(Pr(Zs),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(rs&&null!==ns&&0!==(1&t.mode)&&0===(128&t.flags))hs(),ps(),t.flags|=98560,a=!1;else if(a=ds(t),null!==n&&null!==n.dehydrated){if(null===e){if(!a)throw Error(s(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(s(317));a[hr]=t}else ps(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qo(t),a=!1}else null!==ss&&(ac(ss),ss=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=i,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Zs.current)?0===Nl&&(Nl=3):vc())),null!==t.updateQueue&&(t.flags|=4),qo(t),null);case 4:return Ys(),Do(e,t),null===e&&Vn(t.stateNode.containerInfo),qo(t),null;case 10:return Is(t.type._context),qo(t),null;case 19:if(Pr(Zs),null===(a=t.memoizedState))return qo(t),null;if(n=0!==(128&t.flags),null===(l=a.rendering))if(n)Ho(a,!1);else{if(0!==Nl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,Ho(a,!1),null!==(n=l.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=i,i=t.child;null!==i;)e=n,(a=i).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Cr(Zs,1&Zs.current|2),t.child}e=e.sibling}null!==a.tail&&$e()>Vl&&(t.flags|=128,n=!0,Ho(a,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=ea(l))){if(t.flags|=128,n=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),Ho(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!rs)return qo(t),null}else 2*$e()-a.renderingStartTime>Vl&&1073741824!==i&&(t.flags|=128,n=!0,Ho(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(i=a.last)?i.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=$e(),t.sibling=null,i=Zs.current,Cr(Zs,n?1&i|2:1&i),t):(qo(t),null);case 22:case 23:return dc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&Dl)&&(qo(t),6&t.subtreeFlags&&(t.flags|=8192)):qo(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Jo(e,t){switch(ts(t),t.tag){case 1:return Dr(t.type)&&Mr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ys(),Pr(Ar),Pr(_r),ia(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Xs(t),null;case 13:if(Pr(Zs),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ps()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Pr(Zs),null;case 4:return Ys(),null;case 10:return Is(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Lo=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Do=function(){},Mo=function(e,t,i,n){var r=e.memoizedProps;if(r!==n){e=t.stateNode,Js(Hs.current);var s,a=null;switch(i){case"input":r=Q(e,r),n=Q(e,n),a=[];break;case"select":r=U({},r,{value:void 0}),n=U({},n,{value:void 0}),a=[];break;case"textarea":r=ne(e,r),n=ne(e,n),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof n.onClick&&(e.onclick=Zn)}for(u in ye(i,n),i=null,r)if(!n.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(s in l)l.hasOwnProperty(s)&&(i||(i={}),i[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in n){var c=n[u];if(l=null!=r?r[u]:void 0,n.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(i||(i={}),i[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(i||(i={}),i[s]=c[s])}else i||(a||(a=[]),a.push(u,i)),i=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&jn("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}i&&(a=a||[]).push("style",i);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},No=function(e,t,i,n){i!==n&&(t.flags|=4)};var Qo=!1,Yo=!1,$o="function"===typeof WeakSet?WeakSet:Set,Xo=null;function Zo(e,t){var i=e.ref;if(null!==i)if("function"===typeof i)try{i(null)}catch(n){Ec(e,t,n)}else i.current=null}function el(e,t,i){try{i()}catch(n){Ec(e,t,n)}}var tl=!1;function il(e,t,i){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&el(t,i,s)}r=r.next}while(r!==n)}}function nl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var i=t=t.next;do{if((i.tag&e)===e){var n=i.create;i.destroy=n()}i=i.next}while(i!==t)}}function rl(e){var t=e.ref;if(null!==t){var i=e.stateNode;e.tag,e=i,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hr],delete t[pr],delete t[vr],delete t[gr],delete t[mr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!==(i=i._reactRootContainer)&&void 0!==i||null!==t.onclick||(t.onclick=Zn));else if(4!==n&&null!==(e=e.child))for(ll(e,t,i),e=e.sibling;null!==e;)ll(e,t,i),e=e.sibling}function cl(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==n&&null!==(e=e.child))for(cl(e,t,i),e=e.sibling;null!==e;)cl(e,t,i),e=e.sibling}var ul=null,dl=!1;function hl(e,t,i){for(i=i.child;null!==i;)pl(e,t,i),i=i.sibling}function pl(e,t,i){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(rt,i)}catch(o){}switch(i.tag){case 5:Yo||Zo(i,t);case 6:var n=ul,r=dl;ul=null,hl(e,t,i),dl=r,null!==(ul=n)&&(dl?(e=ul,i=i.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)):ul.removeChild(i.stateNode));break;case 18:null!==ul&&(dl?(e=ul,i=i.stateNode,8===e.nodeType?lr(e.parentNode,i):1===e.nodeType&&lr(e,i),Vt(e)):lr(ul,i.stateNode));break;case 4:n=ul,r=dl,ul=i.stateNode.containerInfo,dl=!0,hl(e,t,i),ul=n,dl=r;break;case 0:case 11:case 14:case 15:if(!Yo&&(null!==(n=i.updateQueue)&&null!==(n=n.lastEffect))){r=n=n.next;do{var s=r,a=s.destroy;s=s.tag,void 0!==a&&(0!==(2&s)||0!==(4&s))&&el(i,t,a),r=r.next}while(r!==n)}hl(e,t,i);break;case 1:if(!Yo&&(Zo(i,t),"function"===typeof(n=i.stateNode).componentWillUnmount))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(o){Ec(i,t,o)}hl(e,t,i);break;case 21:hl(e,t,i);break;case 22:1&i.mode?(Yo=(n=Yo)||null!==i.memoizedState,hl(e,t,i),Yo=n):hl(e,t,i);break;default:hl(e,t,i)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new $o),t.forEach(function(t){var n=_c.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))})}}function vl(e,t){var i=t.deletions;if(null!==i)for(var n=0;n<i.length;n++){var r=i[n];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,dl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===ul)throw Error(s(160));pl(a,o,r),ul=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){Ec(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var i=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vl(t,e),ml(e),4&n){try{il(3,e,e.return),nl(3,e)}catch(g){Ec(e,e.return,g)}try{il(5,e,e.return)}catch(g){Ec(e,e.return,g)}}break;case 1:vl(t,e),ml(e),512&n&&null!==i&&Zo(i,i.return);break;case 5:if(vl(t,e),ml(e),512&n&&null!==i&&Zo(i,i.return),32&e.flags){var r=e.stateNode;try{he(r,"")}catch(g){Ec(e,e.return,g)}}if(4&n&&null!=(r=e.stateNode)){var a=e.memoizedProps,o=null!==i?i.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&$(r,a),be(l,o);var u=be(l,a);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];"style"===d?ge(r,h):"dangerouslySetInnerHTML"===d?de(r,h):"children"===d?he(r,h):b(r,d,h,u)}switch(l){case"input":X(r,a);break;case"textarea":se(r,a);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var f=a.value;null!=f?ie(r,!!a.multiple,f,!1):p!==!!a.multiple&&(null!=a.defaultValue?ie(r,!!a.multiple,a.defaultValue,!0):ie(r,!!a.multiple,a.multiple?[]:"",!1))}r[pr]=a}catch(g){Ec(e,e.return,g)}}break;case 6:if(vl(t,e),ml(e),4&n){if(null===e.stateNode)throw Error(s(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(g){Ec(e,e.return,g)}}break;case 3:if(vl(t,e),ml(e),4&n&&null!==i&&i.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){Ec(e,e.return,g)}break;case 4:default:vl(t,e),ml(e);break;case 13:vl(t,e),ml(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(Gl=$e())),4&n&&fl(e);break;case 22:if(d=null!==i&&null!==i.memoizedState,1&e.mode?(Yo=(u=Yo)||d,vl(t,e),Yo=u):vl(t,e),ml(e),8192&n){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Xo=e,d=e.child;null!==d;){for(h=Xo=d;null!==Xo;){switch(f=(p=Xo).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:Zo(p,p.return);var v=p.stateNode;if("function"===typeof v.componentWillUnmount){n=p,i=p.return;try{t=n,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(g){Ec(n,i,g)}}break;case 5:Zo(p,p.return);break;case 22:if(null!==p.memoizedState){Sl(h);continue}}null!==f?(f.return=p,Xo=f):Sl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{r=h.stateNode,u?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=ve("display",o))}catch(g){Ec(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){Ec(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:vl(t,e),ml(e),4&n&&fl(e);case 21:}}function ml(e){var t=e.flags;if(2&t){try{e:{for(var i=e.return;null!==i;){if(al(i)){var n=i;break e}i=i.return}throw Error(s(160))}switch(n.tag){case 5:var r=n.stateNode;32&n.flags&&(he(r,""),n.flags&=-33),cl(e,ol(e),r);break;case 3:case 4:var a=n.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(s(161))}}catch(o){Ec(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,i){Xo=e,bl(e,t,i)}function bl(e,t,i){for(var n=0!==(1&e.mode);null!==Xo;){var r=Xo,s=r.child;if(22===r.tag&&n){var a=null!==r.memoizedState||Qo;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||Yo;o=Qo;var c=Yo;if(Qo=a,(Yo=l)&&!c)for(Xo=r;null!==Xo;)l=(a=Xo).child,22===a.tag&&null!==a.memoizedState?Tl(r):null!==l?(l.return=a,Xo=l):Tl(r);for(;null!==s;)Xo=s,bl(s,t,i),s=s.sibling;Xo=r,Qo=o,Yo=c}kl(e)}else 0!==(8772&r.subtreeFlags)&&null!==s?(s.return=r,Xo=s):kl(e)}}function kl(e){for(;null!==Xo;){var t=Xo;if(0!==(8772&t.flags)){var i=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Yo||nl(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!Yo)if(null===i)n.componentDidMount();else{var r=t.elementType===t.type?i.memoizedProps:to(t.type,i.memoizedProps);n.componentDidUpdate(r,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&zs(t,a,n);break;case 3:var o=t.updateQueue;if(null!==o){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}zs(t,o,i)}break;case 5:var l=t.stateNode;if(null===i&&4&t.flags){i=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&i.focus();break;case"img":c.src&&(i.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Vt(h)}}}break;default:throw Error(s(163))}Yo||512&t.flags&&rl(t)}catch(p){Ec(t,t.return,p)}}if(t===e){Xo=null;break}if(null!==(i=t.sibling)){i.return=t.return,Xo=i;break}Xo=t.return}}function Sl(e){for(;null!==Xo;){var t=Xo;if(t===e){Xo=null;break}var i=t.sibling;if(null!==i){i.return=t.return,Xo=i;break}Xo=t.return}}function Tl(e){for(;null!==Xo;){var t=Xo;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{nl(4,t)}catch(l){Ec(t,i,l)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var r=t.return;try{n.componentDidMount()}catch(l){Ec(t,r,l)}}var s=t.return;try{rl(t)}catch(l){Ec(t,s,l)}break;case 5:var a=t.return;try{rl(t)}catch(l){Ec(t,a,l)}}}catch(l){Ec(t,t.return,l)}if(t===e){Xo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Xo=o;break}Xo=t.return}}var wl,El=Math.ceil,Pl=k.ReactCurrentDispatcher,Cl=k.ReactCurrentOwner,Il=k.ReactCurrentBatchConfig,_l=0,Al=null,Rl=null,Ll=0,Dl=0,Ml=Er(0),Nl=0,Ol=null,xl=0,Ul=0,Fl=0,jl=null,Bl=null,Gl=0,Vl=1/0,zl=null,Wl=!1,Hl=null,ql=null,Kl=!1,Jl=null,Ql=0,Yl=0,$l=null,Xl=-1,Zl=0;function ec(){return 0!==(6&_l)?$e():-1!==Xl?Xl:Xl=$e()}function tc(e){return 0===(1&e.mode)?1:0!==(2&_l)&&0!==Ll?Ll&-Ll:null!==vs.transition?(0===Zl&&(Zl=vt()),Zl):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function ic(e,t,i,n){if(50<Yl)throw Yl=0,$l=null,Error(s(185));mt(e,i,n),0!==(2&_l)&&e===Al||(e===Al&&(0===(2&_l)&&(Ul|=i),4===Nl&&oc(e,Ll)),nc(e,n),1===i&&0===_l&&0===(1&t.mode)&&(Vl=$e()+500,jr&&Vr()))}function nc(e,t){var i=e.callbackNode;!function(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-at(s),o=1<<a,l=r[a];-1===l?0!==(o&i)&&0===(o&n)||(r[a]=pt(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var n=ht(e,e===Al?Ll:0);if(0===n)null!==i&&Je(i),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=i&&Je(i),1===t)0===e.tag?function(e){jr=!0,Gr(e)}(lc.bind(null,e)):Gr(lc.bind(null,e)),ar(function(){0===(6&_l)&&Vr()}),i=null;else{switch(kt(n)){case 1:i=Ze;break;case 4:i=et;break;case 16:default:i=tt;break;case 536870912:i=nt}i=Ac(i,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function rc(e,t){if(Xl=-1,Zl=0,0!==(6&_l))throw Error(s(327));var i=e.callbackNode;if(Tc()&&e.callbackNode!==i)return null;var n=ht(e,e===Al?Ll:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=gc(e,n);else{t=n;var r=_l;_l|=2;var a=fc();for(Al===e&&Ll===t||(zl=null,Vl=$e()+500,hc(e,t));;)try{yc();break}catch(l){pc(e,l)}Cs(),Pl.current=a,_l=r,null!==Rl?t=0:(Al=null,Ll=0,t=Nl)}if(0!==t){if(2===t&&(0!==(r=ft(e))&&(n=r,t=sc(e,r))),1===t)throw i=Ol,hc(e,0),oc(e,n),nc(e,$e()),i;if(6===t)oc(e,n);else{if(r=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var i=t.updateQueue;if(null!==i&&null!==(i=i.stores))for(var n=0;n<i.length;n++){var r=i[n],s=r.getSnapshot;r=r.value;try{if(!on(s(),r))return!1}catch(o){return!1}}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gc(e,n))&&(0!==(a=ft(e))&&(n=a,t=sc(e,a))),1===t))throw i=Ol,hc(e,0),oc(e,n),nc(e,$e()),i;switch(e.finishedWork=r,e.finishedLanes=n,t){case 0:case 1:throw Error(s(345));case 2:case 5:Sc(e,Bl,zl);break;case 3:if(oc(e,n),(130023424&n)===n&&10<(t=Gl+500-$e())){if(0!==ht(e,0))break;if(((r=e.suspendedLanes)&n)!==n){ec(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=nr(Sc.bind(null,e,Bl,zl),t);break}Sc(e,Bl,zl);break;case 4:if(oc(e,n),(4194240&n)===n)break;for(t=e.eventTimes,r=-1;0<n;){var o=31-at(n);a=1<<o,(o=t[o])>r&&(r=o),n&=~a}if(n=r,10<(n=(120>(n=$e()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*El(n/1960))-n)){e.timeoutHandle=nr(Sc.bind(null,e,Bl,zl),n);break}Sc(e,Bl,zl);break;default:throw Error(s(329))}}}return nc(e,$e()),e.callbackNode===i?rc.bind(null,e):null}function sc(e,t){var i=jl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Bl,Bl=i,null!==t&&ac(t)),e}function ac(e){null===Bl?Bl=e:Bl.push.apply(Bl,e)}function oc(e,t){for(t&=~Fl,t&=~Ul,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-at(t),n=1<<i;e[i]=-1,t&=~n}}function lc(e){if(0!==(6&_l))throw Error(s(327));Tc();var t=ht(e,0);if(0===(1&t))return nc(e,$e()),null;var i=gc(e,t);if(0!==e.tag&&2===i){var n=ft(e);0!==n&&(t=n,i=sc(e,n))}if(1===i)throw i=Ol,hc(e,0),oc(e,t),nc(e,$e()),i;if(6===i)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,Bl,zl),nc(e,$e()),null}function cc(e,t){var i=_l;_l|=1;try{return e(t)}finally{0===(_l=i)&&(Vl=$e()+500,jr&&Vr())}}function uc(e){null!==Jl&&0===Jl.tag&&0===(6&_l)&&Tc();var t=_l;_l|=1;var i=Il.transition,n=bt;try{if(Il.transition=null,bt=1,e)return e()}finally{bt=n,Il.transition=i,0===(6&(_l=t))&&Vr()}}function dc(){Dl=Ml.current,Pr(Ml)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,rr(i)),null!==Rl)for(i=Rl.return;null!==i;){var n=i;switch(ts(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&Mr();break;case 3:Ys(),Pr(Ar),Pr(_r),ia();break;case 5:Xs(n);break;case 4:Ys();break;case 13:case 19:Pr(Zs);break;case 10:Is(n.type._context);break;case 22:case 23:dc()}i=i.return}if(Al=e,Rl=e=Mc(e.current,null),Ll=Dl=t,Nl=0,Ol=null,Fl=Ul=xl=0,Bl=jl=null,null!==Ls){for(t=0;t<Ls.length;t++)if(null!==(n=(i=Ls[t]).interleaved)){i.interleaved=null;var r=n.next,s=i.pending;if(null!==s){var a=s.next;s.next=r,n.next=a}i.pending=n}Ls=null}return e}function pc(e,t){for(;;){var i=Rl;try{if(Cs(),na.current=$a,ca){for(var n=aa.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}ca=!1}if(sa=0,la=oa=aa=null,ua=!1,da=0,Cl.current=null,null===i||null===i.return){Nl=1,Ol=t,Rl=null;break}e:{var a=e,o=i.return,l=i,c=t;if(t=Ll,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=go(o);if(null!==f){f.flags&=-257,mo(f,o,l,0,t),1&f.mode&&vo(a,u,t),c=u;var v=(t=f).updateQueue;if(null===v){var g=new Set;g.add(c),t.updateQueue=g}else v.add(c);break e}if(0===(1&t)){vo(a,u,t),vc();break e}c=Error(s(426))}else if(rs&&1&l.mode){var m=go(o);if(null!==m){0===(65536&m.flags)&&(m.flags|=256),mo(m,o,l,0,t),fs(lo(c,l));break e}}a=c=lo(c,l),4!==Nl&&(Nl=2),null===jl?jl=[a]:jl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Gs(a,po(0,c,t));break e;case 1:l=c;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===ql||!ql.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,Gs(a,fo(a,l,t));break e}}a=a.return}while(null!==a)}kc(i)}catch(k){t=k,Rl===i&&null!==i&&(Rl=i=i.return);continue}break}}function fc(){var e=Pl.current;return Pl.current=$a,null===e?$a:e}function vc(){0!==Nl&&3!==Nl&&2!==Nl||(Nl=4),null===Al||0===(268435455&xl)&&0===(268435455&Ul)||oc(Al,Ll)}function gc(e,t){var i=_l;_l|=2;var n=fc();for(Al===e&&Ll===t||(zl=null,hc(e,t));;)try{mc();break}catch(r){pc(e,r)}if(Cs(),_l=i,Pl.current=n,null!==Rl)throw Error(s(261));return Al=null,Ll=0,Nl}function mc(){for(;null!==Rl;)bc(Rl)}function yc(){for(;null!==Rl&&!Qe();)bc(Rl)}function bc(e){var t=wl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?kc(e):Rl=t,Cl.current=null}function kc(e){var t=e;do{var i=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(i=Ko(i,t,Dl)))return void(Rl=i)}else{if(null!==(i=Jo(i,t)))return i.flags&=32767,void(Rl=i);if(null===e)return Nl=6,void(Rl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Rl=t);Rl=t=e}while(null!==t);0===Nl&&(Nl=5)}function Sc(e,t,i){var n=bt,r=Il.transition;try{Il.transition=null,bt=1,function(e,t,i,n){do{Tc()}while(null!==Jl);if(0!==(6&_l))throw Error(s(327));i=e.finishedWork;var r=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var a=i.lanes|i.childLanes;if(function(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<i;){var r=31-at(i),s=1<<r;t[r]=0,n[r]=-1,e[r]=-1,i&=~s}}(e,a),e===Al&&(Rl=Al=null,Ll=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||Kl||(Kl=!0,Ac(tt,function(){return Tc(),null})),a=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||a){a=Il.transition,Il.transition=null;var o=bt;bt=1;var l=_l;_l|=4,Cl.current=null,function(e,t){if(er=Wt,pn(e=hn())){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(n&&0!==n.rangeCount){i=n.anchorNode;var r=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{i.nodeType,a.nodeType}catch(S){i=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==i||0!==r&&3!==h.nodeType||(l=o+r),h!==a||0!==n&&3!==h.nodeType||(c=o+n),3===h.nodeType&&(o+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===i&&++u===r&&(l=o),p===a&&++d===n&&(c=o),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}i=-1===l||-1===c?null:{start:l,end:c}}else i=null}i=i||{start:0,end:0}}else i=null;for(tr={focusedElem:e,selectionRange:i},Wt=!1,Xo=t;null!==Xo;)if(e=(t=Xo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Xo=e;else for(;null!==Xo;){t=Xo;try{var v=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var g=v.memoizedProps,m=v.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),m);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var k=t.stateNode.containerInfo;1===k.nodeType?k.textContent="":9===k.nodeType&&k.documentElement&&k.removeChild(k.documentElement);break;default:throw Error(s(163))}}catch(S){Ec(t,t.return,S)}if(null!==(e=t.sibling)){e.return=t.return,Xo=e;break}Xo=t.return}v=tl,tl=!1}(e,i),gl(i,e),fn(tr),Wt=!!er,tr=er=null,e.current=i,yl(i,e,r),Ye(),_l=l,bt=o,Il.transition=a}else e.current=i;if(Kl&&(Kl=!1,Jl=e,Ql=r),a=e.pendingLanes,0===a&&(ql=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),nc(e,$e()),null!==t)for(n=e.onRecoverableError,i=0;i<t.length;i++)r=t[i],n(r.value,{componentStack:r.stack,digest:r.digest});if(Wl)throw Wl=!1,e=Hl,Hl=null,e;0!==(1&Ql)&&0!==e.tag&&Tc(),a=e.pendingLanes,0!==(1&a)?e===$l?Yl++:(Yl=0,$l=e):Yl=0,Vr()}(e,t,i,n)}finally{Il.transition=r,bt=n}return null}function Tc(){if(null!==Jl){var e=kt(Ql),t=Il.transition,i=bt;try{if(Il.transition=null,bt=16>e?16:e,null===Jl)var n=!1;else{if(e=Jl,Jl=null,Ql=0,0!==(6&_l))throw Error(s(331));var r=_l;for(_l|=4,Xo=e.current;null!==Xo;){var a=Xo,o=a.child;if(0!==(16&Xo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Xo=u;null!==Xo;){var d=Xo;switch(d.tag){case 0:case 11:case 15:il(8,d,a)}var h=d.child;if(null!==h)h.return=d,Xo=h;else for(;null!==Xo;){var p=(d=Xo).sibling,f=d.return;if(sl(d),d===u){Xo=null;break}if(null!==p){p.return=f,Xo=p;break}Xo=f}}}var v=a.alternate;if(null!==v){var g=v.child;if(null!==g){v.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(null!==g)}}Xo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Xo=o;else e:for(;null!==Xo;){if(0!==(2048&(a=Xo).flags))switch(a.tag){case 0:case 11:case 15:il(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Xo=y;break e}Xo=a.return}}var b=e.current;for(Xo=b;null!==Xo;){var k=(o=Xo).child;if(0!==(2064&o.subtreeFlags)&&null!==k)k.return=o,Xo=k;else e:for(o=b;null!==Xo;){if(0!==(2048&(l=Xo).flags))try{switch(l.tag){case 0:case 11:case 15:nl(9,l)}}catch(T){Ec(l,l.return,T)}if(l===o){Xo=null;break e}var S=l.sibling;if(null!==S){S.return=l.return,Xo=S;break e}Xo=l.return}}if(_l=r,Vr(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(rt,e)}catch(T){}n=!0}return n}finally{bt=i,Il.transition=t}}return!1}function wc(e,t,i){e=js(e,t=po(0,t=lo(i,t),1),1),t=ec(),null!==e&&(mt(e,1,t),nc(e,t))}function Ec(e,t,i){if(3===e.tag)wc(e,e,i);else for(;null!==t;){if(3===t.tag){wc(t,e,i);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===ql||!ql.has(n))){t=js(t,e=fo(t,e=lo(i,e),1),1),e=ec(),null!==t&&(mt(t,1,e),nc(t,e));break}}t=t.return}}function Pc(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&i,Al===e&&(Ll&i)===i&&(4===Nl||3===Nl&&(130023424&Ll)===Ll&&500>$e()-Gl?hc(e,0):Fl|=i),nc(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var i=ec();null!==(e=Ns(e,t))&&(mt(e,t,i),nc(e,i))}function Ic(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),Cc(e,i)}function _c(e,t){var i=0;switch(e.tag){case 13:var n=e.stateNode,r=e.memoizedState;null!==r&&(i=r.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(s(314))}null!==n&&n.delete(t),Cc(e,i)}function Ac(e,t){return Ke(e,t)}function Rc(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(e,t,i,n){return new Rc(e,t,i,n)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Mc(e,t){var i=e.alternate;return null===i?((i=Lc(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=14680064&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Nc(e,t,i,n,r,a){var o=2;if(n=e,"function"===typeof e)Dc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case w:return Oc(i.children,r,a,t);case E:o=8,r|=8;break;case P:return(e=Lc(12,i,t,2|r)).elementType=P,e.lanes=a,e;case A:return(e=Lc(13,i,t,r)).elementType=A,e.lanes=a,e;case R:return(e=Lc(19,i,t,r)).elementType=R,e.lanes=a,e;case M:return xc(i,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:o=10;break e;case I:o=9;break e;case _:o=11;break e;case L:o=14;break e;case D:o=16,n=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Lc(o,i,t,r)).elementType=e,t.type=n,t.lanes=a,t}function Oc(e,t,i,n){return(e=Lc(7,e,n,t)).lanes=i,e}function xc(e,t,i,n){return(e=Lc(22,e,n,t)).elementType=M,e.lanes=i,e.stateNode={isHidden:!1},e}function Uc(e,t,i){return(e=Lc(6,e,null,t)).lanes=i,e}function Fc(e,t,i){return(t=Lc(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function jc(e,t,i,n,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Bc(e,t,i,n,r,s,a,o,l){return e=new jc(e,t,i,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Lc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},xs(s),e}function Gc(e){if(!e)return Ir;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Dr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var i=e.type;if(Dr(i))return Or(e,i,t)}return t}function Vc(e,t,i,n,r,s,a,o,l){return(e=Bc(i,n,!0,e,0,s,0,o,l)).context=Gc(null),i=e.current,(s=Fs(n=ec(),r=tc(i))).callback=void 0!==t&&null!==t?t:null,js(i,s,r),e.current.lanes=r,mt(e,r,n),nc(e,n),e}function zc(e,t,i,n){var r=t.current,s=ec(),a=tc(r);return i=Gc(i),null===t.context?t.context=i:t.pendingContext=i,(t=Fs(s,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=js(r,t,a))&&(ic(e,r,a,s),Bs(e,r,a)),a}function Wc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function qc(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}wl=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ar.current)bo=!0;else{if(0===(e.lanes&i)&&0===(128&t.flags))return bo=!1,function(e,t,i){switch(t.tag){case 3:Ao(t),ps();break;case 5:$s(t);break;case 1:Dr(t.type)&&xr(t);break;case 4:Qs(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,r=t.memoizedProps.value;Cr(Ts,n._currentValue),n._currentValue=r;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Cr(Zs,1&Zs.current),t.flags|=128,null):0!==(i&t.child.childLanes)?Uo(e,t,i):(Cr(Zs,1&Zs.current),null!==(e=Wo(e,t,i))?e.sibling:null);Cr(Zs,1&Zs.current);break;case 19:if(n=0!==(i&t.childLanes),0!==(128&e.flags)){if(n)return Vo(e,t,i);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Cr(Zs,Zs.current),n)break;return null;case 22:case 23:return t.lanes=0,Eo(e,t,i)}return Wo(e,t,i)}(e,t,i);bo=0!==(131072&e.flags)}else bo=!1,rs&&0!==(1048576&t.flags)&&Zr(t,qr,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;zo(e,t),e=t.pendingProps;var r=Lr(t,_r.current);As(t,i),r=va(null,t,n,e,r,i);var a=ga();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Dr(n)?(a=!0,xr(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,xs(t),r.updater=no,t.stateNode=r,r._reactInternals=t,oo(t,n,e,i),t=_o(null,t,n,!0,a,i)):(t.tag=0,rs&&a&&es(t),ko(null,t,r,i),t=t.child),t;case 16:n=t.elementType;e:{switch(zo(e,t),e=t.pendingProps,n=(r=n._init)(n._payload),t.type=n,r=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===_)return 11;if(e===L)return 14}return 2}(n),e=to(n,e),r){case 0:t=Co(null,t,n,e,i);break e;case 1:t=Io(null,t,n,e,i);break e;case 11:t=So(null,t,n,e,i);break e;case 14:t=To(null,t,n,to(n.type,e),i);break e}throw Error(s(306,n,""))}return t;case 0:return n=t.type,r=t.pendingProps,Co(e,t,n,r=t.elementType===n?r:to(n,r),i);case 1:return n=t.type,r=t.pendingProps,Io(e,t,n,r=t.elementType===n?r:to(n,r),i);case 3:e:{if(Ao(t),null===e)throw Error(s(387));n=t.pendingProps,r=(a=t.memoizedState).element,Us(e,t),Vs(t,n,null,i);var o=t.memoizedState;if(n=o.element,a.isDehydrated){if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Ro(e,t,n,i,r=lo(Error(s(423)),t));break e}if(n!==r){t=Ro(e,t,n,i,r=lo(Error(s(424)),t));break e}for(ns=cr(t.stateNode.containerInfo.firstChild),is=t,rs=!0,ss=null,i=Ss(t,null,n,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(ps(),n===r){t=Wo(e,t,i);break e}ko(e,t,n,i)}t=t.child}return t;case 5:return $s(t),null===e&&cs(t),n=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,o=r.children,ir(n,r)?o=null:null!==a&&ir(n,a)&&(t.flags|=32),Po(e,t),ko(e,t,o,i),t.child;case 6:return null===e&&cs(t),null;case 13:return Uo(e,t,i);case 4:return Qs(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=ks(t,null,n,i):ko(e,t,n,i),t.child;case 11:return n=t.type,r=t.pendingProps,So(e,t,n,r=t.elementType===n?r:to(n,r),i);case 7:return ko(e,t,t.pendingProps,i),t.child;case 8:case 12:return ko(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(n=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value,Cr(Ts,n._currentValue),n._currentValue=o,null!==a)if(on(a.value,o)){if(a.children===r.children&&!Ar.current){t=Wo(e,t,i);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===a.tag){(c=Fs(-1,i&-i)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}a.lanes|=i,null!==(c=a.alternate)&&(c.lanes|=i),_s(a.return,i,t),l.lanes|=i;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=i,null!==(l=o.alternate)&&(l.lanes|=i),_s(o,i,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}ko(e,t,r.children,i),t=t.child}return t;case 9:return r=t.type,n=t.pendingProps.children,As(t,i),n=n(r=Rs(r)),t.flags|=1,ko(e,t,n,i),t.child;case 14:return r=to(n=t.type,t.pendingProps),To(e,t,n,r=to(n.type,r),i);case 15:return wo(e,t,t.type,t.pendingProps,i);case 17:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:to(n,r),zo(e,t),t.tag=1,Dr(n)?(e=!0,xr(t)):e=!1,As(t,i),so(t,n,r),oo(t,n,r,i),_o(null,t,n,!0,e,i);case 19:return Vo(e,t,i);case 22:return Eo(e,t,i)}throw Error(s(156,t.tag))};var Kc="function"===typeof reportError?reportError:function(e){console.error(e)};function Jc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Xc(){}function Zc(e,t,i,n,r){var s=i._reactRootContainer;if(s){var a=s;if("function"===typeof r){var o=r;r=function(){var e=Wc(a);o.call(e)}}zc(t,a,e,r)}else a=function(e,t,i,n,r){if(r){if("function"===typeof n){var s=n;n=function(){var e=Wc(a);s.call(e)}}var a=Vc(t,n,e,0,null,!1,0,"",Xc);return e._reactRootContainer=a,e[fr]=a.current,Vn(8===e.nodeType?e.parentNode:e),uc(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof n){var o=n;n=function(){var e=Wc(l);o.call(e)}}var l=Bc(e,0,!1,null,0,!1,0,"",Xc);return e._reactRootContainer=l,e[fr]=l.current,Vn(8===e.nodeType?e.parentNode:e),uc(function(){zc(t,l,i,n)}),l}(i,t,e,r,n);return Wc(a)}Qc.prototype.render=Jc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));zc(e,t,null,null)},Qc.prototype.unmount=Jc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){zc(null,e,null,null)}),t[fr]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Mt.length&&0!==t&&t<Mt[i].priority;i++);Mt.splice(i,0,e),0===i&&Ut(e)}},St=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=dt(t.pendingLanes);0!==i&&(yt(t,1|i),nc(t,$e()),0===(6&_l)&&(Vl=$e()+500,Vr()))}break;case 13:uc(function(){var t=Ns(e,1);if(null!==t){var i=ec();ic(t,e,1,i)}}),qc(e,1)}},Tt=function(e){if(13===e.tag){var t=Ns(e,134217728);if(null!==t)ic(t,e,134217728,ec());qc(e,134217728)}},wt=function(e){if(13===e.tag){var t=tc(e),i=Ns(e,t);if(null!==i)ic(i,e,t,ec());qc(e,t)}},Et=function(){return bt},Pt=function(e,t){var i=bt;try{return bt=e,t()}finally{bt=i}},Te=function(e,t,i){switch(t){case"input":if(X(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var r=Sr(n);if(!r)throw Error(s(90));K(n),X(n,r)}}}break;case"textarea":se(e,i);break;case"select":null!=(t=i.value)&&ie(e,!!i.multiple,t,!1)}},_e=cc,Ae=uc;var eu={usingClientEntryPoint:!1,Events:[br,kr,Sr,Ce,Ie,cc]},tu={findFiberByHostInstance:yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},iu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var nu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nu.isDisabled&&nu.supportsFiber)try{rt=nu.inject(iu),st=nu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(s(200));return function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:T,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}(e,t,null,i)},t.createRoot=function(e,t){if(!Yc(e))throw Error(s(299));var i=!1,n="",r=Kc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Bc(e,1,!1,null,0,i,0,n,r),e[fr]=t.current,Vn(8===e.nodeType?e.parentNode:e),new Jc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,i){if(!$c(t))throw Error(s(200));return Zc(null,e,t,!0,i)},t.hydrateRoot=function(e,t,i){if(!Yc(e))throw Error(s(405));var n=null!=i&&i.hydratedSources||null,r=!1,a="",o=Kc;if(null!==i&&void 0!==i&&(!0===i.unstable_strictMode&&(r=!0),void 0!==i.identifierPrefix&&(a=i.identifierPrefix),void 0!==i.onRecoverableError&&(o=i.onRecoverableError)),t=Vc(t,null,e,1,null!=i?i:null,r,0,a,o),e[fr]=t.current,Vn(e),n)for(e=0;e<n.length;e++)r=(r=(i=n[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,r]:t.mutableSourceEagerHydrationData.push(i,r);return new Qc(t)},t.render=function(e,t,i){if(!$c(t))throw Error(s(200));return Zc(null,e,t,!1,i)},t.unmountComponentAtNode=function(e){if(!$c(e))throw Error(s(40));return!!e._reactRootContainer&&(uc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[fr]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,i,n){if(!$c(i))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return Zc(e,t,i,!1,n)},t.version="18.3.1-next-f1338f8080-20240426"},824:e=>{"use strict";const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const i=t.splitSections(e);return i&&i[0]},t.getMediaSections=function(e){const i=t.splitSections(e);return i.shift(),i},t.matchPrefix=function(e,i){return t.splitLines(e).filter(e=>0===e.indexOf(i))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const i={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let n=8;n<t.length;n+=2)switch(t[n]){case"raddr":i.relatedAddress=t[n+1];break;case"rport":i.relatedPort=parseInt(t[n+1],10);break;case"tcptype":i.tcpType=t[n+1];break;case"ufrag":i.ufrag=t[n+1],i.usernameFragment=t[n+1];break;default:void 0===i[t[n]]&&(i[t[n]]=t[n+1])}return i},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const i=e.component;"rtp"===i?t.push(1):"rtcp"===i?t.push(2):t.push(i),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let i;const n=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<n.length;r++)i=n[r].trim().split("="),t[i[0].trim()]=i[1];return t},t.writeFmtp=function(e){let t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),i={ssrc:parseInt(e.substring(7,t),10)},n=e.indexOf(":",t);return n>-1?(i.attribute=e.substring(t+1,n),i.value=e.substring(n+1)):i.attribute=e.substring(t+1),i},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const i=t.matchPrefix(e,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,i){return{role:"auto",fingerprints:t.matchPrefix(e+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let i="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),i},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,i){return t.matchPrefix(e+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,i){const n=t.matchPrefix(e+i,"a=ice-ufrag:")[0],r=t.matchPrefix(e+i,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" ");i.profile=n[2];for(let s=3;s<n.length;s++){const r=n[s],a=t.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(a){const n=t.parseRtpMap(a),s=t.matchPrefix(e,"a=fmtp:"+r+" ");switch(n.parameters=s.length?t.parseFmtp(s[0]):{},n.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(t.parseRtcpFb),i.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(n.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{i.headerExtensions.push(t.parseExtmap(e))});const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(e=>{r.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),i},t.writeRtpDescription=function(e,i){let n="";n+="m="+e+" ",n+=i.codecs.length>0?"9":"0",n+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=i.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",i.codecs.forEach(e=>{n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)});let r=0;return i.codecs.forEach(e=>{e.maxptime>r&&(r=e.maxptime)}),r>0&&(n+="a=maxptime:"+r+"\r\n"),i.headerExtensions&&i.headerExtensions.forEach(e=>{n+=t.writeExtmap(e)}),n},t.parseRtpEncodingParameters=function(e){const i=[],n=t.parseRtpParameters(e),r=-1!==n.fecMechanisms.indexOf("RED"),s=-1!==n.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),o=a.length>0&&a[0].ssrc;let l;const c=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));c.length>0&&c[0].length>1&&c[0][0]===o&&(l=c[0][1]),n.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:o,codecPayloadType:parseInt(e.parameters.apt,10)};o&&l&&(t.rtx={ssrc:l}),i.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:o,mechanism:s?"red+ulpfec":"red"},i.push(t))}}),0===i.length&&o&&i.push({ssrc:o});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,i.forEach(e=>{e.maxBitrate=u})),i},t.parseRtcpParameters=function(e){const i={},n=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];n&&(i.cname=n.value,i.ssrc=n.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=0===r.length;const s=t.matchPrefix(e,"a=rtcp-mux");return i.mux=s.length>0,i},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let i;const n=t.matchPrefix(e,"a=msid:");if(1===n.length)return i=n[0].substring(7).split(" "),{stream:i[0],track:i[1]};const r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return r.length>0?(i=r[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(e){const i=t.parseMLine(e),n=t.matchPrefix(e,"a=max-message-size:");let r;n.length>0&&(r=parseInt(n[0].substring(19),10)),isNaN(r)&&(r=65536);const s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:i.fmt,maxMessageSize:r};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let i=[];return i="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,i,n){let r;const s=void 0!==i?i:2;r=e||t.generateSessionId();return"v=0\r\no="+(n||"thisisadapterortc")+" "+r+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,i){const n=t.splitLines(e);for(let t=0;t<n.length;t++)switch(n[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[t].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const i=t.splitLines(e)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(e){const i=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;const i=t.splitLines(e);for(let t=0;t<i.length;t++)if(i[t].length<2||"="!==i[t].charAt(1))return!1;return!0},e.exports=t},853:(e,t,i)=>{"use strict";e.exports=i(234)},877:(e,t,i)=>{var n=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,i){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:r?t[e.name]:t;!function(e,t,i,r){if(r&&!i)t[r]=n(e[1]);else for(var s=0;s<i.length;s+=1)null!=e[s+1]&&(t[i[s]]=n(e[s+1]))}(i.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},s=i(321),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},i=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),n=i[i.length-1]);for(var o=0;o<(s[t]||[]).length;o+=1){var l=s[t][o];if(l.reg.test(a))return r(l,n,a)}}),t.media=i,t};var o=function(e,t){var i=t.split(/=(.+)/,2);return 2===i.length?e[i[0]]=n(i[1]):1===i.length&&t.length>1&&(e[i[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],i=e.split(" ").map(n),r=0;r<i.length;r+=3)t.push({component:i[r],ip:i[r+1],port:i[r+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,i=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),i=!0),{scid:t,paused:i}})})}},950:(e,t,i)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=i(730)}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.amdO={},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";var e={};i.r(e),i.d(e,{fixNegotiationNeeded:()=>X,shimAddTrackRemoveTrack:()=>Y,shimAddTrackRemoveTrackWithNative:()=>Q,shimGetDisplayMedia:()=>z,shimGetSendersWithDtmf:()=>q,shimGetStats:()=>K,shimGetUserMedia:()=>V,shimMediaStream:()=>W,shimOnTrack:()=>H,shimPeerConnection:()=>$,shimSenderReceiverGetStats:()=>J});var t={};i.r(t),i.d(t,{shimAddTransceiver:()=>oe,shimCreateAnswer:()=>ue,shimCreateOffer:()=>ce,shimGetDisplayMedia:()=>ee,shimGetParameters:()=>le,shimGetUserMedia:()=>Z,shimOnTrack:()=>te,shimPeerConnection:()=>ie,shimRTCDataChannel:()=>ae,shimReceiverGetStats:()=>re,shimRemoveStream:()=>se,shimSenderGetStats:()=>ne});var n={};i.r(n),i.d(n,{shimAudioContext:()=>be,shimCallbacksAPI:()=>pe,shimConstraints:()=>ve,shimCreateOfferLegacy:()=>ye,shimGetUserMedia:()=>fe,shimLocalStreamsAPI:()=>de,shimRTCIceServerUrls:()=>ge,shimRemoteStreamsAPI:()=>he,shimTrackEventTransceiver:()=>me});var r={};i.r(r),i.d(r,{removeExtmapAllowMixed:()=>Ie,shimAddIceCandidateNullOrEmpty:()=>_e,shimConnectionState:()=>Ce,shimMaxMessageSize:()=>Ee,shimParameterlessSetLocalDescription:()=>Ae,shimRTCIceCandidate:()=>Te,shimRTCIceCandidateRelayProtocol:()=>we,shimSendThrowTypeError:()=>Pe});var s=i(43),a=i(391);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function l(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}function c(e,t,i){return(t=l(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function d(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach(function(t){c(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function h(e){let t;const i=new Set,n=(e,n)=>{const r="function"===typeof e?e(t):e;if(r!==t){const e=t;t=n?r:Object.assign({},t,r),i.forEach(i=>i(t,e))}},r=()=>t,s={setState:n,getState:r,subscribe:(e,n,s)=>n||s?function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let a=n(t);function o(){const i=n(t);if(!s(a,i)){const t=a;e(a=i,t)}}return i.add(o),()=>i.delete(o)}(e,n,s):(i.add(e),()=>i.delete(e)),destroy:()=>i.clear()};return t=e(n,r,s),s}const p="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?s.useEffect:s.useLayoutEffect;function f(e){const t="function"===typeof e?h(e):e,i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getState,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is;const[,n]=(0,s.useReducer)(e=>e+1,0),r=t.getState(),a=(0,s.useRef)(r),o=(0,s.useRef)(e),l=(0,s.useRef)(i),c=(0,s.useRef)(!1),u=(0,s.useRef)();let d;void 0===u.current&&(u.current=e(r));let h=!1;(a.current!==r||o.current!==e||l.current!==i||c.current)&&(d=e(r),h=!i(u.current,d)),p(()=>{h&&(u.current=d),a.current=r,o.current=e,l.current=i,c.current=!1});const f=(0,s.useRef)(r);p(()=>{const e=()=>{try{const e=t.getState(),i=o.current(e);l.current(u.current,i)||(a.current=e,u.current=i,n())}catch(e){c.current=!0,n()}},i=t.subscribe(e);return t.getState()!==f.current&&e(),i},[]);const v=h?d:u.current;return(0,s.useDebugValue)(v),v};return Object.assign(i,t),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const e=[i,t];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},i}function v(e,t){return e===t}var g=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var s=0,a=n.pop(),o=function(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every(function(e){return"function"===typeof e})){var i=t.map(function(e){return typeof e}).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+i+"]")}return t}(n),l=e.apply(void 0,[function(){return s++,a.apply(null,arguments)}].concat(i)),c=e(function(){for(var e=[],t=o.length,i=0;i<t;i++)e.push(o[i].apply(null,arguments));return l.apply(null,e)});return c.resultFunc=a,c.dependencies=o,c.recomputations=function(){return s},c.resetRecomputations=function(){return s=0},c}}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v,i=null,n=null;return function(){return function(e,t,i){if(null===t||null===i||t.length!==i.length)return!1;for(var n=t.length,r=0;r<n;r++)if(!e(t[r],i[r]))return!1;return!0}(t,i,arguments)||(n=e.apply(null,arguments)),i=arguments,n}});var m,y=i(121),b=new Uint8Array(16);function k(){if(!m&&!(m="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return m(b)}const S=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const T=function(e){return"string"===typeof e&&S.test(e)};for(var w=[],E=0;E<256;++E)w.push((E+256).toString(16).substr(1));const P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(w[e[t+0]]+w[e[t+1]]+w[e[t+2]]+w[e[t+3]]+"-"+w[e[t+4]]+w[e[t+5]]+"-"+w[e[t+6]]+w[e[t+7]]+"-"+w[e[t+8]]+w[e[t+9]]+"-"+w[e[t+10]]+w[e[t+11]]+w[e[t+12]]+w[e[t+13]]+w[e[t+14]]+w[e[t+15]]).toLowerCase();if(!T(i))throw TypeError("Stringified UUID is invalid");return i};const C=function(e,t,i){var n=(e=e||{}).random||(e.rng||k)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return P(n)};var I=i(67),_=i.n(I);let A=!0,R=!0;function L(e,t,i){const n=e.match(t);return n&&n.length>=i&&parseFloat(n[i],10)}function D(e,t,i){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return r.apply(this,arguments);const s=e=>{const t=i(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,s),r.apply(this,[e,s])};const s=n.removeEventListener;n.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(i))return s.apply(this,arguments);const n=this._eventMap[t].get(i);return this._eventMap[t].delete(i),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function M(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(A=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function N(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(R=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function O(){if("object"===typeof window){if(A)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}}function x(e,t){R&&console.warn(e+" is deprecated, please use "+t+" instead.")}function U(e){return"[object Object]"===Object.prototype.toString.call(e)}function F(e){return U(e)?Object.keys(e).reduce(function(t,i){const n=U(e[i]),r=n?F(e[i]):e[i],s=n&&!Object.keys(r).length;return void 0===r||s?t:Object.assign(t,{[i]:r})},{}):e}function j(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?j(e,e.get(t[n]),i):n.endsWith("Ids")&&t[n].forEach(t=>{j(e,e.get(t),i)})}))}function B(e,t,i){const n=i?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const s=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)}),s.forEach(t=>{e.forEach(i=>{i.type===n&&i.trackId===t.id&&j(e,i,r)})}),r}const G=O;function V(e,t){const i=e&&e.navigator;if(!i.mediaDevices)return;const n=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(i=>{if("require"===i||"advanced"===i||"mediaSource"===i)return;const n="object"===typeof e[i]?e[i]:{ideal:e[i]};void 0!==n.exact&&"number"===typeof n.exact&&(n.min=n.max=n.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"===typeof n.ideal?(e[r("min",i)]=n.ideal,t.optional.push(e),e={},e[r("max",i)]=n.ideal,t.optional.push(e)):(e[r("",i)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!==typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",i)]=n.exact):["min","max"].forEach(e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,i)]=n[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===typeof e.audio){const t=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===typeof e.video){let s=e.video.facingMode;s=s&&("object"===typeof s?s:{ideal:s});const a=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(t=["front"]),t)return i.mediaDevices.enumerateDevices().then(i=>{i=i.filter(e=>"videoinput"===e.kind);let a=i.find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!a&&i.length&&t.includes("back")&&(a=i[i.length-1]),a&&(e.video.deviceId=s.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=n(e.video),G("chrome: "+JSON.stringify(e)),r(e)})}e.video=n(e.video)}return G("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=function(e,t,n){r(e,e=>{i.webkitGetUserMedia(e,t,e=>{n&&n(s(e))})})}.bind(i),i.mediaDevices.getUserMedia){const e=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(t){return r(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(s(e))))}}}function z(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"===typeof t?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(t=>{const n=i.video&&i.video.width,r=i.video&&i.video.height,s=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},n&&(i.video.mandatory.maxWidth=n),r&&(i.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function W(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function H(e){if("object"===typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===i.track.id):{track:i.track};const r=new Event("track");r.track=i.track,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)}),t.stream.getTracks().forEach(i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===i.id):{track:i};const r=new Event("track");r.track=i,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else D(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function q(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let r=i.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function K(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,n]=arguments;if(arguments.length>0&&"function"===typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!==typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach(e=>{const i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{i[t]=e.stat(t)}),t[i.id]=i}),t},s=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const n=function(e){i(s(r(e)))};return t.apply(this,[n,e])}return new Promise((e,i)=>{t.apply(this,[function(t){e(s(r(t)))},i])}).then(i,n)}}function J(e){if(!("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>B(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),D(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>B(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,i,n;return this.getSenders().forEach(i=>{i.track===e&&(t?n=!0:t=i)}),this.getReceivers().forEach(t=>(t.track===e&&(i?n=!0:i=t),t.track===e)),n||t&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Q(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(n)&&this._shimmedLocalStreams[i.id].push(n):this._shimmedLocalStreams[i.id]=[i,n],n};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();i.apply(this,arguments);const n=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const i=this._shimmedLocalStreams[t].indexOf(e);-1!==i&&this._shimmedLocalStreams[t].splice(i,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),r.apply(this,arguments)}}function Y(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Q(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=i.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const n=e._reverseStreams[t],r=e._streams[n.id];i=i.replace(new RegExp(r.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:i})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[i.id];if(r)r.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const n=new e.MediaStream([t]);this._streams[i.id]=n,this._reverseStreams[n.id]=i,this.addStream(n)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments;return arguments.length&&"function"===typeof arguments[0]?i.apply(this,[t=>{const i=s(this,t);e[0].apply(null,[i])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):i.apply(this,arguments).then(e=>s(this,e))}};e.RTCPeerConnection.prototype[t]=n[t]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const n=e._reverseStreams[t],r=e._streams[n.id];i=i.replace(new RegExp(n.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:i})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=o.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(i=>{this._streams[i].getTracks().find(t=>e.track===t)&&(t=this._streams[i])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function $(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]})}function X(e,t){D(e,"negotiationneeded",e=>{const i=e.target;if(!(t.version<72||i.getConfiguration&&"plan-b"===i.getConfiguration().sdpSemantics)||"stable"===i.signalingState)return e})}function Z(e,t){const i=e&&e.navigator,n=e&&e.MediaStreamTrack;if(i.getUserMedia=function(e,t,n){x("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const e=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},t=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(i){return"object"===typeof i&&"object"===typeof i.audio&&(i=JSON.parse(JSON.stringify(i)),e(i.audio,"autoGainControl","mozAutoGainControl"),e(i.audio,"noiseSuppression","mozNoiseSuppression")),t(i)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const i=t.apply(this,arguments);return e(i,"mozAutoGainControl","autoGainControl"),e(i,"mozNoiseSuppression","noiseSuppression"),i}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(i){return"audio"===this.kind&&"object"===typeof i&&(i=JSON.parse(JSON.stringify(i)),e(i,"autoGainControl","mozAutoGainControl"),e(i,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[i])}}}}function ee(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===i.video?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function te(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ie(e,t){if("object"!==typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,s]=arguments;return n.apply(this,[e||null]).then(e=>{if(t.version<53&&!r)try{e.forEach(e=>{e.type=i[e.type]||e.type})}catch(n){if("TypeError"!==n.name)throw n;e.forEach((t,n)=>{e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(r,s)}}function ne(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function re(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),D(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function se(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){x("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function ae(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function oe(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const i=e.length>0;i&&e.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const n=t.apply(this,arguments);if(i){const{sender:t}=n,i=t.getParameters();(!("encodings"in i)||1===i.encodings.length&&0===Object.keys(i.encodings[0]).length)&&(i.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(i).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return n})}function le(e){if("object"!==typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ce(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function ue(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function de(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(i=>t.call(this,i,e)),e.getVideoTracks().forEach(i=>t.call(this,i,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return n&&n.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const i=e.getTracks();this.getSenders().forEach(e=>{i.includes(e.track)&&this.removeTrack(e)})})}}function he(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const i=new Event("addstream");i.stream=t,e.dispatchEvent(i)})}),t.apply(e,arguments)}}}function pe(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,n=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r};let o=function(e,t,i){const n=r.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n};t.setLocalDescription=o,o=function(e,t,i){const n=s.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.setRemoteDescription=o,o=function(e,t,i){const n=a.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.addIceCandidate=o}function fe(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>i(ve(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,i,n){t.mediaDevices.getUserMedia(e).then(i,n)}.bind(t))}function ve(e){return e&&void 0!==e.video?Object.assign({},e,{video:F(e.video)}):e}function ge(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){const t=[];for(let i=0;i<e.iceServers.length;i++){let n=e.iceServers[i];void 0===n.urls&&n.url?(x("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[i])}e.iceServers=t}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function me(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ye(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const i=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function be(e){"object"!==typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var ke=i(824),Se=i.n(ke);function Te(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const i=new t(e),n=Se().parseCandidate(e.candidate);for(const e in n)e in i||Object.defineProperty(i,e,{value:n[e]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,D(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function we(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||D(e,"icecandidate",e=>{if(e.candidate){const t=Se().parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function Ee(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Se().splitSections(e.sdp);return t.shift(),t.some(e=>{const t=Se().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const i=parseInt(t[1],10);return i!==i?-1:i}(arguments[0]),i=function(e){let i=65536;return"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i}(e),n=function(e,i){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const r=Se().matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?n=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==i&&(n=2147483637),n}(arguments[0],e);let r;r=0===i&&0===n?Number.POSITIVE_INFINITY:0===i||0===n?Math.max(i,n):Math.min(i,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>r}),this._sctp=s}return i.apply(this,arguments)}}function Pe(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const i=e.send;e.send=function(){const n=arguments[0],r=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=i.apply(this,arguments);return t(e,this),e},D(e,"datachannel",e=>(t(e.channel,e.target),e))}function Ce(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const i=new Event("connectionstatechange",e);t.dispatchEvent(i)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Ie(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t._safariVersion>=13.1)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const i=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:i}):t.sdp=i}return i.apply(this,arguments)}}function _e(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&0!==i.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Ae(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&0!==i.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!==typeof e||e.type&&e.sdp)return i.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return i.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>i.apply(this,[e]))})}const Re=function(){let{window:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const a=O,o=function(e){const t={browser:null,version:null};if("undefined"===typeof e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:i}=e;if(i.mozGetUserMedia)t.browser="firefox",t.version=parseInt(L(i.userAgent,/Firefox\/(\d+)\./,1));else if(i.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(L(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else{if(!e.RTCPeerConnection||!i.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=parseInt(L(i.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=L(i.userAgent,/Version\/(\d+(\.?\d+))/,1)}return t}(i),l={browserDetails:o,commonShim:r,extractVersion:L,disableLog:M,disableWarnings:N,sdp:ke};switch(o.browser){case"chrome":if(!e||!$||!s.shimChrome)return a("Chrome shim is not included in this adapter release."),l;if(null===o.version)return a("Chrome shim can not determine version, not shimming."),l;a("adapter.js shimming chrome."),l.browserShim=e,_e(i,o),Ae(i),V(i,o),W(i),$(i,o),H(i),Y(i,o),q(i),K(i),J(i),X(i,o),Te(i),we(i),Ce(i),Ee(i,o),Pe(i),Ie(i,o);break;case"firefox":if(!t||!ie||!s.shimFirefox)return a("Firefox shim is not included in this adapter release."),l;a("adapter.js shimming firefox."),l.browserShim=t,_e(i,o),Ae(i),Z(i,o),ie(i,o),te(i),se(i),ne(i),re(i),ae(i),oe(i),le(i),ce(i),ue(i),Te(i),Ce(i),Ee(i,o),Pe(i);break;case"safari":if(!n||!s.shimSafari)return a("Safari shim is not included in this adapter release."),l;a("adapter.js shimming safari."),l.browserShim=n,_e(i,o),Ae(i),ge(i),ye(i),pe(i),de(i),he(i),me(i),fe(i),be(i),Te(i),we(i),Ee(i,o),Pe(i),Ie(i,o);break;default:a("Unsupported browser!")}return l}({window:"undefined"===typeof window?void 0:window}),Le=Re;var De=i(476),Me=i.n(De);function Ne(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(i.length?" "+i.map(function(e){return"'"+e+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Oe(e){return!!e&&!!e[Tt]}function xe(e){var t;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var i=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return i===Object||"function"==typeof i&&Function.toString.call(i)===wt}(e)||Array.isArray(e)||!!e[St]||!!(null===(t=e.constructor)||void 0===t?void 0:t[St])||ze(e)||We(e))}function Ue(e,t,i){void 0===i&&(i=!1),0===Fe(e)?(i?Object.keys:Et)(e).forEach(function(n){i&&"symbol"==typeof n||t(n,e[n],e)}):e.forEach(function(i,n){return t(n,i,e)})}function Fe(e){var t=e[Tt];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:ze(e)?2:We(e)?3:0}function je(e,t){return 2===Fe(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Be(e,t){return 2===Fe(e)?e.get(t):e[t]}function Ge(e,t,i){var n=Fe(e);2===n?e.set(t,i):3===n?e.add(i):e[t]=i}function Ve(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function ze(e){return mt&&e instanceof Map}function We(e){return yt&&e instanceof Set}function He(e){return e.o||e.t}function qe(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=Pt(e);delete t[Tt];for(var i=Et(t),n=0;n<i.length;n++){var r=i[n],s=t[r];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[r]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[r]})}return Object.create(Object.getPrototypeOf(e),t)}function Ke(e,t){return void 0===t&&(t=!1),Qe(e)||Oe(e)||!xe(e)||(Fe(e)>1&&(e.set=e.add=e.clear=e.delete=Je),Object.freeze(e),t&&Ue(e,function(e,t){return Ke(t,!0)},!0)),e}function Je(){Ne(2)}function Qe(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function Ye(e){var t=Ct[e];return t||Ne(18,e),t}function $e(){return vt}function Xe(e,t){t&&(Ye("Patches"),e.u=[],e.s=[],e.v=t)}function Ze(e){et(e),e.p.forEach(it),e.p=null}function et(e){e===vt&&(vt=e.l)}function tt(e){return vt={p:[],l:vt,h:e,m:!0,_:0}}function it(e){var t=e[Tt];0===t.i||1===t.i?t.j():t.g=!0}function nt(e,t){t._=t.p.length;var i=t.p[0],n=void 0!==e&&e!==i;return t.h.O||Ye("ES5").S(t,e,n),n?(i[Tt].P&&(Ze(t),Ne(4)),xe(e)&&(e=rt(t,e),t.l||at(t,e)),t.u&&Ye("Patches").M(i[Tt].t,e,t.u,t.s)):e=rt(t,i,[]),Ze(t),t.u&&t.v(t.u,t.s),e!==kt?e:void 0}function rt(e,t,i){if(Qe(t))return t;var n=t[Tt];if(!n)return Ue(t,function(r,s){return st(e,n,t,r,s,i)},!0),t;if(n.A!==e)return t;if(!n.P)return at(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var r=4===n.i||5===n.i?n.o=qe(n.k):n.o,s=r,a=!1;3===n.i&&(s=new Set(r),r.clear(),a=!0),Ue(s,function(t,s){return st(e,n,r,t,s,i,a)}),at(e,r,!1),i&&e.u&&Ye("Patches").N(n,i,e.u,e.s)}return n.o}function st(e,t,i,n,r,s,a){if(Oe(r)){var o=rt(e,r,s&&t&&3!==t.i&&!je(t.R,n)?s.concat(n):void 0);if(Ge(i,n,o),!Oe(o))return;e.m=!1}else a&&i.add(r);if(xe(r)&&!Qe(r)){if(!e.h.D&&e._<1)return;rt(e,r),t&&t.A.l||at(e,r)}}function at(e,t,i){void 0===i&&(i=!1),!e.l&&e.h.D&&e.m&&Ke(t,i)}function ot(e,t){var i=e[Tt];return(i?He(i):e)[t]}function lt(e,t){if(t in e)for(var i=Object.getPrototypeOf(e);i;){var n=Object.getOwnPropertyDescriptor(i,t);if(n)return n;i=Object.getPrototypeOf(i)}}function ct(e){e.P||(e.P=!0,e.l&&ct(e.l))}function ut(e){e.o||(e.o=qe(e.t))}function dt(e,t,i){var n=ze(t)?Ye("MapSet").F(t,i):We(t)?Ye("MapSet").T(t,i):e.O?function(e,t){var i=Array.isArray(e),n={i:i?1:0,A:t?t.A:$e(),P:!1,I:!1,R:{},l:t,t:e,k:null,o:null,j:null,C:!1},r=n,s=It;i&&(r=[n],s=_t);var a=Proxy.revocable(r,s),o=a.revoke,l=a.proxy;return n.k=l,n.j=o,l}(t,i):Ye("ES5").J(t,i);return(i?i.A:$e()).p.push(n),n}function ht(e){return Oe(e)||Ne(22,e),function e(t){if(!xe(t))return t;var i,n=t[Tt],r=Fe(t);if(n){if(!n.P&&(n.i<4||!Ye("ES5").K(n)))return n.t;n.I=!0,i=pt(t,r),n.I=!1}else i=pt(t,r);return Ue(i,function(t,r){n&&Be(n.t,t)===r||Ge(i,t,e(r))}),3===r?new Set(i):i}(e)}function pt(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return qe(e)}var ft,vt,gt="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),mt="undefined"!=typeof Map,yt="undefined"!=typeof Set,bt="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,kt=gt?Symbol.for("immer-nothing"):((ft={})["immer-nothing"]=!0,ft),St=gt?Symbol.for("immer-draftable"):"__$immer_draftable",Tt=gt?Symbol.for("immer-state"):"__$immer_state",wt=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),Et="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Pt=Object.getOwnPropertyDescriptors||function(e){var t={};return Et(e).forEach(function(i){t[i]=Object.getOwnPropertyDescriptor(e,i)}),t},Ct={},It={get:function(e,t){if(t===Tt)return e;var i=He(e);if(!je(i,t))return function(e,t,i){var n,r=lt(t,i);return r?"value"in r?r.value:null===(n=r.get)||void 0===n?void 0:n.call(e.k):void 0}(e,i,t);var n=i[t];return e.I||!xe(n)?n:n===ot(e.t,t)?(ut(e),e.o[t]=dt(e.A.h,n,e)):n},has:function(e,t){return t in He(e)},ownKeys:function(e){return Reflect.ownKeys(He(e))},set:function(e,t,i){var n=lt(He(e),t);if(null==n?void 0:n.set)return n.set.call(e.k,i),!0;if(!e.P){var r=ot(He(e),t),s=null==r?void 0:r[Tt];if(s&&s.t===i)return e.o[t]=i,e.R[t]=!1,!0;if(Ve(i,r)&&(void 0!==i||je(e.t,t)))return!0;ut(e),ct(e)}return e.o[t]===i&&(void 0!==i||t in e.o)||Number.isNaN(i)&&Number.isNaN(e.o[t])||(e.o[t]=i,e.R[t]=!0),!0},deleteProperty:function(e,t){return void 0!==ot(e.t,t)||t in e.t?(e.R[t]=!1,ut(e),ct(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var i=He(e),n=Reflect.getOwnPropertyDescriptor(i,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:i[t]}:n},defineProperty:function(){Ne(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){Ne(12)}},_t={};Ue(It,function(e,t){_t[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),_t.deleteProperty=function(e,t){return _t.set.call(this,e,t,void 0)},_t.set=function(e,t,i){return It.set.call(this,e[0],t,i,e[0])};var At=function(){function e(e){var t=this;this.O=bt,this.D=!0,this.produce=function(e,i,n){if("function"==typeof e&&"function"!=typeof i){var r=i;i=e;var s=t;return function(e){var t=this;void 0===e&&(e=r);for(var n=arguments.length,a=Array(n>1?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return s.produce(e,function(e){var n;return(n=i).call.apply(n,[t,e].concat(a))})}}var a;if("function"!=typeof i&&Ne(6),void 0!==n&&"function"!=typeof n&&Ne(7),xe(e)){var o=tt(t),l=dt(t,e,void 0),c=!0;try{a=i(l),c=!1}finally{c?Ze(o):et(o)}return"undefined"!=typeof Promise&&a instanceof Promise?a.then(function(e){return Xe(o,n),nt(e,o)},function(e){throw Ze(o),e}):(Xe(o,n),nt(a,o))}if(!e||"object"!=typeof e){if(void 0===(a=i(e))&&(a=e),a===kt&&(a=void 0),t.D&&Ke(a,!0),n){var u=[],d=[];Ye("Patches").M(e,a,u,d),n(u,d)}return a}Ne(21,e)},this.produceWithPatches=function(e,i){if("function"==typeof e)return function(i){for(var n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return t.produceWithPatches(i,function(t){return e.apply(void 0,[t].concat(r))})};var n,r,s=t.produce(e,i,function(e,t){n=e,r=t});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(function(e){return[e,n,r]}):[s,n,r]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){xe(e)||Ne(8),Oe(e)&&(e=ht(e));var t=tt(this),i=dt(this,e,void 0);return i[Tt].C=!0,et(t),i},t.finishDraft=function(e,t){var i=(e&&e[Tt]).A;return Xe(i,t),nt(void 0,i)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!bt&&Ne(20),this.O=e},t.applyPatches=function(e,t){var i;for(i=t.length-1;i>=0;i--){var n=t[i];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}i>-1&&(t=t.slice(i+1));var r=Ye("Patches").$;return Oe(e)?r(e,t):this.produce(e,function(e){return r(e,t)})},e}(),Rt=new At,Lt=Rt.produce;Rt.produceWithPatches.bind(Rt),Rt.setAutoFreeze.bind(Rt),Rt.setUseProxies.bind(Rt),Rt.applyPatches.bind(Rt),Rt.createDraft.bind(Rt),Rt.finishDraft.bind(Rt);const Dt=function(e,t){if(Object.is(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(let n=0;n<i.length;n++)if(!Object.prototype.hasOwnProperty.call(t,i[n])||!Object.is(e[i[n]],t[i[n]]))return!1;return!0};const Mt=function(e){let t;const i=new Set,n=(e,n)=>{const r="function"===typeof e?e(t):e;if(r!==t){const e=t;t=n?r:Object.assign({},t,r),i.forEach(i=>i(t,e))}},r=()=>t,s={setState:n,getState:r,subscribe:(e,n,s)=>n||s?function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is,a=n(t);function o(){const i=n(t);if(!s(a,i)){const t=a;e(a=i,t)}}return i.add(o),()=>i.delete(o)}(e,n,s):(i.add(e),()=>i.delete(e)),destroy:()=>i.clear()};return t=e(n,r,s),s};var Nt=i(640),Ot=Object.defineProperty,xt=Object.defineProperties,Ut=Object.getOwnPropertyDescriptors,Ft=Object.getOwnPropertySymbols,jt=Object.getPrototypeOf,Bt=Object.prototype.hasOwnProperty,Gt=Object.prototype.propertyIsEnumerable,Vt=Reflect.get,zt=(e,t,i)=>t in e?Ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Wt=(e,t)=>{for(var i in t||(t={}))Bt.call(t,i)&&zt(e,i,t[i]);if(Ft)for(var i of Ft(t))Gt.call(t,i)&&zt(e,i,t[i]);return e},Ht=(e,t)=>xt(e,Ut(t)),qt=(e,t)=>{var i={};for(var n in e)Bt.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&Ft)for(var n of Ft(e))t.indexOf(n)<0&&Gt.call(e,n)&&(i[n]=e[n]);return i},Kt=(e,t,i)=>Vt(jt(e),i,t),Jt=(e,t,i)=>new Promise((n,r)=>{var s=e=>{try{o(i.next(e))}catch(t){r(t)}},a=e=>{try{o(i.throw(e))}catch(t){r(t)}},o=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,a);o((i=i.apply(e,t)).next())}),Qt=((e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports))((e,t)=>{t.exports={version:"0.12.36",license:"MIT",repository:{type:"git",url:"https://github.com/100mslive/web-sdks.git",directory:"packages/hms-video-store"},main:"dist/index.cjs.js",module:"dist/index.js",typings:"dist/index.d.ts",files:["dist","src"],engines:{node:">=12"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},sideEffects:!1,scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",format:"prettier --write src/**/*.ts",test:"jest --maxWorkers=1","test:watch":"jest --watch","test:coverage":"jest --coverage",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",docs:"rm -rf ./docs && typedoc && rm -f ./docs/README.md && mkdir ./docs/home &&mv ./docs/modules.md ./docs/home/content.md && node ../../scripts/docs-store && npx prettier --write './docs/**/*'"},name:"@100mslive/hms-video-store",author:"100ms",dependencies:{eventemitter2:"^6.4.9",immer:"^9.0.6","lodash.isequal":"^4.5.0",reselect:"4.0.0","sdp-transform":"^2.14.1","ua-parser-js":"^1.0.1",uuid:"^8.3.2","webrtc-adapter":"^8.0.0",zustand:"3.5.7"},devDependencies:{"@types/dom-screen-wake-lock":"^1.0.1","@types/lodash.isequal":"^4.5.8","@types/sdp-transform":"^2.4.4","@types/ua-parser-js":"^0.7.36","@types/uuid":"^8.3.0","jest-canvas-mock":"^2.3.1","jsdom-worker":"^0.3.0",tslib:"^2.2.0"},description:"@100mslive Core SDK which abstracts the complexities of webRTC while providing a reactive store for data management with a unidirectional data flow",keywords:["video","webrtc","conferencing","100ms"],gitHead:"777fbe43235a3488b310cd0a390a7e36150f6229"}}),Yt=(e=>(e.Disconnected="Disconnected",e.Preview="Preview",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed",e))(Yt||{}),$t=()=>({room:{id:"",isConnected:!1,name:"",peers:[],localPeer:"",roomState:"Disconnected",recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[],sessionStore:{},templateAppData:{},polls:{},whiteboards:{},hideLocalPeer:!1}),Xt=()=>({peerStats:{},remoteTrackStats:{},localTrackStats:{},localPeer:{id:""}}),Zt=(e=>(e.CHAT="chat",e))(Zt||{}),ei=(e=>(e.INFO="info",e.ERROR="error",e))(ei||{}),ti=(e=>(e.PEER_JOINED="PEER_JOINED",e.PEER_LEFT="PEER_LEFT",e.PEER_LIST="PEER_LIST",e.NEW_MESSAGE="NEW_MESSAGE",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED",e.TRACK_ADDED="TRACK_ADDED",e.TRACK_REMOVED="TRACK_REMOVED",e.TRACK_MUTED="TRACK_MUTED",e.TRACK_UNMUTED="TRACK_UNMUTED",e.TRACK_DEGRADED="TRACK_DEGRADED",e.TRACK_RESTORED="TRACK_RESTORED",e.TRACK_DESCRIPTION_CHANGED="TRACK_DESCRIPTION_CHANGED",e.ROLE_UPDATED="ROLE_UPDATED",e.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",e.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",e.ROOM_ENDED="ROOM_ENDED",e.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",e.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",e.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",e.NAME_UPDATED="NAME_UPDATED",e.METADATA_UPDATED="METADATA_UPDATED",e.POLL_CREATED="POLL_CREATED",e.POLL_STARTED="POLL_STARTED",e.POLL_STOPPED="POLL_STOPPED",e.POLL_VOTES_UPDATED="POLL_VOTES_UPDATED",e.POLLS_LIST="POLLS_LIST",e.HAND_RAISE_CHANGED="HAND_RAISE_CHANGED",e.TRANSCRIPTION_STATE_UPDATED="TRANSCRIPTION_STATE_UPDATED",e))(ti||{}),ii=(e=>(e.audio="audio",e.video="video",e))(ii||{});function ni(e,t){let i,n;if(t)for(let r of t.auxiliaryTracks){let t=e[r];ai(t)&&(n=ri(t)?t:n,i=si(t)?t:i)}return{video:i,audio:n}}function ri(e){return e&&"audio"===e.type}function si(e){return e&&"video"===e.type}function ai(e){return e&&"screen"===e.source}function oi(e){return e&&"audioplaylist"===e.source}function li(e){return e&&"videoplaylist"===e.source}function ci(e){return!!e&&!(null==e||!e.degraded)}function ui(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].enabled}function di(e){var t;let i=!1,n=!1,r=!1;return null!=(t=null==e?void 0:e.publishParams)&&t.allowed&&(i=e.publishParams.allowed.includes("video"),n=e.publishParams.allowed.includes("audio"),r=e.publishParams.allowed.includes("screen")),{video:i,audio:n,screen:r}}var hi=(e=>(e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.TIME=4]="TIME",e[e.TIMEEND=5]="TIMEEND",e[e.ERROR=6]="ERROR",e[e.NONE=7]="NONE",e))(hi||{}),pi="undefined"!=typeof window&&"undefined"!=typeof window.expect,fi=class{static v(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.log(0,e,...i)}static d(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.log(1,e,...i)}static i(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.log(2,e,...i)}static w(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.log(3,e,...i)}static e(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.log(6,e,...i)}static time(e){this.log(4,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(5,"[HMSPerformanceTiming]",e,e)}static cleanup(){performance.clearMarks(),performance.clearMeasures()}static log(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:console.log(t,...n);break;case 1:console.debug(t,...n);break;case 2:console.info(t,...n);break;case 3:console.warn(t,...n);break;case 6:console.error(t,...n);break;case 4:performance.mark(n[0]);break;case 5:{let e=n[0];try{let i=performance.measure(e,e);this.log(1,t,e,null==i?void 0:i.duration),performance.clearMarks(e),performance.clearMeasures(e)}catch(s){this.log(1,t,e,s)}break}}}};fi.level=pi?7:0;var vi,gi,mi,yi,bi,ki=class{constructor(e){this.tracks=new Array,this.nativeStream=e,this.id=e.id}updateId(e){this.id=e}},Si=new y.UAParser,Ti="undefined"!=typeof window,wi="undefined"==typeof window&&!(null!=(vi=Si.getBrowser().name)&&vi.toLowerCase().includes("electron")),Ei=()=>"mobile"===Si.getDevice().type,Pi=null==(mi=null==(gi=Si.getBrowser())?void 0:gi.name)?void 0:mi.toLowerCase().includes("safari"),Ci="firefox"===(null==(bi=null==(yi=Si.getBrowser())?void 0:yi.name)?void 0:bi.toLowerCase()),Ii=(e=>(e.CUSTOM="CUSTOM",e.LOCAL="LOCAL",e.HMS="HMS",e))(Ii||{});var _i=function(){if(Ti&&window){let e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"LOCAL":e.includes("app.100ms.live")?"HMS":"CUSTOM"}return"CUSTOM"}(),Ai={WebSocketConnectionErrors:{FAILED_TO_CONNECT:1e3,WEBSOCKET_CONNECTION_LOST:1003,ABNORMAL_CLOSE:1006},APIErrors:{SERVER_ERRORS:2e3,INIT_CONFIG_NOT_AVAILABLE:2002,ENDPOINT_UNREACHABLE:2003,INVALID_TOKEN_FORMAT:2004},TracksErrors:{GENERIC_TRACK:3e3,CANT_ACCESS_CAPTURE_DEVICE:3001,DEVICE_NOT_AVAILABLE:3002,DEVICE_IN_USE:3003,DEVICE_LOST_MIDWAY:3004,NOTHING_TO_RETURN:3005,INVALID_VIDEO_SETTINGS:3006,CODEC_CHANGE_NOT_PERMITTED:3007,AUTOPLAY_ERROR:3008,OVER_CONSTRAINED:3009,NO_AUDIO_DETECTED:3010,SYSTEM_DENIED_PERMISSION:3011,CURRENT_TAB_NOT_SHARED:3012,AUDIO_PLAYBACK_ERROR:3013,SELECTED_DEVICE_MISSING:3014,NO_DATA:3015},WebrtcErrors:{CREATE_OFFER_FAILED:4001,CREATE_ANSWER_FAILED:4002,SET_LOCAL_DESCRIPTION_FAILED:4003,SET_REMOTE_DESCRIPTION_FAILED:4004,ICE_FAILURE:4005,ICE_DISCONNECTED:4006,STATS_FAILED:4007},WebsocketMethodErrors:{SERVER_ERRORS:5e3,ALREADY_JOINED:5001,CANNOT_JOIN_PREVIEW_IN_PROGRESS:5002},GenericErrors:{NOT_CONNECTED:6e3,SIGNALLING:6001,UNKNOWN:6002,NOT_READY:6003,JSON_PARSING_FAILED:6004,TRACK_METADATA_MISSING:6005,RTC_TRACK_MISSING:6006,PEER_METADATA_MISSING:6007,INVALID_ROLE:6008,PREVIEW_IN_PROGRESS:6009,MISSING_MEDIADEVICES:6010,MISSING_RTCPEERCONNECTION:6011,LOCAL_STORAGE_ACCESS_DENIED:6012,VALIDATION_FAILED:6013},PlaylistErrors:{NO_ENTRY_TO_PLAY:8001,NO_ENTRY_IS_PLAYING:8002}},Ri=class e extends Error{constructor(t,i,n,r,s){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(r),this.code=t,this.name=i,this.message=r,this.description=s,this.isTerminal=a,Object.setPrototypeOf(this,e.prototype),this.action=n.toString()}toAnalyticsProperties(){return{error_name:this.name,error_code:this.code,error_message:this.message,error_description:this.description,action:this.action,is_terminal:this.isTerminal}}addNativeError(e){this.nativeError=e}toString(){var e;return"{\n        code: ".concat(this.code,";\n        name: ").concat(this.name,";\n        action: ").concat(this.action,";\n        message: ").concat(this.message,";\n        description: ").concat(this.description,";\n        isTerminal: ").concat(this.isTerminal,";\n        nativeError: ").concat(null==(e=this.nativeError)?void 0:e.message,";\n      }")}},Li=class extends Ri{constructor(e,t,i,n,r,s){super(e,t,i,n,r,!1),this.code=e,this.name=t,this.message=n,this.description=r,this.trackType=s}toAnalyticsProperties(){return Ht(Wt({},super.toAnalyticsProperties()),{track_type:this.trackType})}toString(){var e;return"{\n        code: ".concat(this.code,";\n        name: ").concat(this.name,";\n        action: ").concat(this.action,";\n        message: ").concat(this.message,";\n        description: ").concat(this.description,";\n        isTerminal: ").concat(this.isTerminal,";\n        nativeError: ").concat(null==(e=this.nativeError)?void 0:e.message,";\n        trackType: ").concat(this.trackType,";\n      }")}},Di=(e=>(e.AUDIO="audio",e.VIDEO="video",e.AUDIO_VIDEO="audio, video",e.SCREEN="screen",e))(Di||{});function Mi(e){switch(e){case"join":return"JOIN";case"offer":return"PUBLISH";case"answer":return"SUBSCRIBE";case"track-update":return"TRACK";default:return"NONE"}}var Ni=["join","offer","answer","trickle","on-error","JOIN"],Oi={WebSocketConnectionErrors:{FailedToConnect(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.WebSocketConnectionErrors.FAILED_TO_CONNECT,"WebsocketFailedToConnect",e,"[WS]: ".concat(t),"[WS]: ".concat(t))},WebSocketConnectionLost(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,"WebSocketConnectionLost",e,"Network connection lost",t)},AbnormalClose(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.WebSocketConnectionErrors.ABNORMAL_CLOSE,"WebSocketAbnormalClose",e,"Websocket closed abnormally",t)}},APIErrors:{ServerErrors(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Ri(e,"ServerErrors",t,"[".concat(t,"]: Server error ").concat(i),i,n)},EndpointUnreachable(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.APIErrors.ENDPOINT_UNREACHABLE,"EndpointUnreachable",e,"Endpoint is not reachable - ".concat(t),t)},InvalidTokenFormat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.APIErrors.INVALID_TOKEN_FORMAT,"InvalidTokenFormat",e,"Token is not in proper JWT format - ".concat(t),t,!0)},InitConfigNotAvailable(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.APIErrors.INIT_CONFIG_NOT_AVAILABLE,"InitError",e,"[INIT]: ".concat(t),"[INIT]: ".concat(t))}},TracksErrors:{GenericTrack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Li(Ai.TracksErrors.GENERIC_TRACK,"GenericTrack",e,"[TRACK]: ".concat(t),"[TRACK]: ".concat(t),"audio, video")},CantAccessCaptureDevice(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Li(Ai.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,"CantAccessCaptureDevice",e,"User denied permission to access capture device - ".concat(t),i,t)},DeviceNotAvailable(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Li(Ai.TracksErrors.DEVICE_NOT_AVAILABLE,"DeviceNotAvailable",e,"[TRACK]: Capture device is no longer available - ".concat(t),i,t)},DeviceInUse(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Li(Ai.TracksErrors.DEVICE_IN_USE,"DeviceInUse",e,"[TRACK]: Capture device is in use by another application - ".concat(t),i,t)},DeviceLostMidway(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Li(Ai.TracksErrors.DEVICE_LOST_MIDWAY,"DeviceLostMidway",e,"Lost access to capture device midway - ".concat(t),i,t)},NothingToReturn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"There is no media to return. Please select either video or audio or both.";return new Li(Ai.TracksErrors.NOTHING_TO_RETURN,"NothingToReturn",e,i,t,"audio, video")},InvalidVideoSettings(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Li(Ai.TracksErrors.INVALID_VIDEO_SETTINGS,"InvalidVideoSettings",e,"Cannot enable simulcast when no video settings are provided",t,"video")},AutoplayBlocked(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Li(Ai.TracksErrors.AUTOPLAY_ERROR,"AutoplayBlocked",e,"Autoplay blocked because the user didn't interact with the document first",t,"audio")},CodecChangeNotPermitted(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Li(Ai.TracksErrors.CODEC_CHANGE_NOT_PERMITTED,"CodecChangeNotPermitted",e,"Codec can't be changed mid call.",t,"audio, video")},OverConstrained(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Li(Ai.TracksErrors.OVER_CONSTRAINED,"OverConstrained",e,"[TRACK]: Requested constraints cannot be satisfied with the device hardware - ".concat(t),i,t)},NoAudioDetected(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Please check the mic or use another audio input";return new Li(Ai.TracksErrors.NO_AUDIO_DETECTED,"NoAudioDetected",e,"No audio input detected from microphone",t,"audio")},SystemDeniedPermission(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Li(Ai.TracksErrors.SYSTEM_DENIED_PERMISSION,"SystemDeniedPermission",e,"Operating System denied permission to access capture device - ".concat(t),i,t)},CurrentTabNotShared:()=>new Li(Ai.TracksErrors.CURRENT_TAB_NOT_SHARED,"CurrentTabNotShared","TRACK","The app requires you to share the current tab","You must screen share the current tab in order to proceed","screen"),AudioPlaybackError:e=>new Li(Ai.TracksErrors.AUDIO_PLAYBACK_ERROR,"Audio playback error","TRACK",e,e,"audio"),SelectedDeviceMissing:e=>new Li(Ai.TracksErrors.SELECTED_DEVICE_MISSING,"SelectedDeviceMissing","TRACK","Could not detect selected ".concat(e," device"),"Please check connection to the ".concat(e," device"),e),NoDataInTrack:e=>new Li(Ai.TracksErrors.NO_DATA,"Track does not have any data","TRACK",e,"This could possibily due to another application taking priority over the access to camera or microphone or due to an incoming call","audio, video")},WebrtcErrors:{CreateOfferFailed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.WebrtcErrors.CREATE_OFFER_FAILED,"CreateOfferFailed",e,"[".concat(e.toString(),"]: Failed to create offer. "),t)},CreateAnswerFailed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.WebrtcErrors.CREATE_ANSWER_FAILED,"CreateAnswerFailed",e,"[".concat(e.toString(),"]: Failed to create answer. "),t)},SetLocalDescriptionFailed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.WebrtcErrors.SET_LOCAL_DESCRIPTION_FAILED,"SetLocalDescriptionFailed",e,"[".concat(e.toString(),"]: Failed to set offer. "),t)},SetRemoteDescriptionFailed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.WebrtcErrors.SET_REMOTE_DESCRIPTION_FAILED,"SetRemoteDescriptionFailed",e,"[".concat(e.toString(),"]: Failed to set answer. "),t,!0)},ICEFailure(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Ri(Ai.WebrtcErrors.ICE_FAILURE,"ICEFailure",e,"[".concat(e.toString(),"]: Ice connection state FAILED"),t,i)},ICEDisconnected(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.WebrtcErrors.ICE_DISCONNECTED,"ICEDisconnected",e,"[".concat(e.toString(),"]: Ice connection state DISCONNECTED"),t)},StatsFailed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.WebrtcErrors.STATS_FAILED,"StatsFailed",e,"Failed to WebRTC get stats - ".concat(t),t)}},WebsocketMethodErrors:{ServerErrors:(e,t,i)=>new Ri(e,"ServerErrors",t,i,i,Ni.includes(t)),AlreadyJoined(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.WebsocketMethodErrors.ALREADY_JOINED,"AlreadyJoined",e,"[JOIN]: You have already joined this room.",t)},CannotJoinPreviewInProgress(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.WebsocketMethodErrors.CANNOT_JOIN_PREVIEW_IN_PROGRESS,"CannotJoinPreviewInProgress",e,"[JOIN]: Cannot join if preview is in progress",t)}},GenericErrors:{NotConnected(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.GenericErrors.NOT_CONNECTED,"NotConnected",e,"Client is not connected",t)},Signalling:(e,t)=>new Ri(Ai.GenericErrors.SIGNALLING,"Signalling",e,"Unknown signalling error: ".concat(e.toString()," ").concat(t," "),t),Unknown:(e,t)=>new Ri(Ai.GenericErrors.UNKNOWN,"Unknown",e,"Unknown exception: ".concat(t),t),NotReady(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.GenericErrors.NOT_READY,"NotReady",e,t,t)},JsonParsingFailed(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Ri(Ai.GenericErrors.JSON_PARSING_FAILED,"JsonParsingFailed",e,"Failed to parse JSON message - ".concat(t),i)},TrackMetadataMissing(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.GenericErrors.TRACK_METADATA_MISSING,"TrackMetadataMissing",e,"Track Metadata Missing",t)},RTCTrackMissing(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.GenericErrors.RTC_TRACK_MISSING,"RTCTrackMissing",e,"RTC Track missing",t)},PeerMetadataMissing(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.GenericErrors.PEER_METADATA_MISSING,"PeerMetadataMissing",e,"Peer Metadata Missing",t)},ValidationFailed:(e,t)=>new Ri(Ai.GenericErrors.VALIDATION_FAILED,"ValidationFailed","VALIDATION",e,t?JSON.stringify(t):""),InvalidRole:(e,t)=>new Ri(Ai.GenericErrors.INVALID_ROLE,"InvalidRole",e,"Invalid role. Join with valid role",t,!0),PreviewAlreadyInProgress(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ri(Ai.GenericErrors.PREVIEW_IN_PROGRESS,"PreviewAlreadyInProgress",e,"[Preview]: Cannot join if preview is in progress",t)},LocalStorageAccessDenied(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Access to localStorage has been denied";return new Ri(Ai.GenericErrors.LOCAL_STORAGE_ACCESS_DENIED,"LocalStorageAccessDenied","NONE","LocalStorageAccessDenied",e)},MissingMediaDevices:()=>new Ri(Ai.GenericErrors.MISSING_MEDIADEVICES,"MissingMediaDevices","JOIN","navigator.mediaDevices is undefined. 100ms SDK won't work on this website as WebRTC is not supported on HTTP endpoints(missing navigator.mediaDevices). Please ensure you're using the SDK either on localhost or a valid HTTPS endpoint.","",!0),MissingRTCPeerConnection:()=>new Ri(Ai.GenericErrors.MISSING_RTCPEERCONNECTION,"MissingRTCPeerConnection","JOIN","RTCPeerConnection which is a core requirement for WebRTC call was not found, this could be due to an unsupported browser or browser extensions blocking WebRTC","",!0)},MediaPluginErrors:{PlatformNotSupported(e){return new Ri(7001,"PlatformNotSupported",e,"Check HMS Docs to see the list of supported platforms",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")},InitFailed(e){return new Ri(7002,"InitFailed",e,"Plugin init failed",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")},ProcessingFailed(e){return new Ri(7003,"ProcessingFailed",e,"Plugin processing failed",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")},AddAlreadyInProgress(e){return new Ri(7004,"AddAlreadyInProgress",e,"Plugin add already in progress",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")},DeviceNotSupported(e){return new Ri(7005,"DeviceNotSupported",e,"Check HMS Docs to see the list of supported devices",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")}},PlaylistErrors:{NoEntryToPlay:(e,t)=>new Ri(Ai.PlaylistErrors.NO_ENTRY_TO_PLAY,"NoEntryToPlay",e,"Reached end of playlist",t),NoEntryPlaying:(e,t)=>new Ri(Ai.PlaylistErrors.NO_ENTRY_IS_PLAYING,"NoEntryIsPlaying",e,"No entry is playing at this time",t)}},xi=class{constructor(){this.valuesMap=new Map}getItem(e){return this.valuesMap.has(e)?String(this.valuesMap.get(e)):null}setItem(e,t){this.valuesMap.set(e,t)}removeItem(e){this.valuesMap.delete(e)}clear(){this.valuesMap.clear()}key(e){if(0===arguments.length)throw new TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");return Array.from(this.valuesMap.keys())[e]}get length(){return this.valuesMap.size}},Ui=class{constructor(e){this.key=e,this.storage=null}getStorage(){try{return Ti&&!this.storage&&((()=>{try{Ti&&!localStorage&&(window.localStorage=new xi)}catch(Be){fi.e("Error initialising localStorage",Oi.GenericErrors.LocalStorageAccessDenied())}})(),this.storage=window.localStorage),this.storage}catch(e){return fi.e("Error initialising localStorage",Oi.GenericErrors.LocalStorageAccessDenied()),null}}get(){var e;let t=null==(e=this.getStorage())?void 0:e.getItem(this.key);return t?JSON.parse(t):void 0}set(e){var t;let i=JSON.stringify(e);null==(t=this.getStorage())||t.setItem(this.key,i)}clear(){var e;null==(e=this.getStorage())||e.removeItem(this.key)}},Fi=()=>{let e,t=new Ui("hms-analytics-deviceId"),i=t.get();return i?e=i:(e=C(),t.set(e)),e},ji="[VALIDATIONS]";function Bi(e){return null!=e}var Gi=()=>{if(!Bi(RTCPeerConnection)){let e=Oi.GenericErrors.MissingRTCPeerConnection();throw fi.e(ji,e),e}},Vi=()=>{if(!Bi(navigator.mediaDevices)){let e=Oi.GenericErrors.MissingMediaDevices();throw fi.e(ji,e),e}},zi=Qt().version;function Wi(){let e=arguments.length>1?arguments[1]:void 0,t="LOCAL"!==_i&&"prod"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"prod")?"prod":"debug";if(wi)return qi({os:"web_nodejs",os_version:process.version,sdk:"web",sdk_version:zi,env:t,domain:_i,is_prebuilt:!(null==e||!e.isPrebuilt),framework:"node",framework_version:process.version,framework_sdk_version:null==e?void 0:e.sdkVersion});let i=Si.getOS(),n=Si.getDevice(),r=Si.getBrowser(),s=Hi("web_".concat(i.name)),a=i.version||"",o=Hi("".concat(r.name,"_").concat(r.version)),l=o;return n.type&&(l="".concat(Hi("".concat(n.vendor,"_").concat(n.type)),"/").concat(o)),qi({os:s,os_version:a,sdk:"web",sdk_version:zi,device_model:l,env:t,domain:_i,is_prebuilt:!(null==e||!e.isPrebuilt),framework:null==e?void 0:e.type,framework_version:null==e?void 0:e.version,framework_sdk_version:null==e?void 0:e.sdkVersion})}function Hi(e){return e.replace(/ /g,"_")}var qi=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return Object.keys(e).filter(t=>Bi(e[t])).map(t=>"".concat(t,":").concat(e[t])).join(t)},Ki=class{constructor(e){let{name:t,level:i,properties:n,includesPII:r,timestamp:s}=e;this.metadata={peer:{},userAgent:Wi()},this.name=t,this.level=i,this.includesPII=r||!1,this.properties=n||{},this.timestamp=s||(new Date).getTime(),this.event_id=C(),this.device_id=Fi()}toSignalParams(){return{name:this.name,info:Ht(Wt({},this.properties),{timestamp:this.timestamp,domain:_i}),timestamp:(new Date).getTime()}}},Ji=class{static connect(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Date,r=arguments.length>4?arguments[4]:void 0,s=this.eventNameFor("connect",void 0===e),a=e?2:1,o=this.getPropertiesWithError(Ht(Wt({},t),{[this.KEY_REQUESTED_AT]:null==i?void 0:i.getTime(),[this.KEY_RESPONDED_AT]:null==n?void 0:n.getTime(),endpoint:r}),e);return new Ki({name:s,level:a,properties:o})}static disconnect(e,t){let i=e?2:1,n=this.getPropertiesWithError(t,e);return new Ki({name:"disconnected",level:i,properties:n})}static preview(e){var t=e,{error:i}=t,n=qt(t,["error"]);let r=this.eventNameFor("preview",void 0===i),s=i?2:1,a=this.getPropertiesWithError(n,i);return new Ki({name:r,level:s,properties:a})}static join(e){var t=e,{error:i}=t,n=qt(t,["error"]);let r=this.eventNameFor("join",void 0===i),s=i?2:1,a=this.getPropertiesWithError(Ht(Wt({},n),{is_preview_called:!!n.is_preview_called}),i);return new Ki({name:r,level:s,properties:a})}static publish(e){let{devices:t,settings:i,error:n}=e,r=this.eventNameFor("publish",void 0===n),s=n?2:1,a=this.getPropertiesWithError({devices:t,audio:null==i?void 0:i.audio,video:null==i?void 0:i.video},n);return new Ki({name:r,level:s,properties:a})}static hlsPlayerError(e){return new Ki({name:"hlsPlayerError",level:2,properties:this.getErrorProperties(e)})}static subscribeFail(e){let t=this.eventNameFor("subscribe",!1),i=this.getErrorProperties(e);return new Ki({name:t,level:2,properties:i})}static leave(){return new Ki({name:"leave",level:1})}static autoplayError(){return new Ki({name:"autoplayError",level:2})}static audioPlaybackError(e){return new Ki({name:"audioPlaybackError",level:2,properties:this.getErrorProperties(e)})}static audioRecovered(e){return new Ki({name:"audioRecovered",level:1,properties:{message:e}})}static permissionChange(e,t){return new Ki({name:"permissionChanged",level:1,properties:{message:"Perrmission for ".concat(e," changed to ").concat(t)}})}static deviceChange(e){let{isUserSelection:t,selection:i,type:n,devices:r,error:s}=e,a=this.eventNameFor(s?"publish":"device.".concat(n),void 0===s),o=s?2:1,l=this.getPropertiesWithError({selection:i,devices:r,isUserSelection:t},s);return new Ki({name:a,level:o,properties:l})}static performance(e){let t=e.toAnalyticsProperties();return new Ki({name:"perf.stats",level:1,properties:t})}static rtcStats(e){let t=e.toAnalyticsProperties();return new Ki({name:"rtc.stats",level:1,properties:t})}static rtcStatsFailed(e){return new Ki({name:"rtc.stats.failed",level:2,properties:this.getErrorProperties(e)})}static degradationStats(e,t){let i={degradedAt:e.degradedAt,trackId:e.trackId};if(!t&&e.degradedAt instanceof Date){let t=new Date,n=t.valueOf()-e.degradedAt.valueOf();i=Ht(Wt({},i),{duration:n,restoredAt:t})}return new Ki({name:"video.degradation.stats",level:1,properties:i})}static audioDetectionFail(e,t){let i=this.getPropertiesWithError({device:t},e);return new Ki({name:"audiopresence.failed",level:2,properties:i})}static previewNetworkQuality(e){return new Ki({name:"perf.networkquality.preview",level:e.error?2:1,properties:e})}static publishStats(e){return new Ki({name:"publisher.stats",level:1,properties:e})}static subscribeStats(e){return new Ki({name:"subscriber.stats",level:1,properties:e})}static getKrispUsage(e){return new Ki({name:"krisp.usage",level:1,properties:{duration:e}})}static krispStart(){return new Ki({name:"krisp.start",level:1})}static krispStop(){return new Ki({name:"krisp.stop",level:1})}static interruption(e){let{started:t,type:i,reason:n,deviceInfo:r}=e;return new Ki({name:"".concat(t?"interruption.start":"interruption.stop"),level:1,properties:Wt({reason:n,type:i},r)})}static eventNameFor(e,t){return"".concat(e,".").concat(t?"success":"failed")}static getPropertiesWithError(e,t){let i=this.getErrorProperties(t);return e=Wt(Wt({},i),e)}static getErrorProperties(e){return e?e instanceof Ri?e.toAnalyticsProperties():{error_name:e.name,error_message:e.message,error_description:e.cause}:{}}};Ji.KEY_REQUESTED_AT="requested_at",Ji.KEY_RESPONDED_AT="responded_at";var Qi=e=>e?"{\n    trackId: ".concat(e.id,";\n    kind: ").concat(e.kind,";\n    enabled: ").concat(e.enabled,";\n    muted: ").concat(e.muted,";\n    readyState: ").concat(e.readyState,";\n  }"):"",Yi=class{constructor(e,t,i){this.logIdentifier="",this.isTrackNotPublishing=()=>"ended"===this.nativeTrack.readyState||this.nativeTrack.muted,this.stream=e,this.nativeTrack=t,this.source=i}get enabled(){return this.nativeTrack.enabled}get trackId(){return this.firstTrackId||this.sdpTrackId||this.nativeTrack.id}getMediaTrackSettings(){return this.nativeTrack.getSettings()}setEnabled(e){return Jt(this,null,function*(){this.nativeTrack.enabled=e})}setSdpTrackId(e){this.sdpTrackId=e}setFirstTrackId(e){this.firstTrackId=e}sendInterruptionEvent(e){let{started:t,reason:i}=e;return Ji.interruption({started:t,type:this.type,reason:i,deviceInfo:{deviceId:this.nativeTrack.getSettings().deviceId,groupId:this.nativeTrack.getSettings().groupId}})}cleanup(){var e;fi.d("[HMSTrack]","Stopping track",this.toString()),null==(e=this.nativeTrack)||e.stop()}toString(){var e;return"{\n      streamId: ".concat(this.stream.id,";\n      peerId: ").concat(this.peerId,";\n      trackId: ").concat(this.trackId,";\n      mid: ").concat((null==(e=this.transceiver)?void 0:e.mid)||"-",";\n      logIdentifier: ").concat(this.logIdentifier,";\n      source: ").concat(this.source,";\n      enabled: ").concat(this.enabled,";\n      nativeTrack: ").concat(Qi(this.nativeTrack),";\n    }")}},$i=class extends Yi{constructor(e,t,i){if(super(e,t,i),this.type="audio",this.audioElement=null,"audio"!==t.kind)throw new Error("Expected 'track' kind = 'audio'")}getVolume(){return this.audioElement?Math.floor(100*this.audioElement.volume):null}setVolume(e){return Jt(this,null,function*(){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");yield this.subscribeToAudio(0!==e&&this.enabled),this.audioElement&&(this.audioElement.volume=e/100)})}setAudioElement(e){fi.d("[HMSAudioTrack]",this.logIdentifier,"adding audio element","".concat(this),e),this.audioElement=e}getAudioElement(){return this.audioElement}getOutputDevice(){return this.outputDevice}cleanup(){super.cleanup(),this.audioElement&&(this.audioElement.srcObject=null,this.audioElement.remove(),this.audioElement=null)}setOutputDevice(e){return Jt(this,null,function*(){var t;if(e){if(!this.audioElement)return fi.d("[HMSAudioTrack]",this.logIdentifier,"no audio element to set output","".concat(this)),void(this.outputDevice=e);try{"function"==typeof this.audioElement.setSinkId&&(Ci||(yield null==(t=this.audioElement)?void 0:t.setSinkId(e.deviceId)),this.outputDevice=e)}catch(i){fi.d("[HMSAudioTrack]","error in setSinkId",i)}}else fi.d("[HMSAudioTrack]",this.logIdentifier,"device is null","".concat(this))})}subscribeToAudio(e){return Jt(this,null,function*(){this.stream instanceof Nr&&(yield this.stream.setAudio(e,this.trackId,this.logIdentifier))})}},Xi=new class{constructor(){this.storage=new Ui("hms-device-selection"),this.remember=!1,this.TAG="[HMSDeviceStorage]"}setDevices(e){this.devices=e}rememberDevices(e){this.remember=e}updateSelection(e,t){let{deviceId:i,groupId:n}=t;if(!this.devices||!this.remember)return;let r=this.devices[e].find(e=>this.isSame({deviceId:i,groupId:n},e));if(!r)return void fi.w(this.TAG,"Could not find device with deviceId: ".concat(i,", groupId: ").concat(n));let s=this.storage.get()||{};s[e]=r,this.storage.set(s)}getSelection(){if(this.remember)return this.storage.get()}cleanup(){this.remember=!1,this.devices=void 0}isSame(e,t){return e.deviceId===t.deviceId&&(e.groupId===t.groupId||!e.groupId)}},Zi=(e=>(e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE",e))(Zi||{}),en=(e=>(e.PLATFORM_NOT_SUPPORTED="PLATFORM_NOT_SUPPORTED",e.DEVICE_NOT_SUPPORTED="DEVICE_NOT_SUPPORTED",e))(en||{}),tn=class{static failure(e,t){let i=Wt({plugin_name:e},t.toAnalyticsProperties());return new Ki({name:"mediaPlugin.failed",level:2,properties:i})}static audioPluginFailure(e,t,i){let n=Wt({plugin_name:e,sampleRate:t},i.toAnalyticsProperties());return new Ki({name:"mediaPlugin.failed",level:2,properties:n})}static audioPluginStats(e){let{pluginName:t,duration:i,loadTime:n,sampleRate:r}=e;return new Ki({name:"mediaPlugin.stats",level:1,properties:{plugin_name:t,duration:i,load_time:n,sampleRate:r}})}static added(e,t){return new Ki({name:"mediaPlugin.added",level:1,properties:{plugin_name:e,added_at:t}})}static stats(e){let{pluginName:t,duration:i,loadTime:n,avgPreProcessingTime:r,avgProcessingTime:s,inputFrameRate:a,pluginFrameRate:o}=e;return new Ki({name:"mediaPlugin.stats",level:1,properties:{plugin_name:t,duration:i,load_time:n,avg_preprocessing_time:r,avg_processing_time:s,input_frame_rate:a,plugin_frame_rate:o}})}},nn=class{constructor(e){this.eventBus=e,this.TAG="[AudioPluginsAnalytics]",this.initTime={},this.addedTimestamps={},this.pluginAdded={},this.pluginSampleRate={}}added(e,t){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.pluginSampleRate[e]=t,this.eventBus.analytics.publish(tn.added(e,this.addedTimestamps[e]))}removed(e){if(this.pluginAdded[e]){let t={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],sampleRate:this.pluginSampleRate[e]};this.eventBus.analytics.publish(tn.audioPluginStats(t)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(tn.audioPluginFailure(e,this.pluginSampleRate[e],t)),this.clean(e))}initWithTime(e,t){return Jt(this,null,function*(){if(this.initTime[e])return void fi.i(this.TAG,"Plugin Already loaded ".concat(e,", time it took: ").concat(this.initTime[e]));let i;try{i=yield this.timeInMs(t),fi.i(this.TAG,"Time taken for Plugin ".concat(e," initialization : ").concat(i))}catch(n){let t=Oi.MediaPluginErrors.InitFailed("AUDIO_PLUGINS","failed during initialization of plugin".concat(n.message||n));throw fi.e(this.TAG,t),this.failure(e,t),t}i&&(this.initTime[e]=i)})}timeInMs(e){return Jt(this,null,function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)})}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.pluginAdded[e],delete this.pluginSampleRate[e]}},rn=class{constructor(e,t,i){this.eventBus=t,this.TAG="[AudioPluginsManager]",this.pluginAddInProgress=!1,this.hmsTrack=e,this.pluginsMap=new Map,this.analytics=new nn(t),this.audioContext=dn.getAudioContext(),this.room=i}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e){return Jt(this,null,function*(){var t,i;let n=null==(t=e.getName)?void 0:t.call(e);if(n){if(this.pluginAddInProgress){let e=Oi.MediaPluginErrors.AddAlreadyInProgress("AUDIO_PLUGINS","Add Plugin is already in Progress");throw this.analytics.added(n,this.audioContext.sampleRate),this.analytics.failure(n,e),fi.w("can't add another plugin when previous add is in progress"),e}if("HMSKrispPlugin"===e.getName()){if(null==(i=this.room)||!i.isNoiseCancellationEnabled){let e="Krisp Noise Cancellation is not enabled for this room";if(0===this.pluginsMap.size)throw Error(e);return void fi.w(this.TAG,e)}this.eventBus.analytics.publish(Ji.krispStart())}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e)}finally{this.pluginAddInProgress=!1}}else fi.w("no name provided by the plugin")})}addPluginInternal(e){return Jt(this,null,function*(){var t,i;let n=null==(t=e.getName)?void 0:t.call(e);if(this.pluginsMap.get(n))fi.w(this.TAG,"plugin - ".concat(n," already added."));else{yield this.validateAndThrow(n,e),null==(i=e.setEventBus)||i.call(e,this.eventBus);try{0===this.pluginsMap.size?yield this.initAudioNodes():this.prevAudioNode&&this.prevAudioNode.disconnect(),this.analytics.added(n,this.audioContext.sampleRate),yield this.analytics.initWithTime(n,()=>Jt(this,null,function*(){return e.init()})),this.pluginsMap.set(n,e),yield this.processPlugin(e),yield this.connectToDestination(),yield this.updateProcessedTrack()}catch(r){throw fi.e(this.TAG,"failed to add plugin",r),r}}})}validatePlugin(e){return e.checkSupport(this.audioContext)}validateAndThrow(e,t){return Jt(this,null,function*(){let i=this.validatePlugin(t);if(i.isSupported)fi.i(this.TAG,"plugin is supported,- ".concat(t.getName()));else{if(this.analytics.added(e,this.audioContext.sampleRate),"PLATFORM_NOT_SUPPORTED"===i.errType){let t=Oi.MediaPluginErrors.PlatformNotSupported("AUDIO_PLUGINS","platform not supported, see docs");throw this.analytics.failure(e,t),yield this.cleanup(),t}if("DEVICE_NOT_SUPPORTED"===i.errType){let t=Oi.MediaPluginErrors.DeviceNotSupported("AUDIO_PLUGINS","audio device not supported, see docs");throw this.analytics.failure(e,t),yield this.cleanup(),t}}})}removePlugin(e){return Jt(this,null,function*(){if("HMSKrispPlugin"===e.getName())this.eventBus.analytics.publish(Ji.krispStop());yield this.removePluginInternal(e),0===this.pluginsMap.size?(yield this.cleanup(),fi.i(this.TAG,"No plugins left, stopping plugins loop"),yield this.hmsTrack.setProcessedTrack(void 0)):yield this.reprocessPlugins()})}cleanup(){return Jt(this,null,function*(){var e,t,i;for(let n of this.pluginsMap.values())yield this.removePluginInternal(n);yield this.hmsTrack.setProcessedTrack(void 0),null==(e=this.sourceNode)||e.disconnect(),null==(t=this.prevAudioNode)||t.disconnect(),null==(i=this.outputTrack)||i.stop(),this.sourceNode=void 0,this.destinationNode=void 0,this.prevAudioNode=void 0,this.outputTrack=void 0})}closeContext(){return Jt(this,null,function*(){this.audioContext=void 0})}reprocessPlugins(){return Jt(this,null,function*(){if(0===this.pluginsMap.size||!this.sourceNode)return;let e=Array.from(this.pluginsMap.values());yield this.cleanup(),yield this.initAudioNodes();for(let t of e)yield this.addPlugin(t);yield this.updateProcessedTrack()})}initAudioNodes(){return Jt(this,null,function*(){if(this.audioContext){let e=new MediaStream([this.hmsTrack.nativeTrack]);this.sourceNode=this.audioContext.createMediaStreamSource(e),this.destinationNode||(this.destinationNode=this.audioContext.createMediaStreamDestination(),this.outputTrack=this.destinationNode.stream.getAudioTracks()[0])}})}updateProcessedTrack(){return Jt(this,null,function*(){try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(e){throw fi.e(this.TAG,"error in setting processed track",e),e}})}processPlugin(e){return Jt(this,null,function*(){try{let t=yield e.processAudioTrack(this.audioContext,this.prevAudioNode||this.sourceNode);this.prevAudioNode&&this.prevAudioNode.connect(t),this.prevAudioNode=t}catch(xe){let i=e.getName();fi.e(this.TAG,"error in processing plugin ".concat(i),xe),yield this.removePluginInternal(e)}})}connectToDestination(){return Jt(this,null,function*(){try{this.prevAudioNode&&this.destinationNode&&this.prevAudioNode.context===this.destinationNode.context&&this.prevAudioNode.connect(this.destinationNode)}catch(e){fi.e(this.TAG,"error in connecting to destination node",e)}})}removePluginInternal(e){return Jt(this,null,function*(){var t;let i=null==(t=e.getName)?void 0:t.call(e);this.pluginsMap.get(i)?(fi.i(this.TAG,"removing plugin ".concat(i)),this.pluginsMap.delete(i),e.stop(),this.analytics.removed(i)):fi.w(this.TAG,"plugin - ".concat(i," not found to remove."))})}};function sn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("chrome"===Le.browserDetails.browser&&"NotAllowedError"===e.name&&e.message.includes("denied by system"))return Oi.TracksErrors.SystemDeniedPermission("TRACK",t,e.message);if("firefox"===Le.browserDetails.browser&&"NotFoundError"===e.name){let i=Oi.TracksErrors.SystemDeniedPermission("TRACK",t,e.message);return i.description="Capture device is either blocked at Operating System level or not available - ".concat(t),i}switch(e.name){case"OverconstrainedError":return Oi.TracksErrors.OverConstrained("TRACK",t,e.constraint);case"NotAllowedError":return Oi.TracksErrors.CantAccessCaptureDevice("TRACK",t,e.message);case"NotFoundError":return Oi.TracksErrors.DeviceNotAvailable("TRACK",t,e.message);case"NotReadableError":return Oi.TracksErrors.DeviceInUse("TRACK",t,e.message);case"TypeError":return Oi.TracksErrors.NothingToReturn("TRACK",e.message);default:return function(e,t){let i=e.toLowerCase(),n=Oi.TracksErrors.GenericTrack("TRACK",e);return i.includes("device not found")?n=Oi.TracksErrors.DeviceNotAvailable("TRACK",t,e):i.includes("permission denied")&&(n=Oi.TracksErrors.CantAccessCaptureDevice("TRACK",t,e)),n}(e.message,t)}}function an(e,t){let i=sn(e,t);return i.addNativeError(e),i}function on(e){return Jt(this,null,function*(){try{let t=!!e&&e.toConstraints();return t&&"object"==typeof t&&null!=e&&e.deviceId&&(t.deviceId={exact:e.deviceId}),(yield navigator.mediaDevices.getUserMedia({audio:t})).getAudioTracks()[0]}catch(t){throw an(t,"audio")}})}function ln(e){return Jt(this,null,function*(){try{let t=!!e&&e.toConstraints();return t&&"object"==typeof t&&null!=e&&e.deviceId&&(t.deviceId={exact:e.deviceId}),(yield navigator.mediaDevices.getUserMedia({video:t})).getVideoTracks()[0]}catch(t){throw an(t,"video")}})}function cn(e){return"canvas"in e||"MediaStreamAudioDestinationNode"===e.label||""===e.label}var un=(e,t)=>{navigator.permissions?navigator.permissions.query({name:e}).then(e=>{e.onchange=()=>{t(e.state)}}).catch(t=>{fi.e("".concat(e," not supported"),t.message)}):fi.d("Permissions API not supported")},dn={audioContext:null,getAudioContext(){return this.audioContext||(this.audioContext=Ci?new AudioContext:new AudioContext({sampleRate:32e3})),this.audioContext},resumeContext(){return Jt(this,null,function*(){try{return yield this.getAudioContext().resume()}catch(Be){fi.e("AudioContext",Be)}})}},hn=(e=>(e.SPEAKERPHONE="SPEAKERPHONE",e.WIRED="WIRED",e.BLUETOOTH="BLUETOOTH",e.EARPIECE="EARPIECE",e))(hn||{}),pn=e=>{if(!e)return fi.w("[DeviceManager]:","No device label provided"),"SPEAKERPHONE";let t=e.toLowerCase();return t.includes("speakerphone")?"SPEAKERPHONE":t.includes("wired")?"WIRED":/airpods|buds|wireless|bluetooth/gi.test(t)?"BLUETOOTH":t.includes("earpiece")?"EARPIECE":"SPEAKERPHONE"},fn=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;this.capacity=e,this.storage=[]}size(){return this.storage.length}toList(){return this.storage.slice(0)}enqueue(e){this.size()===this.capacity&&this.dequeue(),this.storage.push(e)}dequeue(){return this.storage.shift()}aggregate(e){return e(this.storage)}},vn="(function workerSetup() {\n  function ticker() {\n    self.postMessage('tick');\n  }\n  self.onmessage = function (event) {\n    const [data, time] = event.data;\n    switch (data) {\n      case 'start':\n        setTimeout(ticker, time);\n        break;\n      default:\n        break;\n    }\n  };\n})()";function gn(e){if(e<0)throw Error("`ms` should be a positive integer");return new Promise(t=>{setTimeout(t,e)})}function mn(e){if(e<0)throw Error("`ms` should be a positive integer");if("undefined"==typeof Worker)return gn(e);let t=new Worker(URL.createObjectURL(new Blob([vn],{type:"application/javascript"})));return t.postMessage(["start",e]),new Promise(e=>{t.onmessage=i=>{"tick"===i.data&&(e(),t.terminate())}})}function yn(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];clearTimeout(t),t=void 0;let a=this;t=setTimeout(()=>{e.apply(a,r)},i)}}var bn=class{constructor(e,t,i){this.track=e,this.audioLevelEvent=t,this.silenceEvent=i,this.TAG="[TrackAudioLevelMonitor]",this.audioLevel=0,this.isMonitored=!1,this.interval=100,this.historyInterval=700,this.history=new fn(this.historyInterval/this.interval),this.detectSilence=()=>Jt(this,null,function*(){let e=0;for(;this.isMonitored;){if(this.track.enabled){if(!this.isSilentThisInstant())break;if(e++,e>50){this.silenceEvent.publish({track:this.track});break}}yield gn(20)}});try{let e=new MediaStream([this.track.nativeTrack]);this.analyserNode=this.createAnalyserNodeForStream(e);let t=this.analyserNode.frequencyBinCount;this.dataArray=new Uint8Array(t)}catch(n){fi.w(this.TAG,"Unable to initialize AudioContext",n)}}start(){this.stop(),this.isMonitored=!0,fi.d(this.TAG,"Starting track Monitor","".concat(this.track)),this.loop().then(()=>fi.d(this.TAG,"Stopping track Monitor","".concat(this.track)))}stop(){this.analyserNode?(this.sendAudioLevel(0),this.isMonitored=!1):fi.d(this.TAG,"AudioContext not initialized")}loop(){return Jt(this,null,function*(){for(;this.isMonitored;)this.sendAudioLevel(this.getMaxAudioLevelOverPeriod()),yield gn(this.interval)})}sendAudioLevel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e=e>35?e:0,Math.abs(this.audioLevel-e)>5){this.audioLevel=e;let t={track:this.track,audioLevel:this.audioLevel};this.audioLevelEvent.publish(t)}}getMaxAudioLevelOverPeriod(){if(!this.analyserNode)return void fi.d(this.TAG,"AudioContext not initialized");let e=this.calculateAudioLevel();return void 0!==e&&this.history.enqueue(e),this.history.aggregate(e=>Math.max(...e))}calculateAudioLevel(){if(!this.analyserNode||!this.dataArray)return void fi.d(this.TAG,"AudioContext not initialized");this.analyserNode.getByteTimeDomainData(this.dataArray);let e=.009,t=e;for(let n of this.dataArray)t=Math.max(t,(n-128)/128);let i=(Math.log(e)-Math.log(t))/Math.log(e);return Math.ceil(Math.min(Math.max(100*i,0),100))}isSilentThisInstant(){if(this.analyserNode&&this.dataArray)return this.analyserNode.getByteTimeDomainData(this.dataArray),this.dataArray.every(e=>128===e||0===e);fi.d(this.TAG,"AudioContext not initialized")}createAnalyserNodeForStream(e){let t=dn.getAudioContext(),i=t.createMediaStreamSource(e),n=t.createAnalyser();return n.fftSize=2048,i.connect(n),n}},kn=(e=>(e.SIP="sip",e.REGULAR="regular",e))(kn||{}),Sn=(e=>(e.NONE="none",e.INITIALISED="initialised",e.STARTED="started",e.PAUSED="paused",e.RESUMED="resumed",e.STOPPED="stopped",e.FAILED="failed",e))(Sn||{}),Tn=(e=>(e.DVR="dvr",e.NO_DVR="no-dvr",e))(Tn||{}),wn=(e=>(e.REGULAR="regular",e.SCREEN="screen",e.COMPOSITE="composite",e))(wn||{}),En=(e=>(e.INITIALISED="initialised",e.STARTED="started",e.STOPPED="stopped",e.FAILED="failed",e))(En||{}),Pn=(e=>(e.CAPTION="caption",e))(Pn||{}),Cn={f:"high",h:"medium",q:"low"},In=(e=>(e.VOICE="voice",e.MUSIC="music",e))(In||{}),_n=(e=>(e.videoInput="videoInput",e.audioInput="audioInput",e.audioOutput="audioOutput",e))(_n||{}),An=class{constructor(){this._volume=1,this._codec="opus",this._maxBitrate=32,this._deviceId="default",this._audioMode="voice",this._advanced=[{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}},{highpassFilter:{exact:!0}},{audioMirroring:{exact:!0}}]}volume(e){if(!(0<=e&&e<=1))throw Error("volume can only be in range [0.0, 1.0]");return this._volume=e,this}codec(e){return this._codec=e,this}maxBitrate(e){if(e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate="music"===this._audioMode?320:e,this}deviceId(e){return this._deviceId=e,this}audioMode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"voice";return this._audioMode=e,"music"===this._audioMode?this._maxBitrate=320:this._maxBitrate=32,this}advanced(e){return this._advanced=e,this}build(){return new Rn(this._volume,this._codec,this._maxBitrate,this._deviceId,this._advanced,this._audioMode)}},Rn=class{constructor(e,t,i,n,r,s){this.volume=e,this.codec=t,this.maxBitrate=i,this.deviceId=n,this.advanced=r,this.audioMode=s,"music"===this.audioMode?this.maxBitrate=320:this.maxBitrate=32}toConstraints(){return{deviceId:this.deviceId,advanced:"music"===this.audioMode?[]:this.advanced}}toAnalyticsProperties(){return{audio_bitrate:this.maxBitrate,audio_codec:this.codec}}},Ln=class{constructor(){this._width=320,this._height=180,this._codec="vp8",this._maxFramerate=30,this._maxBitrate=150,this._advanced=[]}setWidth(e){return this._width=e,this}setHeight(e){return this._height=e,this}codec(e){return this._codec=e,this}maxFramerate(e){if(e&&e<=0)throw Error("maxFramerate should be >= 1");return this._maxFramerate=e,this}maxBitrate(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("number"==typeof e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,!this._maxBitrate&&t&&(this._maxBitrate=15e4),this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}facingMode(e){return this._facingMode=e,this}build(){return new Dn(this._width,this._height,this._codec,this._maxFramerate,this._deviceId,this._advanced,this._maxBitrate,this._facingMode)}},Dn=class{constructor(e,t,i,n,r,s,a,o){this.width=e,this.height=t,this.codec=i,this.maxFramerate=n,this.maxBitrate=a,this.deviceId=r,this.advanced=s,this.facingMode=o}toConstraints(e){let t="ideal";e&&(t="max");let i=this.improviseConstraintsAspect();return{width:{[t]:i.width},height:{[t]:i.height},frameRate:this.maxFramerate,deviceId:this.deviceId,facingMode:this.facingMode}}toAnalyticsProperties(){return{width:this.width,height:this.height,video_bitrate:this.maxBitrate,framerate:this.maxFramerate,video_codec:this.codec,facingMode:this.facingMode}}improviseConstraintsAspect(){return Ei()&&this.height&&this.width&&this.height>this.width?{width:this.height,height:this.width}:{width:this.width,height:this.height}}},Mn=class{constructor(){this._video=(new Ln).build(),this._audio=(new An).build(),this._screen=(new Ln).build(),this._simulcast=!1}video(e){return this._video=e,this}audio(e){return this._audio=e,this}screen(e){return this._screen=e,this}simulcast(e){return this._simulcast=e,this}build(){if(null===this._audio&&null===this._video)throw Oi.TracksErrors.NothingToReturn("TRACK");if(null===this._video&&this._simulcast)throw Oi.TracksErrors.InvalidVideoSettings("TRACK","Cannot enable simulcast when no video settings are provided");return new Nn(this._video,this._audio,this._simulcast,this._screen||void 0)}},Nn=class{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.video=e,this.audio=t,this.simulcast=i,this.screen=n}toAnalyticsProperties(){let e={audio_enabled:null!==this.audio,video_enabled:null!==this.video};return this.audio&&(e=Wt(Wt({},this.audio.toAnalyticsProperties()),e)),this.video&&(e=Wt(Wt({},this.video.toAnalyticsProperties()),e)),e}};function On(e,t){return function(i){return!_()(e[i],t[i])}}var xn,Un,Fn=class e extends $i{constructor(e,t,i,n){var r;let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(new An).build(),a=arguments.length>5?arguments[5]:void 0;super(e,t,i),r=this,this.eventBus=n,this.room=a,this.TAG="[HMSLocalAudioTrack]",this.tracksCreated=new Set,this.isPublished=!1,this.handleVisibilityChange=()=>Jt(this,null,function*(){if(this.shouldReacquireTrack())if("hidden"===document.visibilityState)this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:"visibility-change"}));else{fi.d(this.TAG,"On visibile replacing track as it is not publishing");try{yield this.replaceTrackWith(this.settings)}catch(e){this.eventBus.error.publish(e)}this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:"visibility-change"}))}else fi.d(this.TAG,"visibiltiy: ".concat(document.visibilityState),"".concat(this))}),this.trackPermissions=()=>{un("microphone",e=>{this.eventBus.analytics.publish(Ji.permissionChange(this.type,e)),"denied"===e&&this.eventBus.localAudioEnabled.publish({enabled:!1,track:this})})},this.handleTrackMute=()=>{fi.d(this.TAG,"muted natively");let e="hidden"===document.visibilityState?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:e})),this.eventBus.localAudioEnabled.publish({enabled:!1,track:this})},this.handleTrackUnmute=()=>Jt(this,null,function*(){fi.d(this.TAG,"unmuted natively");let e="hidden"===document.visibilityState?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:e}));try{yield this.setEnabled(this.enabled,!0),this.eventBus.localAudioUnmutedNatively.publish()}catch(t){this.eventBus.error.publish(t)}}),this.replaceSenderTrack=()=>Jt(this,null,function*(){this.transceiver&&"sendonly"===this.transceiver.direction?yield this.transceiver.sender.replaceTrack(this.processedTrack||this.nativeTrack):fi.d(this.TAG,"transceiver for ".concat(this.trackId," not available or not connected yet"))}),this.shouldReacquireTrack=()=>cn(this.nativeTrack)||this.isTrackNotPublishing(),this.handleSettingsChange=e=>Jt(this,null,function*(){let t=this.stream,i=On(e,this.settings);(i("maxBitrate")||i("audioMode"))&&e.maxBitrate&&(yield t.setMaxBitrateAndFramerate(this,e)),(i("advanced")||i("audioMode"))&&(yield this.replaceTrackWith(e))}),this.handleDeviceChange=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Jt(r,null,function*(){if(On(e,this.settings)("deviceId")){this.manuallySelectedDeviceId=t?this.manuallySelectedDeviceId:e.deviceId,fi.d(this.TAG,"device change","manual selection:",this.manuallySelectedDeviceId,"new device:",e.deviceId),yield this.replaceTrackWith(e);let i=this.nativeTrack.getSettings().groupId;!t&&e.deviceId&&(Xi.updateSelection("audioInput",{deviceId:e.deviceId,groupId:i}),this.eventBus.deviceChange.publish({isUserSelection:!0,type:"audioInput",selection:{deviceId:e.deviceId,groupId:i}}))}})},e.tracks.push(this),this.addTrackEventListeners(t),this.trackPermissions(),this.settings=s,s.deviceId!==t.getSettings().deviceId&&!cn(t)&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new rn(this,n,a),this.setFirstTrackId(t.id),"regular"===i&&document.addEventListener("visibilitychange",this.handleVisibilityChange)}clone(t){let i=this.nativeTrack.clone();t.nativeStream.addTrack(i);let n=new e(t,i,this.source,this.eventBus,this.settings,this.room);return n.peerId=this.peerId,this.pluginsManager.pluginsMap.size>0&&this.pluginsManager.pluginsMap.forEach(e=>{n.addPlugin(e).catch(t=>fi.e(this.TAG,"Plugin add failed while migrating",e,t))}),n}getManuallySelectedDeviceId(){return this.manuallySelectedDeviceId}resetManuallySelectedDeviceId(){this.manuallySelectedDeviceId=void 0}updateTrack(e){return Jt(this,null,function*(){e.enabled=this.enabled,yield this.stream.replaceStreamTrack(this.nativeTrack,e),this.nativeTrack=e,yield this.replaceSenderTrack(),this.audioLevelMonitor&&this.initAudioLevelMonitor()})}replaceTrackWith(e){return Jt(this,null,function*(){let t=this.nativeTrack;null==t||t.stop(),this.removeTrackEventListeners(t),this.tracksCreated.forEach(e=>e.stop()),this.tracksCreated.clear();try{let i=yield on(e);this.addTrackEventListeners(i),this.tracksCreated.add(i),fi.d(this.TAG,"replaceTrack, Previous track stopped",t,"newTrack",i),yield this.updateTrack(i)}catch(i){let e=yield on(this.settings);throw this.addTrackEventListeners(e),this.tracksCreated.add(e),yield this.updateTrack(e),this.isPublished&&this.eventBus.analytics.publish(Ji.publish({error:i})),i}try{yield this.pluginsManager.reprocessPlugins()}catch(i){this.eventBus.audioPluginFailed.publish(i)}})}setEnabled(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Jt(this,null,function*(){t===this.enabled&&!i||(t&&this.shouldReacquireTrack()&&(yield this.replaceTrackWith(this.settings)),yield Kt(e.prototype,this,"setEnabled").call(this,t),t&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),this.eventBus.localAudioEnabled.publish({enabled:t,track:this}))})}isPublishedTrackId(e){return this.publishedTrackId===e}setSettings(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Jt(this,null,function*(){let i=this.buildNewSettings(e);cn(this.nativeTrack)||(yield this.handleDeviceChange(i,t),yield this.handleSettingsChange(i)),this.settings=i})}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(e){return Jt(this,null,function*(){return this.pluginsManager.addPlugin(e)})}removePlugin(e){return Jt(this,null,function*(){return this.pluginsManager.removePlugin(e)})}validatePlugin(e){return this.pluginsManager.validatePlugin(e)}setProcessedTrack(e){return Jt(this,null,function*(){e?e!==this.processedTrack&&(this.processedTrack=e):this.processedTrack=void 0,yield this.replaceSenderTrack()})}initAudioLevelMonitor(){this.audioLevelMonitor&&this.destroyAudioLevelMonitor(),fi.d(this.TAG,"Monitor Audio Level for",this,this.getMediaTrackSettings().deviceId),this.audioLevelMonitor=new bn(this,this.eventBus.trackAudioLevelUpdate,this.eventBus.localAudioSilence),this.audioLevelMonitor.start(),this.audioLevelMonitor.detectSilence()}destroyAudioLevelMonitor(){var e;null==(e=this.audioLevelMonitor)||e.stop(),this.audioLevelMonitor=void 0}cleanup(){return Jt(this,null,function*(){var t;Kt(e.prototype,this,"cleanup").call(this),yield this.pluginsManager.cleanup(),yield this.pluginsManager.closeContext(),this.transceiver=void 0,null==(t=this.processedTrack)||t.stop(),this.tracksCreated.forEach(e=>e.stop()),this.tracksCreated.clear(),this.isPublished=!1,this.destroyAudioLevelMonitor(),document.removeEventListener("visibilitychange",this.handleVisibilityChange)})}getTrackIDBeingSent(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}getTrackBeingSent(){return this.processedTrack||this.nativeTrack}addTrackEventListeners(e){e.addEventListener("mute",this.handleTrackMute),e.addEventListener("unmute",this.handleTrackUnmute)}removeTrackEventListeners(e){e.removeEventListener("mute",this.handleTrackMute),e.removeEventListener("unmute",this.handleTrackUnmute)}buildNewSettings(e){let{volume:t,codec:i,maxBitrate:n,deviceId:r,advanced:s,audioMode:a}=Wt(Wt({},this.settings),e);return new Rn(t,i,n,r,s,a)}},jn=class e extends $i{setEnabled(t){return Jt(this,null,function*(){t!==this.enabled&&(yield Kt(e.prototype,this,"setEnabled").call(this,t),yield this.subscribeToAudio(t))})}},Bn=class extends Yi{constructor(e,t,i){if(super(e,t,i),this.type="video",this.sinkCount=0,this.handleTrackUnmute=()=>{this.getSinks().forEach(e=>this.reTriggerPlay({videoElement:e}))},this.reTriggerPlay=e=>{let{videoElement:t}=e;setTimeout(()=>{t.play().catch(e=>{fi.w("[HMSVideoTrack]","failed to play",e.message)})},0)},"video"!==t.kind)throw new Error("Expected 'track' kind = 'video'")}setVideoHandler(e){this.videoHandler=e}hasSinks(){return this.sinkCount>0}getSinks(){return this.videoHandler.getVideoElements()||[]}attach(e){this.videoHandler.addVideoElement(e)}detach(e){this.videoHandler.removeVideoElement(e)}addSink(e){this.addSinkInternal(e,this.nativeTrack)}removeSink(e){null!==e.srcObject&&(e.srcObject=null,this.reduceSinkCount())}cleanup(){super.cleanup(),this.videoHandler.cleanup()}addSinkInternal(e,t){let i=e.srcObject;if(null!==i&&i instanceof MediaStream){let e=i.getVideoTracks()[0];if((null==e?void 0:e.id)===t.id){if(!e.muted&&"live"===e.readyState)return;this.reduceSinkCount()}else this.reduceSinkCount()}this.addPropertiesToElement(e);let n=new MediaStream([t]);e.srcObject=n,this.reTriggerPlay({videoElement:e}),this.sinkCount++}reduceSinkCount(){this.sinkCount>0&&this.sinkCount--}addPropertiesToElement(e){Pi||(e.autoplay=!0),e.playsInline=!0,e.muted=!0,e.controls=!1}},Gn={none:-1,low:0,medium:1,high:2},Vn=(e,t)=>{let i="high",n=t.width>t.height?"width":"height",r=[...e].sort((e,t)=>Gn[e.layer]-Gn[t.layer]),s=t[n]*((null==window?void 0:window.devicePixelRatio)||1);for(let a=0;a<r.length;a++){let{resolution:e,layer:t}=r[a],o=e[n];if(s<=o){i=t;break}{let e=r[a+1];if((s-o)/((e?e.resolution[n]:Number.POSITIVE_INFINITY)-o)<.5){i=t;break}}}return i},zn=new class{constructor(){this.TAG="[HMSIntersectionObserverWrapper]",this.listeners=new WeakMap,this.observe=(e,t)=>{var i;this.createObserver(),this.unobserve(e),null==(i=this.intersectionObserver)||i.observe(e),this.listeners.set(e,t)},this.unobserve=e=>{var t;null==(t=this.intersectionObserver)||t.unobserve(e),this.listeners.delete(e)},this.createObserver=()=>{this.isSupported()&&!this.intersectionObserver&&(this.intersectionObserver=new IntersectionObserver(this.handleIntersection))},this.handleIntersection=e=>{var t;for(let i of e)null==(t=this.listeners.get(i.target))||t(i)},this.createObserver()}isSupported(){let e=Ti&&"undefined"!=typeof window.IntersectionObserver;return e||fi.w(this.TAG,"IntersectionObserver is not supported, fallback will be used instead"),e}},Wn=new class{constructor(){var e=this;this.TAG="[HMSResizeObserverWrapper]",this.listeners=new WeakMap,this.observe=function(t,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{box:"border-box"};var r;e.createObserver(),e.unobserve(t),null==(r=e.resizeObserver)||r.observe(t,n),e.listeners.set(t,i)},this.unobserve=e=>{var t;null==(t=this.resizeObserver)||t.unobserve(e),this.listeners.delete(e)},this.createObserver=()=>{this.isSupported()&&!this.resizeObserver&&(this.resizeObserver=new ResizeObserver(yn(this.handleResize,300)))},this.handleResize=e=>{var t;for(let i of e)null==(t=this.listeners.get(i.target))||t(i)},this.createObserver()}isSupported(){let e=Ti&&"undefined"!=typeof window.ResizeObserver;return e||fi.w(this.TAG,"Resize Observer is not supported"),e}},Hn=class{constructor(e){this.track=e,this.TAG="[VideoElementManager]",this.videoElements=new Set,this.entries=new WeakMap,this.handleIntersection=e=>Jt(this,null,function*(){let t="visible"===getComputedStyle(e.target).visibility;this.track.enabled&&(e.isIntersecting&&t||!document.contains(e.target))?(fi.d(this.TAG,"add sink intersection","".concat(this.track),this.id),this.entries.set(e.target,e.boundingClientRect),yield this.selectMaxLayer(),yield this.track.addSink(e.target)):(fi.d(this.TAG,"remove sink intersection","".concat(this.track),this.id),yield this.track.removeSink(e.target))}),this.handleResize=e=>Jt(this,null,function*(){!this.track.enabled||!(this.track instanceof Lr)||(this.entries.set(e.target,e.contentRect),yield this.selectMaxLayer())}),this.cleanup=()=>{this.videoElements.forEach(e=>{var t,i;e.srcObject=null,null==(t=this.resizeObserver)||t.unobserve(e),null==(i=this.intersectionObserver)||i.unobserve(e)}),this.videoElements.clear(),this.resizeObserver=void 0,this.intersectionObserver=void 0},this.init(),this.id=C()}updateSinks(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(let t of this.videoElements)this.track.enabled?this.track.addSink(t,e):this.track.removeSink(t,e)}addVideoElement(e){return Jt(this,null,function*(){var t;this.videoElements.has(e)||(this.init(),fi.d(this.TAG,"Adding video element for ".concat(this.track),this.id),this.videoElements.add(e),this.videoElements.size>=10&&fi.w(this.TAG,"".concat(this.track),"the track is added to ".concat(this.videoElements.size," video elements, while this may be intentional, it's likely that there is a bug leading to unnecessary creation of video elements in the UI")),null!=(t=this.intersectionObserver)&&t.isSupported()?this.intersectionObserver.observe(e,this.handleIntersection):Ti&&(this.isElementInViewport(e)?this.track.addSink(e):this.track.removeSink(e)),this.resizeObserver?this.resizeObserver.observe(e,this.handleResize):this.track instanceof Lr&&(yield this.track.setPreferredLayer(this.track.getPreferredLayer())))})}removeVideoElement(e){var t,i;this.track.removeSink(e),this.videoElements.delete(e),this.entries.delete(e),null==(t=this.resizeObserver)||t.unobserve(e),null==(i=this.intersectionObserver)||i.unobserve(e),fi.d(this.TAG,"Removing video element for ".concat(this.track))}getVideoElements(){return Array.from(this.videoElements)}init(){Ti&&(this.resizeObserver=Wn,this.intersectionObserver=zn)}isElementInViewport(e){let t=e.offsetTop,i=e.offsetLeft,n=e.offsetWidth,r=e.offsetHeight,{hidden:s}=e,{opacity:a,display:o}=getComputedStyle(e);for(;e.offsetParent;)t+=(e=e.offsetParent).offsetTop,i+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&i<window.pageXOffset+window.innerWidth&&t+r>window.pageYOffset&&i+n>window.pageXOffset&&!s&&(""===a||parseFloat(a)>0)&&"none"!==o}selectMaxLayer(){return Jt(this,null,function*(){if(!(this.track instanceof Lr)||0===this.videoElements.size)return;let e;for(let t of this.videoElements){let i=this.entries.get(t);if(!i)continue;let{width:n,height:r}=i;if(0===n||0===r)continue;let s=Vn(this.track.getSimulcastDefinitions(),{width:n,height:r});e=e?Gn[s]>Gn[e]?s:e:s}e&&(fi.d(this.TAG,"selecting max layer ".concat(e," for the track"),"".concat(this.track)),yield this.track.setPreferredLayer(e))})}},qn=(e=>(e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE",e))(qn||{}),Kn=(e=>(e["2D"]="2d",e.WEBGL="webgl",e.WEBGL2="webgl2",e))(Kn||{}),Jn=class{constructor(){this.total=0,this.count=0}add(e){this.count++,this.total+=e}getAvg(){return Math.floor(this.total/this.count)}reset(){this.total=0,this.count=0}},Qn=class{constructor(e){this.eventBus=e,this.TAG="[VideoPluginsAnalytics]",this.initTime={},this.preProcessingAvgs=new Jn,this.addedTimestamps={},this.processingAvgs={},this.pluginAdded={},this.pluginInputFrameRate={},this.pluginFrameRate={}}added(e,t,i){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.processingAvgs[e]=new Jn,t&&(this.pluginInputFrameRate[e]=t,this.pluginFrameRate[e]=i||t),this.eventBus.analytics.publish(tn.added(e,this.addedTimestamps[e]))}removed(e){var t;if(this.pluginAdded[e]){let i={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],avgPreProcessingTime:this.preProcessingAvgs.getAvg(),avgProcessingTime:null==(t=this.processingAvgs[e])?void 0:t.getAvg(),inputFrameRate:this.pluginInputFrameRate[e],pluginFrameRate:this.pluginFrameRate[e]};this.eventBus.analytics.publish(tn.stats(i)),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(tn.failure(e,t)),this.clean(e))}initWithTime(e,t){return Jt(this,null,function*(){if(this.initTime[e])return void fi.i(this.TAG,"Plugin Already loaded ".concat(e,", time it took: ").concat(this.initTime[e]));let i;try{i=yield this.timeInMs(t),fi.i(this.TAG,"Time taken for Plugin ".concat(e," initialization : ").concat(i))}catch(n){let t=Oi.MediaPluginErrors.InitFailed("VIDEO_PLUGINS","failed during initialization of plugin".concat(n.message||n));throw fi.e(this.TAG,t),this.failure(e,t),t}i&&(this.initTime[e]=i)})}preProcessWithTime(e){return Jt(this,null,function*(){let t=yield this.timeInMs(e);this.preProcessingAvgs.add(t)})}processWithTime(e,t){return Jt(this,null,function*(){var i;let n;try{n=yield this.timeInMs(t)}catch(r){let t=Oi.MediaPluginErrors.ProcessingFailed("VIDEO_PLUGINS","Failed during processing of plugin".concat(r.message||r));throw fi.e(this.TAG,t),this.failure(e,t),t}n&&(null==(i=this.processingAvgs[e])||i.add(n))})}timeInMs(e){return Jt(this,null,function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)})}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.processingAvgs[e],delete this.pluginAdded[e],delete this.pluginInputFrameRate[e],delete this.pluginFrameRate[e]}},Yn=320,$n=240,Xn=class{constructor(e,t){this.TAG="[VideoPluginsManager]",this.pluginsLoopRunning=!1,this.pluginsLoopState="paused",this.pluginAddInProgress=!1,this.reusableWorker=function(){if("undefined"==typeof Worker)return{sleep:e=>gn(e)};let e=new Worker(URL.createObjectURL(new Blob([vn],{type:"application/javascript"})));return{sleep:t=>(e.postMessage(["start",t]),new Promise(t=>{e.onmessage=e=>{"tick"===e.data&&t()}}))}}(),this.hmsTrack=e,this.pluginsMap=new Map,this.pluginNumFramesToSkip={},this.pluginNumFramesSkipped={},this.analytics=new Qn(t),this.canvases=new Array}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e,t){return Jt(this,null,function*(){var i;if(this.pluginAddInProgress){let t=null==(i=e.getName)?void 0:i.call(e);if(!t||""===t)return void fi.w("no name provided by the plugin");let n=Oi.MediaPluginErrors.AddAlreadyInProgress("VIDEO_PLUGINS","Add Plugin is already in Progress");throw this.analytics.failure(t,n),fi.w("can't add another plugin when previous add is in progress"),n}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e,t)}finally{this.pluginAddInProgress=!1}})}addPluginInternal(e,t){return Jt(this,null,function*(){var i,n;let r=null==(i=e.getName)?void 0:i.call(e);if(!r||""===r)return void fi.w("no name provided by the plugin");if(this.pluginsMap.has(r))return void fi.w(this.TAG,"plugin - ".concat(e.getName()," already added."));let s=this.hmsTrack.getMediaTrackSettings().frameRate||24,a=0;t&&t>0?(fi.i(this.TAG,"adding plugin ".concat(e.getName()," with framerate ").concat(t)),t<s&&(a=Math.ceil(s/t)-1),this.analytics.added(r,s,t)):(fi.i(this.TAG,"adding plugin ".concat(e.getName())),this.analytics.added(r,s)),fi.i(this.TAG,"numFrames to skip processing",a),this.pluginNumFramesToSkip[r]=a,this.pluginNumFramesSkipped[r]=a,this.validateAndThrow(r,e);try{if(yield this.analytics.initWithTime(r,()=>Jt(this,null,function*(){return yield e.init()})),this.pluginsMap.set(r,e),this.pluginsMap.size+1>this.canvases.length)for(let e=this.canvases.length;e<=this.pluginsMap.size;e++)this.canvases[e]=document.createElement("canvas");yield this.startPluginsLoop(null==(n=e.getContextType)?void 0:n.call(e))}catch(Ke){throw fi.e(this.TAG,"failed to add plugin",Ke),yield this.removePlugin(e),Ke}})}validatePlugin(e){return e.checkSupport()}validateAndThrow(e,t){let i=this.validatePlugin(t);if(i.isSupported)fi.i(this.TAG,"plugin is supported,- ".concat(t.getName()));else{let t;switch(i.errType){case"PLATFORM_NOT_SUPPORTED":throw t=Oi.MediaPluginErrors.PlatformNotSupported("VIDEO_PLUGINS","platform not supported, see docs"),this.analytics.failure(e,t),t;case"DEVICE_NOT_SUPPORTED":throw t=Oi.MediaPluginErrors.DeviceNotSupported("VIDEO_PLUGINS","video device not supported, see docs"),this.analytics.failure(e,t),t}}}removePlugin(e){return Jt(this,null,function*(){let t=e.getName();this.pluginsMap.get(t)?(fi.i(this.TAG,"removing plugin ".concat(t)),this.removePluginEntry(t),0===this.pluginsMap.size&&(fi.i(this.TAG,"No plugins left, stopping plugins loop"),yield this.stopPluginsLoop()),e.stop(),this.analytics.removed(t)):fi.w(this.TAG,"plugin - ".concat(t," not found to remove."))})}removePluginEntry(e){this.pluginsMap.delete(e),this.pluginNumFramesToSkip[e]&&delete this.pluginNumFramesToSkip[e],this.pluginNumFramesSkipped[e]&&delete this.pluginNumFramesSkipped[e]}waitForRestart(){return Jt(this,null,function*(){if(this.pluginsLoopRunning&&"running"!==this.pluginsLoopState)for(;"paused"===this.pluginsLoopState;)yield mn(100)})}cleanup(){return Jt(this,null,function*(){var e;for(let t of this.pluginsMap.values())yield this.removePlugin(t);null==(e=this.outputTrack)||e.stop()})}initElementsAndStream(e){this.inputCanvas||(this.inputCanvas=document.createElement("canvas")),this.outputCanvas=document.createElement("canvas"),this.inputVideo||(this.inputVideo=document.createElement("video")),this.inputCanvas.getContext("2d"),this.outputCanvas.getContext(e||"2d");let t=this.outputCanvas.captureStream();this.outputTrack=t.getVideoTracks()[0]}startPluginsLoop(e){return Jt(this,null,function*(){if(!this.pluginsLoopRunning){this.initElementsAndStream(e),this.pluginsLoopRunning=!0;try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(xe){throw this.pluginsLoopRunning=!1,fi.e(this.TAG,"error in setting processed track",xe),xe}this.pluginsLoop().then(()=>{fi.d(this.TAG,"processLoop stopped")})}})}stopPluginsLoop(){return Jt(this,null,function*(){var e;this.pluginsLoopRunning=!1,yield this.hmsTrack.setProcessedTrack(void 0),this.resetCanvases(),null==(e=this.outputTrack)||e.stop(),this.inputVideo&&(this.inputVideo.srcObject=null,this.inputVideo=void 0)})}pluginsLoop(){return Jt(this,null,function*(){for(;this.pluginsLoopRunning;){let t=this.hmsTrack.getMediaTrackSettings().frameRate||24,i=Math.floor(1e3/t);if(!this.hmsTrack.enabled||"ended"===this.hmsTrack.nativeTrack.readyState){"running"===this.pluginsLoopState&&this.resetCanvases(),this.pluginsLoopState="paused",yield this.reusableWorker.sleep(i);continue}let n=0;try{yield this.analytics.preProcessWithTime(()=>Jt(this,null,function*(){return yield this.doPreProcessing()}));let e=Date.now();yield this.processFramesThroughPlugins(),n=Math.floor(Date.now()-e),n>i&&(n=i)}catch(e){fi.e(this.TAG,"error in plugins loop",e)}this.pluginsLoopState="running",yield this.reusableWorker.sleep(i-n)}})}doPreProcessing(){return Jt(this,null,function*(){yield this.addTrackToVideo(),yield this.updateInputCanvas()})}processFramesThroughPlugins(){return Jt(this,null,function*(){this.canvases[0]=this.inputCanvas;let e=0;for(let i of this.pluginsMap.values()){let n=i.getName();if(i){try{let t=this.checkIfSkipRequired(n);if("TRANSFORM"===i.getPluginType()){let r=(e,r)=>Jt(this,null,function*(){try{yield i.processVideoFrame(e,r,t)}catch(Ke){fi.e(this.TAG,"error in processing plugin ".concat(n),Ke)}});if(t)e===this.pluginsMap.size-1?yield r(this.canvases[e],this.outputCanvas):yield r(this.canvases[e],this.canvases[e+1]);else{let t=this.canvases[e],i=this.canvases[e+1];e===this.pluginsMap.size-1?yield this.analytics.processWithTime(n,()=>Jt(this,null,function*(){return r(t,this.outputCanvas)})):yield this.analytics.processWithTime(n,()=>Jt(this,null,function*(){return r(t,i)}))}}else"ANALYZE"===i.getPluginType()&&!t&&(yield this.analytics.processWithTime(n,()=>Jt(this,null,function*(){return yield i.processVideoFrame(this.inputCanvas)})))}catch(t){fi.e(this.TAG,"error in processing plugin ".concat(n),t),yield this.removePlugin(i)}e++}}})}addTrackToVideo(){return Jt(this,null,function*(){var e;if(!this.inputVideo)return;let t=this.inputVideo.srcObject;null!==t&&t instanceof MediaStream&&(null==(e=t.getVideoTracks()[0])?void 0:e.id)===this.hmsTrack.nativeTrack.id||(this.inputVideo.pause(),this.inputVideo.srcObject=new MediaStream([this.hmsTrack.nativeTrack]),this.inputVideo.muted=!0,this.inputVideo.playsInline=!0,yield this.inputVideo.play())})}updateInputCanvas(){return Jt(this,null,function*(){if(!this.inputCanvas||!this.inputVideo)return;let{width:e=Yn,height:t=$n}=this.hmsTrack.getMediaTrackSettings();this.inputCanvas.height!==t&&(this.inputCanvas.height=t),this.inputCanvas.width!==e&&(this.inputCanvas.width=e),this.inputCanvas.getContext("2d").drawImage(this.inputVideo,0,0,e,t)})}resetCanvases(){if(!this.outputCanvas||!this.inputCanvas)return;let e=this.inputCanvas.getContext("2d");e&&(e.fillStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height)),this.canvases=[]}checkIfSkipRequired(e){let t=!1;return this.pluginNumFramesSkipped[e]<this.pluginNumFramesToSkip[e]?(this.pluginNumFramesSkipped[e]++,t=!0):(t=!1,this.pluginNumFramesSkipped[e]=0),t}},Zn=class{constructor(e,t){this.TAG="[MediaStreamPluginsManager]",this.plugins=new Set,this.analytics=new Qn(e),this.room=t}addPlugins(e){e.forEach(e=>{var t;if("HMSEffectsPlugin"===e.getName())if(null==(t=this.room)||!t.isEffectsEnabled){let e="Effects Virtual Background is not enabled for this room";if(0===this.plugins.size)throw Error(e);return void fi.w(this.TAG,e)}this.plugins.add(e)})}removePlugins(e){e.forEach(e=>{e.stop(),this.analytics.removed(e.getName()),this.plugins.delete(e)})}applyPlugins(e){let t=e;for(let n of this.plugins){let e=n.getName();try{t=n.apply(t),this.analytics.added(e)}catch(i){this.analytics.failure(e,i),fi.e("Could not apply plugin",i,e)}}return t}getPlugins(){return Array.from(this.plugins).map(e=>e.getName())}cleanup(){return Jt(this,null,function*(){this.removePlugins(Array.from(this.plugins))})}},er=["init_response_time","ws_connect_time","on_policy_change_time","local_audio_track_time","local_video_track_time","peer_list_time","room_state_time","join_response_time"],tr=class{constructor(){this.eventPerformanceMeasures={}}start(e){performance.mark(e)}end(e){var t;try{this.eventPerformanceMeasures[e]=performance.measure(e,e),fi.d("[HMSPerformanceTiming]",e,null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration)}catch(E){fi.w("[AnalyticsTimer]","Error in measuring performance for event ".concat(e),{error:E})}}getTimeTaken(e){var t;return null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration}getTimes(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return[...er,...t].reduce((e,t)=>Ht(Wt({},e),{[t]:this.getTimeTaken(t)}),{})}cleanup(){this.eventPerformanceMeasures={}}},ir={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default",audioMode:"voice"},nr=class e{constructor(e,t,i,n,r){this.store=e,this.observer=t,this.deviceManager=i,this.eventBus=n,this.analyticsTimer=r,this.TAG="[LocalTrackManager]",this.setScreenCaptureHandleConfig()}getTracksToPublish(){return Jt(this,arguments,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ir;return function*(){let i=e.getAVTrackSettings(t);if(!i)return[];let n=!!i.audio,r=!!i.video,s=[],{videoTrack:a,audioTrack:o}=yield e.updateCurrentLocalTrackSettings(i),l=(null==a?void 0:a.stream)||(null==o?void 0:o.stream),c=!(!a||!e.store.getTrackById(a.trackId)),u=!(!o||!e.store.getTrackById(o.trackId));if(c&&u)return[];let d={audio:n&&!o&&(!t.isAudioMuted||"empty"),video:r&&!a&&(!t.isVideoMuted||"empty")};d.audio&&e.analyticsTimer.start("local_audio_track_time"),d.video&&e.analyticsTimer.start("local_video_track_time");try{fi.d(e.TAG,"Init Local Tracks",{fetchTrackOptions:d}),s=yield e.getLocalTracks(d,i,l)}catch(h){s=yield e.retryGetLocalTracks(h,i,d,l)}return d.audio&&e.analyticsTimer.end("local_audio_track_time"),d.video&&e.analyticsTimer.end("local_video_track_time"),a&&r&&!c&&s.push(a),o&&n&&!u&&s.push(o),s}()})}getLocalTracks(){return Jt(this,arguments,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0},i=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return function*(){try{let r=yield e.getNativeLocalTracks(t,i);return e.createHMSLocalTracks(r,i,n)}catch(r){throw e.eventBus.analytics.publish(Ji.publish({devices:e.deviceManager.getDevices(),error:r,settings:i})),r}}()})}getNativeLocalTracks(){return Jt(this,arguments,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!1,video:!1},i=arguments.length>1?arguments[1]:void 0;return function*(){let n=new Nn(!0===t.video?i.video:null,!0===t.audio?i.audio:null,i.simulcast),r=[];return(n.audio||n.video)&&r.push(...yield e.getAVTracks(n)),r.push(...e.getEmptyTracks(t)),r}()})}optimizeScreenShareConstraint(e,t){return Jt(this,null,function*(){var i,n,r;if("boolean"==typeof t.video||null==(i=t.video)||!i.width||null==(n=t.video)||!n.height)return;let s=this.store.getPublishParams();if(!s||null==(r=s.allowed)||!r.includes("screen"))return;let a=document.createElement("video");a.srcObject=e,a.addEventListener("loadedmetadata",()=>Jt(this,null,function*(){let{videoWidth:i,videoHeight:n}=a,r=s.screen,o=r.width*r.height,l=i/n,c=r.width/r.height;if(l>c){let r=t.video,s=l/c,a=Math.sqrt(s);i*n>o?(r.width=i/a,r.height=n/a):(r.height=n*a,r.width=i*a),yield e.getVideoTracks()[0].applyConstraints(r)}}))})}getLocalScreen(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Jt(this,null,function*(){var i;let n,r=yield this.getOrDefaultScreenshareConfig(e),s=this.getScreenshareSettings(r.videoOnly),a={video:Ht(Wt({},null==s?void 0:s.video.toConstraints(!0)),{displaySurface:r.displaySurface}),preferCurrentTab:r.preferCurrentTab,selfBrowserSurface:r.selfBrowserSurface,surfaceSwitching:r.surfaceSwitching,systemAudio:r.systemAudio};if(null!=s&&s.audio){let e=null==(i=null==s?void 0:s.audio)?void 0:i.toConstraints();delete e.advanced,a.audio=Ht(Wt({},e),{autoGainControl:!1,noiseSuppression:!1,googAutoGainControl:!1,echoCancellation:!1})}else null!=e&&e.forceCurrentTab&&e.preferCurrentTab&&e.cropElement&&(a.audio={echoCancellation:!0,noiseSuppression:!0});try{fi.d("retrieving screenshare with ",{config:r},{constraints:a}),n=yield navigator.mediaDevices.getDisplayMedia(a),t&&(yield this.optimizeScreenShareConstraint(n,a))}catch(Ze){fi.w(this.TAG,"error in getting screenshare - ",Ze);let t=an(Ze,"screen");throw this.eventBus.analytics.publish(Ji.publish({error:t,devices:this.deviceManager.getDevices(),settings:new Nn(null==s?void 0:s.video,null==s?void 0:s.audio,!1)})),t}let o=[],l=new Mr(n),c=n.getVideoTracks()[0],u=new sr(l,c,"screen",this.eventBus,null==s?void 0:s.video,this.store.getRoom());u.setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"screen"));try{let e=this.validateCurrentTabCapture(u,r.forceCurrentTab);u.isCurrentTab=e,yield u.cropTo(r.cropTarget)}catch(Ze){throw n.getTracks().forEach(e=>e.stop()),Ze}o.push(u);let d=n.getAudioTracks()[0];if(d){let e=new Fn(l,d,"screen",this.eventBus,null==s?void 0:s.audio,this.store.getRoom());o.push(e)}return fi.v(this.TAG,"getLocalScreen",o),o})}setScreenCaptureHandleConfig(e){var t;null==(t=navigator.mediaDevices)||!t.setCaptureHandleConfig||this.isInIframe()||(e=e||{},Object.assign(e,{handle:C(),exposeOrigin:!1,permittedOrigins:[window.location.origin]}),fi.d("setting capture handle - ",e.handle),navigator.mediaDevices.setCaptureHandleConfig(e),this.captureHandleIdentifier=e.handle)}validateCurrentTabCapture(e,t){let i=e.getCaptureHandle(),n=!(!this.captureHandleIdentifier||(null==i?void 0:i.handle)!==this.captureHandleIdentifier);if(t&&!n)throw fi.e(this.TAG,"current tab was not shared with forceCurrentTab as true"),Oi.TracksErrors.CurrentTabNotShared();return n}requestPermissions(){return Jt(this,null,function*(){try{(yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach(e=>e.stop())}catch(e){fi.e(this.TAG,e)}})}static getEmptyVideoTrack(e){var t,i,n;let r=(null==(t=null==e?void 0:e.getSettings())?void 0:t.width)||320,s=(null==(i=null==e?void 0:e.getSettings())?void 0:i.height)||240;xn||((xn=document.createElement("canvas")).width=r,xn.height=s,null==(n=xn.getContext("2d"))||n.fillRect(0,0,r,s)),Un||(Un=setInterval(()=>{let e=null==xn?void 0:xn.getContext("2d");e&&e.fillRect(0,0,1,1)},1e3));let a=xn.captureStream(1).getVideoTracks()[0];return a.enabled=!1,a}static getEmptyAudioTrack(){let e=dn.getAudioContext(),t=e.createOscillator(),i=e.createMediaStreamDestination();t.connect(i),t.start();let n=i.stream.getAudioTracks()[0];return n.enabled=!1,n}static cleanup(){clearInterval(Un),Un=void 0,xn=void 0}getAVTracks(e){return Jt(this,null,function*(){try{let t=yield navigator.mediaDevices.getUserMedia({audio:!!e.audio&&e.audio.toConstraints(),video:!!e.video&&e.video.toConstraints()});return t.getVideoTracks().concat(t.getAudioTracks())}catch(xe){yield this.deviceManager.init();let i=!(this.deviceManager.hasWebcamPermission||!e.video),n=!(this.deviceManager.hasMicrophonePermission||!e.audio);throw an(xe,this.getErrorType(i,n))}})}getAVTrackSettings(e){let t=this.getAudioSettings(e),i=this.getVideoSettings(e);return t||i?(new Mn).video(i).audio(t).build():null}isInIframe(){try{return window.self!==window.top}catch(e){return!0}}retryGetLocalTracks(e,t,i,n){return Jt(this,null,function*(){if(!(e instanceof Ri&&"TRACK"===e.action))return fi.w(this.TAG,"Fetch AV Tracks failed - unknown exception",e),this.observer.onFailure(e),[];{this.observer.onFailure(e);let s=e.code===Ai.TracksErrors.OVER_CONSTRAINED,a=e.message.includes("audio"),o=e.message.includes("video");if(s){let s=(new Mn).video(new Dn).audio(new Rn).build();fi.w(this.TAG,"Fetch AV Tracks failed with overconstrained error",{fetchTrackOptions:i},{error:e});try{return yield this.getLocalTracks(i,s,n)}catch(r){let e=r instanceof Ri?r.nativeError:r,s=r;if("OverconstrainedError"===(null==e?void 0:e.name)){let t=Oi.TracksErrors.GenericTrack("TRACK","Overconstrained error after dropping all constraints");t.addNativeError(e),s=t}return yield this.retryGetLocalTracks(s,t,i,n)}}i.audio=a?"empty":i.audio,i.video=o?"empty":i.video,fi.w(this.TAG,"Fetch AV Tracks failed",{fetchTrackOptions:i},e);try{return yield this.getLocalTracks(i,t,n)}catch(Ke){return fi.w(this.TAG,"Fetch empty tacks failed",Ke),i.audio=i.audio&&"empty",i.video=i.video&&"empty",this.observer.onFailure(Ke),yield this.getLocalTracks(i,t,n)}}})}getErrorType(e,t){return e&&t?"audio, video":e?"video":t?"audio":"audio, video"}getEmptyTracks(t){let i=[];return"empty"===t.audio&&i.push(e.getEmptyAudioTrack()),"empty"===t.video&&i.push(e.getEmptyVideoTrack()),i}updateCurrentLocalTrackSettings(e){return Jt(this,null,function*(){let t=this.store.getLocalPeerTracks(),i=t.find(e=>"video"===e.type&&"regular"===e.source),n=t.find(e=>"audio"===e.type&&"regular"===e.source),r=t.find(e=>"video"===e.type&&"screen"===e.source);null!=e&&e.video&&(yield null==i?void 0:i.setSettings(e.video)),null!=e&&e.audio&&(yield null==n?void 0:n.setSettings(e.audio));let s=this.getScreenshareSettings(!0);return null!=s&&s.video&&(yield null==r?void 0:r.setSettings(null==s?void 0:s.video)),{videoTrack:i,audioTrack:n}})}getAudioSettings(e){var t;let i=this.store.getPublishParams();if(!i||null==(t=i.allowed)||!t.includes("audio"))return null;let n=this.store.getLocalPeer(),r=null==n?void 0:n.audioTrack,s=(null==r?void 0:r.settings.deviceId)||e.audioInputDeviceId;return(new An).codec(i.audio.codec).maxBitrate(i.audio.bitRate).deviceId(s||ir.audioInputDeviceId).build()}getVideoSettings(e){var t;let i=this.store.getPublishParams();if(!i||null==(t=i.allowed)||!t.includes("video"))return null;let n=this.store.getLocalPeer(),r=null==n?void 0:n.videoTrack,s=(null==r?void 0:r.settings.deviceId)||e.videoDeviceId,a=i.video;return(new Ln).codec(a.codec).maxBitrate(a.bitRate).maxFramerate(a.frameRate).setWidth(a.width).setHeight(a.height).deviceId(s||ir.videoDeviceId).build()}getScreenshareSettings(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;let i=this.store.getPublishParams();if(!i||null==(t=i.allowed)||!t.includes("screen"))return null;let n=i.screen;return{video:(new Ln).maxBitrate(n.bitRate,!1).codec(n.codec).maxFramerate(n.frameRate).setWidth(n.width).setHeight(n.height).build(),audio:e?void 0:(new An).build()}}getOrDefaultScreenshareConfig(e){return Jt(this,null,function*(){var t;let i=Object.assign({videoOnly:!1,audioOnly:!1,forceCurrentTab:!1,preferCurrentTab:!1,selfBrowserSurface:"exclude",surfaceSwitching:"include",systemAudio:"exclude",displaySurface:"monitor"},e||{});return i.forceCurrentTab&&(i.videoOnly=!0,i.preferCurrentTab=!0,i.selfBrowserSurface="include",i.surfaceSwitching="exclude"),i.preferCurrentTab&&(i.selfBrowserSurface="include",i.displaySurface=void 0),i.cropElement&&null!=(t=window.CropTarget)&&t.fromElement&&(i.cropTarget=yield window.CropTarget.fromElement(i.cropElement)),i})}createHMSLocalTracks(e,t,i){let n=e.find(e=>"video"===e.kind),r=e.find(e=>"audio"===e.kind);i?e.forEach(e=>null==i?void 0:i.nativeStream.addTrack(e)):i=new Mr(new MediaStream(e));let s=[];if(r&&null!=t&&t.audio){let e=new Fn(i,r,"regular",this.eventBus,t.audio,this.store.getRoom());s.push(e)}if(n&&null!=t&&t.video){let e=new sr(i,n,"regular",this.eventBus,t.video,this.store.getRoom());e.setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"regular")),s.push(e)}return s}};function rr(e,t){return function(i){return!_()(e[i],t[i])}}var sr=class e extends Bn{constructor(e,t,i,n){var r;let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(new Ln).build(),a=arguments.length>5?arguments[5]:void 0;super(e,t,i),r=this,this.eventBus=n,this.room=a,this._layerDefinitions=[],this.TAG="[HMSLocalVideoTrack]",this.enabledStateBeforeBackground=!1,this.isCurrentTab=!1,this.isPublished=!1,this.replaceSenderTrack=e=>Jt(this,null,function*(){this.transceiver&&"sendonly"===this.transceiver.direction?yield this.transceiver.sender.replaceTrack(e):fi.d(this.TAG,"transceiver for ".concat(this.trackId," not available or not connected yet"))}),this.buildNewSettings=e=>{let{width:t,height:i,codec:n,maxFramerate:r,maxBitrate:s,deviceId:a,advanced:o,facingMode:l}=Wt(Wt({},this.settings),e);return new Dn(t,i,n,r,a,o,s,l)},this.handleSettingsChange=e=>Jt(this,null,function*(){let t=this.stream,i=rr(e,this.settings);if(i("maxBitrate")&&e.maxBitrate&&(yield t.setMaxBitrateAndFramerate(this)),i("width")||i("height")||i("advanced"))if("video"===this.source){let t=yield this.replaceTrackWith(e);yield this.replaceSender(t,this.enabled),this.nativeTrack=t,yield this.processPlugins(),this.videoHandler.updateSinks()}else yield this.nativeTrack.applyConstraints(e.toConstraints())}),this.handleDeviceChange=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Jt(r,null,function*(){if(rr(e,this.settings)("deviceId")&&"regular"===this.source){if(this.enabled){delete e.facingMode;let t=yield this.replaceTrackWith(e);yield this.replaceSender(t,this.enabled),this.nativeTrack=t,yield this.processPlugins(),this.videoHandler.updateSinks()}let i=this.nativeTrack.getSettings().groupId;!t&&e.deviceId&&(Xi.updateSelection("videoInput",{deviceId:e.deviceId,groupId:i}),this.eventBus.deviceChange.publish({isUserSelection:!0,type:"video",selection:{deviceId:e.deviceId,groupId:i}}))}})},this.trackPermissions=()=>{un("camera",e=>{this.eventBus.analytics.publish(Ji.permissionChange(this.type,e)),"denied"===e&&this.eventBus.localVideoEnabled.publish({enabled:!1,track:this})})},this.handleTrackMute=()=>{fi.d(this.TAG,"muted natively",document.visibilityState);let e="hidden"===document.visibilityState?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:e})),this.eventBus.localVideoEnabled.publish({enabled:!1,track:this})},this.handleTrackUnmuteNatively=()=>Jt(this,null,function*(){fi.d(this.TAG,"unmuted natively");let e="hidden"===document.visibilityState?"visibility-change":"incoming-call";this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:e})),this.handleTrackUnmute(),this.eventBus.localVideoEnabled.publish({enabled:this.enabled,track:this}),this.eventBus.localVideoUnmutedNatively.publish(),yield this.setEnabled(this.enabled)}),this.removeOrReplaceProcessedTrack=e=>Jt(this,null,function*(){e?e!==this.processedTrack&&(this.processedTrack=e):this.processedTrack=void 0,yield this.replaceSenderTrack(this.processedTrack||this.nativeTrack)}),this.handleVisibilityChange=()=>Jt(this,null,function*(){if("hidden"===document.visibilityState)this.enabledStateBeforeBackground=this.enabled,this.enabled&&(yield this.setEnabled(!1)),this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!0,reason:"visibility-change"}));else{if(fi.d(this.TAG,"visibility visible, restoring track state",this.enabledStateBeforeBackground),this.enabledStateBeforeBackground)try{yield this.setEnabled(!0)}catch(e){this.eventBus.error.publish(e)}this.eventBus.analytics.publish(this.sendInterruptionEvent({started:!1,reason:"visibility-change"}))}}),this.addTrackEventListeners(t),this.trackPermissions(),e.tracks.push(this),this.setVideoHandler(new Hn(this)),this.settings=s,s.deviceId!==t.getSettings().deviceId&&t.enabled&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new Xn(this,n),this.mediaStreamPluginsManager=new Zn(n,a),this.setFirstTrackId(this.trackId),this.eventBus.localAudioUnmutedNatively.subscribe(this.handleTrackUnmute),Ti&&"regular"===i&&Ei()&&document.addEventListener("visibilitychange",this.handleVisibilityChange)}clone(t){let i=this.nativeTrack.clone();t.nativeStream.addTrack(i);let n=new e(t,i,this.source,this.eventBus,this.settings,this.room);return n.peerId=this.peerId,this.pluginsManager.pluginsMap.size>0&&this.pluginsManager.pluginsMap.forEach(e=>{n.addPlugin(e).catch(t=>fi.e(this.TAG,"Plugin add failed while migrating",e,t))}),this.mediaStreamPluginsManager.plugins.size>0&&n.addStreamPlugins(Array.from(this.mediaStreamPluginsManager.plugins)),n}setSimulcastDefinitons(e){this._layerDefinitions=e}getSimulcastDefinitions(){return this._layerDefinitions}setEnabled(t){return Jt(this,null,function*(){var i;if(t!==this.enabled){if("regular"===this.source){let n;n=t?yield this.replaceTrackWith(this.settings):yield this.replaceTrackWithBlank(),yield this.replaceSender(n,t),null==(i=this.nativeTrack)||i.stop(),this.nativeTrack=n,yield Kt(e.prototype,this,"setEnabled").call(this,t),t&&(yield this.pluginsManager.waitForRestart(),yield this.processPlugins(),this.settings=this.buildNewSettings({deviceId:n.getSettings().deviceId})),this.videoHandler.updateSinks()}this.eventBus.localVideoEnabled.publish({enabled:t,track:this})}})}processPlugins(){return Jt(this,null,function*(){try{if(this.pluginsManager.getPlugins().length>0)return;if(this.mediaStreamPluginsManager.getPlugins().length>0){let e=this.mediaStreamPluginsManager.applyPlugins(new MediaStream([this.nativeTrack])).getVideoTracks()[0];yield this.setProcessedTrack(e)}else yield this.setProcessedTrack();this.videoHandler.updateSinks()}catch(xe){console.error("error in processing plugin(s)",xe)}})}addStreamPlugins(e){return Jt(this,null,function*(){if(this.pluginsManager.getPlugins().length>0)throw Error("Plugins of type HMSMediaStreamPlugin and HMSVideoPlugin cannot be used together");this.mediaStreamPluginsManager.addPlugins(e),yield this.processPlugins()})}removeStreamPlugins(e){return Jt(this,null,function*(){this.mediaStreamPluginsManager.removePlugins(e),yield this.processPlugins()})}isPublishedTrackId(e){return this.publishedTrackId===e}addSink(e){this.addSinkInternal(e,this.processedTrack||this.nativeTrack)}setSettings(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Jt(this,null,function*(){let i=this.buildNewSettings(e);yield this.handleDeviceChange(i,t),this.enabled&&!cn(this.nativeTrack)?(yield this.pluginsManager.waitForRestart(),yield this.handleSettingsChange(i),this.settings=i):this.settings=i})}getPlugins(){return this.mediaStreamPluginsManager.getPlugins().length>0?this.mediaStreamPluginsManager.getPlugins():this.pluginsManager.getPlugins()}addPlugin(e,t){return Jt(this,null,function*(){if(this.mediaStreamPluginsManager.getPlugins().length>0)throw Error("Plugins of type HMSVideoPlugin and HMSMediaStreamPlugin cannot be used together");return this.pluginsManager.addPlugin(e,t)})}removePlugin(e){return Jt(this,null,function*(){return this.pluginsManager.removePlugin(e)})}validatePlugin(e){return this.pluginsManager.validatePlugin(e)}cleanup(){return Jt(this,null,function*(){var t;this.eventBus.localAudioUnmutedNatively.unsubscribe(this.handleTrackUnmute),this.removeTrackEventListeners(this.nativeTrack),yield this.mediaStreamPluginsManager.cleanup(),yield this.pluginsManager.cleanup(),Kt(e.prototype,this,"cleanup").call(this),this.transceiver=void 0,null==(t=this.processedTrack)||t.stop(),this.isPublished=!1,Ti&&Ei()&&document.removeEventListener("visibilitychange",this.handleVisibilityChange)})}cropTo(e){return Jt(this,null,function*(){if(e&&"screen"===this.source)try{this.nativeTrack.cropTo&&(yield this.nativeTrack.cropTo(e))}catch(E){throw fi.e(this.TAG,"failed to crop screenshare capture - ",E),Oi.TracksErrors.GenericTrack("TRACK","failed to crop screenshare capture")}})}getCaptureHandle(){if(this.nativeTrack.getCaptureHandle)return this.nativeTrack.getCaptureHandle()}setProcessedTrack(e){return Jt(this,null,function*(){this.nativeTrack.enabled?(yield this.removeOrReplaceProcessedTrack(e),this.videoHandler.updateSinks()):this.processedTrack=e})}getTrackIDBeingSent(){return this.getTrackBeingSent().id}getTrackBeingSent(){return this.enabled&&this.processedTrack||this.nativeTrack}switchCamera(){return Jt(this,null,function*(){var e;let t=this.getMediaTrackSettings().facingMode;if(!t||"regular"!==this.source)return void fi.d(this.TAG,"facingMode not supported");let i="environment"===t?"user":"environment";null==(e=this.nativeTrack)||e.stop();let n=yield this.replaceTrackWith(this.buildNewSettings({facingMode:i,deviceId:void 0}));yield this.replaceSender(n,this.enabled),this.nativeTrack=n,yield this.processPlugins(),this.videoHandler.updateSinks(),this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId,facingMode:i}),Xi.updateSelection("videoInput",{deviceId:this.settings.deviceId,groupId:this.nativeTrack.getSettings().groupId})})}replaceTrackWith(e){return Jt(this,null,function*(){let t=this.nativeTrack;this.removeTrackEventListeners(t),null==t||t.stop();try{let i=yield ln(e);return this.addTrackEventListeners(i),fi.d(this.TAG,"replaceTrack, Previous track stopped",t,"newTrack",i),"default"===this.settings.deviceId&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),i}catch(i){let e=yield ln(this.settings);throw this.addTrackEventListeners(e),yield this.replaceSender(e,this.enabled),this.nativeTrack=e,yield this.processPlugins(),this.videoHandler.updateSinks(),this.isPublished&&this.eventBus.analytics.publish(Ji.publish({error:i})),i}})}replaceTrackWithBlank(){return Jt(this,null,function*(){let e=this.nativeTrack,t=nr.getEmptyVideoTrack(e);return this.removeTrackEventListeners(e),this.addTrackEventListeners(t),null==e||e.stop(),fi.d(this.TAG,"replaceTrackWithBlank, Previous track stopped",e,"newTrack",t),t})}replaceSender(e,t){return Jt(this,null,function*(){t?yield this.replaceSenderTrack(this.processedTrack||e):yield this.replaceSenderTrack(e),this.stream.replaceStreamTrack(this.nativeTrack,e)})}addTrackEventListeners(e){e.addEventListener("mute",this.handleTrackMute),e.addEventListener("unmute",this.handleTrackUnmuteNatively)}removeTrackEventListeners(e){e.removeEventListener("mute",this.handleTrackMute),e.removeEventListener("unmute",this.handleTrackUnmuteNatively)}},ar="renegotiation-callback-id",or="ion-sfu",lr="SUBSCRIBE_ICE_CONNECTION_CALLBACK_ID",cr=Math.pow(2,31)-1,ur="device-change",dr="local-audio-enabled",hr="local-video-enabled",pr="local-video-unmuted-natively",fr="local-audio-unmuted-natively",vr="stats-update",gr="track-degraded",mr="track-restored",yr="track-audio-level-update",br="local-audio-silence",kr="analytics",Sr="audio-plugin-failed",Tr="policy-change",wr="local-role-update",Er="audio-track-update",Pr="audio-track-added",Cr="audio-track-removed",Ir="autoplay-error",_r="leave",Ar="error",Rr="_handraise",Lr=class e extends Bn{constructor(e,t,i,n){super(e,t,i),this._degraded=!1,this._degradedAt=null,this._layerDefinitions=[],this.history=new Dr,this.preferredLayer="high",this.disableNoneLayerRequest=!1,this.disableNoneLayerRequest=!!n,this.setVideoHandler(new Hn(this))}setTrackId(e){this.bizTrackId=e}get trackId(){return this.bizTrackId||super.trackId}get degraded(){return this._degraded}get degradedAt(){return this._degradedAt}setEnabled(t){return Jt(this,null,function*(){t!==this.enabled&&(Kt(e.prototype,this,"setEnabled").call(this,t),this.videoHandler.updateSinks(!0))})}setPreferredLayer(e){return Jt(this,null,function*(){if("none"!==e){if(this.preferredLayer=e,this.shouldSendVideoLayer(e,"preferLayer")){if(!this.hasSinks())return void fi.d("[Remote Track] ".concat(this.logIdentifier,"\n        streamId=").concat(this.stream.id," \n        trackId=").concat(this.trackId,"\n        saving ").concat(e,", source=").concat(this.source,"\n        Track does not have any sink"));yield this.requestLayer(e,"preferLayer"),this.pushInHistory("uiPreferLayer-".concat(e))}}else fi.w("layer none will be ignored")})}getSimulcastLayer(){return this.stream.getSimulcastLayer()}getLayer(){return this.stream.getVideoLayer()}getPreferredLayer(){return this.preferredLayer}getPreferredLayerDefinition(){return this._layerDefinitions.find(e=>e.layer===this.preferredLayer)}replaceTrack(e){this.nativeTrack=e.nativeTrack,e.transceiver&&(this.transceiver=e.transceiver,this.stream.updateId(e.stream.id)),this.videoHandler.updateSinks()}addSink(t){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Jt(this,null,function*(){cn(this.nativeTrack)?yield this.requestLayer(this.preferredLayer,"addSink"):(Kt(e.prototype,this,"addSink").call(this,t),i&&(yield this.updateLayer("addSink"))),this.pushInHistory("uiSetLayer-high")})}removeSink(t){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Jt(this,null,function*(){Kt(e.prototype,this,"removeSink").call(this,t),i&&(yield this.updateLayer("removeSink")),this._degraded=!1,this.pushInHistory("uiSetLayer-none")})}getSimulcastDefinitions(){return[...this._layerDefinitions]}setSimulcastDefinitons(e){this._layerDefinitions=e}setLayerFromServer(e){this._degraded=this.getDegradationValue(e),this._degradedAt=this._degraded?new Date:this._degradedAt;let t=e.current_layer;return fi.d("[Remote Track] ".concat(this.logIdentifier," \n      streamId=").concat(this.stream.id," \n      trackId=").concat(this.trackId,"\n      layer update from sfu\n      currLayer=").concat(e.current_layer,"\n      preferredLayer=").concat(e.expected_layer,"\n      sub_degraded=").concat(e.subscriber_degraded,"\n      pub_degraded=").concat(e.publisher_degraded,"\n      isDegraded=").concat(this._degraded)),this.stream.setVideoLayerLocally(t,this.logIdentifier,"setLayerFromServer"),this.pushInHistory("sfuLayerUpdate-".concat(t)),this._degraded}getDegradationValue(e){return this.enabled&&(e.publisher_degraded||e.subscriber_degraded)&&"none"===e.current_layer}updateLayer(e){return Jt(this,null,function*(){let t=this.preferredLayer;this.enabled&&this.hasSinks()?t=this.preferredLayer:this.disableNoneLayerRequest||(t="none"),this.shouldSendVideoLayer(t,e)&&(yield this.requestLayer(t,e))})}pushInHistory(e){}requestLayer(e,t){return Jt(this,null,function*(){try{let i=yield this.stream.setVideoLayer(e,this.trackId,this.logIdentifier,t);return fi.d("[Remote Track] ".concat(this.logIdentifier," \n      streamId=").concat(this.stream.id,"\n      trackId=").concat(this.trackId,"\n      Requested layer ").concat(e,", source=").concat(t)),i}catch(i){throw fi.d("[Remote Track] ".concat(this.logIdentifier," \n      streamId=").concat(this.stream.id,"\n      trackId=").concat(this.trackId,"\n      Failed to set layer ").concat(e,", source=").concat(t,"\n      error=").concat(i.message)),i}})}shouldSendVideoLayer(e,t){let i=this.getLayer();return!(!this.degraded||"none"!==e)||(i!==e||(fi.d("[Remote Track] ".concat(this.logIdentifier),"Not sending update, already on layer ".concat(e,", source=").concat(t)),!1))}},Dr=class{constructor(){this.history=[]}push(e){e.time=(new Date).toISOString().split("T")[1],this.history.push(e)}},Mr=class extends ki{constructor(){super(...arguments),this.TAG="[HMSLocalStream]",this.connection=null}setConnection(e){this.connection=e}addTransceiver(e,t){let i=this.connection.addTransceiver(e.getTrackBeingSent(),{streams:[this.nativeStream],direction:"sendonly",sendEncodings:this.getTrackEncodings(e,t)});return this.setPreferredCodec(i,e.nativeTrack.kind),e.transceiver=i,i}setMaxBitrateAndFramerate(e,t){return Jt(this,null,function*(){var i;yield null==(i=this.connection)?void 0:i.setMaxBitrateAndFramerate(e,t)})}setPreferredCodec(e,t){}replaceStreamTrack(e,t){this.nativeStream.addTrack(t),this.nativeStream.removeTrack(e)}removeSender(e){var t,i;if(!this.connection||"closed"===this.connection.connectionState)return void fi.d(this.TAG,"publish connection is not initialised or closed");let n=null==(t=e.transceiver)?void 0:t.sender;if(!n)return void fi.w(this.TAG,"No sender found for trackId=".concat(e.trackId));null==(i=this.connection)||i.removeTrack(n);let r=this.tracks.indexOf(e);-1!==r?this.tracks.splice(r,1):fi.w(this.TAG,"Cannot find ".concat(e.trackId," in locally stored tracks"))}getTrackEncodings(e,t){let i=[];if(e instanceof sr)if(t.length>0)fi.d(this.TAG,"Simulcast enabled with layers",t),i.push(...t);else{let t={active:this.nativeStream.active};e.settings.maxBitrate&&!wi&&(t.maxBitrate=e.settings.maxBitrate),i.push(t)}return i}},Nr=class extends ki{constructor(e,t){super(e),this.audio=!0,this.video="none",this.connection=t}setAudio(e,t,i){return Jt(this,null,function*(){this.audio!==e&&(this.audio=e,fi.d("[Remote stream] ".concat(i||""," \n    streamId=").concat(this.id,"\n    trackId=").concat(t,"\n    subscribing audio - ").concat(this.audio)),yield this.connection.sendOverApiDataChannelWithResponse({params:{subscribed:this.audio,track_id:t},method:"prefer-audio-track-state"}))})}setVideoLayerLocally(e,t,i){this.video=e,fi.d("[Remote stream] ".concat(t,"\n    streamId=").concat(this.id,"\n    source: ").concat(i,"\n    Setting layer field to=").concat(e))}setVideoLayer(e,t,i,n){return fi.d("[Remote stream] ".concat(i," \n      streamId=").concat(this.id,"\n      trackId=").concat(t," \n      source: ").concat(n," request ").concat(e," layer")),this.setVideoLayerLocally(e,i,n),this.connection.sendOverApiDataChannelWithResponse({params:{max_spatial_layer:this.video,track_id:t},method:"prefer-video-track-state"})}getSimulcastLayer(){return this.video}getVideoLayer(){return this.video}isAudioSubscribed(){return this.audio}},Or=(e,t,i,n)=>Jt(void 0,null,function*(){var r;let s,a={};if(null!=(r=t.transceiver)&&r.sender.track){try{s=yield t.transceiver.sender.getStats();let e={},r={},o={};null==s||s.forEach(t=>{switch(t.type){case"outbound-rtp":r[t.id]=t;break;case"remote-inbound-rtp":o[t.ssrc]=t;break;case"codec":e[t.id]=t.mimeType}}),Object.keys(Wt({},r)).forEach(s=>{var l,c;let u,d=null==(l=r[s])?void 0:l.codecId,h=d?e[d]:void 0;h&&(u=h.substring(h.indexOf("/")+1));let p=Ht(Wt({},r[s]),{rid:null==(c=r[s])?void 0:c.rid}),f=o[p.ssrc];a[s]=Ht(Wt({},p),{bitrate:Br("bytesSent",p,null==n?void 0:n[s]),packetsLost:null==f?void 0:f.packetsLost,jitter:null==f?void 0:f.jitter,roundTripTime:null==f?void 0:f.roundTripTime,totalRoundTripTime:null==f?void 0:f.totalRoundTripTime,peerName:i,peerID:t.peerId,enabled:t.enabled,codec:u})})}catch(o){e.analytics.publish(Ji.rtcStatsFailed(Oi.WebrtcErrors.StatsFailed("TRACK","Error getting local track stats ".concat(t.trackId," - ").concat(o.message)))),fi.w("[HMSWebrtcStats]","Error in getting local track stats",t,o,o.name)}return a}}),xr=(e,t,i,n)=>Jt(void 0,null,function*(){var r;let s;try{s=yield null==(r=t.transceiver)?void 0:r.receiver.getStats()}catch(c){e.analytics.publish(Ji.rtcStatsFailed(Oi.WebrtcErrors.StatsFailed("TRACK","Error getting remote track stats ".concat(t.trackId," - ").concat(c.message)))),fi.w("[HMSWebrtcStats]","Error in getting remote track stats",t,c)}let a=Ur(s),o=Br("bytesReceived",a,n),l=Gr("packetsLost",a,n);return null!=a&&a.remote&&Object.assign(a.remote,{packetsLostRate:Gr("packetsLost",a.remote,null==n?void 0:n.remote)}),a&&Ht(Wt({},a),{bitrate:o,packetsLostRate:l,peerID:t.peerId,enabled:t.enabled,peerName:i,codec:a.codec})}),Ur=e=>{let t,i,n={};null==e||e.forEach(e=>{switch(e.type){case"inbound-rtp":case"outbound-rtp":t=e;break;case"remote-inbound-rtp":i=e;break;case"codec":n[e.id]=e.mimeType}});let r,s=null!=t&&t.codecId?n[t.codecId]:void 0;return s&&(r=s.substring(s.indexOf("/")+1)),t&&Object.assign(t,{remote:i,codec:r})},Fr=(e,t,i)=>{let n=jr(t),r=Br("publish"===e?"bytesSent":"bytesReceived",n,i&&i[e]);return n&&Object.assign(n,{bitrate:r})},jr=e=>{let t;return null==e||e.forEach(i=>{"transport"===i.type&&(t=null==e?void 0:e.get(i.selectedCandidatePairId))}),t||null==e||e.forEach(e=>{"candidate-pair"===e.type&&e.selected&&(t=e)}),t},Br=(e,t,i)=>8*Gr(e,t,i),Gr=(e,t,i)=>{let n=t&&t[e],r=i?i[e]:null;return[t,i,Bi(n),Bi(r)].every(e=>!!e)?1e3*Vr(n,r,null==t?void 0:t.timestamp,null==i?void 0:i.timestamp):0},Vr=(e,t,i,n)=>Bi(e)&&Bi(t)&&i&&n?(e-t)/(i-n):0,zr=class{constructor(e,t,i,n){var r;this.store=e,this.eventBus=t,this.publishConnection=i,this.subscribeConnection=n,this.TAG="[HMSWebrtcStats]",this.peerStats={},this.remoteTrackStats={},this.localTrackStats={},this.getLocalPeerStats=()=>this.peerStats[this.localPeerID],this.getRemoteTrackStats=e=>this.remoteTrackStats[e],this.getAllRemoteTracksStats=()=>this.remoteTrackStats,this.getLocalTrackStats=()=>this.localTrackStats,this.updateStats=()=>Jt(this,null,function*(){yield this.updateLocalPeerStats(),yield this.updateLocalTrackStats(),yield this.updateRemoteTrackStats()}),this.updateLocalPeerStats=()=>Jt(this,null,function*(){var e,t,i,n;let r,s=this.getLocalPeerStats();try{r=yield null==(e=this.publishConnection)?void 0:e.getStats()}catch(Ge){this.eventBus.analytics.publish(Ji.rtcStatsFailed(Oi.WebrtcErrors.StatsFailed("PUBLISH",Ge.message))),fi.w(this.TAG,"Error in getting publish stats",Ge)}let a,o=r&&Fr("publish",r,s);try{a=yield null==(t=this.subscribeConnection)?void 0:t.getStats()}catch(Ge){this.eventBus.analytics.publish(Ji.rtcStatsFailed(Oi.WebrtcErrors.StatsFailed("SUBSCRIBE",Ge.message))),fi.w(this.TAG,"Error in getting subscribe stats",Ge)}let l=a&&Fr("subscribe",a,s),{packetsLost:c,jitter:u}=(e=>{let t={packetsLost:0,jitter:0};return null==e||e.forEach(e=>{e.packetsLost&&(t.packetsLost+=e.packetsLost),e.jitter>t.jitter&&(t.jitter=e.jitter)}),t})(a),d=Vr(c,null==(i=null==s?void 0:s.subscribe)?void 0:i.packetsLost,null==l?void 0:l.timestamp,null==(n=null==s?void 0:s.subscribe)?void 0:n.timestamp),h=l&&Object.assign(l,{packetsLostRate:d,jitter:u,packetsLost:c});this.peerStats[this.localPeerID]={publish:o,subscribe:h}}),this.updateRemoteTrackStats=()=>Jt(this,null,function*(){var e;let t=Array.from(this.store.getTracksMap().values()).filter(e=>e instanceof Lr||e instanceof jn),i=t.map(e=>e.trackId);Object.keys(this.remoteTrackStats).forEach(e=>{i.includes(e)||delete this.remoteTrackStats[e]});for(let n of t){let t=n.peerId&&(null==(e=this.store.getPeerById(n.peerId))?void 0:e.name),i=this.getRemoteTrackStats(n.trackId),r=yield xr(this.eventBus,n,t,i);r&&(this.remoteTrackStats[n.trackId]=r)}}),this.updateLocalTrackStats=()=>Jt(this,null,function*(){var e;let t=this.store.getLocalPeerTracks().reduce((e,t)=>(e[t.getTrackIDBeingSent()]=t,e),{}),i=((e,t)=>Array.from(new Set(e.concat(t))))(Object.keys(this.localTrackStats),Object.keys(t));for(let n of i){let i=t[n];if(i){let t=null==(e=this.store.getLocalPeer())?void 0:e.name,r=yield Or(this.eventBus,i,t,this.localTrackStats[n]);r&&(this.localTrackStats[n]=r)}else delete this.localTrackStats[n]}}),this.localPeerID=null==(r=this.store.getLocalPeer())?void 0:r.peerId}setPeerConnections(e){let{publish:t,subscribe:i}=e;this.publishConnection=t,this.subscribeConnection=i}getPublishPeerConnection(){return this.publishConnection}getSubscribePeerConnection(){return this.subscribeConnection}},Wr=class{constructor(e,t){this.store=e,this.eventBus=t,this.TAG="[HMSWebrtcInternals]",this.interval=1e3,this.isMonitored=!1,this.handleStatsUpdate=()=>Jt(this,null,function*(){var e;yield null==(e=this.hmsStats)?void 0:e.updateStats(),this.hmsStats&&this.eventBus.statsUpdate.publish(this.hmsStats)})}getCurrentStats(){return this.hmsStats}getPublishPeerConnection(){var e;return null==(e=this.hmsStats)?void 0:e.getPublishPeerConnection()}getSubscribePeerConnection(){var e;return null==(e=this.hmsStats)?void 0:e.getSubscribePeerConnection()}onStatsChange(e){return this.eventBus.statsUpdate.subscribe(e),()=>{this.eventBus.statsUpdate.unsubscribe(e)}}setPeerConnections(e){let{publish:t,subscribe:i}=e;this.hmsStats?this.hmsStats.setPeerConnections({publish:t,subscribe:i}):this.hmsStats=new zr(this.store,this.eventBus,t,i)}start(){return Jt(this,null,function*(){this.isMonitored?fi.d(this.TAG,"Already started"):(this.stop(),this.isMonitored=!0,fi.d(this.TAG,"Starting Webrtc Stats Monitor"),this.startLoop().then(()=>fi.d(this.TAG,"Stopping Webrtc Stats Monitor")).catch(e=>{this.eventBus.analytics.publish(Ji.rtcStatsFailed(Oi.WebrtcErrors.StatsFailed("PUBLISH",e.message))),fi.e(this.TAG,e.message)}))})}stop(){this.isMonitored=!1}startLoop(){return Jt(this,null,function*(){for(;this.isMonitored;)yield this.handleStatsUpdate(),yield gn(this.interval)})}cleanup(){this.stop(),this.eventBus.statsUpdate.removeAllListeners()}},Hr=class{constructor(e){let{peerId:t,name:i,isLocal:n,customerUserId:r,metadata:s,role:a,joinedAt:o,groups:l,realtime:c,type:u}=e;this.customerUserId="",this.metadata="",this.auxiliaryTracks=[],this.name=i,this.peerId=t,this.isLocal=n,this.customerUserId=r,this.metadata=s,this.joinedAt=o,this.groups=l,this.realtime=c,this.type=u,a&&(this.role=a)}get isHandRaised(){var e;return!(null==(e=this.groups)||!e.includes(Rr))}updateRole(e){this.role=e}updateName(e){this.name=e}updateNetworkQuality(e){this.networkQuality=e}updateMetadata(e){this.metadata=e}updateGroups(e){this.groups=e}toString(){var e,t,i,n;return"{\n      name: ".concat(this.name,";\n      role: ").concat(null==(e=this.role)?void 0:e.name,";\n      peerId: ").concat(this.peerId,";\n      customerUserId: ").concat(this.customerUserId,";\n      ").concat(this.audioTrack?"audioTrack: ".concat(null==(t=this.audioTrack)?void 0:t.trackId,";"):"","\n      ").concat(this.videoTrack?"videoTrack: ".concat(null==(i=this.videoTrack)?void 0:i.trackId,";"):"","\n      groups: ").concat(null==(n=this.groups)?void 0:n.join(),"\n    }")}},qr=class{};qr.makePeerId=()=>C();var Kr=class extends Hr{constructor(e){super(Ht(Wt({},e),{peerId:qr.makePeerId(),isLocal:!0})),this.isLocal=!0,this.auxiliaryTracks=[],this.asRole=e.asRole}isInPreview(){return!!this.asRole}toString(){var e,t,i;return"{\n      name: ".concat(this.name,";\n      role: ").concat(null==(e=this.role)?void 0:e.name,";\n      peerId: ").concat(this.peerId,";\n      customerUserId: ").concat(this.customerUserId,";\n      ").concat(this.asRole?"asRole: ".concat(this.asRole.name,";"):"","\n      ").concat(this.audioTrack?"audioTrack: ".concat(null==(t=this.audioTrack)?void 0:t.trackId,";"):"","\n      ").concat(this.videoTrack?"videoTrack: ".concat(null==(i=this.videoTrack)?void 0:i.trackId,";"):"","\n    }")}},Jr=class extends Hr{constructor(e){super(Ht(Wt({},e),{isLocal:!1})),this.isLocal=!1,this.auxiliaryTracks=[],this.fromRoomState=!1,this.fromRoomState=!!e.fromRoomState}},Qr=(e,t)=>new Jr({peerId:e.peer_id,name:e.info.name,role:t.getPolicyForRole(e.role),customerUserId:e.info.user_id,metadata:e.info.data,groups:e.groups,type:e.info.type}),Yr=class{constructor(e,t,i){this.transport=e,this.store=t,this.options=i,this.isEnd=!1,this.iterator=null,this.total=0,this.defaultPaginationLimit=10}validateConnection(){if(!this.transport||!this.store)throw Error("Use usePaginatedParticipants or hmsActions.getPeerListIterator after preview or join has happened")}hasNext(){return!this.isEnd}getTotal(){return this.total}findPeers(){return Jt(this,null,function*(){var e;this.validateConnection();let t=yield this.transport.signal.findPeers(Ht(Wt({},this.options||{}),{limit:(null==(e=this.options)?void 0:e.limit)||this.defaultPaginationLimit}));return this.updateState(t),this.processPeers(t.peers)})}next(){return Jt(this,null,function*(){var e;let t;return this.validateConnection(),this.iterator||this.isEnd?this.iterator?(t=yield this.transport.signal.peerIterNext({iterator:this.iterator,limit:(null==(e=this.options)?void 0:e.limit)||this.defaultPaginationLimit}),this.updateState(t),this.processPeers(t.peers)):[]:yield this.findPeers()})}processPeers(e){let t=[];return e.forEach(e=>{let i=Qr(e,this.store);t.push(i)}),t}updateState(e){this.isEnd=e.eof,this.total=e.total,e.iterator&&(this.iterator=e.iterator)}},$r=class{constructor(e){this.TAG="[AudioContextManager]",this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(e),this.source.connect(this.audioContext.destination)}resumeContext(){return Jt(this,null,function*(){"suspended"===this.audioContext.state&&(yield this.audioContext.resume(),fi.d(this.TAG,"AudioContext is resumed"))})}getAudioTrack(){return this.destinationNode&&this.source.disconnect(this.destinationNode),this.destinationNode=this.audioContext.createMediaStreamDestination(),this.source.connect(this.destinationNode),this.destinationNode.stream.getAudioTracks()[0]}cleanup(){"closed"!==this.audioContext.state&&this.audioContext.close().catch(e=>{fi.d(this.TAG,"AudioContext close error",e.message)})}},Xr=class extends De.EventEmitter2{on(e,t){return super.on(e,t)}off(e,t){return super.off(e,t)}emit(e,t){return super.emit(e,t)}listeners(e){return super.listeners(e)}},Zr=class extends Xr{constructor(){super(...arguments),this.audioElement=null,this.TAG="[PlaylistAudioManager]",this.seeked=!1}play(e){return Jt(this,null,function*(){return this.audioElement=this.getAudioElement(),new Promise((t,i)=>{this.audioElement=this.getAudioElement(),this.audioElement.src=e,this.seeked=!1,this.audioElement.onerror=()=>{let t="Error loading ".concat(e);fi.e(this.TAG,t),this.stop(),i(t)},this.audioElement.oncanplaythrough=()=>Jt(this,null,function*(){try{if(!this.audioElement)return;if(this.audioContextManager.resumeContext(),this.track)this.seeked?this.seeked=!1:(yield this.audioElement.play(),t([this.track]));else{yield this.audioElement.play();let e=this.audioContextManager.getAudioTrack();this.track=e,t([e])}}catch(n){fi.e(this.TAG,"Error playing audio",e,n.message),i(n)}}),this.audioElement.onseeked=()=>{this.seeked=!0}})})}getTracks(){return this.track?[this.track.id]:[]}getElement(){return this.audioElement||(this.audioElement=this.getAudioElement()),this.audioElement}stop(){var e,t,i;null==(e=this.audioElement)||e.pause(),null==(t=this.audioElement)||t.removeAttribute("src"),this.audioElement=null,null==(i=this.audioContextManager)||i.cleanup(),this.track=void 0}getAudioElement(){if(this.audioElement)return this.audioElement;let e=document.createElement("audio");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",e=>this.emit("progress",e)),e.addEventListener("ended",()=>{this.emit("ended",null)}),this.audioContextManager=new $r(e),e}},es=class extends Xr{constructor(){super(...arguments),this.TAG="[PlaylistVideoManager]",this.videoElement=null,this.canvasContext=null,this.tracks=[],this.DEFAUL_FPS=24,this.seeked=!1,this.drawImage=()=>{var e,t,i;this.videoElement&&!this.videoElement.paused&&!this.videoElement.ended&&(null==(i=this.canvasContext)||i.drawImage(this.videoElement,0,0,null==(e=this.canvas)?void 0:e.width,null==(t=this.canvas)?void 0:t.height),this.timer=setTimeout(()=>{this.drawImage()},1e3/this.DEFAUL_FPS))}}play(e){return this.videoElement=this.getVideoElement(),this.createCanvas(),new Promise((t,i)=>{this.videoElement=this.getVideoElement(),this.videoElement.src=e,this.seeked=!1,this.videoElement.onerror=()=>{let t="Error loading ".concat(e);fi.e(this.TAG,t),this.stop(),i(t)},this.videoElement.oncanplaythrough=()=>Jt(this,null,function*(){var n,r,s;try{if(!this.videoElement)return;if(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight,0===this.tracks.length){this.clearCanvasAndTracks();let e=this.canvas.captureStream();if(!e)return void fi.e(this.TAG,"Browser does not support captureStream");this.videoElement.onplay=this.drawImage,yield this.audioContextManager.resumeContext(),yield this.videoElement.play();let i=this.audioContextManager.getAudioTrack();e.addTrack(i),e.getTracks().forEach(e=>{this.tracks.push(e)}),t(this.tracks)}else this.seeked?(this.seeked=!1,null==(s=this.canvasContext)||s.drawImage(this.videoElement,0,0,null==(n=this.canvas)?void 0:n.width,null==(r=this.canvas)?void 0:r.height)):(yield this.videoElement.play(),t(this.tracks))}catch(Ke){fi.e(this.TAG,"Error playing video",e,Ke.message),i(Ke)}}),this.videoElement.onseeked=()=>{this.seeked=!0}})}getTracks(){return this.tracks.map(e=>e.id)}getElement(){return this.videoElement||(this.videoElement=this.getVideoElement()),this.videoElement}stop(){var e,t,i;null==(e=this.videoElement)||e.pause(),null==(t=this.videoElement)||t.removeAttribute("src"),this.videoElement=null,null==(i=this.audioContextManager)||i.cleanup(),this.clearCanvasAndTracks()}clearCanvasAndTracks(){var e;this.tracks=[],null==(e=this.canvasContext)||e.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(this.timer)}getVideoElement(){if(this.videoElement)return this.videoElement;let e=document.createElement("video");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",e=>this.emit("progress",e)),e.addEventListener("ended",()=>{this.emit("ended",null)}),this.audioContextManager=new $r(e),e}createCanvas(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"))}},ts={list:[],currentIndex:-1,isAutoplayOn:!0},is={list:[],currentIndex:-1,isAutoplayOn:!0},ns=class extends Xr{constructor(e,t){super(),this.sdk=e,this.eventBus=t,this.state={audio:Wt({},ts),video:Wt({},is)},this.TAG="[PlaylistManager]",this.handlePausePlaylist=e=>Jt(this,[e],function(e){var t=this;let{enabled:i,track:n}=e;return function*(){var e;if(i)return;let r;"audioplaylist"===n.source&&(r="audio"),"videoplaylist"===n.source&&(r="video"),r&&(null==(e=t.getElement(r))||e.pause())}()}),this.addTrack=(e,t)=>Jt(this,null,function*(){yield this.sdk.addTrack(e,t),fi.d(this.TAG,"Playlist track added",Qi(e))}),this.removeTrack=e=>Jt(this,null,function*(){yield this.sdk.removeTrack(e,!0),fi.d(this.TAG,"Playlist track removed",e)}),this.audioManager=new Zr,this.videoManager=new es,this.addListeners()}getList(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return this.state[e].list}setList(e){e&&0!==e.length?e.forEach(e=>{this.state[e.type].list.find(t=>t.id===e.id)||this.state[e.type].list.push(e)}):fi.w(this.TAG,"Please pass in a list of HMSPlaylistItem's")}clearList(e){return Jt(this,null,function*(){this.isPlaying(e)&&(yield this.stop(e)),this.state[e].list=[]})}removeItem(e,t){return Jt(this,null,function*(){let{list:i,currentIndex:n}=this.state[t],r=i.findIndex(t=>e===t.id);return r>-1&&(n===r&&this.isPlaying(t)&&(yield this.stop(t)),i.splice(r,1),!0)})}seek(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio",{currentIndex:i}=this.state[t];if(-1===i)throw Oi.PlaylistErrors.NoEntryToPlay("PLAYLIST","No item is currently playing");let n=this.getElement(t);if(n){let t=Math.max(n.currentTime+e,0);n.currentTime=Math.min(t,n.duration)}}seekTo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio",{currentIndex:i}=this.state[t];if(-1===i)throw Oi.PlaylistErrors.NoEntryToPlay("PLAYLIST","No item is currently playing");if(e<0)throw Error("value cannot be negative");let n=this.getElement(t);n&&(n.currentTime=Math.min(e,n.duration))}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio";if(e<0||e>100)throw Error("Please pass a valid number between 0-100");let i=this.getElement(t);i&&(i.volume=.01*e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio",t=this.getElement(e);return t?Math.floor(100*t.volume):0}getCurrentTime(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio",t=this.getElement(e);return(null==t?void 0:t.currentTime)||0}getCurrentIndex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return this.state[e].currentIndex}getCurrentProgress(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";var t;let{list:i,currentIndex:n}=this.state[e],r=null==(t=i[n])?void 0:t.url,s=this.getElement(e);return r&&s?Math.floor(s.currentTime/s.duration*100):0}getCurrentSelection(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio",{list:t,currentIndex:i}=this.state[e];if(-1!==i)return t[i]}isPlaying(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio",t=this.getElement(e);return!!t&&!t.paused}setIsAutoplayOn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio",t=arguments.length>1?arguments[1]:void 0;this.state[e].isAutoplayOn=t}getPlaybackRate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio",t=this.getElement(e);return t?t.playbackRate:1}setPlaybackRate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio",t=arguments.length>1?arguments[1]:void 0;if(t<.25||t>2)throw Error("Please pass a value between 0.25 and 2.0");let i=this.getElement(e);i&&(i.playbackRate=t)}setEnabled(e,t){return Jt(this,arguments,function(e,t){var i=this;let{id:n,type:r="audio"}=t;return function*(){let t=i.state[r].list.findIndex(e=>e.id===n);if(!n||-1===t)return void fi.w(i.TAG,"Pass a valid id");let s=i.state[r].list[t].url;e?yield i.play(s,r):yield i.pause(s,r),i.state[r].currentIndex=t,i.setDuration(r)}()})}playNext(){return Jt(this,arguments,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return function*(){let{list:i,currentIndex:n}=e.state[t];if(n>=i.length-1)throw Oi.PlaylistErrors.NoEntryToPlay("PLAYLIST","Reached end of playlist");yield e.play(i[n+1].url,t),e.state[t].currentIndex=n+1,e.setDuration(t)}()})}playPrevious(){return Jt(this,arguments,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return function*(){let{list:i,currentIndex:n}=e.state[t];if(n<=0)throw Oi.PlaylistErrors.NoEntryToPlay("PLAYLIST","Reached start of playlist");yield e.play(i[n-1].url,t),e.state[t].currentIndex=n-1,e.setDuration(t)}()})}stop(){return Jt(this,arguments,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return function*(){var i;let n="audio"===t?e.audioManager:e.videoManager;null==(i=n.getElement())||i.pause(),yield e.removeTracks(t),n.stop(),e.state[t].currentIndex=-1}()})}cleanup(){this.state={audio:Wt({},ts),video:Wt({},is)},this.eventBus.localAudioEnabled.unsubscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.unsubscribe(this.handlePausePlaylist),this.audioManager.stop(),this.videoManager.stop()}onProgress(e){this.videoManager.on("progress",()=>{try{e({type:"video",progress:this.getCurrentProgress("video")})}catch(E){fi.e(this.TAG,"Error in onProgress callback")}}),this.audioManager.on("progress",()=>{try{e({type:"audio",progress:this.getCurrentProgress("audio")})}catch(E){fi.e(this.TAG,"Error in onProgress callback")}})}onNewTrackStart(e){this.on("newTrackStart",e)}onPlaylistEnded(e){this.on("playlistEnded",e)}onCurrentTrackEnded(e){this.on("currentTrackEnded",e)}getElement(){return"audio"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio")?this.audioManager.getElement():this.videoManager.getElement()}removeTracks(){return Jt(this,arguments,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return function*(){let i=("audio"===t?e.audioManager:e.videoManager).getTracks();for(let t of i)yield e.removeTrack(t)}()})}play(e){return Jt(this,arguments,function(e){var t=this;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio";return function*(){let n="audio"===i?t.audioManager:t.videoManager,r=n.getElement();if(t.isItemCurrentlyPlaying(e,i))fi.w(t.TAG,"The ".concat(i," is currently playing"));else if(null!=r&&r.src.includes(e))yield r.play();else{null==r||r.pause();let s=yield n.play(e);for(let e of s)yield t.addTrack(e,"audio"===i?"audioplaylist":"videoplaylist")}}()})}isItemCurrentlyPlaying(e,t){let i=this.getElement(t);return!(!i||i.paused||!i.src.includes(e))}setDuration(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio",t=this.getElement(e),{list:i,currentIndex:n}=this.state[e];i[n]&&(i[n].duration=(null==t?void 0:t.duration)||0),this.emit("newTrackStart",i[n])}pause(e){return Jt(this,arguments,function(e){var t=this;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio";return function*(){let n=t.getElement(i);n&&!n.paused&&n.src.includes(e)?(n.pause(),fi.d(t.TAG,"paused url",e)):fi.w(t.TAG,"The passed in url is not currently playing")}()})}addListeners(){this.audioManager.on("ended",()=>this.handleEnded("audio")),this.videoManager.on("ended",()=>this.handleEnded("video")),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.subscribe(this.handlePausePlaylist)}handleEnded(){return Jt(this,arguments,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return function*(){let{list:i,currentIndex:n,isAutoplayOn:r}=e.state[t];n===i.length-1?(yield e.stop(t),e.emit("playlistEnded",t)):r?e.playNext(t):yield e.pause(i[n].url,t),e.emit("currentTrackEnded",i[n])}()})}},rs=e=>e.room,ss=(g(e=>e.errors,e=>0===e.length?null:e.at(-1)),g(rs,e=>e.id),e=>e.peers),as=e=>e.messages.byID,os=e=>e.messages.allIDs,ls=e=>e.tracks,cs=e=>e.settings,us=e=>e.appData,ds=g([rs],e=>e&&e.isConnected),hs=(g([ds,rs],(e,t)=>e?void 0!==t.peerCount?t.peerCount||1:t.peers.length:Math.max(void 0!==t.peerCount?t.peerCount:t.peers.length-1,0)),g([rs,ss,e=>e.hideLocalPeer],(e,t,i)=>i?e.peers.filter(t=>e.localPeer!==t).map(e=>t[e]):e.peers.map(e=>t[e]))),ps=g(ls,e=>Object.values(e)),fs=g(rs,ss,(e,t)=>t[e.localPeer]),vs=g(rs,e=>e.localPeer),gs=(g(fs,e=>null==e?void 0:e.name),g(fs,e=>null==e?void 0:e.roleName),g(fs,e=>null==e?void 0:e.audioTrack)),ms=g(fs,e=>null==e?void 0:e.videoTrack),ys=g(fs,e=>null==e?void 0:e.auxiliaryTracks),bs=g([gs,ms,ys],(e,t,i)=>{let n=i?[...i]:[];return e&&n.unshift(e),t&&n.unshift(t),n}),ks=(g(hs,e=>e.filter(e=>!e.isLocal)),g(ss,e=>e.speakers,(e,t)=>{let i=Object.entries(t).sort((e,t)=>{var i,n;let r=(null==(i=e[1])?void 0:i.audioLevel)||0;return((null==(n=t[1])?void 0:n.audioLevel)||0)>r?1:-1});if(i.length>0&&i[0][1].audioLevel&&i[0][1].audioLevel>0){let t=i[0][1].peerID;if(t in e)return e[t]}return null}),e=>{let t=fs(e);return ui(e,null==t?void 0:t.audioTrack)}),Ss=e=>{let t=fs(e);return ui(e,null==t?void 0:t.videoTrack)},Ts=e=>{let t=fs(e);return function(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].displayEnabled}(e,null==t?void 0:t.videoTrack)},ws=g(fs,ls,(e,t)=>{let{video:i,audio:n}=ni(t,e);return!(!i&&!n)}),Es=g(ss,ls,(e,t)=>{let i;for(let n in e){let r=e[n],{video:s,audio:a}=ni(t,r);if(s)return r;a&&!i&&(i=r)}return i}),Ps=(g(Es,e=>!!e),g(ss,ls,(e,t)=>{for(let i in e){let n=e[i],{audio:r,video:s}=ni(t,n);if(!s&&r)return n}}),g(ss,ls,(e,t)=>{let i=[],n=[];for(let r in e){let s=e[r],{video:a,audio:o}=ni(t,s);a?i.push(s):o&&n.push(s)}return i.concat(n)}),g(ss,ls,(e,t)=>{for(let i in t){let n=t[i];if(li(n)&&si(n)&&n.peerId)return e[n.peerId]}}),g(ss,ls,(e,t)=>{for(let i in t){let n=t[i];if(oi(n)&&n.peerId)return e[n.peerId]}}),g(ps,e=>e.filter(ci)),g(os,e=>e.length),g(as,e=>Object.values(e).filter(e=>!e.read).length),g(os,as,(e,t)=>{let i=[];return e.forEach(e=>{i.push(t[e])}),i})),Cs=g(Ps,e=>e.filter(e=>{var t;return!e.recipientPeer&&!(e.recipientRoles&&(null==(t=e.recipientRoles)?void 0:t.length)>0)})),Is=(g(Cs,e=>e.filter(e=>!e.read).length),g([rs],e=>e&&e.roomState)),_s=g(Is,e=>"Preview"===e),As=(g(rs,e=>"Disconnected"!==e.roomState),g(rs,e=>!(!e.transcriptions||e.transcriptions.length<=0)&&e.transcriptions.some(e=>"caption"===e.mode&&"started"===e.state)),e=>e.roles),Rs=(g([As],e=>Object.keys(e)),g([fs,As],(e,t)=>null!=e&&e.roleName?t[e.roleName]:null)),Ls=g([e=>{var t;return null==(t=e.preview)?void 0:t.asRole},As],(e,t)=>e?t[e]:null),Ds=(g([Rs],e=>{var t;return!(null==(t=null==e?void 0:e.subscribeParams)||!t.subscribeToRoles)&&e.subscribeParams.subscribeToRoles.length>0}),g(Rs,e=>null==e?void 0:e.permissions)),Ms=(g(rs,e=>e.recording),g(rs,e=>e.rtmp),g(rs,e=>e.hls),g(rs,e=>e.transcriptions),g(rs,e=>e.sessionId),g(rs,e=>e.startedAt),g(rs,e=>!!e.isLargeRoom),g(rs,e=>!!e.isEffectsEnabled),g(rs,e=>!!e.isVBEnabled),g(rs,e=>e.effectsKey),g(hs,e=>e.filter(e=>e.isHandRaised)),g(e=>e.whiteboards,e=>Object.values(e)[0]),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return t=>t.playlist[e].list}),Ns=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return t=>t.playlist[e].selection},Os=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return t=>t.playlist[e].progress},xs=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return t=>t.playlist[e].currentTime},Us=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return t=>t.playlist[e].playbackRate},Fs=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return t=>t.playlist[e].volume},js=function(){return g(Ms(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio"),e=>Object.values(e))},Bs=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio";return g(Ms(e),Ns(e),(e,t)=>{if(t.id)return e[t.id]})},Gs={selection:Ns("audio"),progress:Os("audio"),currentTime:xs("audio"),playbackRate:Us("audio"),volume:Fs("audio"),list:js("audio"),selectedItem:Bs("audio")},Vs={selection:Ns("video"),progress:Os("video"),currentTime:xs("video"),playbackRate:Us("video"),volume:Fs("video"),list:js("video"),selectedItem:Bs("video")};function zs(e){return t=>i=>e(i,t)}var Ws="HMS-Store:",Hs=class{static v(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.log(0,e,...i)}static d(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(1,...t)}static i(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(2,...t)}static w(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(3,...t)}static e(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(6,...t)}static time(e){this.log(4,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(5,"[HMSPerformanceTiming]",e,e)}static cleanup(){performance.clearMarks(),performance.clearMeasures()}static log(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:console.log(Ws,...i);break;case 1:console.debug(Ws,...i);break;case 2:console.info(Ws,...i);break;case 3:console.warn(Ws,...i);break;case 6:console.error(Ws,...i);break;case 4:performance.mark(i[1]);break;case 5:{let e=i[0],t=i[1];try{let i=performance.measure(t,t);this.log(1,e,t,null==i?void 0:i.duration),performance.clearMarks(t),performance.clearMeasures(t)}catch(r){this.log(1,e,t,r)}break}}}};Hs.level=0;var qs=(e,t)=>t,Ks=(e,t)=>t,Js=(e,t)=>t,Qs=g([ss,qs],(e,t)=>t?e[t]:null),Ys=g([ls,Ks],(e,t)=>t?e[t]:null),$s=g([ls,Ks],(e,t)=>{if(!t)return null;let i=e[t];return"video"===(null==i?void 0:i.type)?i:null}),Xs=g([ls,Ks],(e,t)=>{if(!t)return null;let i=e[t];return"audio"===(null==i?void 0:i.type)?i:null}),Zs=g([ls,Ks],(e,t)=>{if(!t)return null;let i=e[t];return"audio"===(null==i?void 0:i.type)&&"screen"===(null==i?void 0:i.source)?i:null}),ea=g([ls,Ks],(e,t)=>{if(!t)return null;let i=e[t];return"video"===(null==i?void 0:i.type)&&"screen"===(null==i?void 0:i.source)?i:null}),ta=g([e=>e.polls,(e,t)=>t],(e,t)=>t?e[t]:null),ia=zs(Qs);zs(g([us,(e,t)=>t],(e,t)=>{if(e)return t?e[t]:e}));zs(g(Qs,e=>null==e?void 0:e.name)),zs(g(Qs,e=>null==e?void 0:e.type));var na=zs(Ys),ra=zs($s),sa=(zs(Xs),zs(Zs),zs(ea),zs((e,t)=>{let i=Qs(e,t);if(i&&i.videoTrack&&""!==i.videoTrack)return e.tracks[i.videoTrack]}),zs((e,t)=>{let i=Qs(e,t);if(i&&i.audioTrack&&""!==i.audioTrack)return e.tracks[i.audioTrack]})),aa=(zs((e,t)=>{let i=Qs(e,t);return(null==i?void 0:i.auxiliaryTracks.map(t=>e.tracks[t]))||[]}),(e,t)=>t?e.speakers[t]:null),oa=(zs(g(aa,e=>(null==e?void 0:e.audioLevel)||0)),zs(g((e,t)=>{let i=sa(t)(e);return aa(e,null==i?void 0:i.id)},e=>(null==e?void 0:e.audioLevel)||0)),zs((e,t)=>{if(t)return e.connectionQualities[t]}),zs((e,t)=>{let i=Qs(e,t);if(i){let t=null==i?void 0:i.auxiliaryTracks.find(t=>ri(e.tracks[t]));return t?e.tracks[t]:void 0}}),zs(g(ls,Qs,(e,t)=>{let i=null==t?void 0:t.auxiliaryTracks.find(t=>{let i=e[t];return li(i)&&si(i)});return i?e[i]:void 0})),zs(g(ls,Qs,(e,t)=>{let i=null==t?void 0:t.auxiliaryTracks.find(t=>{let i=e[t];return li(i)&&ri(i)});return i?e[i]:void 0})),zs(g(ls,Qs,(e,t)=>{let i=null==t?void 0:t.auxiliaryTracks.find(t=>{let i=e[t];return oi(i)&&ri(i)});return i?e[i]:void 0})),zs(g(ls,Qs,(e,t)=>ni(e,t)))),la=e=>g(oa(e),e=>e.audio),ca=(zs((e,t)=>{let i=Qs(e,t);return ui(e,null==i?void 0:i.audioTrack)}),zs((e,t)=>{let i=Qs(e,t);return ui(e,null==i?void 0:i.videoTrack)}),zs((e,t)=>{if(t&&e.tracks[t])return 0===e.tracks[t].volume})),ua=(zs((e,t)=>{let i=Qs(e,t);return ca(null==i?void 0:i.audioTrack)(e)}),zs((e,t)=>{let i=la(t)(e);return ca(null==i?void 0:i.id)(e)}),zs((e,t)=>{let i=Ys(e,t);if(i)return"audio"!==i.type?void Hs.w("Please pass audio track here"):i.volume})),da=(zs((e,t)=>{let i=Qs(e,t);return ua(null==i?void 0:i.audioTrack)(e)}),zs((e,t)=>{let i=la(t)(e);return ua(null==i?void 0:i.id)(e)}),zs((e,t)=>{let i=Ys(e,t);if(i)return"video"!==i.type?void Hs.w("Please pass video track here"):i.layer}),g([Ps,vs,qs],(e,t,i)=>{if(i)return e.filter(e=>{var n;return!(!(e.recipientPeer||null!=(n=e.recipientRoles)&&n.length)||e.sender&&![t,i].includes(e.sender))&&[t,i].includes(e.recipientPeer)})})),ha=g([Ps,Js],(e,t)=>{if(t)return e.filter(e=>{var i,n;return!(null==(i=e.recipientRoles)||!i.length)&&(null==(n=e.recipientRoles)?void 0:n.includes(t))})}),pa=g(Ps,e=>e.filter(e=>{var t;return!e.recipientPeer&&!(null!=(t=e.recipientRoles)&&t.length)})),fa=g([ha,Js],e=>e?e.filter(e=>!e.read).length:0),va=g([da,qs],e=>e?e.filter(e=>!e.read).length:0),ga=(g(pa,e=>e.filter(e=>!e.read).length),zs(da),zs(ha),zs(fa),zs(va),zs(ta)),ma=(g([ss,ls],(e,t)=>Object.values(e).map(e=>{var i;return{peer:e,isAudioEnabled:!!e.audioTrack&&(null==(i=t[e.audioTrack])?void 0:i.enabled)}})),g([e=>e.roleChangeRequests[0]||null,ss,As],(e,t,i)=>e?{requestedBy:e.requestedBy?t[e.requestedBy]:void 0,role:i[e.roleName],token:e.token}:null),g([Rs],e=>di(e)),g([Ls],e=>di(e)),g([ms,ls],(e,t)=>{let i=null;return e&&(i=t[e]),(null==i?void 0:i.plugins)||[]}),g([gs,ls],(e,t)=>{let i=null;return e&&(i=t[e]),(null==i?void 0:i.plugins)||[]}),{0:"PEER_JOINED",1:"PEER_LEFT",8:"ROLE_UPDATED",10:"NAME_UPDATED",11:"METADATA_UPDATED",12:"HAND_RAISE_CHANGED"}),ya={0:"TRACK_ADDED",1:"TRACK_REMOVED",2:"TRACK_MUTED",3:"TRACK_UNMUTED",5:"TRACK_DEGRADED",6:"TRACK_RESTORED",4:"TRACK_DESCRIPTION_CHANGED"},ba={0:"POLL_CREATED",1:"POLL_STARTED",2:"POLL_STOPPED",4:"POLL_VOTES_UPDATED",3:"POLLS_LIST"},ka="TRANSCRIPTION_STATE_UPDATED",Sa="hmsNotification",Ta=class{constructor(e){this.id=0,this.onNotification=(e,t)=>{let i=i=>{if(t){let e;if(e=Array.isArray(t)?t.includes(i.type):t===i.type,!e)return}e(i)};return this.eventEmitter.addListener(Sa,i),()=>{this.eventEmitter.removeListener(Sa,i)}},this.store=e,this.eventEmitter=new De.EventEmitter2({maxListeners:Object.keys(ti).length})}sendPlaylistTrackEnded(e){let t=this.createNotification("PLAYLIST_TRACK_ENDED",e,"info");this.emitEvent(t)}sendDeviceChange(e){var t;let i=this.createNotification("DEVICE_CHANGE_UPDATE",e,e.error?"error":"info","Selected ".concat(e.type," device - ").concat(null==(t=e.selection)?void 0:t.label));this.emitEvent(i)}sendLeaveRoom(e){var t;let i=null==(t=e.requestedBy)?void 0:t.name,n=this.createNotification(e.roomEnded||!i?"ROOM_ENDED":"REMOVED_FROM_ROOM",e,"info","".concat(e.roomEnded?"Room ended":"Removed from room"," ").concat(i?"by ".concat(i):""));this.emitEvent(n)}sendPeerList(e){if(0===e.length)return;let t=this.createNotification("PEER_LIST",e,"info");this.emitEvent(t)}sendPeerUpdate(e,t){let i=this.store.getState(ia(null==t?void 0:t.id))||t,n=ma[e];if(n&&i){let e=this.createNotification(n,i,"info");this.emitEvent(e)}}sendTrackUpdate(e,t){let i=this.store.getState(na(t)),n=ya[e];if(n){let e=this.createNotification(n,i,"info");this.emitEvent(e)}}sendMessageReceived(e){let t=this.createNotification("NEW_MESSAGE",e,"info");this.emitEvent(t)}sendError(e){let t=this.createNotification("ERROR",e,"error");this.emitEvent(t)}sendReconnecting(e){let t=this.createNotification("RECONNECTING",e,"error");this.emitEvent(t)}sendReconnected(){let e=this.createNotification("RECONNECTED",null,"info");this.emitEvent(e)}sendChangeTrackStateRequest(e){let t=this.createNotification("CHANGE_TRACK_STATE_REQUEST",e,"info");this.emitEvent(t)}sendChangeMultiTrackStateRequest(e){let t=this.createNotification("CHANGE_MULTI_TRACK_STATE_REQUEST",e,"info");this.emitEvent(t)}sendPollUpdate(e,t){let i=ba[e],n=this.store.getState(ga(t));if(i){let e=this.createNotification(i,n,"info");this.emitEvent(e)}}sendTranscriptionUpdate(e){let t=this.createNotification(ka,e,"info");this.emitEvent(t)}emitEvent(e){this.eventEmitter.emit(Sa,e)}createNotification(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return this.id++,{id:this.id,type:e,message:n,data:t,severity:i}}},wa=class{constructor(e){this.queuedUpdates={},this.timers={},this.DEFAULT_INTERVAL_MS=50,this.store=e}setState(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.DEFAULT_INTERVAL_MS;this.queuedUpdates[t]=this.queuedUpdates[t]||[],this.queuedUpdates[t].push(e),!this.timers[t]&&(window?this.timers[t]=window.setTimeout(()=>this.setStateBatched(t),i):this.setStateBatched(t))}setStateBatched(e){var t;if((null==(t=this.queuedUpdates[e])?void 0:t.length)>0){let t=t=>{this.queuedUpdates[e].forEach(e=>{try{e(t)}catch(Fe){Hs.w("failed to update store",Fe)}})};console.time("timed-".concat(e)),this.store.namedSetState(t,e),console.timeEnd("timed-".concat(e))}delete this.queuedUpdates[e],window&&this.timers[e]&&(window.clearTimeout(this.timers[e]),delete this.timers[e])}};var Ea,Pa,Ca=(e,t)=>{let i=Da(Object.keys(e),Object.keys(t));for(let n of i){let i=e[n],r=t[n];_a(i,r)?Object.assign(i,r):Aa(i,r)?delete e[n]:Ra(i,r)&&(e[n]=r)}},Ia=(e,t)=>{e.plugins&&La(e.plugins,t.plugins)&&(t.plugins=e.plugins),"video"===e.type&&e.layerDefinitions&&La(e.layerDefinitions,t.layerDefinitions)&&(t.layerDefinitions=e.layerDefinitions)},_a=(e,t)=>e&&t,Aa=(e,t)=>e&&!t,Ra=(e,t)=>!e&&t,La=(e,t)=>{if(e===t||0===e.length&&0===(null==t?void 0:t.length))return!0;if(!e||!t||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},Da=(e,t)=>{let i=new Set;for(let n of e)i.add(n);for(let n of t)i.add(n);return Array.from(i)},Ma=class e{static convertPeer(e){var t,i,n;return{id:e.peerId,name:e.name,roleName:null==(t=e.role)?void 0:t.name,isLocal:e.isLocal,videoTrack:null==(i=e.videoTrack)?void 0:i.trackId,audioTrack:null==(n=e.audioTrack)?void 0:n.trackId,auxiliaryTracks:e.auxiliaryTracks.map(e=>e.trackId),customerUserId:e.customerUserId,metadata:e.metadata,joinedAt:e.joinedAt,groups:e.groups,isHandRaised:e.isHandRaised,type:e.type}}static convertTrack(e,t){let i={id:e.trackId,source:e.source,type:e.type,enabled:e.enabled,displayEnabled:e.enabled,peerId:e.peerId||t};return this.enrichTrack(i,e),i}static enrichTrack(t,i){let n=i.getMediaTrackSettings();i instanceof jn&&(t.volume=i.getVolume()||0),e.updateDeviceID(t,i),e.enrichLocalTrack(t,i),"video"===t.type&&("screen"===t.source?(t.displaySurface=n.displaySurface,e.enrichScreenTrack(t,i)):"regular"===t.source&&(t.facingMode=n.facingMode),t.height=n.height,t.width=n.width,e.enrichVideoTrack(t,i)),e.enrichPluginsDetails(t,i)}static enrichLocalTrack(e,t){(t instanceof sr||t instanceof Fn)&&(e.isPublished=t.isPublished)}static updateDeviceID(e,t){var i;e.deviceID=t instanceof sr||t instanceof Fn?t.settings.deviceId:null==(i=t.getMediaTrackSettings())?void 0:i.deviceId}static enrichVideoTrack(e,t){t instanceof Lr&&(e.layer=t.getLayer(),e.preferredLayer=t.getPreferredLayer(),e.degraded=t.degraded),(t instanceof Lr||t instanceof sr)&&(La(t.getSimulcastDefinitions(),e.layerDefinitions)||(e.layerDefinitions=t.getSimulcastDefinitions()))}static enrichScreenTrack(e,t){var i,n;if(t instanceof sr){let r=null==(i=t.getCaptureHandle)?void 0:i.call(t);(null==r?void 0:r.handle)!==(null==(n=e.captureHandle)?void 0:n.handle)&&(e.captureHandle=r),t.isCurrentTab&&(e.displaySurface="selfBrowser")}}static enrichPluginsDetails(e,t){(t instanceof sr||t instanceof Fn)&&(La(t.getPlugins(),e.plugins)||(e.plugins=t.getPlugins()))}static convertRoom(t,i){let{recording:n,rtmp:r,hls:s,transcriptions:a}=e.convertRecordingStreamingState(t.recording,t.rtmp,t.hls,t.transcriptions);return{id:t.id,name:t.name,localPeer:i,recording:n,rtmp:r,hls:s,transcriptions:a,sessionId:t.sessionId,startedAt:t.startedAt,joinedAt:t.joinedAt,peerCount:t.peerCount,isLargeRoom:t.large_room_optimization,isEffectsEnabled:t.isEffectsEnabled,disableNoneLayerRequest:t.disableNoneLayerRequest,isVBEnabled:t.isVBEnabled,effectsKey:t.effectsKey,isHipaaEnabled:t.isHipaaEnabled,isNoiseCancellationEnabled:t.isNoiseCancellationEnabled}}static convertMessage(e,t){var i,n,r,s;return{sender:null==(i=e.peer)?void 0:i.peer_id,senderName:null==(n=e.peer)?void 0:n.info.name,senderRole:null==(r=e.peer)?void 0:r.role,senderUserId:null==(s=e.peer)?void 0:s.info.user_id,recipientPeer:e.private?t:void 0,recipientRoles:e.roles,time:new Date(e.timestamp),type:e.info.type,message:e.info.message,id:e.message_id}}static convertRoles(e){let t={};return e&&e.forEach(e=>{t[e.name]=e}),t}static convertRoleChangeRequest(e){var t;return{requestedBy:null==(t=e.requestedBy)?void 0:t.peerId,roleName:e.role.name,token:e.token}}static convertException(e){let t="trackType"in e,i={code:e.code,action:e.action,name:e.name,message:e.message,description:e.description,isTerminal:e.isTerminal,nativeError:e.nativeError,timestamp:new Date};return t&&(i.trackType=null==e?void 0:e.trackType),i}static convertDeviceChangeUpdate(e){let t={devices:e.devices,selection:e.selection,type:e.type};return e.error&&(t.error=this.convertException(e.error)),t}static convertPlaylist(e){return{audio:this.getConvertedPlaylistType(e,"audio"),video:this.getConvertedPlaylistType(e,"video")}}static convertPlaylistItem(e,t){let i=t.type,n=e.getCurrentSelection(i),r=e.isPlaying(i),s=t.url===(null==n?void 0:n.url);return Ht(Wt({},t),{type:t.type,selected:s,playing:s&&r})}static getConvertedPlaylistType(t,i){let n={},r=t.getCurrentSelection(i),s=t.getCurrentProgress(i),a=t.getVolume(i),o=t.getList(i),l=t.getCurrentIndex(i);return t.getList(i).forEach(i=>{n[i.id]=e.convertPlaylistItem(t,i)}),{list:n,selection:{id:null==r?void 0:r.id,hasPrevious:l>0,hasNext:l<o.length-1},progress:s,volume:a,currentTime:t.getCurrentTime(i),playbackRate:t.getPlaybackRate(i)}}static convertRecordingStreamingState(e,t,i,n){var r;return{recording:{browser:Wt({running:!1},null==e?void 0:e.browser),server:Wt({running:!1},null==e?void 0:e.server),hls:Wt({running:!1},null==e?void 0:e.hls)},rtmp:Wt({running:!1},t),hls:{variants:(null==(r=null==i?void 0:i.variants)?void 0:r.map(e=>e))||[],running:!(null==i||!i.running),error:null==i?void 0:i.error},transcriptions:n||[]}}},Na=class{constructor(e,t,i,n){this.playlistManager=e,this.syncPlaylistState=i,this.store=n,this.type=t}play(e){return Jt(this,null,function*(){e?yield this.playlistManager.setEnabled(!0,{id:e,type:this.type}):Hs.w("Please pass id to play")})}pause(){return Jt(this,null,function*(){let e="audio"===this.type?Gs:Vs,t=this.store.getState(e.selection);t.id?yield this.playlistManager.setEnabled(!1,{id:t.id,type:this.type}):Hs.w("No item is currently playing to pause")})}playNext(){return Jt(this,null,function*(){yield this.playlistManager.playNext(this.type)})}playPrevious(){return Jt(this,null,function*(){yield this.playlistManager.playPrevious(this.type)})}seek(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState("seekOn".concat(this.type,"Playlist"))}seekTo(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState("seekToOn".concat(this.type,"Playlist"))}setVolume(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState("setVolumeOn".concat(this.type,"Playlist"))}setList(e){this.playlistManager.setList(e),this.syncPlaylistState("setListOn".concat(this.type,"Playlist"))}stop(){return Jt(this,null,function*(){yield this.playlistManager.stop(this.type),this.syncPlaylistState("stop".concat(this.type,"Playlist"))})}setIsAutoplayOn(e){this.playlistManager.setIsAutoplayOn(this.type,e)}setPlaybackRate(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState("set".concat(this.type,"PlaybackRate"))}removeItem(e){return Jt(this,null,function*(){let t=yield this.playlistManager.removeItem(e,this.type);return t&&this.syncPlaylistState("remove".concat(this.type,"PlaylistItem")),t})}clearList(){return Jt(this,null,function*(){yield this.playlistManager.clearList(this.type),this.syncPlaylistState("clear".concat(this.type,"Playlist"))})}},Oa=class{constructor(e,t){this.sdk=e,this.setLocally=t}get sdkSessionStore(){return this.sdk.getSessionStore()}set(e,t){return Jt(this,null,function*(){let{value:i}=yield this.sdkSessionStore.set(String(e),t);this.setLocally({key:e,value:i})})}observe(e){return Jt(this,null,function*(){let t=Array.isArray(e)?e.map(e=>String(e)):[String(e)];yield this.sdkSessionStore.observe(t)})}unobserve(e){return Jt(this,null,function*(){let t=Array.isArray(e)?e.map(e=>String(e)):[String(e)];yield this.sdkSessionStore.unobserve(t)})}},xa=class{constructor(e,t){this.TAG="[BeamSpeakerLabelsLogger]",this.intervalMs=100,this.shouldMonitor=!1,this.hasStarted=!1,this.unsubs=[],this.analysers={},this.store=e,this.actions=t}start(){return Jt(this,null,function*(){if(this.hasStarted)return;this.hasStarted=!0,Hs.d("starting audio level monitor for remote peers",this.store);let e=this.store.getState(ds);Hs.d("starting audio levels is connected to room",e),e&&(yield this.monitorAudioLevels());let t=this.store.subscribe(this.monitorAudioLevels.bind(this),ds);this.unsubs.push(t)})}stop(){return Jt(this,null,function*(){this.hasStarted&&(this.hasStarted=!1,this.shouldMonitor=!1,this.unsubs.forEach(e=>e()),Hs.d("stopped audio level monitor for remote peers"))})}monitorAudioLevels(){return Jt(this,null,function*(){if(!this.store.getState(ds))return void(this.shouldMonitor&&(Hs.i("room no longer connected, stopping audio level monitoring for remote"),this.shouldMonitor=!1));if(this.shouldMonitor)return;Hs.i("monitoring audio levels"),this.shouldMonitor=!0;let e=()=>{this.shouldMonitor?(this.logAllPeersAudioLevels(),setTimeout(e,this.intervalMs)):Hs.i("stopped monitoring audio levels")};setTimeout(e,1e3)})}logAllPeersAudioLevels(){return Jt(this,null,function*(){var e;if(!window.__triggerBeamEvent__)return;let t=this.store.getState(hs),i=t.filter(e=>!!e.audioTrack);Hs.d(this.TAG,"Peers Without audio track",t.filter(e=>!e.audioTrack).map(e=>e.id).join(","));let n=[];for(let r of i){let t=this.actions.getTrackById(r.audioTrack||""),i=null==(e=null==t?void 0:t.stream)?void 0:e.nativeStream;if(r.joinedAt&&i){let e=yield this.getAudioLevel(r,i);Hs.d(this.TAG,r.id,e),e.level>0&&n.push(e)}}if(n.length>0){let e={event:"app-audio-level",data:n};Hs.d("logging audio levels",JSON.stringify(n)),window.__triggerBeamEvent__(JSON.stringify(e))}})}getAudioLevel(e,t){return Jt(this,null,function*(){this.analysers[t.id]||(this.analysers[t.id]=this.createAnalyserNode(t));let i=this.analysers[t.id],n=this.calculateAudioLevel(i);return{peerId:e.id,peerName:e.name,level:n}})}createAnalyserNode(e){this.audioContext||(this.audioContext=new AudioContext);let t=this.audioContext.createAnalyser();return this.audioContext.createMediaStreamSource(e).connect(t),t}calculateAudioLevel(e){let t=new Uint8Array(e.fftSize);e.getByteTimeDomainData(t);let i=.009,n=i;for(let s of t)n=Math.max(n,(s-128)/128);let r=(Math.log(i)-Math.log(n))/Math.log(i);return Math.ceil(Math.min(Math.max(100*r,0),100))}},Ua=1e4,Fa={name:"diagnostics-role",priority:1,publishParams:{allowed:["audio","video"],audio:{bitRate:32,codec:"opus"},video:{bitRate:100,codec:"vp8",frameRate:30,height:720,width:1280},screen:{bitRate:100,codec:"vp8",frameRate:10,height:1080,width:1920}},subscribeParams:{subscribeToRoles:[],maxSubsBitRate:3200},permissions:{browserRecording:!1,changeRole:!1,endRoom:!1,hlsStreaming:!1,mute:!1,pollRead:!1,pollWrite:!1,removeOthers:!1,rtmpStreaming:!1,unmute:!1}},ja=class{constructor(){this.networkScores=[],this.lastPushedAt=0}pushScore(e){!e||e<0||(0===this.networkScores.length?(this.networkScores.push(e),this.lastPushedAt=Date.now()):this.addPendingCQSTillNow())}addPendingCQSTillNow(){if(this.networkScores.length>0){let e=(Date.now()-this.lastPushedAt)/1e3;for(;e>0;)this.networkScores.push(this.networkScores[this.networkScores.length-1]),e-=1;this.lastPushedAt=Date.now()}}getCQS(){return this.networkScores.reduce((e,t)=>e+t,0)/this.networkScores.length}},Ba=e=>e[e.length-1],Ga=(e,t)=>{let i=e.filter(e=>(e=>!!e&&!isNaN(e))(t(e)));return i.reduce((e,i)=>e+(t(i)||0),0)/i.length},Va=class{constructor(e){this.sdk=e,this.peerStatsList=[],this.localAudioTrackStatsList=[],this.localVideoTrackStatsList=[],this.remoteAudioTrackStatsList=[],this.remoteVideoTrackStatsList=[]}handleStatsUpdate(e){return Jt(this,null,function*(){var t,i,n,r,s,a,o,l;let c=e.getLocalPeerStats();c&&this.peerStatsList.push(c);let u=null==(n=null==(i=null==(t=this.sdk.getLocalPeer())?void 0:t.audioTrack)?void 0:i.nativeTrack)?void 0:n.id,d=null==(a=null==(s=null==(r=this.sdk.getLocalPeer())?void 0:r.videoTrack)?void 0:s.nativeTrack)?void 0:a.id,h=e.getLocalTrackStats();h&&(u&&this.localAudioTrackStatsList.push(h[u]),d&&this.localVideoTrackStatsList.push(h[d]));let p=yield null==(l=null==(o=this.sdk.getWebrtcInternals())?void 0:o.getSubscribePeerConnection())?void 0:l.getStats();null==p||p.forEach(e=>{if("inbound-rtp"===e.type){let t="audio"===e.kind?this.remoteAudioTrackStatsList:this.remoteVideoTrackStatsList,i=Br("bytesReceived",e,Ba(t));t.push(Ht(Wt({},e),{bitrate:i}))}})})}buildReport(){var e,t,i,n,r,s,a,o,l,c;let u=null==(e=Ba(this.peerStatsList))?void 0:e.publish,d=null==(t=Ba(this.peerStatsList))?void 0:t.subscribe,h=null!=u&&u.responsesReceived?((null==u?void 0:u.totalRoundTripTime)||0)/u.responsesReceived:0,p=null!=d&&d.responsesReceived?((null==d?void 0:d.totalRoundTripTime)||0)/d.responsesReceived:0,f=Number(((h+p)/2*1e3).toFixed(2)),v=(null==(i=Ba(this.remoteAudioTrackStatsList))?void 0:i.packetsReceived)||0,g=(null==(n=Ba(this.remoteVideoTrackStatsList))?void 0:n.packetsReceived)||0,m=this.localAudioTrackStatsList.map(e=>e?Ga(Object.values(e),e=>e.bitrate):0),y=this.localVideoTrackStatsList.map(e=>e?Ga(Object.values(e),e=>e.bitrate):0),b=(null==(r=Ba(this.remoteAudioTrackStatsList))?void 0:r.jitter)||0,k=(null==(s=Ba(this.remoteVideoTrackStatsList))?void 0:s.jitter)||0,S=Math.max(b,k),T=Ba(this.localAudioTrackStatsList),w=Ba(this.localVideoTrackStatsList);return{combined:{roundTripTime:f,packetsReceived:v+g,packetsLost:(null==d?void 0:d.packetsLost)||0,bytesSent:(null==u?void 0:u.bytesSent)||0,bytesReceived:(null==d?void 0:d.bytesReceived)||0,bitrateSent:Ga(this.peerStatsList,e=>{var t;return null==(t=e.publish)?void 0:t.bitrate}),bitrateReceived:Ga(this.peerStatsList,e=>{var t;return null==(t=e.subscribe)?void 0:t.bitrate}),jitter:S},audio:{roundTripTime:f,packetsReceived:v,packetsLost:(null==(a=Ba(this.remoteAudioTrackStatsList))?void 0:a.packetsLost)||0,bytesReceived:(null==(o=Ba(this.remoteAudioTrackStatsList))?void 0:o.bytesReceived)||0,bitrateSent:Ga(m,e=>e),bitrateReceived:Ga(this.remoteAudioTrackStatsList,e=>e.bitrate),bytesSent:T?Object.values(T).reduce((e,t)=>e+(t.bytesSent||0),0):0,jitter:b},video:{roundTripTime:f,packetsLost:(null==(l=Ba(this.remoteVideoTrackStatsList))?void 0:l.packetsLost)||0,bytesReceived:(null==(c=Ba(this.remoteVideoTrackStatsList))?void 0:c.bytesReceived)||0,packetsReceived:g,bitrateSent:Ga(y,e=>e),bitrateReceived:Ga(this.remoteVideoTrackStatsList,e=>e.bitrate),bytesSent:w?Object.values(w).reduce((e,t)=>e+(t.bytesSent||0),0):0,jitter:k}}}},za=(e=>(e[e.STARTING=0]="STARTING",e[e.INIT_FETCHED=1]="INIT_FETCHED",e[e.SIGNAL_CONNECTED=2]="SIGNAL_CONNECTED",e[e.ICE_ESTABLISHED=3]="ICE_ESTABLISHED",e[e.MEDIA_CAPTURED=4]="MEDIA_CAPTURED",e[e.MEDIA_PUBLISHED=5]="MEDIA_PUBLISHED",e[e.COMPLETED=6]="COMPLETED",e))(za||{}),Wa=class{constructor(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2e4;this.sdk=e,this.sdkListener=t,this.progressCallback=i,this.completionCallback=n,this.connectivityDuration=r,this.wsConnected=!1,this.initConnected=!1,this.isPublishICEConnected=!1,this.isSubscribeICEConnected=!1,this.gatheredPublishICECandidates=[],this.gatheredSubscribeICECandidates=[],this.errors=[],this.isAudioTrackCaptured=!1,this.isVideoTrackCaptured=!1,this.isAudioTrackPublished=!1,this.isVideoTrackPublished=!1,this.cqsCalculator=new ja,this.timestamp=Date.now(),this.onRoomUpdate=this.sdkListener.onRoomUpdate.bind(this.sdkListener),this.onPeerUpdate=this.sdkListener.onPeerUpdate.bind(this.sdkListener),this.onMessageReceived=this.sdkListener.onMessageReceived.bind(this.sdkListener),this.onReconnected=this.sdkListener.onReconnected.bind(this.sdkListener),this.onRoleChangeRequest=this.sdkListener.onRoleChangeRequest.bind(this.sdkListener),this.onRoleUpdate=this.sdkListener.onRoleUpdate.bind(this.sdkListener),this.onChangeTrackStateRequest=this.sdkListener.onChangeTrackStateRequest.bind(this.sdkListener),this.onChangeMultiTrackStateRequest=this.sdkListener.onChangeMultiTrackStateRequest.bind(this.sdkListener),this.onRemovedFromRoom=this.sdkListener.onRemovedFromRoom.bind(this.sdkListener),this.onNetworkQuality=null==(Ea=this.sdkListener.onNetworkQuality)?void 0:Ea.bind(this.sdkListener),this.onPreview=this.sdkListener.onPreview.bind(this.sdkListener),this.onDeviceChange=null==(Pa=this.sdkListener.onDeviceChange)?void 0:Pa.bind(this.sdkListener),this.onSessionStoreUpdate=this.sdkListener.onSessionStoreUpdate.bind(this.sdkListener),this.onPollsUpdate=this.sdkListener.onPollsUpdate.bind(this.sdkListener),this.onWhiteboardUpdate=this.sdkListener.onWhiteboardUpdate.bind(this.sdkListener),this.handleConnectionQualityUpdate=e=>{let t=e.find(e=>{var t,i;return e.peerID===(null==(i=null==(t=this.sdk)?void 0:t.store.getLocalPeer())?void 0:i.peerId)});this.cqsCalculator.pushScore(null==t?void 0:t.downlinkQuality)},this.statsCollector=new Va(e),this.state=0}get state(){return this._state}set state(e){var t;void 0===e||void 0!==this._state&&e<this._state||(this._state=e,null==(t=this.progressCallback)||t.call(this,e))}onICESuccess(e){e?this.isPublishICEConnected=!0:this.isSubscribeICEConnected=!0,this.isPublishICEConnected&&this.isSubscribeICEConnected&&(this.state=3)}onSelectedICECandidatePairChange(e,t){t?this.selectedPublishICECandidate=e:this.selectedSubscribeICECandidate=e}onICECandidate(e,t){t?this.gatheredPublishICECandidates.push(e):this.gatheredSubscribeICECandidates.push(e)}onMediaPublished(e){switch(e.type){case"audio":this.isAudioTrackPublished=!0;break;case"video":this.isVideoTrackPublished=!0}this.isVideoTrackPublished&&this.isAudioTrackPublished&&(this.state=5)}onInitSuccess(e){this.websocketURL=e,this.initConnected=!0,this.state=1}onSignallingSuccess(){this.wsConnected=!0,this.state=2}onJoin(e){var t,i;this.sdkListener.onJoin(e),null==(t=this.sdk.getWebrtcInternals())||t.onStatsChange(e=>this.statsCollector.handleStatsUpdate(e)),null==(i=this.sdk.getWebrtcInternals())||i.start(),this.cleanupTimer=window.setTimeout(()=>{this.cleanupAndReport()},this.connectivityDuration)}onError(e){this.sdkListener.onError(e),this.errors.push(e),null!=e&&e.isTerminal&&this.cleanupAndReport()}onTrackUpdate(e,t,i){if(this.sdkListener.onTrackUpdate(e,t,i),i.isLocal&&0===e){switch(t.type){case"audio":this.isAudioTrackCaptured=!0;break;case"video":this.isVideoTrackCaptured=!0}this.isVideoTrackCaptured&&this.isAudioTrackCaptured&&(this.state=4)}}onReconnecting(e){this.sdkListener.onReconnecting(e),this.cqsCalculator.addPendingCQSTillNow()}cleanupAndReport(){var e;clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0,5===this.state&&(this.state=6),null==(e=this.completionCallback)||e.call(this,this.buildReport()),this.sdk.leave()}buildReport(){this.cqsCalculator.addPendingCQSTillNow();let e=this.cqsCalculator.getCQS(),t=this.statsCollector.buildReport();return{testTimestamp:this.timestamp,connectivityState:this.state,errors:this.errors,signallingReport:{isConnected:this.wsConnected,isInitConnected:this.initConnected,websocketUrl:this.websocketURL},mediaServerReport:{stats:t,connectionQualityScore:e,isPublishICEConnected:this.isPublishICEConnected,isSubscribeICEConnected:this.isSubscribeICEConnected,publishICECandidatePairSelected:this.selectedPublishICECandidate,subscribeICECandidatePairSelected:this.selectedSubscribeICECandidate,publishIceCandidatesGathered:this.gatheredPublishICECandidates,subscribeIceCandidatesGathered:this.gatheredSubscribeICECandidates}}}},Ha=class{constructor(e){this.recording={server:{running:!1},browser:{running:!1},hls:{running:!1}},this.rtmp={running:!1},this.hls={running:!1,variants:[]},this.transcriptions=[],this.id=e}},qa=(e,t,i)=>Jt(void 0,null,function*(){let n=Error("something went wrong during fetch");for(let r=0;r<4;r++)try{let n=yield fetch(e,t),r=yield n.clone().json();if(i&&i.length&&!n.ok&&i.includes(r.code))throw Oi.APIErrors.ServerErrors(r.code,"GET_TOKEN",r.message,!1);return n}catch(Fe){n=Fe}throw["Failed to fetch","NetworkError"].some(e=>n.message.includes(e))?Oi.APIErrors.EndpointUnreachable("GET_TOKEN",n.message):n}),Ka=class{constructor(e,t){this.sdk=e,this.sdkListener=t,this.recordedAudio="https://100ms.live/test-audio.wav",this.sdk.setIsDiagnostics(!0),this.initSdkWithLocalPeer()}get localPeer(){var e;return null==(e=this.sdk)?void 0:e.store.getLocalPeer()}checkBrowserSupport(){Vi(),Gi()}requestPermission(e){return Jt(this,null,function*(){try{let t=yield navigator.mediaDevices.getUserMedia(e);return t.getTracks().forEach(e=>e.stop()),yield this.sdk.deviceManager.init(!0),{audio:t.getAudioTracks().length>0,video:t.getVideoTracks().length>0}}catch(xe){throw an(xe,this.sdk.localTrackManager.getErrorType(!!e.video,!!e.audio))}})}startCameraCheck(e){return Jt(this,null,function*(){var t,i,n,r;if(this.initSdkWithLocalPeer(),!this.localPeer)throw new Error("Local peer not found");this.sdk.store.setSimulcastEnabled(!1),this.localPeer.role=Ht(Wt({},Fa),{publishParams:Ht(Wt({},Fa.publishParams),{allowed:["video"]})});let s=(new Mn).video((new Ln).deviceId(e||"default").build()).build(),a=yield null==(t=this.sdk)?void 0:t.localTrackManager.getLocalTracks({audio:!1,video:!0},s),o=null==a?void 0:a.find(e=>"video"===e.type);if(!o)throw new Error("No video track found");null==(i=this.sdk)||i.deviceManager.init(!0),this.localPeer.videoTrack=o,null==(r=null==(n=this.sdk)?void 0:n.listener)||r.onPeerUpdate(9,[this.localPeer])})}stopCameraCheck(){var e,t;null==(t=null==(e=this.localPeer)?void 0:e.videoTrack)||t.cleanup(),this.localPeer&&(this.localPeer.videoTrack=void 0)}startMicCheck(e){return Jt(this,arguments,function(e){var t=this;let{inputDevice:i,onError:n,onStop:r,time:s=Ua}=e;return function*(){var e,a,o,l;t.initSdkWithLocalPeer(e=>{t.stopMicCheck(),null==n||n(e)});let c=yield t.getLocalAudioTrack(i);if(null==(e=t.sdk)||e.deviceManager.init(!0),!t.localPeer)throw new Error("Local peer not found");if(!c)throw new Error("No audio track found");t.localPeer.audioTrack=c,null==(a=t.sdk)||a.initPreviewTrackAudioLevelMonitor(),null==(l=null==(o=t.sdk)?void 0:o.listener)||l.onPeerUpdate(9,[t.localPeer]),t.mediaRecorder=new MediaRecorder(c.stream.nativeStream);let u=[];t.mediaRecorder.ondataavailable=function(e){u.push(e.data)},t.mediaRecorder.onstop=()=>{var e,i;let n=new Blob(u,{type:null==(e=t.mediaRecorder)?void 0:e.mimeType});t.recordedAudio=URL.createObjectURL(n),null==(i=t.onStopMicCheck)||i.call(t)},t.mediaRecorder.start();let d=setTimeout(()=>{t.stopMicCheck()},s);t.onStopMicCheck=()=>{clearTimeout(d),null==r||r()}}()})}stopMicCheck(){var e,t,i;null==(e=this.mediaRecorder)||e.stop(),null==(i=null==(t=this.localPeer)?void 0:t.audioTrack)||i.cleanup(),this.localPeer&&(this.localPeer.audioTrack=void 0)}getRecordedAudio(){return this.recordedAudio}startConnectivityCheck(e,t,i,n){return Jt(this,null,function*(){if(!this.sdk)throw new Error("SDK not found");this.connectivityCheck=new Wa(this.sdk,this.sdkListener,e,t,n);let r=yield this.getAuthToken(i);yield this.sdk.leave(),yield this.sdk.join({authToken:r,userName:"diagnostics-test"},this.connectivityCheck),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:e=>{var t;null==(t=this.connectivityCheck)||t.handleConnectionQualityUpdate(e)}})})}stopConnectivityCheck(){return Jt(this,null,function*(){var e;return null==(e=this.connectivityCheck)?void 0:e.cleanupAndReport()})}initSdkWithLocalPeer(e){var t,i,n;this.sdkListener&&(null==(t=this.sdk)||t.initStoreAndManagers(Ht(Wt({},this.sdkListener),{onError:t=>{null==e||e(t),this.sdkListener.onError(t)}})));let r=new Kr({name:"diagnostics-peer",role:Fa,type:"regular"});null==(i=this.sdk)||i.store.addPeer(r);let s=new Ha("diagnostics-room");this.sdk.store.setRoom(s),this.sdkListener.onRoomUpdate("ROOM_PEER_COUNT_UPDATED",s),null==(n=this.sdk)||n.deviceManager.init(!0)}getAuthToken(e){return Jt(this,null,function*(){let t=new URL("https://api.100ms.live/v2/diagnostics/token");e&&t.searchParams.append("region",e);let i=yield qa(t.toString(),{method:"GET"},[429,500,501,502,503,504,505,506,507,508,509,510,511]),n=yield i.json();if(!i.ok)throw Oi.APIErrors.ServerErrors(n.code,"GET_TOKEN",n.message,!1);let{token:r}=n;if(!r)throw Error(n.message);return r})}getLocalAudioTrack(e){return Jt(this,null,function*(){var t;if(!this.localPeer)return;this.localPeer.role=Ht(Wt({},Fa),{publishParams:Ht(Wt({},Fa.publishParams),{allowed:["audio"]})});let i=(new Mn).audio((new An).deviceId(e||"default").build()).build(),n=yield null==(t=this.sdk)?void 0:t.localTrackManager.getLocalTracks({audio:!0,video:!1},i);return null==n?void 0:n.find(e=>"audio"===e.type)})}},Ja=class{constructor(e,t,i){this.isRoomJoinCalled=!1,this.ignoredMessageTypes=[],this.setProgress=e=>{let{type:t,progress:i}=e;this.setState(e=>{e.playlist[t].progress=i,e.playlist[t].currentTime=this.sdk.getPlaylistManager().getCurrentTime(t)},"playlistProgress")},this.syncPlaylistState=e=>{this.setState(e=>{Object.assign(e.playlist,Ma.convertPlaylist(this.sdk.getPlaylistManager()))},e)},this.sendPeerUpdateNotification=(e,t)=>{let i=this.store.getState(ia(t.peerId)),n=ma[e]||"peerUpdate";if(8===e)this.syncRoomState(n),this.updateMidCallPreviewRoomState(e,t);else if([0,1].includes(e))this.syncRoomState(n),i||(i=this.store.getState(ia(t.peerId)));else if([12,13,14].includes(e))this.syncRoomState(n),i||(i=this.store.getState(ia(t.peerId)));else{let e=Ma.convertPeer(t);this.setState(t=>{let n=t.peers[e.id];_a(n,e)&&(La(n.auxiliaryTracks,e.auxiliaryTracks)&&(n.auxiliaryTracks=e.auxiliaryTracks),Object.assign(n,e)),i=e},n)}this.hmsNotifications.sendPeerUpdate(e,i)},this.getSDKHMSPeer=e=>this.sdk.getPeerMap()[e],this.setState=(e,t)=>this.store.namedSetState(e,t),this.store=e,this.sdk=t,this.hmsNotifications=i,this.sessionStore=new Oa(this.sdk,this.setSessionStoreValueLocally.bind(this)),this.actionBatcher=new wa(e)}submitSessionFeedback(e,t){return this.sdk.submitSessionFeedback(e,t)}getLocalTrack(e){return this.sdk.store.getLocalPeerTracks().find(t=>t.trackId===e)}get interactivityCenter(){return this.sdk.getInteractivityCenter()}setPlaylistSettings(e){this.sdk.updatePlaylistSettings(e)}refreshDevices(){return Jt(this,null,function*(){yield this.sdk.refreshDevices()})}unblockAudio(){return Jt(this,null,function*(){yield this.sdk.getAudioOutput().unblockAutoplay()})}setVolume(e,t){return Jt(this,null,function*(){t?yield this.setTrackVolume(e,t):(yield this.sdk.getAudioOutput().setVolume(e),this.syncRoomState("setOutputVolume"))})}setAudioOutputDevice(e){return Jt(this,null,function*(){(yield this.sdk.getAudioOutput().setDevice(e))&&this.setState(t=>{t.settings.audioOutputDeviceId=e},"setAudioOutputDevice")})}setPreferredLayer(e,t){return Jt(this,null,function*(){var i;let n=this.getTrackById(e);if(n)if(n instanceof Lr){if("none"===t)return void Hs.d("layer none will be ignored");if((null==(i=this.store.getState(ra(e)))?void 0:i.preferredLayer)===t)return void Hs.d("preferred layer is already ".concat(t));this.setState(i=>{let n=i.tracks[e];n&&(n.preferredLayer=t)},"setPreferredLayer"),yield n.setPreferredLayer(t)}else Hs.d("track ".concat(e," is not a remote video track"));else this.logPossibleInconsistency("track ".concat(e," not present, unable to set preffer layer"))})}getNativeTrackById(e){var t;return null==(t=this.sdk.store.getTrackById(e))?void 0:t.nativeTrack}getTrackById(e){return this.sdk.store.getTrackById(e)}getAuthTokenByRoomCode(e,t){return this.sdk.getAuthTokenByRoomCode(e,t)}preview(e){return Jt(this,null,function*(){let t=this.store.getState(Is);if("Preview"!==t&&"Connecting"!==t)try{"Connected"!==t&&this.setState(e=>{e.room.roomState="Connecting"},"connecting"),yield this.sdkPreviewWithListeners(e)}catch(E){throw Hs.e("Cannot show preview. Failed to connect to room - ",E),E}else this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting")})}cancelMidCallPreview(){return Jt(this,null,function*(){return this.sdk.cancelMidCallPreview()})}join(e){return Jt(this,null,function*(){if(this.isRoomJoinCalled)this.logPossibleInconsistency("room join is called again");else try{this.isRoomJoinCalled=!0,this.setState(e=>{e.room.roomState="Connecting"},"join"),yield this.sdkJoinWithListeners(e)}catch(xe){throw this.isRoomJoinCalled=!1,Hs.e("Failed to connect to room - ",xe),xe}})}leave(){return Jt(this,null,function*(){let e=!0;this.store.getState(ds)||(e=!1,this.logPossibleInconsistency("room leave is called when no room is connected"));let t=this.store.getState(Is);return this.setState(e=>{e.room.roomState="Disconnecting"},"leaving"),this.sdk.leave(e).then(()=>{this.resetState("leave"),this.beamSpeakerLabelsLogger&&this.beamSpeakerLabelsLogger.stop().catch(Hs.e),Hs.i("left room")}).catch(e=>{Hs.e("error in leaving room - ",e),this.setState(e=>{e.room.roomState=t},"revertLeave")})})}setScreenShareEnabled(e,t){return Jt(this,null,function*(){"boolean"==typeof t&&(t={audioOnly:t});try{e?yield this.startScreenShare(t):yield this.stopScreenShare()}catch(E){throw this.hmsNotifications.sendError(Ma.convertException(E)),E}})}addTrack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"regular";return Jt(this,null,function*(){yield this.sdk.addTrack(e,t),this.syncRoomState("addTrack")})}removeTrack(e){return Jt(this,null,function*(){yield this.sdk.removeTrack(e),this.syncRoomState("removeTrack")})}setLocalAudioEnabled(e){return Jt(this,null,function*(){let t=this.store.getState(gs);t&&(yield this.setEnabledTrack(t,e))})}setLocalVideoEnabled(e){return Jt(this,null,function*(){let t=this.store.getState(ms);t&&(yield this.setEnabledTrack(t,e))})}setEnabledTrack(e,t){return Jt(this,null,function*(){var i;if((null==(i=this.store.getState().tracks[e])?void 0:i.enabled)===t)return void this.logPossibleInconsistency("local track[".concat(e,"] enabled state - ").concat(t));this.setState(i=>{i.tracks[e]?i.tracks[e].displayEnabled=t:this.logPossibleInconsistency("track id not found for setEnabled")},"displayEnabled");try{yield this.setEnabledSDKTrack(e,t),this.syncRoomState("setEnabled")}catch(Fe){throw this.setState(i=>{i.tracks[e].displayEnabled=!t},"rollbackDisplayEnabled"),this.hmsNotifications.sendError(Ma.convertException(Fe)),Fe}let n=t?3:2;this.hmsNotifications.sendTrackUpdate(n,e)})}autoSelectAudioOutput(e){return Jt(this,null,function*(){yield this.sdk.autoSelectAudioOutput(e)})}setAudioSettings(e){return Jt(this,null,function*(){let t=this.store.getState(gs);t&&(yield this.setSDKLocalAudioTrackSettings(t,e),this.syncRoomState("setAudioSettings"))})}setVideoSettings(e){return Jt(this,null,function*(){let t=this.store.getState(ms);t&&(yield this.setSDKLocalVideoTrackSettings(t,e),this.syncRoomState("setVideoSettings"))})}switchCamera(){return Jt(this,null,function*(){let e=this.store.getState(ms);if(e){let t=this.sdk.store.getLocalPeerTracks().find(t=>t.trackId===e);t&&(yield t.switchCamera(),this.syncRoomState("switchCamera"))}})}sendMessage(e){this.sendBroadcastMessage(e)}sendBroadcastMessage(e,t){return Jt(this,null,function*(){let{message_id:i,timestamp:n}=yield this.sdk.sendBroadcastMessage(e,t);this.updateMessageInStore({message:e,type:t,id:i,time:n})})}sendGroupMessage(e,t,i){return Jt(this,null,function*(){let n=this.store.getState(As),r=t.map(e=>n[e]),{message_id:s,timestamp:a}=yield this.sdk.sendGroupMessage(e,r,i);this.updateMessageInStore({message:e,recipientRoles:t,type:i,id:s,time:a})})}sendDirectMessage(e,t,i){return Jt(this,null,function*(){let{message_id:n,timestamp:r}=yield this.sdk.sendDirectMessage(e,t,i);this.updateMessageInStore({message:e,recipientPeer:t,type:i,id:n,time:r})})}updateMessageInStore(e){var t;if(!e.message)throw Hs.w("sendMessage","Failed to send message",e),Error("sendMessage Failed - ".concat(JSON.stringify(e)));if(e.type&&this.ignoredMessageTypes.includes(e.type))return;let i=this.sdk.getLocalPeer(),n={read:!0,id:e.id,time:new Date(e.time),message:e.message,type:e.type||"chat",recipientPeer:e.recipientPeer,recipientRoles:e.recipientRoles,senderName:null==i?void 0:i.name,sender:null==i?void 0:i.peerId,senderRole:null==(t=null==i?void 0:i.role)?void 0:t.name,ignored:!1};this.setState(e=>{e.messages.byID[n.id]=n,e.messages.allIDs.push(n.id)},"newMessage")}setMessageRead(e,t){this.setState(i=>{t?i.messages.byID[t]?i.messages.byID[t].read=e:this.logPossibleInconsistency("no message with id is found"):i.messages.allIDs.forEach(t=>{i.messages.byID[t].read=e})},"setMessageRead")}attachVideo(e,t){return Jt(this,null,function*(){if(this.localAndVideoUnmuting(e))return new Promise(i=>{let n=this.store.subscribe(r=>Jt(this,null,function*(){r&&(yield this.attachVideoInternal(e,t),n(),i())}),Ss)});yield this.attachVideoInternal(e,t)})}detachVideo(e,t){return Jt(this,null,function*(){let i=this.getTrackById(e);"video"===(null==i?void 0:i.type)?yield this.sdk.detachVideo(i,t):(t&&(t.srcObject=null),Hs.d("possible inconsistency detected - no video track found to remove sink"))})}addPluginToVideoTrack(e,t){return Jt(this,null,function*(){return this.addRemoveVideoPlugin(e,"add",t)})}addPluginsToVideoStream(e){return Jt(this,null,function*(){return this.addRemoveMediaStreamVideoPlugins(e,"add")})}removePluginsFromVideoStream(e){return Jt(this,null,function*(){return this.addRemoveMediaStreamVideoPlugins(e,"remove")})}addPluginToAudioTrack(e){return Jt(this,null,function*(){return this.addRemoveAudioPlugin(e,"add")})}validateVideoPluginSupport(e){let t={isSupported:!1};if(!e)return Hs.w("no plugin passed in for checking support"),t.errMsg="no plugin passed in for checking support",t;let i=this.store.getState(ms);if(!i)return Hs.w("video Track not added to local peer yet"),t.errMsg="call this function only after local peer has video track",t;let n=this.getTrackById(i);return n?t=n.validatePlugin(e):(Hs.w("track ".concat(i," not present, unable to validate plugin")),t.errMsg="track ".concat(i," not present, unable to validate plugin")),t}validateAudioPluginSupport(e){let t={isSupported:!1};if(!e)return Hs.w('no plugin passed in for checking support"'),t.errMsg='no plugin passed in for checking support"',t;let i=this.store.getState(gs);if(!i)return Hs.w("audio track not added to local peer yet"),t.errMsg="call this function only after local peer has audio track",t;let n=this.getTrackById(i);return n?t=n.validatePlugin(e):(Hs.w("track ".concat(i," not present, unable to validate plugin")),t.errMsg="track ".concat(i," not present, unable to validate plugin")),t}removePluginFromVideoTrack(e){return Jt(this,null,function*(){return this.addRemoveVideoPlugin(e,"remove")})}removePluginFromAudioTrack(e){return Jt(this,null,function*(){return this.addRemoveAudioPlugin(e,"remove")})}changeRole(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Jt(this,null,function*(){yield this.sdk.changeRoleOfPeer(e,t,i)})}changeRoleOfPeer(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Jt(this,null,function*(){yield this.sdk.changeRoleOfPeer(e,t,i)})}changeRoleOfPeersWithRoles(e,t){return Jt(this,null,function*(){let i=this.sdk.getRoles().filter(t=>e.includes(t.name));yield this.sdk.changeRoleOfPeersWithRoles(i,t)})}acceptChangeRole(e){return Jt(this,null,function*(){let t=e.requestedBy?this.getSDKHMSPeer(e.requestedBy.id):void 0;t||Hs.w("peer for which role change is requested no longer available - ".concat(e.requestedBy));let i={requestedBy:t,role:e.role,token:e.token};yield this.sdk.acceptChangeRole(i),this.removeRoleChangeRequest(e)})}raiseLocalPeerHand(){return Jt(this,null,function*(){yield this.sdk.raiseLocalPeerHand()})}lowerLocalPeerHand(){return Jt(this,null,function*(){yield this.sdk.lowerLocalPeerHand()})}raiseRemotePeerHand(e){return Jt(this,null,function*(){yield this.sdk.raiseRemotePeerHand(e)})}lowerRemotePeerHand(e){return Jt(this,null,function*(){yield this.sdk.lowerRemotePeerHand(e)})}getPeer(e){return Jt(this,null,function*(){let t=yield this.sdk.getPeer(e);if(t)return Ma.convertPeer(t)})}findPeerByName(e){return Jt(this,null,function*(){let{offset:t,peers:i,eof:n}=yield this.sdk.findPeerByName(e);return{offset:t,eof:n,peers:i.map(e=>Ma.convertPeer(e))}})}getPeerListIterator(e){let t=this.sdk.getPeerListIterator(e);return{hasNext:()=>t.hasNext(),next:()=>Jt(this,null,function*(){return(yield t.next()).map(e=>Ma.convertPeer(e))}),findPeers:()=>Jt(this,null,function*(){return(yield t.findPeers()).map(e=>Ma.convertPeer(e))}),getTotal:()=>t.getTotal()}}initAppData(e){this.setState(t=>{t.appData=e},"initAppData")}setAppData(e,t,i){let n="Object"===(null==t?void 0:t.constructor.name);this.setState(r=>{if(r.appData)i&&n?Object.assign(r.appData[e],t):r.appData[e]=t;else{let i={[e]:t};r.appData=i}},"setAppData-".concat(e))}rejectChangeRole(e){this.removeRoleChangeRequest(e)}endRoom(e,t){return Jt(this,null,function*(){let i=this.store.getState(Ds);if(null==i||!i.endRoom)return void Hs.w("You are not allowed to perform this action - endRoom");let n=this.store.getState(Is);this.setState(e=>{e.room.roomState="Disconnecting"},"endingRoom");try{yield this.sdk.endRoom(e,t),this.resetState("endRoom")}catch(r){Hs.e("error in ending room - ",r),this.setState(e=>{e.room.roomState=n},"revertEndRoom")}})}removePeer(e,t){return Jt(this,null,function*(){var i;let n=null==(i=this.sdk.getLocalPeer())?void 0:i.peerId;e!==n&&(yield this.sdk.removePeer(e,t))})}startRTMPOrRecording(e){return Jt(this,null,function*(){yield this.sdk.startRTMPOrRecording(e)})}stopRTMPAndRecording(){return Jt(this,null,function*(){yield this.sdk.stopRTMPAndRecording()})}startHLSStreaming(e){return Jt(this,null,function*(){yield this.sdk.startHLSStreaming(e)})}stopHLSStreaming(e){return Jt(this,null,function*(){yield this.sdk.stopHLSStreaming(e)})}startTranscription(e){return Jt(this,null,function*(){yield this.sdk.startTranscription(e)})}stopTranscription(e){return Jt(this,null,function*(){yield this.sdk.stopTranscription(e)})}sendHLSTimedMetadata(e){return Jt(this,null,function*(){yield this.sdk.sendHLSTimedMetadata(e)})}changeName(e){return Jt(this,null,function*(){yield this.sdk.changeName(e)})}changeMetadata(e){return Jt(this,null,function*(){"string"!=typeof e&&(e=JSON.stringify(e)),yield this.sdk.changeMetadata(e)})}setSessionMetadata(e){return Jt(this,null,function*(){yield this.sdk.setSessionMetadata(e),this.setState(t=>{t.sessionMetadata=e},"setSessionMetadata"),this.setSessionStoreValueLocally({key:"default",value:e},"setSessionMetadata")})}populateSessionMetadata(){return Jt(this,null,function*(){let e=yield this.sdk.getSessionMetadata();this.setState(t=>{t.sessionMetadata=e},"populateSessionMetadata"),this.setSessionStoreValueLocally({key:"default",value:e},"populateSessionmetadata")})}setRemoteTrackEnabled(e,t){return Jt(this,null,function*(){if("string"==typeof e){let i=this.getTrackById(e);i&&function(e){return e instanceof jn||e instanceof Lr}(i)?yield this.sdk.changeTrackState(i,t):this.logPossibleInconsistency("No remote track with ID ".concat(e," found for change track state"))}else Array.isArray(e)&&e.forEach(e=>this.setRemoteTrackEnabled(e,t))})}setRemoteTracksEnabled(e){return Jt(this,null,function*(){let t={enabled:e.enabled,type:e.type,source:e.source};if(e.roles){let i=this.store.getState(As);t.roles=e.roles.map(e=>i[e])}yield this.sdk.changeMultiTrackState(t)})}setLogLevel(e){Hs.level=e,this.sdk.setLogLevel(e)}setFrameworkInfo(e){this.sdk.setFrameworkInfo(e)}ignoreMessageTypes(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])this.ignoredMessageTypes=e;else for(let t of e)this.ignoredMessageTypes.includes(t)||this.ignoredMessageTypes.push(t)}enableBeamSpeakerLabelsLogging(){return Jt(this,null,function*(){this.beamSpeakerLabelsLogger||(Hs.i("enabling beam speaker labels logging"),this.beamSpeakerLabelsLogger=new xa(this.store,this),yield this.beamSpeakerLabelsLogger.start())})}initDiagnostics(){let e=new Ka(this.sdk,{onJoin:this.onJoin.bind(this),onPreview:this.onPreview.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this),onSessionStoreUpdate:this.onSessionStoreUpdate.bind(this),onPollsUpdate:this.onPollsUpdate.bind(this),onWhiteboardUpdate:this.onWhiteboardUpdate.bind(this)});return this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)}),e}resetState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"resetState";this.isRoomJoinCalled=!1,Hs.cleanup(),this.setState(e=>{Object.assign(e,{room:{id:"",isConnected:!1,name:"",peers:[],localPeer:"",roomState:"Disconnected",recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[],sessionStore:{},templateAppData:{},polls:{},whiteboards:{},hideLocalPeer:!1})},e)}getDebugInfo(){return this.sdk.getDebugInfo()}sdkJoinWithListeners(e){return Jt(this,null,function*(){yield this.sdk.join(e,{onJoin:this.onJoin.bind(this),onPreview:this.onPreview.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this),onSessionStoreUpdate:this.onSessionStoreUpdate.bind(this),onPollsUpdate:this.onPollsUpdate.bind(this),onWhiteboardUpdate:this.onWhiteboardUpdate.bind(this),onSFUMigration:this.onSFUMigration.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)})})}onSFUMigration(){this.syncRoomState("SFUMigration")}onRemovedFromRoom(e){var t;let i=this.store.getState(ia(null==(t=e.requestedBy)?void 0:t.peerId));this.hmsNotifications.sendLeaveRoom(Ht(Wt({},e),{requestedBy:i||void 0}));let n=e.roomEnded||!i?"roomEnded":"removedFromRoom";Hs.i("resetting state after peer removed ".concat(n),e),this.resetState(n)}onDeviceChange(e){let t=e.devices;if(!t)return;let i=this.store.getState(fs);if(this.setState(e=>{La(e.devices.audioInput,t.audioInput)||(e.devices.audioInput=t.audioInput),La(e.devices.videoInput,t.videoInput)||(e.devices.videoInput=t.videoInput),La(e.devices.audioOutput,t.audioOutput)||(e.devices.audioOutput=t.audioOutput);let n=this.sdk.getLocalPeer();null!=i&&i.id&&n&&Object.assign(e.settings,this.getMediaSettings(n))},"deviceChange"),e.selection&&!e.internal){let t=Ma.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(t)}}sdkPreviewWithListeners(e){return Jt(this,null,function*(){yield this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})})}onNetworkQuality(e){this.setState(t=>{var i;let n=t.room.localPeer||(null==(i=this.sdk.getLocalPeer())?void 0:i.peerId);n&&(t.connectionQualities[n]={peerID:n,downlinkQuality:e})},"ConnectionQuality")}onSessionStoreUpdate(e){this.setSessionStoreValueLocally(e,"sessionStoreUpdate")}onPollsUpdate(e,t){let i=ba[e];this.setState(e=>{let i=t.reduce((e,t)=>{var i;return e[t.id]=Ht(Wt({},t),{questions:null==(i=t.questions)?void 0:i.map(e=>{var t,i;return Ht(Wt({},e),{answer:e.answer?Wt({},e.answer):void 0,options:null==(t=e.options)?void 0:t.map(e=>Wt({},e)),responses:null==(i=e.responses)?void 0:i.map(e=>Wt({},e))})})}),e},{});((e,t)=>{let i=Da(Object.keys(e),Object.keys(t));for(let n of i){let i=e[n],r=t[n];_a(i,r)?(i.questions&&La(i.questions,r.questions)&&(r.questions=i.questions),Object.assign(i,r)):Ra(i,r)&&(e[n]=r)}})(e.polls,i)},i),t.forEach(t=>this.hmsNotifications.sendPollUpdate(e,t.id))}onWhiteboardUpdate(e){this.setState(t=>{t.whiteboards[e.id]=e},"whiteboardUpdate")}startScreenShare(e){return Jt(this,null,function*(){this.store.getState(ws)?this.logPossibleInconsistency("start screenshare is called while it's on"):(yield this.sdk.startScreenShare(()=>this.syncRoomState("screenshareStopped"),e),this.syncRoomState("startScreenShare"))})}stopScreenShare(){return Jt(this,null,function*(){this.store.getState(ws)?(yield this.sdk.stopScreenShare(),this.syncRoomState("stopScreenShare")):this.logPossibleInconsistency("stop screenshare is called while it's not on")})}attachVideoInternal(e,t){return Jt(this,null,function*(){let i=this.getTrackById(e);i||(i=this.getLocalTrack(e)),i&&"video"===i.type?yield this.sdk.attachVideo(i,t):this.logPossibleInconsistency("no video track found to add sink")})}syncRoomState(e){e="".concat(e,"_fullSync"),Hs.time("store-sync-".concat(e));let t,i={},n=[],r={},s={},a={},o=this.sdk.getPeers();for(let h of o){let e=Ma.convertPeer(h);i[e.id]=e,n.push(e.id),a[e.id]={peerID:e.id,downlinkQuality:h.networkQuality||-1};let o=[h.audioTrack,h.videoTrack,...h.auxiliaryTracks];for(let t of o){if(!t)continue;let e=Ma.convertTrack(t);r[e.id]=e}if(h.isLocal){let e=h;t=this.getPreviewFields(e),Object.assign(s,this.getMediaSettings(e))}}let l=this.sdk.getRecordingState(),c=this.sdk.getRTMPState(),u=this.sdk.getHLSState(),d=this.sdk.getTranscriptionState();this.setState(e=>{var o;e.room.peers=n;let h=e.peers,p=e.tracks;((e,t)=>{let i=Da(Object.keys(e),Object.keys(t));for(let n of i){let i=e[n],r=t[n];_a(i,r)?(La(i.auxiliaryTracks,r.auxiliaryTracks)&&(r.auxiliaryTracks=i.auxiliaryTracks),i.groups&&La(i.groups,r.groups)&&(r.groups=i.groups),Object.assign(i,r)):Aa(i,r)?delete e[n]:Ra(i,r)&&(e[n]=r)}})(h,i),((e,t)=>{let i=Da(Object.keys(e),Object.keys(t));for(let n of i){let i=e[n],r=t[n];_a(i,r)?(Ia(i,r),Object.assign(i,r)):Aa(i,r)?delete e[n]:Ra(i,r)&&(e[n]=r)}})(p,r),Object.assign(e.settings,s),e.room.isConnected&&Object.assign(e.connectionQualities,a),null!=(o=e.preview)&&o.localPeer&&null!=t&&t.localPeer?Object.assign(e.preview,t):e.preview=t,Object.assign(e.roles,Ma.convertRoles(this.sdk.getRoles())),Object.assign(e.playlist,Ma.convertPlaylist(this.sdk.getPlaylistManager())),Object.assign(e.room,Ma.convertRecordingStreamingState(l,c,u,d)),Object.assign(e.templateAppData,this.sdk.getTemplateAppData())},e),Hs.timeEnd("store-sync-".concat(e))}onPreview(e){this.setState(t=>{var i;Object.assign(t.room,Ma.convertRoom(e,null==(i=this.sdk.getLocalPeer())?void 0:i.peerId)),t.room.roomState="Preview"},"previewStart"),this.syncRoomState("previewSync")}onJoin(e){let t=this.sdk.getPlaylistManager();this.audioPlaylist=new Na(t,"audio",this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new Na(t,"video",this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState(t=>{var i;Object.assign(t.room,Ma.convertRoom(e,null==(i=this.sdk.getLocalPeer())?void 0:i.peerId)),t.room.isConnected=!0,t.room.roomState="Connected"},"joined"),t.onProgress(this.setProgress),t.onNewTrackStart(e=>{this.syncPlaylistState("".concat(e.type,"PlaylistUpdate"))}),t.onPlaylistEnded(e=>{this.syncPlaylistState("".concat(e,"PlaylistEnded"))}),t.onCurrentTrackEnded(e=>{this.hmsNotifications.sendPlaylistTrackEnded(Ma.convertPlaylistItem(t,e)),this.syncPlaylistState("".concat(e.type,"PlaylistItemEnded"))})}onRoomUpdate(e,t){this.setState(e=>{var i;Object.assign(e.room,Ma.convertRoom(t,null==(i=this.sdk.getLocalPeer())?void 0:i.peerId))},e),"TRANSCRIPTION_STATE_UPDATED"===e&&this.hmsNotifications.sendTranscriptionUpdate(t.transcriptions)}onPeerUpdate(e,t){if(![4,5].includes(e)){if(Array.isArray(t)){let e=this.store.getState(ss),i=t.filter(t=>!e[t.peerId]);if(this.syncRoomState("peersJoined"),this.store.getState(ds)){let e=[];for(let i of t){let t=this.store.getState(ia(i.peerId));t&&e.push(t)}this.hmsNotifications.sendPeerList(e)}else i.forEach(e=>{let t=this.store.getState(ia(e.peerId));t&&this.hmsNotifications.sendPeerUpdate(0,t)});return}this.sendPeerUpdateNotification(e,t)}}onTrackUpdate(e,t,i){if(1===e)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,i);else if([0,1].includes(e)){let i=ya[e];this.syncRoomState(i),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}else{let i=ya[e]||"trackUpdate",n=Ma.convertTrack(t);this.setState(e=>{let t=e.tracks[n.id];_a(t,n)&&(Ia(t,n),Object.assign(t,n))},i),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}onMessageReceived(e){let t=Ma.convertMessage(e,this.store.getState(vs));t.read=!1,t.ignored=this.ignoredMessageTypes.includes(t.type),"hms_transcript"===t.type&&(t.ignored=!0),this.putMessageInStore(t),this.hmsNotifications.sendMessageReceived(t)}putMessageInStore(e){e.ignored||this.actionBatcher.setState(t=>{t.messages.byID[e.id]=e,t.messages.allIDs.push(e.id)},"newMessage",150)}onAudioLevelUpdate(e){this.setState(t=>{let i={};e.forEach(e=>{if(!e.track||!e.peer)return;let n=e.track.trackId;i[n]=e.audioLevel,t.speakers[n]||(t.speakers[n]={audioLevel:e.audioLevel,peerID:e.peer.peerId,trackID:n})});let n=Object.entries(t.speakers);for(let[e,r]of n)r.audioLevel=i[e]||0,0===r.audioLevel&&delete t.speakers[e]},"audioLevel")}onConnectionQualityUpdate(e){this.setState(t=>{e.forEach(e=>{let i=e.peerID;i&&(t.connectionQualities[i]?Object.assign(t.connectionQualities[i],e):t.connectionQualities[i]=e)})},"connectionQuality")}onChangeTrackStateRequest(e){var t;let i=this.store.getState(ia(null==(t=e.requestedBy)?void 0:t.peerId)),n=this.getStoreLocalTrackIDfromSDKTrack(e.track),r=this.store.getState(na(n));if(!r)return this.logPossibleInconsistency("Not found track for which track state change was requested, ".concat(e.track));e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:i||void 0,track:r,enabled:e.enabled})}onChangeMultiTrackStateRequest(e){var t;let i=this.store.getState(ia(null==(t=e.requestedBy)?void 0:t.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");let n=[],r=this.store.getState(ls);for(let s of e.tracks){let e=this.getStoreLocalTrackIDfromSDKTrack(s);e&&r[e]&&n.push(r[e])}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:i||void 0,tracks:n,enabled:e.enabled,type:e.type,source:e.source})}onReconnected(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState(e=>{e.room.roomState=e.room.isConnected?"Connected":"Preview"},"reconnected")}onReconnecting(e){let t=Ma.convertException(e);Hs.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState(e=>{e.room.roomState="Reconnecting",e.errors.push(t)},"reconnecting")}onError(e){let t=Ma.convertException(e);t.isTerminal?(this.leave().then(()=>Hs.e("error from SDK, left room.")),this.setState(e=>{e.room.roomState="Failed",e.errors.push(t)},"errorTerminal")):this.store.getState().errors.length<50&&this.setState(e=>{e.errors.push(t)},"error"),this.syncRoomState("errorSync"),this.hmsNotifications.sendError(t),Hs.e("received error from sdk",t instanceof Ri?"".concat(t):t)}handleTrackRemove(e,t){this.setState(i=>{let n=i.peers[t.peerId],r=i.tracks,s=e.trackId;if(n)if(s===n.audioTrack)delete n.audioTrack;else if(s===n.videoTrack)delete n.videoTrack;else{let e=n.auxiliaryTracks.indexOf(s);e>-1&&n.auxiliaryTracks.splice(e,1)}delete r[s]},"trackRemoved")}setEnabledSDKTrack(e,t){return Jt(this,null,function*(){let i=this.getLocalTrack(e);i?yield i.setEnabled(t):this.logPossibleInconsistency("track ".concat(e," not present, unable to enabled/disable"))})}setSDKLocalVideoTrackSettings(e,t){return Jt(this,null,function*(){let i=this.getLocalTrack(e);i?yield i.setSettings(t):this.logPossibleInconsistency("local track ".concat(e," not present, unable to set settings"))})}setSDKLocalAudioTrackSettings(e,t){return Jt(this,null,function*(){let i=this.getLocalTrack(e);i?yield i.setSettings(t):this.logPossibleInconsistency("local track ".concat(e," not present, unable to set settings"))})}getMediaSettings(e){var t;let i=this.store.getState(cs),n=e.audioTrack,r=e.videoTrack;return{audioInputDeviceId:(null==n?void 0:n.settings.deviceId)||i.audioInputDeviceId,videoInputDeviceId:(null==r?void 0:r.settings.deviceId)||i.videoInputDeviceId,audioOutputDeviceId:null==(t=this.sdk.getAudioOutput().getDevice())?void 0:t.deviceId,audioMode:(null==n?void 0:n.settings.audioMode)||"voice"}}getPreviewFields(e){var t,i;if(!e.isInPreview())return;let n=Ma.convertPeer(e);return{localPeer:n.id,audioTrack:n.audioTrack,videoTrack:n.videoTrack,asRole:(null==(t=e.asRole)?void 0:t.name)||(null==(i=e.role)?void 0:i.name)}}setTrackVolume(e,t){return Jt(this,null,function*(){let i=this.getTrackById(t);i?i instanceof $i?(yield i.setVolume(e),this.setState(i=>{let n=i.tracks[t];n&&"audio"===n.type&&(n.volume=e)},"trackVolume")):Hs.w("track ".concat(t," is not an audio track")):this.logPossibleInconsistency("track ".concat(t," not present, unable to set volume"))})}localAndVideoUnmuting(e){let t=this.store.getState(fs);if((null==t?void 0:t.videoTrack)!==e)return!1;let i=this.store.getState(Ts),n=this.store.getState(Ss);return i&&!n}logPossibleInconsistency(e){Hs.w("possible inconsistency detected - ",e)}addRemoveVideoPlugin(e,t,i){return Jt(this,null,function*(){if(!e)return void Hs.w("Invalid plugin received in store");let n=this.store.getState(ms);if(n){let r=this.getLocalTrack(n);r?("add"===t?yield r.addPlugin(e,i):"remove"===t&&(yield r.removePlugin(e)),this.syncRoomState("".concat(t,"VideoPlugin"))):this.logPossibleInconsistency("track ".concat(n," not present, unable to ").concat(t," plugin"))}})}addRemoveMediaStreamVideoPlugins(e,t){return Jt(this,null,function*(){if(0===e.length)return void Hs.w("Invalid plugin received in store");let i=this.store.getState(ms);if(i){let n=this.getLocalTrack(i);n?("add"===t?yield n.addStreamPlugins(e):"remove"===t&&(yield n.removeStreamPlugins(e)),this.syncRoomState("".concat(t,"MediaStreamPlugin"))):this.logPossibleInconsistency("track ".concat(i," not present, unable to ").concat(t," plugin"))}})}addRemoveAudioPlugin(e,t){return Jt(this,null,function*(){try{if(!e)return void Hs.w("Invalid plugin received in store");let i=this.store.getState(gs);if(i){let n=this.getLocalTrack(i);n?("add"===t?yield n.addPlugin(e):"remove"===t&&(yield n.removePlugin(e)),this.syncRoomState("".concat(t,"AudioPlugin"))):this.logPossibleInconsistency("track ".concat(i," not present, unable to ").concat(t," plugin"))}}catch(E){console.error(E)}})}onRoleChangeRequest(e){this.setState(t=>{0===t.roleChangeRequests.length&&t.roleChangeRequests.push(Ma.convertRoleChangeRequest(e))},"roleChangeRequest")}removeRoleChangeRequest(e){this.setState(t=>{let i=t.roleChangeRequests.findIndex(t=>t.token===e.token);-1!==i&&t.roleChangeRequests.splice(i,1)},"removeRoleChangeRequest")}onRoleUpdate(){this.syncRoomState("roleUpdate")}getStoreLocalTrackIDfromSDKTrack(e){return this.store.getState(bs).find(t=>{var i;return(null==(i=this.getTrackById(t))?void 0:i.trackId)===e.trackId})}updateMidCallPreviewRoomState(e,t){t.isLocal&&8===e&&this.store.getState(_s)&&this.setState(e=>{e.room.roomState="Connected"},"midCallPreviewCompleted")}setSessionStoreValueLocally(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"setSessionStore",i=Array.isArray(e)?e:[e];this.setState(e=>{i.forEach(t=>{e.sessionStore[t.key]=t.value})},t)}hasActiveElements(e){let t=Object.keys(this.store.getState().whiteboards).length>0,i=Object.keys(this.store.getState().polls).length>0,n=Object.keys(this.store.getState().peers).length>0,r=e.getState().remoteTrackStats;return n&&(t||i||Object.values(r).some(e=>e&&"number"==typeof e.bitrate&&e.bitrate>0))}},Qa=e=>Ti?"".concat(e," ").concat(document.title):e,Ya=class{constructor(e,t){this.eventBus=e,this.listener=t,this.TAG="[NetworkTestManager]",this.controller=new AbortController,this.start=e=>Jt(this,null,function*(){var t;if(!e)return;let{url:i,timeout:n,scoreMap:r}=e,s=this.controller.signal,a=Date.now(),o=0,l=gn(n).then(()=>{this.controller.abort()});try{let e=null==(t=(yield fetch("".concat(i,"?").concat(Date.now()),{signal:s})).body)?void 0:t.getReader();if(!e)throw Error("unable to process request");let n=()=>Jt(this,null,function*(){if(e)try{let t=!1;for(;!t;){let{value:i,done:n}=yield e.read();t=n,i&&(o+=i.byteLength,this.sendScore({scoreMap:r,downloadedSize:o,startTime:a}))}}catch(Ze){"AbortError"!==Ze.name&&fi.d(this.TAG,Ze)}});return Promise.race([n(),l]).then(()=>{this.sendScore({scoreMap:r,downloadedSize:o,startTime:a,finished:!0})}).catch(e=>{fi.d(this.TAG,e),this.updateScoreToListener(0),this.eventBus.analytics.publish(Ji.previewNetworkQuality({error:e.message}))})}catch(He){"AbortError"!==He.name?(fi.d(this.TAG,He),this.updateScoreToListener(0),this.eventBus.analytics.publish(Ji.previewNetworkQuality({error:He.message}))):fi.d(this.TAG,He)}}),this.stop=()=>{this.controller.signal.aborted||this.controller.abort()},this.sendScore=e=>{let{scoreMap:t,downloadedSize:i,startTime:n,finished:r=!1}=e,s=i/1024/((Date.now()-n)/1e3)*8,a=-1;for(let o in t){let e=t[o];s>=e.low&&(!e.high||s<=e.high)&&(a=Number(o))}this.updateScoreToListener(a),r&&this.eventBus.analytics.publish(Ji.previewNetworkQuality({score:a,downLink:s.toFixed(2)}))}}updateScoreToListener(e){var t,i;e!==this.score&&(this.score=e,null==(i=null==(t=this.listener)?void 0:t.onNetworkQuality)||i.call(t,e))}},$a=class{constructor(e,t,i,n,r,s){this.store=e,this.transport=t,this.deviceManager=i,this.publish=n,this.removeAuxiliaryTrack=r,this.listener=s,this.handleLocalPeerRoleUpdate=e=>Jt(this,[e],function(e){var t=this;let{oldRole:i,newRole:n}=e;return function*(){var e;let r=t.store.getLocalPeer();r&&(yield t.diffRolesAndPublishTracks({oldRole:i,newRole:n}),null==(e=t.listener)||e.onPeerUpdate(8,r))}()}),this.diffRolesAndPublishTracks=e=>Jt(this,[e],function(e){var t=this;let{oldRole:i,newRole:n}=e;return function*(){var e,r,s,a,o,l;let c=new Set(i.publishParams.allowed),u=new Set(n.publishParams.allowed),d=t.removeTrack(c,u,"video"),h=t.removeTrack(c,u,"audio"),p=t.removeTrack(c,u,"screen"),f=t.hasSimulcastDifference(null==(e=i.publishParams.simulcast)?void 0:e.video,null==(r=n.publishParams.simulcast)?void 0:r.video),v=t.hasSimulcastDifference(null==(s=i.publishParams.simulcast)?void 0:s.screen,null==(a=n.publishParams.simulcast)?void 0:a.screen),g=null==(l=null==(o=t.store.getLocalPeer())?void 0:o.videoTrack)?void 0:l.enabled;yield t.removeAudioTrack(h),yield t.removeVideoTracks(d||f),yield t.removeScreenTracks(p||v);let m=t.getSettings();f&&(m.isVideoMuted=!g),yield t.publish(m),yield t.syncDevices(m,n)}()})}syncDevices(e,t){return Jt(this,null,function*(){(!e.isAudioMuted||!e.isVideoMuted)&&t.publishParams.allowed.length>0&&(yield this.deviceManager.init(!0))})}removeVideoTracks(e){return Jt(this,null,function*(){var t;if(!e)return;let i=this.store.getLocalPeer();null!=i&&i.videoTrack&&(i.videoTrack.isPublished?yield this.transport.unpublish([i.videoTrack]):yield i.videoTrack.cleanup(),null==(t=this.listener)||t.onTrackUpdate(1,i.videoTrack,i),i.videoTrack=void 0),yield this.removeAuxTracks(e=>"screen"!==e.source&&"video"===e.type)})}removeAudioTrack(e){return Jt(this,null,function*(){var t;if(!e)return;let i=this.store.getLocalPeer();null!=i&&i.audioTrack&&(i.audioTrack.isPublished?yield this.transport.unpublish([i.audioTrack]):yield i.audioTrack.cleanup(),null==(t=this.listener)||t.onTrackUpdate(1,i.audioTrack,i),i.audioTrack=void 0),yield this.removeAuxTracks(e=>"screen"!==e.source&&"audio"===e.type)})}removeScreenTracks(e){return Jt(this,null,function*(){e&&(yield this.removeAuxTracks(e=>"screen"===e.source))})}removeAuxTracks(e){return Jt(this,null,function*(){let t=this.store.getLocalPeer();if(null!=t&&t.auxiliaryTracks){let i=[...t.auxiliaryTracks];for(let t of i)e(t)&&(yield this.removeAuxiliaryTrack(t.trackId))}})}removeTrack(e,t,i){return e.has(i)&&!t.has(i)}hasSimulcastDifference(e,t){var i,n,r;return!(!e&&!t)&&((null==(i=null==e?void 0:e.layers)?void 0:i.length)!==(null==(n=null==t?void 0:t.layers)?void 0:n.length)||!(null==(r=null==e?void 0:e.layers)||!r.some(e=>{var i;let n=null==(i=null==t?void 0:t.layers)?void 0:i.find(t=>t.rid===e.rid);return(null==n?void 0:n.maxBitrate)!==e.maxBitrate||(null==n?void 0:n.maxFramerate)!==e.maxFramerate})))}getSettings(){let{isAudioMuted:e,isVideoMuted:t}=this.getMutedStatus(),{audioInputDeviceId:i,audioOutputDeviceId:n}=this.getAudioDeviceSettings();return{isAudioMuted:e,isVideoMuted:t,audioInputDeviceId:i,audioOutputDeviceId:n,videoDeviceId:this.getVideoInputDeviceId()}}getMutedStatus(){var e,t,i;let n=null==(e=this.store.getConfig())?void 0:e.settings;return{isAudioMuted:null==(t=null==n?void 0:n.isAudioMuted)||t,isVideoMuted:null==(i=null==n?void 0:n.isVideoMuted)||i}}getAudioDeviceSettings(){var e,t,i;let n=null==(e=this.store.getConfig())?void 0:e.settings;return{audioInputDeviceId:(null==(t=this.deviceManager.currentSelection.audioInput)?void 0:t.deviceId)||(null==n?void 0:n.audioInputDeviceId)||"default",audioOutputDeviceId:(null==(i=this.deviceManager.currentSelection.audioOutput)?void 0:i.deviceId)||(null==n?void 0:n.audioOutputDeviceId)||"default"}}getVideoInputDeviceId(){var e,t;let i=null==(e=this.store.getConfig())?void 0:e.settings;return(null==(t=this.deviceManager.currentSelection.videoInput)?void 0:t.deviceId)||(null==i?void 0:i.videoDeviceId)||"default"}},Xa=new class{constructor(){this.TAG="[HTTPAnalyticsTransport]",this.failedEvents=new Ui("client-events"),this.isConnected=!0,this.env=null,this.websocketURL=""}setEnv(e){this.env=e,this.flushFailedEvents()}setWebsocketEndpoint(e){this.websocketURL=e}sendEvent(e){if(!this.env)return void this.addEventToStorage(e);let t={event:e.name,payload:e.properties,event_id:String(e.timestamp),peer:e.metadata.peer,timestamp:e.timestamp,device_id:e.device_id,cluster:{websocket_url:this.websocketURL}},i="prod"===this.env?"https://event.100ms.live/v2/client/report":"https://event-nonprod.100ms.live/v2/client/report";fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.metadata.token),user_agent_v2:e.metadata.userAgent},body:JSON.stringify(t)}).then(t=>{if(401!==t.status){if(200!==t.status)throw Error(t.statusText);this.removeFromStorage(e)}else this.removeFromStorage(e)}).catch(t=>{fi.v(this.TAG,"Failed to send event",t,e),this.addEventToStorage(e)})}flushFailedEvents(){let e=this.failedEvents.get();null==e||e.forEach(e=>this.sendEvent(e))}addEventToStorage(e){let t=this.failedEvents.get()||[];t.find(t=>t.timestamp===e.timestamp)||(100===t.length&&t.shift(),t.push(e),this.failedEvents.set(t))}removeFromStorage(e){let t=this.failedEvents.get()||[],i=t.findIndex(t=>t.timestamp===e.timestamp);i>-1&&(t.splice(i,1),this.failedEvents.set(t))}},Za=class{constructor(e){this.type=e.type,this.source=e.source||"regular",this.description="",e instanceof Yi?(this.mute=!e.enabled,this.track_id=e.publishedTrackId,this.stream_id=e.stream.id):(this.mute=e.mute,this.track_id=e.track_id,this.stream_id=e.stream_id)}},eo=class{constructor(){var e=this;this.TAG="[Store]:",this.knownRoles={},this.peers={},this.tracks=new Map,this.peerTrackStates={},this.speakers=[],this.roleDetailsArrived=!1,this.env="prod",this.simulcastEnabled=!1,this.userAgent=Wi(this.env),this.polls=new Map,this.whiteboards=new Map,this.addPermissionToRole=(e,t,i,n)=>{var r;if(!this.knownRoles[e])return void fi.d(this.TAG,"role ".concat(e," is not present in given roles"),this.knownRoles);let s=this.knownRoles[e].permissions;"transcriptions"===t&&n?s[t]=Ht(Wt({},s[t]),{[n]:[i]}):"whiteboard"===t&&(s[t]||(s[t]=[]),null==(r=s[t])||r.push(i))},this.addWhiteboardPluginToRole=e=>{var t,i,n;let r=null==e?void 0:e.permissions;null==(t=null==r?void 0:r.admin)||t.forEach(e=>this.addPermissionToRole(e,"whiteboard","admin")),null==(i=null==r?void 0:r.reader)||i.forEach(e=>this.addPermissionToRole(e,"whiteboard","read")),null==(n=null==r?void 0:r.writer)||n.forEach(e=>this.addPermissionToRole(e,"whiteboard","write"))},this.addTranscriptionsPluginToRole=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];var i,n;for(let r of t)null==(n=null==(i=r.permissions)?void 0:i.admin)||n.forEach(t=>e.addPermissionToRole(t,"transcriptions","admin",r.mode))},this.handleNoiseCancellationPlugin=e=>{this.room&&(this.room.isNoiseCancellationEnabled=!(null==e||!e.enabled)&&!!this.room.isNoiseCancellationEnabled)}}getConfig(){return this.config}setSimulcastEnabled(e){this.simulcastEnabled=e}removeRemoteTracks(){this.tracks.forEach(e=>{(e instanceof jn||e instanceof Lr)&&(this.removeTrack(e),delete this.peerTrackStates[e.trackId])})}getEnv(){return this.env}getPublishParams(){let e=this.getLocalPeer(),t=(null==e?void 0:e.asRole)||(null==e?void 0:e.role);return null==t?void 0:t.publishParams}getRoom(){return this.room}getPolicyForRole(e){return this.knownRoles[e]}getKnownRoles(){return this.knownRoles}getTemplateAppData(){return this.templateAppData}getLocalPeer(){if(this.localPeerId&&this.peers[this.localPeerId])return this.peers[this.localPeerId]}getRemotePeers(){return Object.values(this.peers).filter(e=>!e.isLocal)}getPeers(){return Object.values(this.peers)}getPeerMap(){return this.peers}getPeerById(e){if(this.peers[e])return this.peers[e]}getTracksMap(){return this.tracks}getTracks(){return Array.from(this.tracks.values())}getVideoTracks(){return this.getTracks().filter(e=>"video"===e.type)}getRemoteVideoTracks(){return this.getTracks().filter(e=>e instanceof Lr)}getAudioTracks(){return this.getTracks().filter(e=>"audio"===e.type)}getPeerTracks(e){let t=e?this.peers[e]:void 0,i=[];return null!=t&&t.videoTrack&&i.push(t.videoTrack),null!=t&&t.audioTrack&&i.push(t.audioTrack),i.concat((null==t?void 0:t.auxiliaryTracks)||[])}getLocalPeerTracks(){return this.getPeerTracks(this.localPeerId)}hasTrack(e){return this.tracks.has(e)}getTrackById(e){var t,i;let n=Array.from(this.tracks.values()).find(t=>t.trackId===e);if(n)return n;let r=this.getLocalPeer();if(r){if(null!=(t=r.audioTrack)&&t.isPublishedTrackId(e))return r.audioTrack;if(null!=(i=r.videoTrack)&&i.isPublishedTrackId(e))return r.videoTrack}}getPeerByTrackId(e){let t=Array.from(this.tracks.values()).find(t=>t.trackId===e);return null!=t&&t.peerId?this.peers[t.peerId]:void 0}getSpeakers(){return this.speakers}getSpeakerPeers(){return this.speakers.map(e=>e.peer)}getUserAgent(){return this.userAgent}createAndSetUserAgent(e){this.userAgent=Wi(this.env,e)}setRoom(e){this.room=e}setKnownRoles(e){var t,i;if(this.knownRoles=e.known_roles,this.addPluginsToRoles(e.plugins),this.roleDetailsArrived=!0,this.templateAppData=e.app_data,!this.simulcastEnabled)return;let n=null==(t=this.knownRoles[e.name])?void 0:t.publishParams;this.videoLayers=this.convertSimulcastLayers(null==(i=n.simulcast)?void 0:i.video),this.updatePeersPolicy()}hasRoleDetailsArrived(){return this.roleDetailsArrived}setConfig(e){var t,i,n;if(Xi.rememberDevices(!!e.rememberDeviceSelection),e.rememberDeviceSelection){let r=Xi.getSelection();r&&(e.settings||(e.settings={}),null!=(t=r.audioInput)&&t.deviceId&&(e.settings.audioInputDeviceId=e.settings.audioInputDeviceId||r.audioInput.deviceId),null!=(i=r.audioOutput)&&i.deviceId&&(e.settings.audioOutputDeviceId=e.settings.audioOutputDeviceId||r.audioOutput.deviceId),null!=(n=r.videoInput)&&n.deviceId&&(e.settings.videoDeviceId=e.settings.videoDeviceId||r.videoInput.deviceId))}e.autoManageVideo=!1!==e.autoManageVideo,e.autoManageWakeLock=!1!==e.autoManageWakeLock,this.config=e,this.setEnv()}addPeer(e){this.peers[e.peerId]=e,e.isLocal&&(this.localPeerId=e.peerId)}addTrack(e){this.tracks.set(e,e)}getTrackState(e){return this.peerTrackStates[e]}setTrackState(e){this.peerTrackStates[e.trackInfo.track_id]=e}removeTrackState(e){delete this.peerTrackStates[e]}removePeer(e){this.localPeerId===e&&(this.localPeerId=void 0),delete this.peers[e]}removeTrack(e){this.tracks.delete(e)}updateSpeakers(e){this.speakers=e}updateAudioOutputVolume(e){return Jt(this,null,function*(){for(let t of this.getAudioTracks())yield t.setVolume(e)})}updateAudioOutputDevice(e){return Jt(this,null,function*(){let t=[];this.getAudioTracks().forEach(i=>{i instanceof jn&&t.push(i.setOutputDevice(e))}),yield Promise.all(t)})}getSimulcastLayers(e){var t;return this.simulcastEnabled&&["screen","regular"].includes(e)?"screen"===e?[]:(null==(t=this.videoLayers)?void 0:t.layers)||[]:[]}convertSimulcastLayers(e){if(e)return Ht(Wt({},e),{layers:(e.layers||[]).map(e=>Ht(Wt({},e),{maxBitrate:1e3*e.maxBitrate}))})}getSimulcastDefinitionsForPeer(e,t){var i,n,r;if([!e||!e.role,"screen"===t,!this.simulcastEnabled].some(e=>!!e))return[];let s,a,o,l=this.getPolicyForRole(e.role.name).publishParams;return"regular"===t?(s=null==(i=l.simulcast)?void 0:i.video,a=l.video.width,o=l.video.height):"screen"===t&&(s=null==(n=l.simulcast)?void 0:n.screen,a=l.screen.width,o=l.screen.height),(null==(r=null==s?void 0:s.layers)?void 0:r.map(e=>({layer:Cn[e.rid],resolution:{width:Math.floor(a/e.scaleResolutionDownBy),height:Math.floor(o/e.scaleResolutionDownBy)}})))||[]}setPoll(e){this.polls.set(e.id,e)}getPoll(e){return this.polls.get(e)}setWhiteboard(e){this.whiteboards.set(e.id,e)}getWhiteboards(){return this.whiteboards}getWhiteboard(e){return e?this.whiteboards.get(e):this.whiteboards.values().next().value}getErrorListener(){return this.errorListener}cleanup(){let e=this.getTracks();for(let t of e)t.cleanup();this.room=void 0,this.config=void 0,this.localPeerId=void 0,this.roleDetailsArrived=!1}setErrorListener(e){this.errorListener=e}updatePeersPolicy(){this.getPeers().forEach(e=>{var t;e.role?e.role=this.getPolicyForRole(e.role.name):null==(t=this.errorListener)||t.onError(Oi.GenericErrors.InvalidRole("VALIDATION",""))})}addPluginsToRoles(e){e&&Object.keys(e).forEach(t=>{let i=t;switch(i){case"whiteboard":this.addWhiteboardPluginToRole(e[i]);break;case"transcriptions":this.addTranscriptionsPluginToRole(e[i]);break;case"noiseCancellation":this.handleNoiseCancellationPlugin(e[i])}})}setEnv(){var e;let t=(null==(e=this.config)?void 0:e.initEndpoint).split("https://")[1],i="prod";t.startsWith("prod")?i="prod":t.startsWith("qa")?i="qa":t.startsWith("dev")&&(i="dev"),this.env=i,Xa.setEnv(i)}},to=class{constructor(){this.TAG="[WakeLockManager]",this.wakeLock=null,this.acquireLock=()=>Jt(this,null,function*(){yield this.requestWakeLock(),null==document||document.addEventListener("visibilitychange",this.visibilityHandler)}),this.cleanup=()=>Jt(this,null,function*(){if(this.wakeLock&&!this.wakeLock.released)try{yield this.wakeLock.release(),fi.d(this.TAG,"Wake lock released")}catch(e){let t=e;fi.w(this.TAG,"Error while releasing wake lock","name=".concat(t.name,", message=").concat(t.message))}null==document||document.removeEventListener("visibilitychange",this.visibilityHandler),this.wakeLock=null}),this.visibilityHandler=()=>Jt(this,null,function*(){"visible"===(null==document?void 0:document.visibilityState)&&(!this.wakeLock||this.wakeLock.released)&&(fi.d(this.TAG,"Re-acquiring wake lock due to visibility change"),yield this.requestWakeLock())}),this.requestWakeLock=()=>Jt(this,null,function*(){try{if(!("wakeLock"in navigator))return void fi.d(this.TAG,"Wake lock feature not supported");this.wakeLock=yield navigator.wakeLock.request("screen"),fi.d(this.TAG,"Wake lock acquired")}catch(e){let t=e;fi.w(this.TAG,"Error acquiring wake lock","name=".concat(t.name,", message=").concat(t.message))}})}},io=class{constructor(e){this.store=e,this.bufferSize=100,this.TAG="[AnalyticsEventsService]",this.transport=null,this.pendingEvents=[],this.level=1}setTransport(e){this.transport=e}reset(){this.transport=null,this.pendingEvents=[]}queue(e){if(e.level>=this.level&&(this.pendingEvents.push(e),this.pendingEvents.length>this.bufferSize)){let e=this.pendingEvents.shift();fi.d(this.TAG,"Max buffer size reached","Removed event to accommodate new events",e)}return this}flushFailedClientEvents(){Xa.flushFailedEvents()}flush(){var e;try{for(;this.pendingEvents.length>0;){let t=this.pendingEvents.shift();t&&(t.metadata.peer.peer_id=null==(e=this.store.getLocalPeer())?void 0:e.peerId,t.metadata.userAgent=this.store.getUserAgent(),this.transport&&this.transport.transportProvider.isConnected?this.transport.sendEvent(t):this.sendClientEventOnHTTP(t))}}catch(xe){fi.w(this.TAG,"Flush Failed",xe)}}sendClientEventOnHTTP(e){var t,i,n,r;let s=this.store.getRoom(),a=this.store.getLocalPeer();e.metadata.token=null==(t=this.store.getConfig())?void 0:t.authToken,e.metadata.peer={session_id:null==s?void 0:s.sessionId,room_id:null==s?void 0:s.id,room_name:null==s?void 0:s.name,template_id:null==s?void 0:s.templateId,joined_at:null==(i=null==s?void 0:s.joinedAt)?void 0:i.getTime(),session_started_at:null==(n=null==s?void 0:s.startedAt)?void 0:n.getTime(),role:null==(r=null==a?void 0:a.role)?void 0:r.name,user_name:null==a?void 0:a.name,user_data:null==a?void 0:a.metadata,peer_id:null==a?void 0:a.peerId},Xa.sendEvent(e)}},no={autoplayFailed:void 0,initialized:!1,autoplayCheckPromise:void 0},ro=class{constructor(e,t,i){this.store=e,this.deviceManager=t,this.eventBus=i,this.autoPausedTracks=new Set,this.TAG="[AudioSinkManager]:",this.volume=100,this.state=Wt({},no),this.handleAudioPaused=e=>Jt(this,null,function*(){fi.d(this.TAG,"Audio Paused",e.target.id);let t=this.store.getTrackById(e.target.id);t&&this.autoPausedTracks.add(t)}),this.handleTrackUpdate=e=>{let{track:t}=e;fi.d(this.TAG,"Track updated","".concat(t))},this.handleTrackAdd=e=>Jt(this,[e],function(e){var t=this;let{track:i,peer:n,callListener:r=!0}=e;return function*(){var e,s;let a=document.createElement("audio");a.style.display="none",a.id=i.trackId,a.addEventListener("pause",t.handleAudioPaused),a.onerror=()=>Jt(t,null,function*(){var e,t;fi.e(this.TAG,"error on audio element",a.error);let r=Oi.TracksErrors.AudioPlaybackError("Audio playback error for track - ".concat(i.trackId," code - ").concat(null==(e=null==a?void 0:a.error)?void 0:e.code));this.eventBus.analytics.publish(Ji.audioPlaybackError(r)),(null==(t=null==a?void 0:a.error)?void 0:t.code)===MediaError.MEDIA_ERR_DECODE&&(this.removeAudioElement(a,i),yield gn(500),yield this.handleTrackAdd({track:i,peer:n,callListener:!1}),this.state.autoplayFailed||this.eventBus.analytics.publish(Ji.audioRecovered("Audio recovered after media decode error")))}),i.setAudioElement(a),yield i.setVolume(t.volume),fi.d(t.TAG,"Audio track added","".concat(i)),t.init(),null==(e=t.audioSink)||e.append(a),t.outputDevice&&(yield i.setOutputDevice(t.outputDevice)),a.srcObject=new MediaStream([i.nativeTrack]),r&&(null==(s=t.listener)||s.onTrackUpdate(0,i,n)),yield t.handleAutoplayError(i)}()}),this.handleAutoplayError=e=>Jt(this,null,function*(){void 0===this.state.autoplayFailed&&(this.state.autoplayCheckPromise||(this.state.autoplayCheckPromise=new Promise(t=>{this.playAudioFor(e).then(t)})),yield this.state.autoplayCheckPromise),this.state.autoplayFailed?this.autoPausedTracks.add(e):yield this.playAudioFor(e)}),this.handleAudioDeviceChange=e=>Jt(this,null,function*(){e.isUserSelection||e.error||!e.selection||"video"===e.type||(yield this.unpauseAudioTracks())}),this.handleTrackRemove=e=>{this.autoPausedTracks.delete(e);let t=document.getElementById(e.trackId);t&&this.removeAudioElement(t,e),this.audioSink&&0===this.audioSink.childElementCount&&(this.state.autoplayCheckPromise=void 0,this.state.autoplayFailed=void 0),fi.d(this.TAG,"Audio track removed","".concat(e))},this.unpauseAudioTracks=()=>Jt(this,null,function*(){let e=[];this.autoPausedTracks.forEach(t=>{e.push(this.playAudioFor(t))}),yield Promise.all(e)}),this.removeAudioElement=(e,t)=>{e&&(fi.d(this.TAG,"removing audio element","".concat(t)),e.removeEventListener("pause",this.handleAudioPaused),e.srcObject=null,e.remove(),t.setAudioElement(null))},this.eventBus.audioTrackAdded.subscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.subscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.subscribe(this.handleTrackUpdate),this.eventBus.deviceChange.subscribe(this.handleAudioDeviceChange),this.eventBus.localVideoUnmutedNatively.subscribe(this.unpauseAudioTracks),this.eventBus.localAudioUnmutedNatively.subscribe(this.unpauseAudioTracks)}setListener(e){this.listener=e}get outputDevice(){return this.deviceManager.outputDevice}getVolume(){return this.volume}setVolume(e){return Jt(this,null,function*(){yield this.store.updateAudioOutputVolume(e),this.volume=e})}unblockAutoplay(){return Jt(this,null,function*(){this.autoPausedTracks.size>0&&(yield this.unpauseAudioTracks()),yield dn.resumeContext()})}init(e){if(this.state.initialized||this.audioSink)return;this.state.initialized=!0;let t=document.createElement("div");t.id="HMS-SDK-audio-sink-".concat(C()),(e&&document.getElementById(e)||document.body).append(t),this.audioSink=t,fi.d(this.TAG,"audio sink created",this.audioSink)}cleanup(){var e;null==(e=this.audioSink)||e.remove(),this.audioSink=void 0,this.eventBus.audioTrackAdded.unsubscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.unsubscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.unsubscribe(this.handleTrackUpdate),this.eventBus.deviceChange.unsubscribe(this.handleAudioDeviceChange),this.eventBus.localVideoUnmutedNatively.unsubscribe(this.unpauseAudioTracks),this.eventBus.localAudioUnmutedNatively.unsubscribe(this.unpauseAudioTracks),this.autoPausedTracks=new Set,this.state=Wt({},no)}playAudioFor(e){return Jt(this,null,function*(){let t=e.getAudioElement();if(t)try{yield t.play(),this.state.autoplayFailed=!1,this.autoPausedTracks.delete(e),fi.d(this.TAG,"Played track","".concat(e))}catch(E){this.autoPausedTracks.add(e),fi.w(this.TAG,"Failed to play track","".concat(e),E);let i=E;if(!this.state.autoplayFailed&&"NotAllowedError"===i.name){this.state.autoplayFailed=!0;let e=Oi.TracksErrors.AutoplayBlocked("AUTOPLAY","");e.addNativeError(i),this.eventBus.analytics.publish(Ji.autoplayError()),this.eventBus.autoplayError.publish(e)}}else fi.w(this.TAG,"No audio element found on track",e.trackId)})}},so=class{constructor(e){this.eventBus=e,this.pluginUsage=new Map,this.pluginLastAddedAt=new Map,this.getPluginUsage=e=>{if(this.pluginUsage.has(e)||this.pluginUsage.set(e,0),this.pluginLastAddedAt.has(e)){let t=this.pluginLastAddedAt.get(e)||0,i=t?Date.now()-t:0;this.pluginUsage.set(e,(this.pluginUsage.get(e)||0)+i),this.pluginLastAddedAt.delete(e)}return this.pluginUsage.get(e)},this.updatePluginUsageData=e=>{var t;let i=(null==(t=e.properties)?void 0:t.plugin_name)||"";switch(e.name){case"mediaPlugin.toggled.on":case"mediaPlugin.added":{let t=e.properties.added_at||Date.now();this.pluginLastAddedAt.set(i,t);break}case"mediaPlugin.toggled.off":case"mediaPlugin.stats":if(this.pluginLastAddedAt.has(i)){let t=e.properties.duration||(Date.now()-(this.pluginLastAddedAt.get(i)||0))/1e3;this.pluginUsage.set(i,(this.pluginUsage.get(i)||0)+1e3*Math.max(t,0)),this.pluginLastAddedAt.delete(i)}}},this.cleanup=()=>{this.pluginLastAddedAt.clear(),this.pluginUsage.clear()},this.eventBus.analytics.subscribe(e=>this.updatePluginUsageData(e))}},ao=class{constructor(e,t){this.store=e,this.eventBus=t,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.hasWebcamPermission=!1,this.hasMicrophonePermission=!1,this.currentSelection={audioInput:void 0,videoInput:void 0,audioOutput:void 0},this.TAG="[Device Manager]:",this.initialized=!1,this.videoInputChanged=!1,this.audioInputChanged=!1,this.earpieceSelected=!1,this.timer=null,this.updateOutputDevice=(e,t)=>Jt(this,null,function*(){let i=this.audioOutput.find(t=>t.deviceId===e);return i&&(this.outputDevice=i,yield this.store.updateAudioOutputDevice(i),this.eventBus.analytics.publish(Ji.deviceChange({isUserSelection:t,selection:{audioOutput:i},devices:this.getDevices(),type:"audioOutput"})),Xi.updateSelection("audioOutput",{deviceId:i.deviceId,groupId:i.groupId})),i}),this.getCurrentSelection=()=>{var e,t;let i=this.store.getLocalPeer(),n=this.createIdentifier(null==(e=null==i?void 0:i.audioTrack)?void 0:e.getMediaTrackSettings()),r=this.createIdentifier(null==(t=null==i?void 0:i.videoTrack)?void 0:t.getMediaTrackSettings()),s=this.audioInput.find(e=>this.createIdentifier(e)===n),a=this.videoInput.find(e=>this.createIdentifier(e)===r);return{audioInput:s,videoInput:a,audioOutput:this.outputDevice}},this.computeChange=(e,t)=>e.length!==t.length||t.some(t=>!e.includes(this.createIdentifier(t))),this.enumerateDevices=()=>Jt(this,null,function*(){try{let e=yield navigator.mediaDevices.enumerateDevices(),t=this.videoInput.map(this.createIdentifier),i=this.audioInput.map(this.createIdentifier);this.audioInput=[],this.audioOutput=[],this.videoInput=[],e.forEach(e=>{"audioinput"===e.kind&&e.label?(this.hasMicrophonePermission=!0,this.audioInput.push(e)):"audiooutput"===e.kind?this.audioOutput.push(e):"videoinput"===e.kind&&e.label&&(this.hasWebcamPermission=!0,this.videoInput.push(e))}),this.videoInputChanged=this.computeChange(t,this.videoInput),this.audioInputChanged=this.computeChange(i,this.audioInput),Xi.setDevices({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput]}),this.logDevices("Enumerate Devices")}catch(e){fi.e(this.TAG,"Failed enumerating devices",e)}}),this.updateToActualDefaultDevice=()=>Jt(this,null,function*(){var e,t,i,n,r;let s=this.store.getLocalPeer();if(!(null==(t=null==(e=this.store.getConfig())?void 0:e.settings)?void 0:t.videoDeviceId)&&null!=s&&s.videoTrack&&(yield s.videoTrack.setSettings({deviceId:null==(i=this.videoInput[0])?void 0:i.deviceId},!0)),!(null==(r=null==(n=this.store.getConfig())?void 0:n.settings)?void 0:r.audioInputDeviceId)&&null!=s&&s.audioTrack){let e=()=>{var e;let t=this.audioInput.find(e=>!e.label.toLowerCase().includes("iphone"));return(()=>{var e;return"ios"===(null==(e=Si.getOS().name)?void 0:e.toLowerCase())})()&&t?null==t?void 0:t.deviceId:null==(e=this.getNewAudioInputDevice())?void 0:e.deviceId};e()&&(yield s.audioTrack.setSettings({deviceId:e()},!0))}}),this.handleDeviceChange=yn(()=>Jt(this,null,function*(){yield this.enumerateDevices(),this.logDevices("After Device Change");let e=this.store.getLocalPeer();yield this.setOutputDevice(!0),yield this.handleAudioInputDeviceChange(null==e?void 0:e.audioTrack),yield this.handleVideoInputDeviceChange(null==e?void 0:e.videoTrack),this.eventBus.analytics.publish(Ji.deviceChange({selection:this.getCurrentSelection(),type:"change",devices:this.getDevices()}))}),500).bind(this),this.handleAudioInputDeviceChange=e=>Jt(this,null,function*(){if(!e)return void fi.d(this.TAG,"No Audio track on local peer");if(!this.audioInputChanged)return void fi.d(this.TAG,"No Change in AudioInput Device");let t=this.getNewAudioInputDevice();if(!t||!t.deviceId)return this.eventBus.analytics.publish(Ji.deviceChange({selection:{audioInput:t},error:Oi.TracksErrors.SelectedDeviceMissing("audio"),devices:this.getDevices(),type:"audioInput"})),void fi.e(this.TAG,"Audio device not found");let{settings:i}=e,n=(new An).codec(i.codec).maxBitrate(i.maxBitrate).deviceId(t.deviceId).audioMode(i.audioMode).build();try{yield e.setSettings(n,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:t,type:"audioInput"}),this.logDevices("Audio Device Change Success")}catch(r){fi.e(this.TAG,"[Audio Device Change]",r),this.eventBus.analytics.publish(Ji.deviceChange({selection:{audioInput:t},devices:this.getDevices(),type:"audioInput",error:r})),this.eventBus.deviceChange.publish({error:r,selection:t,type:"audioInput",devices:this.getDevices()})}}),this.handleVideoInputDeviceChange=e=>Jt(this,null,function*(){if(!e)return void fi.d(this.TAG,"No video track on local peer");if(!this.videoInputChanged)return void fi.d(this.TAG,"No Change in VideoInput Device");let t=this.videoInput[0];if(!t||!t.deviceId)return this.eventBus.analytics.publish(Ji.deviceChange({selection:{videoInput:t},error:Oi.TracksErrors.SelectedDeviceMissing("video"),devices:this.getDevices(),type:"video"})),void fi.e(this.TAG,"Video device not found");let{settings:i}=e,n=(new Ln).codec(i.codec).maxBitrate(i.maxBitrate).maxFramerate(i.maxFramerate).setWidth(i.width).setHeight(i.height).deviceId(t.deviceId).build();try{yield e.setSettings(n,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:t,type:"video"}),this.logDevices("Video Device Change Success")}catch(r){fi.e(this.TAG,"[Video Device Change]",r),this.eventBus.analytics.publish(Ji.deviceChange({selection:{videoInput:t},devices:this.getDevices(),type:"video",error:r})),this.eventBus.deviceChange.publish({error:r,type:"video",selection:t,devices:this.getDevices()})}}),this.startPollingForDevices=()=>Jt(this,null,function*(){let{earpiece:e}=this.categorizeAudioInputDevices();e&&(this.timer=setTimeout(()=>{Jt(this,null,function*(){yield this.enumerateDevices(),yield this.autoSelectAudioOutput(),this.startPollingForDevices()})},5e3))}),this.autoSelectAudioOutput=e=>Jt(this,null,function*(){var t,i;let{bluetoothDevice:n,earpiece:r,speakerPhone:s,wired:a}=this.categorizeAudioInputDevices(),o=null==(t=this.store.getLocalPeer())?void 0:t.audioTrack;if(!o||!r)return;let l=this.getManuallySelectedAudioDevice(),c=(null==l?void 0:l.deviceId)||(null==n?void 0:n.deviceId)||(null==a?void 0:a.deviceId)||(null==s?void 0:s.deviceId);if(e||o.settings.deviceId!==c||!this.earpieceSelected)try{(!this.earpieceSelected||e)&&((null==n?void 0:n.deviceId)===c||(fi.d(this.TAG,"selecting earpiece"),yield o.setSettings({deviceId:null==r?void 0:r.deviceId},!0),e&&(yield gn(e))),this.earpieceSelected=!0),yield o.setSettings({deviceId:c},!0);let t=null==(i=this.audioInput.find(e=>e.deviceId===c))?void 0:i.groupId;this.eventBus.deviceChange.publish({isUserSelection:!1,type:"audioInput",selection:{deviceId:c,groupId:t},devices:this.getDevices(),internal:!0})}catch(Je){this.eventBus.error.publish(Je)}});let i=e=>{let{enabled:t,track:i}=e;return t&&"regular"===i.source};this.eventBus.localVideoEnabled.waitFor(i).then(()=>{0===this.videoInput.length&&this.init(!0)}),this.eventBus.localAudioEnabled.waitFor(i).then(()=>{0===this.audioInput.length&&this.init(!0)}),this.eventBus.deviceChange.subscribe(e=>{let{type:t,isUserSelection:i,selection:n}=e;if(i){let e="video"===t?"videoInput":t,r=this[e].find(e=>this.createIdentifier(e)===this.createIdentifier(n));this.eventBus.analytics.publish(Ji.deviceChange({selection:{[e]:r},devices:this.getDevices(),type:t,isUserSelection:i}))}})}init(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Jt(this,null,function*(){this.initialized&&!e||(!this.initialized&&navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),this.initialized=!0,yield this.enumerateDevices(),e||(yield this.updateToActualDefaultDevice(),this.startPollingForDevices()),yield this.autoSelectAudioOutput(),this.logDevices("Init"),yield this.setOutputDevice(),this.eventBus.deviceChange.publish({devices:this.getDevices()}),t&&this.eventBus.analytics.publish(Ji.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()})))})}getDevices(){return{audioInput:this.audioInput,audioOutput:this.audioOutput,videoInput:this.videoInput}}cleanup(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.initialized=!1,this.earpieceSelected=!1,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.outputDevice=void 0,navigator.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange)}createIdentifier(e){return e?"".concat(e.deviceId).concat(e.groupId):""}getNewAudioInputDevice(){var e,t;let i=this.getManuallySelectedAudioDevice();if(i)return i;null==(t=null==(e=this.store.getLocalPeer())?void 0:e.audioTrack)||t.resetManuallySelectedDeviceId();let n=this.audioInput.find(e=>"default"===e.deviceId);return n?this.audioInput.find(e=>"default"!==e.deviceId&&n.label.includes(e.label)):this.audioInput[0]}setOutputDevice(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Jt(this,null,function*(){let t=this.getNewAudioInputDevice(),i=this.createIdentifier(this.outputDevice);this.outputDevice=this.getAudioOutputDeviceMatchingInput(t),this.outputDevice||(this.outputDevice=this.audioOutput.find(e=>this.createIdentifier(e)===i),this.outputDevice||(this.outputDevice=this.audioOutput.find(e=>"default"===e.deviceId)||this.audioOutput[0])),yield this.store.updateAudioOutputDevice(this.outputDevice),e&&i!==this.createIdentifier(this.outputDevice)&&(this.eventBus.analytics.publish(Ji.deviceChange({selection:{audioOutput:this.outputDevice},devices:this.getDevices(),type:"audioOutput"})),this.eventBus.deviceChange.publish({selection:this.outputDevice,type:"audioOutput",devices:this.getDevices()}))})}getManuallySelectedAudioDevice(){let e=this.store.getLocalPeer(),t=null==e?void 0:e.audioTrack;return this.audioInput.find(e=>e.deviceId===(null==t?void 0:t.getManuallySelectedDeviceId()))}categorizeAudioInputDevices(){let e=null,t=null,i=null,n=null;for(let r of this.audioInput){let s=pn(r.label);"SPEAKERPHONE"===s?t=r:"WIRED"===s?i=r:"BLUETOOTH"===s?e=r:"EARPIECE"===s&&(n=r)}return{bluetoothDevice:e,speakerPhone:t,wired:i,earpiece:n}}getAudioOutputDeviceMatchingInput(e){var t,i;let n=(null==(i=null==(t=this.store.getConfig())?void 0:t.settings)?void 0:i.speakerAutoSelectionBlacklist)||[];if("all"===n||!e)return;let r=e.label.toLowerCase()||"";if(n.some(e=>r.includes(e.toLowerCase())))return;let s=this.audioOutput.find(t=>"default"!==e.deviceId&&t.label===e.label);if(s)return s;let a=this.audioOutput.find(t=>t.groupId===e.groupId);return a&&"default"===this.audioOutput[0].deviceId&&a.groupId===this.audioOutput[0].groupId?a:void 0}logDevices(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";fi.d(this.TAG,e,JSON.stringify({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput],selected:this.getCurrentSelection()},null,4))}},oo=class{constructor(e,t){this.deviceManager=e,this.audioSinkManager=t}getVolume(){return this.audioSinkManager.getVolume()}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.audioSinkManager.setVolume(e)}getDevice(){return this.deviceManager.outputDevice}setDevice(e){return this.deviceManager.updateOutputDevice(e,!0)}unblockAutoplay(){return Jt(this,null,function*(){yield this.audioSinkManager.unblockAutoplay(),yield dn.resumeContext()})}},lo=class{static handleError(e){if(404===e.status)throw Oi.APIErrors.EndpointUnreachable("FEEDBACK",e.statusText);if(e.status>=400)throw Oi.APIErrors.ServerErrors(e.status,"FEEDBACK",null==e?void 0:e.statusText)}static sendFeedback(e){return Jt(this,arguments,function(e){var t=this;let{token:i,eventEndpoint:n="https://event.100ms.live",info:r,feedback:s}=e;return function*(){fi.d(t.TAG,"sendFeedback: feedbackEndpoint=".concat(n," peerId=").concat(r.peer.peer_id," session=").concat(r.peer.session_id," "));let e=new URL("v2/client/feedback",n),a=Ht(Wt({},r),{payload:s});try{let n=yield fetch(e,{headers:{Authorization:"Bearer ".concat(i)},body:JSON.stringify(a),method:"POST"});try{return void t.handleError(n)}catch(o){throw fi.e(t.TAG,"error",o.message,n.status),o instanceof Ri?o:Oi.APIErrors.ServerErrors(n.status,"FEEDBACK",o.message)}}catch(Ke){let t=Ke;throw["Failed to fetch","NetworkError","ECONNRESET"].some(e=>t.message.includes(e))?Oi.APIErrors.EndpointUnreachable("FEEDBACK",t.message):t}}()})}};lo.TAG="[FeedbackService]";var co=class{constructor(e,t){this.eventName=e,this.eventEmitter=t,this.publish=e=>{this.eventEmitter.emit(this.eventName,e)},this.subscribe=e=>{this.eventEmitter.on(this.eventName,e)},this.subscribeOnce=e=>{this.eventEmitter.once(this.eventName,e)},this.unsubscribe=e=>{this.eventEmitter.off(this.eventName,e)},this.waitFor=e=>this.eventEmitter.waitFor(this.eventName,{filter:e}),this.removeAllListeners=()=>{this.eventEmitter.removeAllListeners(this.eventName)}}},uo=class{constructor(){this.eventEmitter=new De.EventEmitter2,this.analytics=new co(kr,this.eventEmitter),this.deviceChange=new co(ur,this.eventEmitter),this.localAudioEnabled=new co(dr,this.eventEmitter),this.localVideoEnabled=new co(hr,this.eventEmitter),this.localVideoUnmutedNatively=new co(pr,this.eventEmitter),this.localAudioUnmutedNatively=new co(fr,this.eventEmitter),this.statsUpdate=new co(vr,this.eventEmitter),this.trackDegraded=new co(gr,this.eventEmitter),this.trackRestored=new co(mr,this.eventEmitter),this.trackAudioLevelUpdate=new co(yr,this.eventEmitter),this.audioPluginFailed=new co(Sr,this.eventEmitter),this.localAudioSilence=new co(br,this.eventEmitter),this.policyChange=new co(Tr,this.eventEmitter),this.localRoleUpdate=new co(wr,this.eventEmitter),this.audioTrackUpdate=new co(Er,this.eventEmitter),this.audioTrackAdded=new co(Pr,this.eventEmitter),this.audioTrackRemoved=new co(Cr,this.eventEmitter),this.autoplayError=new co(Ir,this.eventEmitter),this.leave=new co(_r,this.eventEmitter),this.error=new co(Ar,this.eventEmitter)}},ho=class{constructor(e,t,i){this.store=e,this.listener=t,this.audioListener=i}handleActiveSpeakers(e){var t,i,n;let r=e["speaker-list"],s=r.map(e=>({audioLevel:e.level,peer:this.store.getPeerById(e.peer_id),track:this.store.getTrackById(e.track_id)}));null==(t=this.audioListener)||t.onAudioLevelUpdate(s),this.store.updateSpeakers(s);let a=r[0];if(a){let e=this.store.getPeerById(a.peer_id);null==(i=this.listener)||i.onPeerUpdate(4,e)}else null==(n=this.listener)||n.onPeerUpdate(5,null)}},po=class{constructor(e){this.listener=e,this.TAG="[BroadcastManager]"}handleNotification(e,t){"on-broadcast"===e&&this.handleBroadcast(t)}handleBroadcast(e){var t,i;fi.d(this.TAG,"Received Message from sender=".concat(null==(t=null==e?void 0:e.peer)?void 0:t.peer_id,": ").concat(e)),null==(i=this.listener)||i.onMessageReceived(e)}},fo=class{constructor(e,t){this.store=e,this.listener=t}handleQualityUpdate(e){var t;let i=e.peers.map(e=>{let t=this.store.getPeerById(e.peer_id);return t&&t.updateNetworkQuality(e.downlink_score),{peerID:e.peer_id,downlinkQuality:e.downlink_score}});null==(t=this.listener)||t.onConnectionQualityUpdate(i)}},vo=class{constructor(e,t,i){var n=this;this.store=e,this.eventBus=t,this.listener=i,this.TAG="[TrackManager]",this.tracksToProcess=new Map,this.handleTrackAdd=e=>{fi.d(this.TAG,"ONTRACKADD","".concat(e)),this.tracksToProcess.set(e.trackId,e),this.processPendingTracks()},this.handleTrackRemovedPermanently=e=>{fi.d(this.TAG,"ONTRACKREMOVE permanently",e),Object.keys(e.tracks).forEach(e=>{var t;let i=this.store.getTrackState(e);if(!i)return;let n=this.store.getTrackById(e);if(!n)return void fi.d(this.TAG,"Track not found in store");"audio"===n.type&&this.eventBus.audioTrackRemoved.publish(n),this.store.removeTrack(n);let r=this.store.getPeerById(i.peerId);r&&(this.removePeerTracks(r,n),null==(t=this.listener)||t.onTrackUpdate(1,n,r))})},this.handleTrackLayerUpdate=e=>{for(let t in e.tracks){let i=e.tracks[t],n=this.store.getTrackById(t);!n||!this.store.getPeerByTrackId(t)||n instanceof Lr&&this.setLayer(n,i)}},this.handleTrackUpdate=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i,r;let s=n.store.getPeerById(e.peer.peer_id),a=e.peer;if(s||a){s||(s=Qr(a,n.store),n.store.addPeer(s));for(let a in e.tracks){let o=Object.assign({},null==(i=n.store.getTrackState(a))?void 0:i.trackInfo),l=e.tracks[a],c=n.store.getTrackById(a);if(n.store.setTrackState({peerId:e.peer.peer_id,trackInfo:Wt(Wt({},o),l)}),!c||n.tracksToProcess.has(a))n.processTrackInfo(l,e.peer.peer_id,t),n.processPendingTracks();else{c.setEnabled(!l.mute);let e=n.processTrackUpdate(c,o,l);e&&(null==(r=n.listener)||r.onTrackUpdate(e,c,s))}}}else fi.d(n.TAG,"Track Update ignored - Peer not added to store")},this.processTrackInfo=(e,t,i)=>{},this.processPendingTracks=()=>{new Map(this.tracksToProcess).forEach(e=>{var t;let i=this.store.getTrackState(e.trackId);if(!i)return void fi.d(this.TAG,"TrackState not added to store","peerId - ".concat(e.peerId),"trackId -".concat(e.trackId));let n=this.store.getPeerById(i.peerId);n?(e.source=i.trackInfo.source,e.peerId=n.peerId,e.logIdentifier=n.name,e.setEnabled(!i.trackInfo.mute),this.addAudioTrack(n,e),this.addVideoTrack(n,e),"audio"===e.type?this.eventBus.audioTrackAdded.publish({track:e,peer:n}):null==(t=this.listener)||t.onTrackUpdate(0,e,n),this.tracksToProcess.delete(e.trackId)):fi.d(this.TAG,"Peer not added to store, peerId",i.peerId)})}}handleTrackMetadataAdd(e){fi.d(this.TAG,"TRACK_METADATA_ADD",JSON.stringify(e,null,2));for(let t in e.tracks){let i=e.tracks[t];this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:i})}this.processPendingTracks()}handleTrackRemove(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i;fi.d(this.TAG,"ONTRACKREMOVE","".concat(e));let n=this.store.getTrackState(e.trackId);if(n)if(this.store.hasTrack(e)){if(t){this.store.removeTrack(e);let t=this.store.getPeerById(n.peerId);if(!t)return;this.removePeerTracks(t,e),null==(i=this.listener)||i.onTrackUpdate(1,e,t),"audio"===e.type&&this.eventBus.audioTrackRemoved.publish(e)}}else fi.d(this.TAG,"Track not found in store")}setLayer(e,t){var i,n;let r=this.store.getPeerByTrackId(e.trackId);r&&(e.setLayerFromServer(t)?null==(i=this.listener)||i.onTrackUpdate(5,e,r):null==(n=this.listener)||n.onTrackUpdate(6,e,r))}removePeerTracks(e,t){let i=e.auxiliaryTracks.indexOf(t);i>-1?(e.auxiliaryTracks.splice(i,1),fi.d(this.TAG,"auxiliary track removed","".concat(t))):"audio"===t.type&&e.audioTrack===t?(e.audioTrack=void 0,fi.d(this.TAG,"audio track removed","".concat(t))):"video"===t.type&&e.videoTrack===t&&(e.videoTrack=void 0,fi.d(this.TAG,"video track removed","".concat(t)))}addAudioTrack(e,t){var i;"audio"===t.type&&("regular"!==t.source||e.audioTrack&&(null==(i=e.audioTrack)?void 0:i.trackId)!==t.trackId?e.auxiliaryTracks.push(t):e.audioTrack=t,this.store.addTrack(t),fi.d(this.TAG,"audio track added","".concat(t)))}addVideoTrack(e,t){if("video"!==t.type)return;let i=t,n=this.store.getSimulcastDefinitionsForPeer(e,i.source);if(i.setSimulcastDefinitons(n),this.addAsPrimaryVideoTrack(e,i))e.videoTrack?e.videoTrack.replaceTrack(i):e.videoTrack=i,this.store.addTrack(e.videoTrack);else{let t=e.auxiliaryTracks.findIndex(e=>e.trackId===i.trackId);-1===t?(e.auxiliaryTracks.push(i),this.store.addTrack(i)):(e.auxiliaryTracks[t].replaceTrack(i),this.store.addTrack(e.auxiliaryTracks[t]))}fi.d(this.TAG,"video track added","".concat(t))}addAsPrimaryVideoTrack(e,t){var i;return"regular"===t.source&&(!e.videoTrack||(null==(i=e.videoTrack)?void 0:i.trackId)===t.trackId)}processTrackUpdate(e,t,i){let n;return t.mute!==i.mute?(n=i.mute?2:3,"audio"===e.type&&this.eventBus.audioTrackUpdate.publish({track:e,enabled:!i.mute})):t.description!==i.description&&(n=4),n}},go=class extends vo{constructor(e,t,i,n){var r;super(e,t,n),r=this,this.transport=i,this.TAG="[OnDemandTrackManager]",this.processTrackInfo=function(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n,s;if("video"!==e.type)return;let a=r.store.getPeerById(t);if(!a||!r.isPeerRoleSubscribed(t))return void fi.d(r.TAG,"no peer in store for peerId: ".concat(t));let o=new Nr(new MediaStream,r.transport.getSubscribeConnection()),l=nr.getEmptyVideoTrack();l.enabled=!e.mute;let c=new Lr(o,l,e.source,null==(n=r.store.getRoom())?void 0:n.disableNoneLayerRequest);c.setTrackId(e.track_id),c.peerId=a.peerId,c.logIdentifier=a.name,r.addVideoTrack(a,c),i&&(null==(s=r.listener)||s.onTrackUpdate(0,a.videoTrack,a))}}handleTrackMetadataAdd(e){super.handleTrackMetadataAdd(e);for(let t in e.tracks)"video"===e.tracks[t].type&&this.processTrackInfo(e.tracks[t],e.peer.peer_id)}handleTrackRemove(e){let t="video"===e.type&&"regular"===e.source;super.handleTrackRemove(e,!t),t&&this.processTrackInfo({track_id:e.trackId,mute:!e.enabled,type:e.type,source:e.source,stream_id:e.stream.id},e.peerId,!1)}addAsPrimaryVideoTrack(e,t){return"regular"===t.source&&(!e.videoTrack||e.videoTrack.trackId===t.trackId||e.videoTrack.enabled&&cn(e.videoTrack.nativeTrack))}isPeerRoleSubscribed(e){var t,i,n,r;if(!e)return!0;let s=this.store.getLocalPeer(),a=this.store.getPeerById(e);return a&&(null==(r=null==(i=null==(t=null==s?void 0:s.role)?void 0:t.subscribeParams)?void 0:i.subscribeToRoles)?void 0:r.includes(null==(n=a.role)?void 0:n.name))}},mo=class{constructor(e,t,i,n){this.store=e,this.peerManager=t,this.trackManager=i,this.listener=n,this.TAG="[PeerListManager]",this.handleInitialPeerList=e=>{let t=Object.values(e.peers);this.peerManager.handlePeerList(t)},this.handleReconnectPeerList=e=>{this.handleRepeatedPeerList(e.peers)},this.handlePreviewRoomState=e=>{if(!this.store.hasRoleDetailsArrived())return;let t=e.peers;null!=t?(Object.keys(t).forEach(e=>{t[e].tracks={},t[e].is_from_room_state=!0}),this.handleRepeatedPeerList(t)):0===e.peer_count&&this.handleRepeatedPeerList({})},this.handleRepeatedPeerList=e=>{let t=this.store.getRemotePeers(),i=Object.values(e),n=t.filter(t=>!e[t.peerId]);n.length>0&&fi.d(this.TAG,"".concat(n)),n.forEach(e=>{var t;let i={peer_id:e.peerId,role:(null==(t=e.role)?void 0:t.name)||"",info:{name:e.name,data:e.metadata||"",user_id:e.customerUserId||"",type:e.type},tracks:{},groups:[],realtime:e.realtime};this.peerManager.handlePeerLeave(i)});let r=[];i.forEach(e=>{let t=this.store.getPeerById(e.peer_id),i=Object.values(e.tracks);t&&(this.store.getPeerTracks(t.peerId).forEach(i=>{var n;e.tracks[i.trackId]||(this.removePeerTrack(t,i.trackId),null==(n=this.listener)||n.onTrackUpdate(1,i,t))}),i.forEach(e=>{this.store.getTrackById(e.track_id)||this.store.setTrackState({peerId:t.peerId,trackInfo:e})}),this.trackManager.handleTrackUpdate({peer:e,tracks:e.tracks},!1),this.peerManager.handlePeerUpdate(e)),r.push(e)}),r.length>0&&this.peerManager.handlePeerList(r)}}handleNotification(e,t,i){if("peer-list"===e){let e=t;i?(fi.d(this.TAG,"RECONNECT_PEER_LIST event",JSON.stringify(e,null,2)),this.handleReconnectPeerList(e)):(fi.d(this.TAG,"PEER_LIST event",JSON.stringify(e,null,2)),this.handleInitialPeerList(e))}else if("room-state"===e){let e=t;this.handlePreviewRoomState(e)}}removePeerTrack(e,t){var i,n;if(fi.d(this.TAG,"removing track - ".concat(t," from ").concat(e)),(null==(i=e.audioTrack)?void 0:i.trackId)===t)e.audioTrack=void 0;else if((null==(n=e.videoTrack)?void 0:n.trackId)===t)e.videoTrack=void 0;else{let i=e.auxiliaryTracks.findIndex(e=>e.trackId===t);i>=0&&e.auxiliaryTracks.splice(i,1)}}},yo=e=>e?new Date(e):void 0,bo=class{constructor(e,t,i){this.store=e,this.trackManager=t,this.listener=i,this.TAG="[PeerManager]",this.handlePeerList=e=>{var t,i;if(0===e.length)return void(null==(t=this.listener)||t.onPeerUpdate(9,[]));let n=[],r=new Set(e.map(e=>e.peer_id));this.store.getRemotePeers().forEach(e=>{let{peerId:t,fromRoomState:i}=e;!r.has(t)&&i&&this.store.removePeer(t)});for(let s of e)n.push(this.makePeer(s));null==(i=this.listener)||i.onPeerUpdate(9,n),this.trackManager.processPendingTracks()},this.handlePeerJoin=e=>{var t;let i=this.makePeer(e);null==(t=this.listener)||t.onPeerUpdate(0,i),this.trackManager.processPendingTracks()},this.handlePeerLeave=e=>{var t,i,n,r;let s=this.store.getPeerById(e.peer_id);this.store.removePeer(e.peer_id),fi.d(this.TAG,"PEER_LEAVE",e.peer_id,"remainingPeers=".concat(this.store.getPeers().length)),s&&(s.audioTrack&&(null==(t=this.listener)||t.onTrackUpdate(1,s.audioTrack,s)),s.videoTrack&&(null==(i=this.listener)||i.onTrackUpdate(1,s.videoTrack,s)),null==(n=s.auxiliaryTracks)||n.forEach(e=>{var t;null==(t=this.listener)||t.onTrackUpdate(1,e,s)}),null==(r=this.listener)||r.onPeerUpdate(1,s))}}handleNotification(e,t){switch(e){case"on-peer-join":{let e=t;this.handlePeerJoin(e);break}case"on-peer-leave":{let e=t;this.handlePeerLeave(e);break}case"on-peer-update":this.handlePeerUpdate(t)}}handlePeerUpdate(e){var t,i,n,r,s;let a=this.store.getPeerById(e.peer_id);if(!a&&e.realtime)return a=this.makePeer(e),void(null==(t=this.listener)||t.onPeerUpdate(a.isHandRaised?12:14,a));if(a&&!a.isLocal&&!e.realtime)return this.store.removePeer(a.peerId),void(null==(i=this.listener)||i.onPeerUpdate(13,a));if(!a)return void fi.d(this.TAG,"peer ".concat(e.peer_id," not found"));if(a.role&&a.role.name!==e.role){let t=this.store.getPolicyForRole(e.role);a.updateRole(t),this.updateSimulcastLayersForPeer(a),null==(n=this.listener)||n.onPeerUpdate(8,a)}let o=a.isHandRaised;a.updateGroups(e.groups),o!==(null==(r=e.groups)?void 0:r.includes(Rr))&&(null==(s=this.listener)||s.onPeerUpdate(12,a)),this.handlePeerInfoUpdate(Wt({peer:a},e.info))}handlePeerInfoUpdate(e){let{peer:t,name:i,data:n}=e;var r,s;t&&(i&&t.name!==i&&(t.updateName(i),null==(r=this.listener)||r.onPeerUpdate(10,t)),n&&t.metadata!==n&&(t.updateMetadata(n),null==(s=this.listener)||s.onPeerUpdate(11,t)))}makePeer(e){let t=this.store.getPeerById(e.peer_id);t||(t=Qr(e,this.store),t.realtime=e.realtime,t.joinedAt=yo(e.joined_at),t.fromRoomState=!!e.is_from_room_state,this.store.addPeer(t),fi.d(this.TAG,"adding to the peerList","".concat(t)));for(let i in e.tracks){let t=e.tracks[i];this.store.setTrackState({peerId:e.peer_id,trackInfo:t}),"video"===t.type&&this.trackManager.processTrackInfo(t,e.peer_id,!1)}return t}updateSimulcastLayersForPeer(e){this.store.getPeerTracks(e.peerId).forEach(t=>{if("video"===t.type&&["regular","screen"].includes(t.source)){let i=t,n=this.store.getSimulcastDefinitionsForPeer(e,i.source);i.setSimulcastDefinitons(n)}})}},ko=class{constructor(e,t){this.store=e,this.eventBus=t}handlePolicyChange(e){let t=this.store.getLocalPeer();if(t&&!t.role){let i=e.known_roles[e.name];t.updateRole(i)}this.store.setKnownRoles(e);let i=this.store.getRoom();i?i.templateId=e.template_id:fi.w("[PolicyChangeManager]","on policy change - room not present"),this.updateLocalPeerRole(e),this.eventBus.policyChange.publish(e)}updateLocalPeerRole(e){var t;let i=this.store.getLocalPeer();if(null!=i&&i.role&&i.role.name!==e.name){let n=this.store.getPolicyForRole(e.name),r=i.role;i.updateRole(n),n.name===(null==(t=i.asRole)?void 0:t.name)&&delete i.asRole,this.eventBus.localRoleUpdate.publish({oldRole:r,newRole:n})}}},So=(e=>(e.FLAG_SERVER_SUB_DEGRADATION="subscribeDegradation",e.FLAG_SERVER_SIMULCAST="simulcast",e.FLAG_NON_WEBRTC_DISABLE_OFFER="nonWebRTCDisableOffer",e.FLAG_PUBLISH_STATS="publishStats",e.FLAG_SUBSCRIBE_STATS="subscribeStats",e.FLAG_ON_DEMAND_TRACKS="onDemandTracks",e.FLAG_DISABLE_VIDEO_TRACK_AUTO_UNSUBSCRIBE="disableVideoTrackAutoUnsubscribe",e.FLAG_WHITEBOARD_ENABLED="whiteboardEnabled",e.FLAG_EFFECTS_SDK_ENABLED="effectsSDKEnabled",e.FLAG_VB_ENABLED="vb",e.FLAG_HIPAA_ENABLED="hipaa",e.FLAG_NOISE_CANCELLATION="noiseCancellation",e.FLAG_SCALE_SCREENSHARE_BASED_ON_PIXELS="scaleScreenshareBasedOnPixels",e.FLAG_DISABLE_NONE_LAYER_REQUEST="disableNoneLayerRequest",e))(So||{}),To=(e,t,i)=>{let n=new URL("qa"===i?"https://whiteboard-qa.100ms.live":"https://whiteboard.100ms.live");return n.searchParams.set("endpoint","https://".concat(t)),n.searchParams.set("token",e),n.toString()},wo=class{constructor(e,t,i){this.transport=e,this.store=t,this.listener=i,this.TAG="[HMSWhiteboardInteractivityCenter]"}get isEnabled(){return this.transport.isFlagEnabled("whiteboardEnabled")}open(e){return Jt(this,null,function*(){var t;if(!this.isEnabled)return fi.w(this.TAG,"Whiteboard is not enabled for customer");let i=this.store.getWhiteboard(null==e?void 0:e.id),n=null==i?void 0:i.id;if(i||(n=(yield this.transport.signal.createWhiteboard(this.getCreateOptionsWithDefaults(e))).id),!n)throw new Error("Whiteboard ID: ".concat(n," not found"));let r=yield this.transport.signal.getWhiteboard({id:n}),s=Ht(Wt({},i),{title:null==e?void 0:e.title,attributes:null==e?void 0:e.attributes,id:r.id,url:To(r.token,r.addr,this.store.getEnv()),token:r.token,addr:r.addr,owner:r.owner,permissions:r.permissions||[],open:!0});this.store.setWhiteboard(s),null==(t=this.listener)||t.onWhiteboardUpdate(s)})}close(e){return Jt(this,null,function*(){var t;if(!this.isEnabled)return fi.w(this.TAG,"Whiteboard is not enabled for customer");let i=this.store.getWhiteboard(e);if(!i)throw new Error("Whiteboard ID: ".concat(e," not found"));let n={id:i.id,title:i.title,open:!1};this.store.setWhiteboard(n),null==(t=this.listener)||t.onWhiteboardUpdate(n)})}setListener(e){this.listener=e}handleLocalRoleUpdate(){return Jt(this,null,function*(){var e,t,i;let n=this.store.getWhiteboards();for(let r of n.values())if(r.url){let n=yield this.transport.signal.getWhiteboard({id:r.id}),s=this.store.getLocalPeer(),a=(null==s?void 0:s.customerUserId)===n.owner?null==(t=null==(e=s.role)?void 0:e.permissions.whiteboard)?void 0:t.includes("admin"):n.permissions.length>0,o=Ht(Wt({},r),{id:n.id,url:To(n.token,n.addr,this.store.getEnv()),token:n.token,addr:n.addr,owner:n.owner,permissions:n.permissions,open:a});this.store.setWhiteboard(o),null==(i=this.listener)||i.onWhiteboardUpdate(o)}})}getCreateOptionsWithDefaults(e){var t;let i=Object.values(this.store.getKnownRoles()),n=[],r=[],s=[];return i.forEach(e=>{var t,i,a;null!=(t=e.permissions.whiteboard)&&t.includes("read")&&n.push(e.name),null!=(i=e.permissions.whiteboard)&&i.includes("write")&&r.push(e.name),null!=(a=e.permissions.whiteboard)&&a.includes("admin")&&s.push(e.name)}),{title:(null==e?void 0:e.title)||"".concat(null==(t=this.store.getRoom())?void 0:t.id," Whiteboard"),reader:(null==e?void 0:e.reader)||n,writer:(null==e?void 0:e.writer)||r,admin:(null==e?void 0:e.admin)||s}}},Eo=class{constructor(e,t,i){this.transport=e,this.store=t,this.listener=i,this.whiteboard=new wo(e,t,i)}setListener(e){this.listener=e,this.whiteboard.setListener(e)}createPoll(e){return Jt(this,null,function*(){var t,i;let{poll_id:n}=yield this.transport.signal.setPollInfo(Ht(Wt({},e),{mode:e.mode?{customerID:"userid",peerID:"peerid",userName:"username"}[e.mode]:void 0,poll_id:e.id,vote:e.rolesThatCanVote,responses:e.rolesThatCanViewResponses}));e.id||(e.id=n),Array.isArray(e.questions)&&(yield this.addQuestionsToPoll(e.id,e.questions));let r=yield this.transport.signal.getPollQuestions({poll_id:e.id,index:0,count:50}),s=Po(Ht(Wt({},e),{poll_id:e.id,state:"created",created_by:null==(t=this.store.getLocalPeer())?void 0:t.peerId}));s.questions=r.questions.map(e=>{let{question:t,options:i,answer:n}=e;return Ht(Wt({},t),{options:i,answer:n})}),null==(i=this.listener)||i.onPollsUpdate(0,[s])})}startPoll(e){return Jt(this,null,function*(){"string"==typeof e?yield this.transport.signal.startPoll({poll_id:e}):(yield this.createPoll(e),yield this.transport.signal.startPoll({poll_id:e.id}))})}addQuestionsToPoll(e,t){return Jt(this,null,function*(){t.length>0&&(yield this.transport.signal.setPollQuestions({poll_id:e,questions:t.map((e,t)=>this.createQuestionSetParams(e,t))}))})}stopPoll(e){return Jt(this,null,function*(){yield this.transport.signal.stopPoll({poll_id:e})})}addResponsesToPoll(e,t){return Jt(this,null,function*(){let i=this.store.getPoll(e);if(!i)throw new Error("Invalid poll ID - Poll not found");let n=t.map(e=>{var t,n;let r=this.getQuestionInPoll(i,e.questionIndex);return"single-choice"===r.type?(e.option=e.option||(null==(t=e.options)?void 0:t[0])||-1,delete e.text,delete e.options):"multiple-choice"===r.type?(null==(n=e.options)||n.sort(),delete e.text,delete e.option):(delete e.option,delete e.options),e.skipped&&(delete e.option,delete e.options,delete e.text),Wt({duration:0,type:r.type,question:e.questionIndex},e)});yield this.transport.signal.setPollResponses({poll_id:e,responses:n})})}fetchLeaderboard(e,t,i){return Jt(this,null,function*(){var n,r;let s=this.store.getPoll(e);if(!s)throw new Error("Invalid poll ID - Poll not found");let a=null==(r=null==(n=this.store.getLocalPeer())?void 0:n.role)?void 0:r.permissions,o=!!(null!=a&&a.pollRead||null!=a&&a.pollWrite);if(s.anonymous||"stopped"!==s.state||!o)return{entries:[],hasNext:!1};let l=yield this.transport.signal.fetchPollLeaderboard({poll_id:s.id,count:i,offset:t}),c={avgScore:l.avg_score,avgTime:l.avg_time,votedUsers:l.voted_users,totalUsers:l.total_users,correctUsers:l.correct_users};return{entries:l.questions.map(e=>({position:e.position,totalResponses:e.total_responses,correctResponses:e.correct_responses,duration:e.duration,peer:e.peer,score:e.score})),hasNext:!l.last,summary:c}})}getPollResponses(e,t){return Jt(this,null,function*(){var i,n;let r=yield this.transport.signal.getPollResponses({poll_id:e.id,index:0,count:50,self:t}),s=JSON.parse(JSON.stringify(e));null==(i=r.responses)||i.forEach(i=>{let{response:n,peer:r,final:a}=i;var o,l;let c=null==(o=null==e?void 0:e.questions)?void 0:o.find(e=>e.index===n.question);if(c){let e={id:n.response_id,questionIndex:n.question,option:n.option,options:n.options,text:n.text,responseFinal:a,peer:{peerid:r.peerid,userHash:r.hash,userid:r.userid,username:r.username},skipped:n.skipped,type:n.type,update:n.update},i=c.responses&&!t?[...c.responses]:[];null!=(l=s.questions)&&l[n.question-1]&&(s.questions[n.question-1].responses=[...i,e])}}),this.store.setPoll(s),null==(n=this.listener)||n.onPollsUpdate(4,[s])})}getPolls(){return Jt(this,null,function*(){var e,t,i;let n=yield this.transport.signal.getPollsList({count:50,state:"started"}),r=[],s=null==(t=null==(e=this.store.getLocalPeer())?void 0:e.role)?void 0:t.permissions.pollWrite,a=[...n.polls];if(s){let e=yield this.transport.signal.getPollsList({count:50,state:"created"}),t=yield this.transport.signal.getPollsList({count:50,state:"stopped"});a=[...e.polls,...a,...t.polls]}for(let o of a){let e=yield this.transport.signal.getPollQuestions({poll_id:o.poll_id,index:0,count:50}),t=Po(o),i=this.store.getPoll(o.poll_id);t.questions=e.questions.map((e,t)=>{let{question:n,options:r,answer:s}=e;var a,o;return Ht(Wt({},n),{options:r,answer:s,responses:null==(o=null==(a=null==i?void 0:i.questions)?void 0:a[t])?void 0:o.responses})}),r.push(t),this.store.setPoll(t)}return null==(i=this.listener)||i.onPollsUpdate(3,r),r})}createQuestionSetParams(e,t){var i,n;if(e.index){let n=null==(i=e.options)?void 0:i.map((e,t)=>Ht(Wt({},e),{index:t+1}));return{question:Ht(Wt({},e),{index:t+1}),options:n,answer:e.answer}}let r,s=Ht(Wt({},e),{index:t+1}),a=e.answer||{hidden:!1};return Array.isArray(e.options)&&["single-choice","multiple-choice"].includes(e.type)?(r=null==(n=e.options)?void 0:n.map((e,t)=>({index:t+1,text:e.text,weight:e.weight})),"single-choice"===e.type?a.option=e.options.findIndex(e=>e.isCorrectAnswer)+1||void 0:a.options=e.options.map((e,t)=>e.isCorrectAnswer?t+1:void 0).filter(e=>!!e)):(null==a||delete a.options,null==a||delete a.option),{question:s,options:r,answer:a}}getQuestionInPoll(e,t){var i;let n=null==(i=null==e?void 0:e.questions)?void 0:i.find(e=>e.index===t);if(!n)throw new Error("Invalid question index - Question not found in poll");return n}},Po=e=>({id:e.poll_id,title:e.title,startedBy:e.started_by,createdBy:e.created_by,anonymous:e.anonymous,type:e.type,duration:e.duration,locked:e.locked,mode:e.mode?{userid:"customerID",peerid:"peerID",username:"userName"}[e.mode]:void 0,visibility:e.visibility,rolesThatCanVote:e.vote||[],rolesThatCanViewResponses:e.responses||[],state:e.state,stoppedBy:e.stopped_by,startedAt:yo(e.started_at),stoppedAt:yo(e.stopped_at),createdAt:yo(e.created_at)}),Co=class{constructor(e,t,i){this.store=e,this.transport=t,this.listener=i}handleNotification(e,t){switch(e){case"on-poll-start":this.handlePollStart(t);break;case"on-poll-stop":this.handlePollStop(t);break;case"on-poll-stats":this.handlePollStats(t)}}handlePollStart(e){return Jt(this,null,function*(){var t,i;let n=[];for(let r of e.polls){let e=this.store.getPoll(r.poll_id);if(e&&"started"===e.state)return void(null==(t=this.listener)||t.onPollsUpdate(1,[e]));let i=yield this.transport.signal.getPollQuestions({poll_id:r.poll_id,index:0,count:50}),s=Po(r);s.questions=i.questions.map(e=>{let{question:t,options:i,answer:n}=e;return Ht(Wt({},t),{options:i,answer:n})}),yield this.updatePollResponses(s,!0),n.push(s),this.store.setPoll(s)}null==(i=this.listener)||i.onPollsUpdate(1,n)})}handlePollStop(e){return Jt(this,null,function*(){var t;let i=[];for(let n of e.polls){let e=this.store.getPoll(n.poll_id);if(e){e.state="stopped",e.stoppedAt=yo(n.stopped_at),e.stoppedBy=n.stopped_by;let t=yield this.transport.signal.getPollResult({poll_id:n.poll_id});this.updatePollResult(e,t),i.push(e)}}i.length>0&&(null==(t=this.listener)||t.onPollsUpdate(2,i))})}handlePollStats(e){return Jt(this,null,function*(){var t;let i=[];for(let n of e.polls){let e=this.store.getPoll(n.poll_id);if(!e)return;this.updatePollResult(e,n),i.push(e)}i.length>0&&(null==(t=this.listener)||t.onPollsUpdate(4,i))})}updatePollResult(e,t){var i;e.result=Wt({},e.result),e.result.totalUsers=t.user_count,e.result.maxUsers=t.max_user,e.result.totalResponses=t.total_response,null==(i=t.questions)||i.forEach(t=>{var i,n;let r=null==(i=e.questions)?void 0:i.find(e=>e.index===t.question);r&&(r.result=Wt({},r.result),r.result.correctResponses=t.correct,r.result.skippedCount=t.skipped,r.result.totalResponses=t.total,null==(n=t.options)||n.forEach((e,t)=>{var i;let n=null==(i=r.options)?void 0:i[t];n&&n.voteCount!==e&&(n.voteCount=e)}))})}updatePollResponses(e,t){return Jt(this,null,function*(){var i;null==(i=(yield this.transport.signal.getPollResponses({poll_id:e.id,index:0,count:50,self:t})).responses)||i.forEach(t=>{let{response:i,peer:n,final:r}=t;var s;let a=null==(s=null==e?void 0:e.questions)?void 0:s.find(e=>e.index===i.question);if(!a)return;let o={id:i.response_id,questionIndex:i.question,option:i.option,options:i.options,text:i.text,responseFinal:r,peer:{peerid:n.peerid,userHash:n.hash,userid:n.userid,username:n.username},skipped:i.skipped,type:i.type,update:i.update};Array.isArray(a.responses)&&a.responses.length>0?a.responses.find(e=>{let{id:t}=e;return t===o.id})||a.responses.push(o):a.responses=[o]})})}},Io=class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){switch(e){case"on-role-change-request":this.handleRoleChangeRequest(t);break;case"on-track-update-request":this.handleTrackUpdateRequest(t);break;case"on-change-track-mute-state-request":this.handleChangeTrackStateRequest(t);break;default:return}}handleRoleChangeRequest(e){var t;let i={requestedBy:e.requested_by?this.store.getPeerById(e.requested_by):void 0,role:this.store.getPolicyForRole(e.role),token:e.token};null==(t=this.listener)||t.onRoleChangeRequest(i)}handleTrackUpdateRequest(e){let{requested_by:t,track_id:i,mute:n}=e,r=t?this.store.getPeerById(t):void 0,s=this.store.getLocalPeerTracks().find(e=>e.publishedTrackId===i);if(!s)return;let a=()=>{var e;null==(e=this.listener)||e.onChangeTrackStateRequest({requestedBy:r,track:s,enabled:!n})};if(n){if(s.enabled===!n)return;s.setEnabled(!n).then(a)}else a()}handleChangeTrackStateRequest(e){var t;let{type:i,source:n,value:r,requested_by:s}=e,a=s?this.store.getPeerById(s):void 0,o=!r,l=this.getTracksToBeUpdated({type:i,source:n,enabled:o});if(0!==l.length)if(o)null==(t=this.listener)||t.onChangeMultiTrackStateRequest({requestedBy:a,tracks:l,type:i,source:n,enabled:!0});else{let e=[];for(let t of l)e.push(t.setEnabled(!1));Promise.all(e).then(()=>{var e;null==(e=this.listener)||e.onChangeMultiTrackStateRequest({requestedBy:a,tracks:l,enabled:!1})})}}getTracksToBeUpdated(e){let{type:t,source:i,enabled:n}=e,r=this.store.getLocalPeerTracks();return t&&(r=r.filter(e=>e.type===t)),i&&(r=r.filter(e=>e.source===i)),r.filter(e=>e.enabled!==n)}},_o=class{constructor(e,t){this.store=e,this.listener=t,this.TAG="[RoomUpdateManager]"}handleNotification(e,t){switch(e){case"peer-list":this.onRoomState(t.room);break;case"on-rtmp-update":this.updateRTMPStatus(t);break;case"on-record-update":this.updateRecordingStatus(t);break;case"room-state":this.handlePreviewRoomState(t);break;case"room-info":this.handleRoomInfo(t);break;case"session-info":this.handleSessionInfo(t);break;case"on-hls-update":this.updateHLSStatus(t);break;case"on-transcription-update":this.handleTranscriptionStatus([t])}}handleRoomInfo(e){let t=this.store.getRoom();t?(t.description=e.description,t.large_room_optimization=e.large_room_optimization,t.max_size=e.max_size,t.name=e.name):fi.w(this.TAG,"on session info - room not present")}handleSessionInfo(e){var t;let i=this.store.getRoom();i?(i.sessionId=e.session_id,i.peerCount!==e.peer_count&&(i.peerCount=e.peer_count,null==(t=this.listener)||t.onRoomUpdate("ROOM_PEER_COUNT_UPDATED",i))):fi.w(this.TAG,"on session info - room not present")}handlePreviewRoomState(e){let{room:t}=e;this.onRoomState(t)}onRoomState(e){var t,i,n,r;let{recording:s,streaming:a,transcriptions:o,session_id:l,started_at:c,name:u}=e,d=this.store.getRoom();d?(d.name=u,d.rtmp.running=this.isStreamingRunning(null==(t=null==a?void 0:a.rtmp)?void 0:t.state),d.rtmp.startedAt=yo(null==(i=null==a?void 0:a.rtmp)?void 0:i.started_at),d.rtmp.state=null==(n=null==a?void 0:a.rtmp)?void 0:n.state,d.recording.server=this.getPeerListSFURecording(s),d.recording.browser=this.getPeerListBrowserRecording(s),d.recording.hls=this.getPeerListHLSRecording(s),d.hls=this.convertHls(null==a?void 0:a.hls),d.transcriptions=this.addTranscriptionDetail(o),d.sessionId=l,d.startedAt=yo(c),null==(r=this.listener)||r.onRoomUpdate("RECORDING_STATE_UPDATED",d)):fi.w(this.TAG,"on room state - room not present")}addTranscriptionDetail(e){return e?e.map(e=>({state:e.state,mode:e.mode,initialised_at:yo(e.initialised_at),started_at:yo(e.started_at),stopped_at:yo(e.stopped_at),updated_at:yo(e.updated_at),error:this.toSdkError(null==e?void 0:e.error)})):[]}isRecordingRunning(e){return!!e&&!["none","paused","stopped","failed"].includes(e)}isStreamingRunning(e){return!!e&&!["none","stopped","failed"].includes(e)}initHLS(e){let t=this.store.getRoom(),i={running:!0,variants:[]};return t?(null!=e&&e.variants&&e.variants.forEach((t,n)=>{var r,s,a;"initialised"!==t.state?i.variants.push({meetingURL:null==t?void 0:t.meetingURL,url:null==t?void 0:t.url,metadata:null==t?void 0:t.metadata,playlist_type:null==t?void 0:t.playlist_type,startedAt:yo(null==(r=null==e?void 0:e.variants)?void 0:r[n].started_at),initialisedAt:yo(null==(s=null==e?void 0:e.variants)?void 0:s[n].initialised_at),state:t.state,stream_type:null==t?void 0:t.stream_type}):i.variants.push({initialisedAt:yo(null==(a=null==e?void 0:e.variants)?void 0:a[n].initialised_at),url:""})}),i):(fi.w(this.TAG,"on hls - room not present"),i)}updateHLSStatus(e){var t;let i=this.store.getRoom(),n=!!(e.variants&&e.variants.length>0)&&e.variants.some(e=>this.isStreamingRunning(e.state));i?(e.enabled=n,i.hls=this.convertHls(e),null==(t=this.listener)||t.onRoomUpdate("HLS_STREAMING_STATE_UPDATED",i)):fi.w(this.TAG,"on hls - room not present")}handleTranscriptionStatus(e){var t;let i=this.store.getRoom();i?(i.transcriptions=this.addTranscriptionDetail(e)||[],null==(t=this.listener)||t.onRoomUpdate("TRANSCRIPTION_STATE_UPDATED",i)):fi.w(this.TAG,"on transcription - room not present")}convertHls(e){var t;if(null!=e&&e.variants&&e.variants.length>0&&e.variants.some(e=>"initialised"===e.state))return this.initHLS(e);let i={running:!(null==e||!e.enabled),variants:[],error:this.toSdkError(null==e?void 0:e.error)};return null==(t=null==e?void 0:e.variants)||t.forEach(e=>{i.variants.push({meetingURL:null==e?void 0:e.meeting_url,url:null==e?void 0:e.url,metadata:null==e?void 0:e.metadata,playlist_type:null==e?void 0:e.playlist_type,startedAt:yo(null==e?void 0:e.started_at),initialisedAt:yo(null==e?void 0:e.initialised_at),state:e.state,stream_type:null==e?void 0:e.stream_type})}),i}getHLSRecording(e){var t,i;let n={running:!1},r=this.isRecordingRunning(null==e?void 0:e.state);return(r||"paused"===(null==e?void 0:e.state))&&(n={running:r,singleFilePerLayer:!(null==(t=null==e?void 0:e.hls_recording)||!t.single_file_per_layer),hlsVod:!(null==(i=null==e?void 0:e.hls_recording)||!i.hls_vod),startedAt:yo(null==e?void 0:e.started_at),initialisedAt:yo(null==e?void 0:e.initialised_at),state:null==e?void 0:e.state,error:this.toSdkError(null==e?void 0:e.error)}),n}getPeerListHLSRecording(e){var t,i;let n=null==e?void 0:e.hls;return{running:this.isRecordingRunning(null==n?void 0:n.state),startedAt:yo(null==n?void 0:n.started_at),initialisedAt:yo(null==n?void 0:n.initialised_at),state:null==n?void 0:n.state,singleFilePerLayer:null==(t=null==n?void 0:n.config)?void 0:t.single_file_per_layer,hlsVod:null==(i=null==n?void 0:n.config)?void 0:i.hls_vod}}getPeerListBrowserRecording(e){let t=null==e?void 0:e.browser;return{running:this.isRecordingRunning(null==t?void 0:t.state),startedAt:yo(null==t?void 0:t.started_at),state:null==t?void 0:t.state}}getPeerListSFURecording(e){let t=null==e?void 0:e.sfu;return{running:this.isRecordingRunning(null==t?void 0:t.state),startedAt:yo(null==t?void 0:t.started_at),state:null==t?void 0:t.state}}updateRecordingStatus(e){var t;let i,n=this.store.getRoom(),r=this.isRecordingRunning(e.state);n?("sfu"===e.type?(n.recording.server={running:r,startedAt:r?yo(e.started_at):void 0,error:this.toSdkError(e.error),state:e.state},i="SERVER_RECORDING_STATE_UPDATED"):"HLS"===e.type?(n.recording.hls=this.getHLSRecording(e),i="RECORDING_STATE_UPDATED"):(n.recording.browser={running:r,startedAt:r?yo(e.started_at):void 0,error:this.toSdkError(e.error),state:null==e?void 0:e.state},i="BROWSER_RECORDING_STATE_UPDATED"),null==(t=this.listener)||t.onRoomUpdate(i,n)):fi.w(this.TAG,"set recording status running=".concat(r," - room not present"))}updateRTMPStatus(e){var t,i;let n=this.store.getRoom(),r=this.isStreamingRunning(e.state);if(n)return r?(n.rtmp={running:r,startedAt:r?yo(e.started_at):void 0,state:e.state,error:this.toSdkError(e.error)},void(null==(i=this.listener)||i.onRoomUpdate("RTMP_STREAMING_STATE_UPDATED",n))):(n.rtmp={running:r,state:e.state,error:this.toSdkError(e.error)},void(null==(t=this.listener)||t.onRoomUpdate("RTMP_STREAMING_STATE_UPDATED",n)));fi.w(this.TAG,"on policy change - room not present")}toSdkError(e){if(null==e||!e.code)return;let t=e.message||"error in streaming/recording",i=new Ri(e.code,"ServerErrors","NONE",t,t);return fi.e(this.TAG,"error in streaming/recording",i),i}},Ao=class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){"on-metadata-change"===e&&this.handleMetadataChange(t)}handleMetadataChange(e){var t;let i=e.values.map(e=>({key:e.key,value:e.data,updatedAt:yo(e.updated_at),updatedBy:e.updated_by?this.store.getPeerById(e.updated_by):void 0}));null==(t=this.listener)||t.onSessionStoreUpdate(i)}},Ro=class{constructor(e,t,i){this.store=e,this.transport=t,this.listener=i}handleNotification(e,t){if("on-whiteboard-update"===e)this.handleWhiteboardUpdate(t)}handleWhiteboardUpdate(e){return Jt(this,null,function*(){var t;let i=this.store.getLocalPeer(),n=this.store.getWhiteboard(e.id),r=e.owner===(null==i?void 0:i.peerId)||e.owner===(null==i?void 0:i.customerUserId),s="open"===e.state,a={id:e.id,title:e.title,attributes:e.attributes};if(a.open=r?null==n?void 0:n.open:s,a.owner=a.open?e.owner:void 0,a.open)if(r)a.url=null==n?void 0:n.url,a.token=null==n?void 0:n.token,a.addr=null==n?void 0:n.addr,a.permissions=null==n?void 0:n.permissions;else{let t=yield this.transport.signal.getWhiteboard({id:e.id});a.url=To(t.token,t.addr,this.store.getEnv()),a.token=t.token,a.addr=t.addr,a.permissions=t.permissions,a.open=t.permissions.length>0}this.store.setWhiteboard(a),null==(t=this.listener)||t.onWhiteboardUpdate(a)})}},Lo=class{constructor(e,t,i,n,r,s){this.store=e,this.transport=i,this.listener=n,this.audioListener=r,this.connectionQualityListener=s,this.TAG="[HMSNotificationManager]",this.hasConsistentRoomStateArrived=!1,this.ignoreNotification=e=>{if("peer-list"===e)this.hasConsistentRoomStateArrived=!0;else if("room-state"===e)return this.hasConsistentRoomStateArrived;return!1},this.handleTrackAdd=e=>{this.trackManager.handleTrackAdd(e)},this.handleTrackRemove=e=>{this.trackManager.handleTrackRemove(e)},this.updateLocalPeer=e=>{let{name:t,metadata:i}=e,n=this.store.getLocalPeer();this.peerManager.handlePeerInfoUpdate({peer:n,name:t,data:i})};let a=this.transport.isFlagEnabled("onDemandTracks");this.trackManager=a?new go(this.store,t,this.transport,this.listener):new vo(this.store,t,this.listener),this.peerManager=new bo(this.store,this.trackManager,this.listener),this.peerListManager=new mo(this.store,this.peerManager,this.trackManager,this.listener),this.broadcastManager=new po(this.listener),this.policyChangeManager=new ko(this.store,t),this.requestManager=new Io(this.store,this.listener),this.activeSpeakerManager=new ho(this.store,this.listener,this.audioListener),this.connectionQualityManager=new fo(this.store,this.connectionQualityListener),this.roomUpdateManager=new _o(this.store,this.listener),this.sessionMetadataManager=new Ao(this.store,this.listener),this.pollsManager=new Co(this.store,this.transport,this.listener),this.whiteboardManager=new Ro(this.store,this.transport,this.listener)}setListener(e){this.listener=e,this.trackManager.listener=e,this.peerManager.listener=e,this.peerListManager.listener=e,this.broadcastManager.listener=e,this.requestManager.listener=e,this.activeSpeakerManager.listener=e,this.roomUpdateManager.listener=e,this.sessionMetadataManager.listener=e,this.pollsManager.listener=e,this.whiteboardManager.listener=e}setAudioListener(e){this.audioListener=e,this.activeSpeakerManager.audioListener=e}setConnectionQualityListener(e){this.connectionQualityListener=e,this.connectionQualityManager.listener=e}handleNotification(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var i,n;let r=e.method,s=e.params;["active-speakers","sfu-stats","on-connection-quality-update",void 0].includes(r)||fi.d(this.TAG,"Received notification - ".concat(r),{notification:s}),"sfu-stats"===r&&null!=(i=window.HMS)&&i.ON_SFU_STATS&&"function"==typeof(null==(n=window.HMS)?void 0:n.ON_SFU_STATS)&&window.HMS.ON_SFU_STATS(e.params),!this.ignoreNotification(r)&&(this.roomUpdateManager.handleNotification(r,s),this.peerManager.handleNotification(r,s),this.requestManager.handleNotification(r,s),this.peerListManager.handleNotification(r,s,t),this.broadcastManager.handleNotification(r,s),this.sessionMetadataManager.handleNotification(r,s),this.pollsManager.handleNotification(r,s),this.whiteboardManager.handleNotification(r,s),this.handleIsolatedMethods(r,s))}handleIsolatedMethods(e,t){switch(e){case"on-track-add":this.trackManager.handleTrackMetadataAdd(t);break;case"on-track-update":this.trackManager.handleTrackUpdate(t);break;case"on-track-remove":if(!t.peer)return void fi.d(this.TAG,"Ignoring sfu notification - ".concat(e),{notification:t});this.trackManager.handleTrackRemovedPermanently(t);break;case"on-track-layer-update":this.trackManager.handleTrackLayerUpdate(t);break;case"active-speakers":this.activeSpeakerManager.handleActiveSpeakers(t);break;case"on-connection-quality-update":this.connectionQualityManager.handleQualityUpdate(t);break;case"on-policy-change":this.policyChangeManager.handlePolicyChange(t);break;case"node-info":this.transport.setSFUNodeId(t.sfu_node_id)}}},Do=class{constructor(e){this.transport=e,this.observedKeys=new Set}get(e){return Jt(this,null,function*(){let{data:t,updated_at:i}=yield this.transport.signal.getSessionMetadata(e);return{value:t,updatedAt:yo(i)}})}set(e,t){return Jt(this,null,function*(){let{data:i,updated_at:n}=yield this.transport.signal.setSessionMetadata({key:e,data:t});return{value:i,updatedAt:yo(n)}})}observe(e){return Jt(this,null,function*(){let t=new Set(this.observedKeys);if(e.forEach(e=>this.observedKeys.add(e)),this.observedKeys.size!==t.size)try{yield this.transport.signal.listenMetadataChange(Array.from(this.observedKeys))}catch(E){throw this.observedKeys=t,E}})}unobserve(e){return Jt(this,null,function*(){let t=new Set(this.observedKeys);if(this.observedKeys=new Set([...this.observedKeys].filter(t=>!e.includes(t))),this.observedKeys.size!==t.size)try{yield this.transport.signal.listenMetadataChange(Array.from(this.observedKeys))}catch(E){throw this.observedKeys=t,E}})}},Mo=class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"https://prod-init.100ms.live/init",s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6?arguments[6]:void 0;this.authToken=e,this.peerId=t,this.peerName=i,this.data=n,this.endpoint=r,this.autoSubscribeVideo=s,this.iceServers=a}},No=(e=>(e[e.ConnectFailed=0]="ConnectFailed",e[e.SignalDisconnect=1]="SignalDisconnect",e[e.JoinWSMessageFailed=2]="JoinWSMessageFailed",e[e.PublishIceConnectionFailed=3]="PublishIceConnectionFailed",e[e.SubscribeIceConnectionFailed=4]="SubscribeIceConnectionFailed",e))(No||{}),Oo={0:[],1:[],2:[1],3:[1],4:[1]},xo=(e=>(e.Disconnected="Disconnected",e.Connecting="Connecting",e.Joined="Joined",e.Preview="Preview",e.Failed="Failed",e.Reconnecting="Reconnecting",e.Leaving="Leaving",e))(xo||{}),Uo=class{constructor(e){this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i,e(t,i)})}},Fo=class{constructor(e,t){this.onStateChange=e,this.sendEvent=t,this.TAG="[RetryScheduler]",this.inProgress=new Map,this.retryTaskIds=[]}schedule(e){return Jt(this,arguments,function(e){var t=this;let{category:i,error:n,task:r,originalState:s,maxRetryTime:a=6e4,changeState:o=!0}=e;return function*(){yield t.scheduleTask({category:i,error:n,changeState:o,task:r,originalState:s,maxRetryTime:a,failedAt:Date.now()})}()})}reset(){this.retryTaskIds.forEach(e=>clearTimeout(e)),this.retryTaskIds=[],this.inProgress.clear()}isTaskInProgress(e){return!!this.inProgress.get(e)}scheduleTask(e){return Jt(this,arguments,function(e){var t=this;let{category:i,error:n,changeState:r,task:s,originalState:a,failedAt:o,maxRetryTime:l=6e4,failedRetryCount:c=0}=e;return function*(){if(fi.d(t.TAG,"schedule: ",{category:No[i],error:n}),0===c){let e=t.inProgress.get(i);if(e)return fi.d(t.TAG,"schedule: Already a task for ".concat(No[i]," scheduled, waiting for its completion")),void(yield e.promise);let r=new Uo((e,t)=>{});t.inProgress.set(i,r),t.sendEvent(n,i)}let e=!1,u=Oo[i];for(let n in u){let r=u[parseInt(n)];try{let e=t.inProgress.get(r);e&&(fi.d(t.TAG,"schedule: Suspending retry task of ".concat(No[i],", waiting for ").concat(No[r]," to recover")),yield e.promise,fi.d(t.TAG,"schedule: Resuming retry task ".concat(No[i]," as it's dependency ").concat(No[r]," is recovered")))}catch(v){fi.d(t.TAG,"schedule: Stopping retry task of ".concat(No[i]," as it's dependency ").concat(No[r]," failed to recover")),e=!0;break}}let d=e=>{if(t.inProgress.delete(i),t.sendEvent(e,i),t.reset(),!r)throw e;t.onStateChange("Failed",e)},h=Date.now()-o;if(h>=l||e)return n.description+=". [".concat(No[i],"] Could not recover after ").concat(h," milliseconds"),e&&(n.description+=" Could not recover all of it's required dependencies - [".concat(u.map(e=>No[e]).toString(),"]")),n.isTerminal=!0,d(n);r&&t.onStateChange("Reconnecting",n);let p,f=t.getDelayForRetryCount(i);fi.d(t.TAG,"schedule: [".concat(No[i],"] [failedRetryCount=").concat(c,"] Scheduling retry task in ").concat(f,"ms"));try{p=yield t.setTimeoutPromise(s,f)}catch(We){p=!1;let n=We;if(n.isTerminal)return fi.e(t.TAG,"[".concat(No[i],"] Un-caught terminal exception ").concat(n.name," in retry-task"),We),d(n);fi.w(t.TAG,"[".concat(No[i],"] Un-caught exception ").concat(n.name," in retry-task, initiating retry"),We)}if(p){let e=t.inProgress.get(i);t.inProgress.delete(i),null==e||e.resolve(c),r&&0===t.inProgress.size&&t.onStateChange(a),fi.d(t.TAG,"schedule: [".concat(No[i],"] [failedRetryCount=").concat(c,"] Recovered \u267b\ufe0f after ").concat(h,"ms"))}else yield t.scheduleTask({category:i,error:n,changeState:r,task:s,originalState:a,maxRetryTime:l,failedAt:o,failedRetryCount:c+1})}()})}getDelayForRetryCount(e){let t=2===e?2*Math.random():Math.random(),i=0;return 2===e?i=2+t:1===e&&(i=1),1e3*i}setTimeoutPromise(e,t){return Jt(this,null,function*(){return new Promise((i,n)=>{let r=window.setTimeout(()=>Jt(this,null,function*(){try{let t=yield e();t&&this.retryTaskIds.splice(this.retryTaskIds.indexOf(r),1),i(t)}catch(Fe){n(Fe)}}),t);this.retryTaskIds.push(r)})})}},jo=class extends fn{constructor(){super(100),this.localStorage=new Ui("hms-analytics"),this.localStorage.clear(),this.initLocalStorageQueue()}enqueue(e){super.enqueue(e),this.localStorage.set(this.storage)}dequeue(){let e=super.dequeue();return this.localStorage.set(this.storage),e}initLocalStorageQueue(){var e;null==(e=this.localStorage.get())||e.forEach(e=>{let t=new Ki(e);super.enqueue(t)})}},Bo=class{constructor(){this.TAG="[AnalyticsTransport]",this.eventCount=0,this.lastResetTime=Date.now(),this.MAX_EVENTS_PER_MINUTE=200,this.RESET_INTERVAL_MS=6e4}checkRateLimit(){let e=Date.now();if(e-this.lastResetTime>=this.RESET_INTERVAL_MS&&(this.eventCount=0,this.lastResetTime=e),this.eventCount>=this.MAX_EVENTS_PER_MINUTE)throw new Error("Too many events being sent, please check the implementation.");this.eventCount++}sendEvent(e){try{this.checkRateLimit()}catch(xe){throw fi.w(this.TAG,"Rate limit exceeded",xe),xe}try{this.sendSingleEvent(e),this.flushFailedEvents()}catch(xe){fi.w(this.TAG,"sendEvent failed",xe)}}flushFailedEvents(e){var t;try{for(fi.d(this.TAG,"Flushing failed events",this.failedEvents);this.failedEvents.size()>0;){let i=this.failedEvents.dequeue();i&&((null==(t=i.metadata)?void 0:t.peer.peer_id)!==e&&i.metadata.peer.peer_id?Xa.sendEvent(i):this.sendSingleEvent(i))}}catch(E){fi.w(this.TAG,"flushFailedEvents failed",E)}}sendSingleEvent(e){try{this.transportProvider.sendEvent(e),fi.d(this.TAG,"Sent event",e.name,e)}catch(xe){throw fi.w(this.TAG,"".concat(this.transportProvider.TAG,".sendEvent failed, adding to local storage events"),{event:e,error:xe}),this.failedEvents.enqueue(e),xe}}},Go=class extends Bo{constructor(e){super(),this.transportProvider=e,this.failedEvents=new jo}},Vo=class{constructor(e,t,i,n){this.store=e,this.eventBus=t,this.sampleWindowSize=i,this.pushInterval=n,this.shouldSendEvent=!1,this.sequenceNum=1,this.stop=()=>{this.shouldSendEvent&&this.sendEvent(),this.eventBus.statsUpdate.unsubscribe(this.handleStatsUpdate.bind(this)),this.shouldSendEvent=!1},this.start()}start(){this.shouldSendEvent||(this.stop(),this.shouldSendEvent=!0,this.eventBus.statsUpdate.subscribe(this.handleStatsUpdate.bind(this)),this.startLoop().catch(e=>fi.e("[StatsAnalytics]",e.message)))}startLoop(){return Jt(this,null,function*(){for(;this.shouldSendEvent;)yield gn(1e3*this.pushInterval),this.sendEvent()})}sendEvent(){this.trackAnalytics.forEach(e=>{e.clearSamples()})}cleanTrackAnalyticsAndCreateSample(e){this.trackAnalytics.forEach(e=>{!this.store.hasTrack(e.track)&&!(e.samples.length>0)&&this.trackAnalytics.delete(e.track_id)}),e&&this.trackAnalytics.forEach(e=>{e.createSample()})}},zo=class{constructor(e){let{track:t,ssrc:i,rid:n,kind:r,sampleWindowSize:s}=e;this.samples=[],this.tempStats=[],this.track=t,this.ssrc=i,this.rid=n,this.kind=r,this.track_id=this.track.trackId,this.source=this.track.source,this.sampleWindowSize=s}pushTempStat(e){this.tempStats.push(e)}createSample(){0!==this.tempStats.length&&(this.samples.push(this.collateSample()),this.prevLatestStat=this.getLatestStat(),this.tempStats.length=0)}clearSamples(){this.samples.length=0}getLatestStat(){return this.tempStats[this.tempStats.length-1]}getFirstStat(){return this.tempStats[0]}calculateSum(e){if("number"==typeof this.getLatestStat()[e])return this.tempStats.reduce((t,i)=>t+(i[e]||0),0)}calculateAverage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.calculateSum(e),n=void 0!==i?i/this.tempStats.length:void 0;return n?t?Math.round(n):n:void 0}calculateDifferenceForSample(e){var t;let i=Number(null==(t=this.prevLatestStat)?void 0:t[e])||0;return(Number(this.getLatestStat()[e])||0)-i}calculateDifferenceAverage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.calculateDifferenceForSample(e)/this.tempStats.length;return t?Math.round(i):i}calculateInstancesOfHigh(e,t){if("number"==typeof this.getLatestStat()[e])return this.tempStats.reduce((i,n)=>i+((n[e]||0)>t?1:0),0)}},Wo=(e,t)=>e&&t&&(e.frameWidth!==t.frameWidth||e.frameHeight!==t.frameHeight),Ho=(e,t)=>e&&t&&e.enabled!==t.enabled,qo=e=>Object.entries(e).filter(e=>{let[,t]=e;return void 0!==t}).reduce((e,t)=>{let[i,n]=t;return e[i]=n,e},{}),Ko=class extends Vo{constructor(){super(...arguments),this.trackAnalytics=new Map}toAnalytics(){var e,t;let i=[],n=[];return this.trackAnalytics.forEach(e=>{"audio"===e.track.type?i.push(e.toAnalytics()):"video"===e.track.type&&n.push(e.toAnalytics())}),{audio:i,video:n,joined_at:null==(t=null==(e=this.store.getRoom())?void 0:e.joinedAt)?void 0:t.getTime(),sequence_num:this.sequenceNum++,max_window_sec:30}}sendEvent(){this.eventBus.analytics.publish(Ji.publishStats(this.toAnalytics())),super.sendEvent()}handleStatsUpdate(e){let t=!1,i=e.getLocalTrackStats();Object.keys(i).forEach(n=>{let r=i[n],s=this.store.getLocalPeerTracks().find(e=>e.getTrackIDBeingSent()===n);Object.keys(r).forEach(i=>{var n,a,o;let l=r[i];if(!s)return;let c=this.getTrackIdentifier(s.trackId,l),u=Ht(Wt({},l),{availableOutgoingBitrate:null==(a=null==(n=e.getLocalPeerStats())?void 0:n.publish)?void 0:a.availableOutgoingBitrate});if(c&&this.trackAnalytics.has(c))null==(o=this.trackAnalytics.get(c))||o.pushTempStat(u);else if(s){let e=new Jo({track:s,sampleWindowSize:this.sampleWindowSize,rid:l.rid,ssrc:l.ssrc.toString(),kind:l.kind});e.pushTempStat(u),this.trackAnalytics.set(this.getTrackIdentifier(s.trackId,l),e)}let d=this.trackAnalytics.get(c);null!=d&&d.shouldCreateSample()&&(t=!0)})}),this.cleanTrackAnalyticsAndCreateSample(t)}getTrackIdentifier(e,t){return t.rid?"".concat(e,":").concat(t.rid):e}},Jo=class extends zo{constructor(){super(...arguments),this.samples=[],this.collateSample=()=>{let e=this.getLatestStat(),t=e.qualityLimitationDurations,i=t&&{bandwidth_sec:t.bandwidth,cpu_sec:t.cpu,other_sec:t.other},n=e.frameHeight?{height_px:this.getLatestStat().frameHeight,width_px:this.getLatestStat().frameWidth}:void 0,r=this.calculateAverage("jitter",!1),s=r?Math.round(1e3*r):void 0,a=this.calculateAverage("roundTripTime",!1),o=a?Math.round(1e3*a):void 0;return qo({timestamp:Date.now(),avg_available_outgoing_bitrate_bps:this.calculateAverage("availableOutgoingBitrate"),avg_bitrate_bps:this.calculateAverage("bitrate"),avg_fps:this.calculateAverage("framesPerSecond"),total_packets_lost:this.getLatestStat().packetsLost,total_packets_sent:this.getLatestStat().packetsSent,total_packet_sent_delay_sec:parseFloat(this.calculateDifferenceForSample("totalPacketSendDelay").toFixed(4)),total_fir_count:this.calculateDifferenceForSample("firCount"),total_pli_count:this.calculateDifferenceForSample("pliCount"),total_nack_count:this.calculateDifferenceForSample("nackCount"),avg_jitter_ms:s,avg_round_trip_time_ms:o,total_quality_limitation:i,resolution:n})},this.shouldCreateSample=()=>{let e=this.tempStats.length,t=this.tempStats[e-1],i=this.tempStats[e-2];return 30===e||Ho(t,i)||"video"===t.kind&&Wo(t,i)},this.toAnalytics=()=>({track_id:this.track_id,ssrc:this.ssrc,source:this.source,rid:this.rid,samples:this.samples})}},Qo=class extends Vo{constructor(){super(...arguments),this.trackAnalytics=new Map}toAnalytics(){var e,t;let i=[],n=[];return this.trackAnalytics.forEach(e=>{"audio"===e.track.type?i.push(e.toAnalytics()):"video"===e.track.type&&n.push(e.toAnalytics())}),{audio:i,video:n,joined_at:null==(t=null==(e=this.store.getRoom())?void 0:e.joinedAt)?void 0:t.getTime(),sequence_num:this.sequenceNum++,max_window_sec:10}}sendEvent(){this.eventBus.analytics.publish(Ji.subscribeStats(this.toAnalytics())),super.sendEvent()}handleStatsUpdate(e){let t=e.getAllRemoteTracksStats(),i=!1;Object.keys(t).forEach(n=>{var r,s;let a=this.store.getTrackById(n),o=t[n],l=((e,t)=>{let i=(null==t?void 0:t.jitterBufferDelay)||0,n=(null==t?void 0:t.jitterBufferEmittedCount)||0,r=((null==e?void 0:e.jitterBufferDelay)||0)-i,s=((null==e?void 0:e.jitterBufferEmittedCount)||0)-n;return s>0?1e3*r/s:(null==t?void 0:t.calculatedJitterBufferDelay)||0})(o,null==(r=this.trackAnalytics.get(n))?void 0:r.getLatestStat()),c=this.calculateAvSyncForStat(o,e),u=Ht(Wt({},o),{calculatedJitterBufferDelay:l,avSync:c});if("video"===o.kind){let e=a.getPreferredLayerDefinition();u.expectedFrameHeight=null==e?void 0:e.resolution.height,u.expectedFrameWidth=null==e?void 0:e.resolution.width}if(this.trackAnalytics.has(n))null==(s=this.trackAnalytics.get(n))||s.pushTempStat(u);else if(a){let e=new Yo({track:a,sampleWindowSize:this.sampleWindowSize,ssrc:o.ssrc.toString(),kind:o.kind});e.pushTempStat(u),this.trackAnalytics.set(n,e)}let d=this.trackAnalytics.get(n);null!=d&&d.shouldCreateSample()&&(i=!0)}),this.cleanTrackAnalyticsAndCreateSample(i)}calculateAvSyncForStat(e,t){if(!e.peerID||!e.estimatedPlayoutTimestamp||"video"!==e.kind)return;let i=this.store.getPeerById(e.peerID),n=null==i?void 0:i.audioTrack,r=null==i?void 0:i.videoTrack;if(!(n&&r&&n.enabled&&r.enabled))return cr;let s=t.getRemoteTrackStats(n.trackId);return s?s.estimatedPlayoutTimestamp?s.estimatedPlayoutTimestamp-e.estimatedPlayoutTimestamp:void 0:cr}},Yo=class extends zo{constructor(){super(...arguments),this.samples=[],this.collateSample=()=>{let e=this.getLatestStat(),t=this.getFirstStat(),i={timestamp:Date.now(),total_pli_count:this.calculateDifferenceForSample("pliCount"),total_nack_count:this.calculateDifferenceForSample("nackCount"),avg_jitter_buffer_delay:this.calculateAverage("calculatedJitterBufferDelay",!1)};if("video"===e.kind)return qo(Ht(Wt({},i),{avg_av_sync_ms:this.calculateAvgAvSyncForSample(),avg_frames_received_per_sec:this.calculateDifferenceAverage("framesReceived"),avg_frames_dropped_per_sec:this.calculateDifferenceAverage("framesDropped"),avg_frames_decoded_per_sec:this.calculateDifferenceAverage("framesDecoded"),frame_width:this.calculateAverage("frameWidth"),frame_height:this.calculateAverage("frameHeight"),expected_frame_width:this.calculateAverage("expectedFrameWidth"),expected_frame_height:this.calculateAverage("expectedFrameHeight"),pause_count:this.calculateDifferenceForSample("pauseCount"),pause_duration_seconds:this.calculateDifferenceForSample("totalPausesDuration"),freeze_count:this.calculateDifferenceForSample("freezeCount"),freeze_duration_seconds:this.calculateDifferenceForSample("totalFreezesDuration")}));{let n=(e.concealedSamples||0)-(e.silentConcealedSamples||0)-((t.concealedSamples||0)-(t.silentConcealedSamples||0));return qo(Ht(Wt({},i),{audio_level:this.calculateInstancesOfHigh("audioLevel",.05),audio_concealed_samples:n,audio_total_samples_received:this.calculateDifferenceForSample("totalSamplesReceived"),audio_concealment_events:this.calculateDifferenceForSample("concealmentEvents"),fec_packets_discarded:this.calculateDifferenceForSample("fecPacketsDiscarded"),fec_packets_received:this.calculateDifferenceForSample("fecPacketsReceived"),total_samples_duration:this.calculateDifferenceForSample("totalSamplesDuration"),total_packets_received:this.calculateDifferenceForSample("packetsReceived"),total_packets_lost:this.calculateDifferenceForSample("packetsLost")}))}},this.shouldCreateSample=()=>{let e=this.tempStats.length,t=this.tempStats[e-1],i=this.tempStats[e-2];return 10===e||Ho(t,i)||"video"===t.kind&&Wo(t,i)},this.toAnalytics=()=>({track_id:this.track_id,ssrc:this.ssrc,source:this.source,rid:this.rid,samples:this.samples})}calculateAvgAvSyncForSample(){let e=this.tempStats.map(e=>e.avSync).filter(e=>void 0!==e&&e!==cr);return 0===e.length?cr:e.reduce((e,t)=>e+t,0)/e.length}},$o=(e=>(e[e.Publish=0]="Publish",e[e.Subscribe=1]="Subscribe",e))($o||{});var Xo="[HMSConnection]",Zo=class{constructor(e,t){this.candidates=new Array,this.role=e,this.signal=t}get iceConnectionState(){return this.nativeConnection.iceConnectionState}get connectionState(){return this.nativeConnection.connectionState}get action(){return 0===this.role?"PUBLISH":"SUBSCRIBE"}setSfuNodeId(e){this.sfuNodeId=e}addTransceiver(e,t){return this.nativeConnection.addTransceiver(e,t)}createOffer(e,t){return Jt(this,null,function*(){try{let i=yield this.nativeConnection.createOffer(t);return fi.d(Xo,"[role=".concat(this.role,"] createOffer offer=").concat(JSON.stringify(i,null,1))),function(e){return e.sdp.includes("usedtx=1")?e:{type:e.type,sdp:e.sdp.replace("useinbandfec=1","useinbandfec=1;usedtx=1")}}(function(e,t){var i;let n=Nt.qg(e.sdp);if(null==(i=n.origin)||!i.username.startsWith("mozilla"))return e;let r=t?Array.from(t.values()):[];return n.media.forEach(e=>{var t,i,n;let s=null==(t=e.msid)?void 0:t.split(" ")[0],a=null==(i=r.find(t=>t.type===e.type&&t.stream_id===s))?void 0:i.track_id;a&&(e.msid=null==(n=e.msid)?void 0:n.replace(/\s(.+)/," ".concat(a)))}),{type:e.type,sdp:Nt.M9(n)}}(i,e))}catch(E){throw Oi.WebrtcErrors.CreateOfferFailed(this.action,E.message)}})}createAnswer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return Jt(this,null,function*(){try{let t=yield this.nativeConnection.createAnswer(e);return fi.d(Xo,"[role=".concat(this.role,"] createAnswer answer=").concat(JSON.stringify(t,null,1))),t}catch(xe){throw Oi.WebrtcErrors.CreateAnswerFailed(this.action,xe.message)}})}setLocalDescription(e){return Jt(this,null,function*(){try{fi.d(Xo,"[role=".concat(this.role,"] setLocalDescription description=").concat(JSON.stringify(e,null,1))),yield this.nativeConnection.setLocalDescription(e)}catch(xe){throw Oi.WebrtcErrors.SetLocalDescriptionFailed(this.action,xe.message)}})}setRemoteDescription(e){return Jt(this,null,function*(){try{fi.d(Xo,"[role=".concat(this.role,"] setRemoteDescription description=").concat(JSON.stringify(e,null,1))),yield this.nativeConnection.setRemoteDescription(e)}catch(xe){throw Oi.WebrtcErrors.SetRemoteDescriptionFailed(this.action,xe.message)}})}addIceCandidate(e){return Jt(this,null,function*(){"closed"!==this.nativeConnection.signalingState?(fi.d(Xo,"[role=".concat(this.role,"] addIceCandidate candidate=").concat(JSON.stringify(e,null,1))),yield this.nativeConnection.addIceCandidate(e)):fi.d(Xo,"[role=".concat(this.role,"] addIceCandidate signalling state closed"))})}get remoteDescription(){return this.nativeConnection.remoteDescription}getSenders(){return this.nativeConnection.getSenders()}handleSelectedIceCandidatePairs(){try{(0===this.role?this.getSenders():this.getReceivers()).forEach(e=>{var t;let i=null==(t=e.track)?void 0:t.kind;if(e.transport){let t=e.transport.iceTransport,n=()=>{"function"==typeof t.getSelectedCandidatePair&&(this.selectedCandidatePair=t.getSelectedCandidatePair(),this.selectedCandidatePair&&(this.observer.onSelectedCandidatePairChange(this.selectedCandidatePair),fi.d(Xo,"".concat($o[this.role]," connection"),"selected ".concat(i||"unknown"," candidate pair"),JSON.stringify(this.selectedCandidatePair,null,2))))};"function"==typeof t.onselectedcandidatepairchange&&(t.onselectedcandidatepairchange=n),n()}})}catch(e){fi.w(Xo,"Error in logging selected ice candidate pair for ".concat($o[this.role]," connection"),e)}}removeTrack(e){"closed"!==this.nativeConnection.signalingState&&this.nativeConnection.removeTrack(e)}setMaxBitrateAndFramerate(e,t){return Jt(this,null,function*(){let i=(null==t?void 0:t.maxBitrate)||e.settings.maxBitrate,n=e instanceof sr&&e.settings.maxFramerate,r=this.getSenders().find(t=>{var i;return(null==(i=null==t?void 0:t.track)?void 0:i.id)===e.getTrackIDBeingSent()});if(r){let e=r.getParameters();1===e.encodings.length&&(i&&(e.encodings[0].maxBitrate=1e3*i),n&&(e.encodings[0].maxFramerate=n)),yield r.setParameters(e)}else fi.w(Xo,"no sender found to setMaxBitrate for track - ".concat(e.trackId,", sentTrackId - ").concat(e.getTrackIDBeingSent()))})}getStats(){return Jt(this,null,function*(){return yield this.nativeConnection.getStats()})}close(){this.nativeConnection.close()}getReceivers(){return this.nativeConnection.getReceivers()}},el=class extends Zo{constructor(e,t,i){super(0,e),this.TAG="[HMSPublishConnection]",this.observer=i,this.nativeConnection=new RTCPeerConnection(t),this.channel=this.nativeConnection.createDataChannel(or,{protocol:"SCTP"}),this.channel.onerror=e=>fi.e(this.TAG,"publish data channel onerror ".concat(e),e),this.nativeConnection.onicecandidate=t=>{let{candidate:i}=t;i&&(this.observer.onIceCandidate(i),e.trickle(this.role,i))},this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState),this.nativeConnection.sctp&&(this.nativeConnection.sctp.transport.onstatechange=()=>{var e;this.observer.onDTLSTransportStateChange(null==(e=this.nativeConnection.sctp)?void 0:e.transport.state)},this.nativeConnection.sctp.transport.onerror=e=>{var t;this.observer.onDTLSTransportError(new Error(null==(t=null==e?void 0:e.error)?void 0:t.errorDetail)||"DTLS Transport failed")})}}close(){super.close(),this.channel.close()}initAfterJoin(){this.nativeConnection.onnegotiationneeded=()=>Jt(this,null,function*(){fi.d(this.TAG,"onnegotiationneeded"),yield this.observer.onRenegotiationNeeded()})}},tl=class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.TAG="[HMSDataChannel]",this.nativeChannel=e,this.observer=t,this.metadata=i,e.onmessage=e=>{this.observer.onMessage(e.data)}}get id(){return this.nativeChannel.id}get label(){return this.nativeChannel.label}get readyState(){return this.nativeChannel.readyState}send(e){fi.d(this.TAG,"[".concat(this.metadata,"] Sending [size=").concat(e.length,"] message=").concat(e)),this.nativeChannel.send(e)}close(){this.nativeChannel.close()}},il=class extends Zo{constructor(e,t,i,n){super(1,e),this.isFlagEnabled=i,this.TAG="[HMSSubscribeConnection]",this.remoteStreams=new Map,this.MAX_RETRIES=3,this.pendingMessageQueue=[],this.eventEmitter=new(Me())({maxListeners:60}),this.handlePendingApiMessages=()=>{this.eventEmitter.emit("open",!0),this.pendingMessageQueue.length>0&&(fi.d(this.TAG,"Found pending message queue, sending messages"),this.pendingMessageQueue.forEach(e=>this.sendOverApiDataChannel(e)),this.pendingMessageQueue.length=0)},this.sendMessage=(e,t)=>Jt(this,null,function*(){var i;let n;"open"!==(null==(i=this.apiChannel)?void 0:i.readyState)&&(yield this.eventEmitter.waitFor("open"));for(let r=0;r<this.MAX_RETRIES;r++){this.apiChannel.send(e),n=yield this.waitForResponse(t);let i=n.error;if(!i)break;{if(404===i.code){fi.d(this.TAG,"Track not found ".concat(t),{request:e,try:r+1,error:i});break}if(fi.d(this.TAG,"Failed sending ".concat(t),{request:e,try:r+1,error:i}),i.code/100!==5&&429!==i.code)throw Error("code=".concat(i.code,", message=").concat(i.message));let n=1e3*(2+2*Math.random());yield mn(n)}}return n}),this.waitForResponse=e=>Jt(this,null,function*(){let t=yield this.eventEmitter.waitFor("message",function(t){return t.includes(e)}),i=JSON.parse(t[0]);return fi.d(this.TAG,"response for ".concat(e," -"),JSON.stringify(i,null,2)),i}),this.observer=n,this.nativeConnection=new RTCPeerConnection(t),this.initNativeConnectionCallbacks()}initNativeConnectionCallbacks(){this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)},this.nativeConnection.ondatachannel=e=>{e.channel.label===or&&(this.apiChannel=new tl(e.channel,{onMessage:e=>{this.eventEmitter.emit("message",e),this.observer.onApiChannelMessage(e)}},"role=".concat(this.role)),e.channel.onopen=this.handlePendingApiMessages)},this.nativeConnection.onicecandidate=e=>{null!==e.candidate&&(this.observer.onIceCandidate(e.candidate),this.signal.trickle(this.role,e.candidate))},this.nativeConnection.ontrack=e=>{var t;let i=e.streams[0],n=i.id;if(!this.remoteStreams.has(n)){let e=new Nr(i,this);this.remoteStreams.set(n,e)}i.addEventListener("removetrack",t=>{if(t.track.id!==e.track.id)return;let i=r.tracks.findIndex(i=>{var n;return i.nativeTrack.id===t.track.id&&e.transceiver.mid===(null==(n=i.transceiver)?void 0:n.mid)});if(i>=0){let e=r.tracks[i];this.observer.onTrackRemove(e),r.tracks.splice(i,1),0===r.tracks.length&&this.remoteStreams.delete(n)}});let r=this.remoteStreams.get(n),s="audio"===e.track.kind,a=s?jn:Lr,o=s?new a(r,e.track):new a(r,e.track,void 0,this.isFlagEnabled("disableNoneLayerRequest"));"video"===e.track.kind&&r.setVideoLayerLocally("none","addTrack","subscribeConnection"),o.transceiver=e.transceiver;let l=function(e,t){var i;if(null==e||!e.sdp||!t)return;let n=Nt.qg(e.sdp).media.find(e=>Bi(e.mid)&&parseInt(e.mid)===parseInt(t));return null==(i=null==n?void 0:n.msid)?void 0:i.split(" ")[1]}(this.remoteDescription,null==(t=e.transceiver)?void 0:t.mid);l&&o.setSdpTrackId(l),r.tracks.push(o),this.observer.onTrackAdd(o)}}sendOverApiDataChannel(e){this.apiChannel&&"open"===this.apiChannel.readyState?this.apiChannel.send(e):(fi.w(this.TAG,"API Data channel not ".concat(this.apiChannel?"open":"present",", queueing"),e),this.pendingMessageQueue.push(e))}sendOverApiDataChannelWithResponse(e,t){return Jt(this,null,function*(){let i=C();if("prefer-video-track-state"===e.method&&this.isFlagEnabled("disableVideoTrackAutoUnsubscribe")&&"none"===e.params.max_spatial_layer)return fi.d(this.TAG,"video auto unsubscribe is disabled, request is ignored"),{id:i};let n=JSON.stringify(Wt({id:t||i,jsonrpc:"2.0"},e));return this.sendMessage(n,i)})}close(){var e;super.close(),null==(e=this.apiChannel)||e.close()}},nl=(e,t)=>t&&0!==t.length?t.map(e=>({urls:e.urls,credentialType:"password",credential:e.password,username:e.userName})):e,rl="[InitService]",sl=class{static handleError(e,t){switch(e.status){case 404:throw Oi.APIErrors.EndpointUnreachable("INIT",t.message||e.statusText);case 200:break;default:throw Oi.APIErrors.ServerErrors(t.code||e.status,"INIT",t.message||(null==e?void 0:e.statusText))}}static fetchInitConfig(e){return Jt(this,arguments,function(e){var t=this;let{token:i,peerId:n,userAgent:r,initEndpoint:s="https://prod-init.100ms.live",region:a="",iceServers:o}=e;return function*(){fi.d(rl,"fetchInitConfig: initEndpoint=".concat(s," token=").concat(i," peerId=").concat(n," region=").concat(a," "));let e=function(e,t,i,n){try{let r=new URL("/init",e);return n&&n.trim().length>0&&r.searchParams.set("region",n.trim()),r.searchParams.set("peer_id",t),r.searchParams.set("user_agent_v2",i),r.toString()}catch(s){let t=s;throw fi.e(rl,t.name,t.message),t}}(s,n,r,a);try{let n=yield fetch(e,{headers:{Authorization:"Bearer ".concat(i)}});try{let e=yield n.clone().json();return t.handleError(n,e),fi.d(rl,"config is ".concat(JSON.stringify(e,null,2))),function(e,t){var i;return Ht(Wt({},e),{rtcConfiguration:Ht(Wt({},e.rtcConfiguration),{iceServers:nl(null==(i=e.rtcConfiguration)?void 0:i.ice_servers,t)})})}(e,o)}catch(He){let t=yield n.text();throw fi.e(rl,"json error",He.message,t),He instanceof Ri?He:Oi.APIErrors.ServerErrors(n.status,"INIT",He.message)}}catch(l){let e=l;throw["Failed to fetch","NetworkError","ECONNRESET"].some(t=>e.message.includes(t))?Oi.APIErrors.EndpointUnreachable("INIT",e.message):e}}()})}};var al=class{constructor(e){this.TAG="[SIGNAL]: ",this.pongResponseTimes=new fn(5),this.isJoinCompleted=!1,this.pendingTrickle=[],this.socket=null,this.callbacks=new Map,this._isConnected=!1,this.id=0,this.onCloseHandler=()=>{},this.resolvePingOnAnyResponse=()=>{this.callbacks.forEach((e,t)=>{var i;"ping"===(null==(i=e.metadata)?void 0:i.method)&&(e.resolve({timestamp:Date.now()}),this.callbacks.delete(t))})},this.offlineListener=()=>{fi.d(this.TAG,"Window network offline"),this.setIsConnected(!1,"Window network offline")},this.onlineListener=()=>{fi.d(this.TAG,"Window network online"),this.observer.onNetworkOnline()},this.observer=e,window.addEventListener("offline",this.offlineListener),window.addEventListener("online",this.onlineListener),this.onMessageHandler=this.onMessageHandler.bind(this)}get isConnected(){return this._isConnected}setSfuNodeId(e){this.sfuNodeId=e}setIsConnected(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";fi.d(this.TAG,"isConnected set id: ".concat(this.id,", oldValue: ").concat(this._isConnected,", newValue: ").concat(e)),this._isConnected!==e&&(this._isConnected&&!e?(this._isConnected=e,this.rejectPendingCalls(t),this.observer.onOffline(t)):!this._isConnected&&e&&(this._isConnected=e,this.observer.onOnline()))}getPongResponseTimes(){return this.pongResponseTimes.toList()}internalCall(e,t){return Jt(this,null,function*(){var i;let n=C(),r={method:e,params:t,id:n,jsonrpc:"2.0"};null==(i=this.socket)||i.send(JSON.stringify(r));try{return yield new Promise((t,i)=>{this.callbacks.set(n,{resolve:t,reject:i,metadata:{method:e}})})}catch(Fe){if(Fe instanceof Ri)throw Fe;let i=Fe;throw Oi.WebsocketMethodErrors.ServerErrors(Number(i.code),Mi(e),i.message)}})}notify(e,t){var i,n;let r={method:e,params:t};(null==(i=this.socket)?void 0:i.readyState)===WebSocket.OPEN&&(null==(n=this.socket)||n.send(JSON.stringify(r)))}open(e){return new Promise((t,i)=>{let n=!1;this.socket&&(this.socket.close(),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)),this.socket=new WebSocket(e);let r=()=>{fi.e(this.TAG,"Error from websocket"),n=!0,i(Oi.WebSocketConnectionErrors.FailedToConnect("JOIN","Error opening websocket connection"))};this.onCloseHandler=e=>{fi.w("Websocket closed code=".concat(e.code)),n?this.setIsConnected(!1,"code: ".concat(e.code).concat(1e3!==e.code?", unexpected websocket close":"")):(n=!0,i(Oi.WebSocketConnectionErrors.AbnormalClose("JOIN","Error opening websocket connection - websocket closed unexpectedly with code=".concat(e.code))))},this.socket.addEventListener("error",r);let s=()=>{var e,i;n=!0,t(),this.setIsConnected(!0),this.id++,null==(e=this.socket)||e.removeEventListener("open",s),null==(i=this.socket)||i.removeEventListener("error",r),this.pingPongLoop(this.id)};this.socket.addEventListener("open",s),this.socket.addEventListener("close",this.onCloseHandler),this.socket.addEventListener("message",this.onMessageHandler)})}close(){return Jt(this,null,function*(){window.removeEventListener("offline",this.offlineListener),window.removeEventListener("online",this.onlineListener),this.socket?(this.socket.close(1e3,"Normal Close"),this.setIsConnected(!1,"code: 1000, normal websocket close"),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)):this.setIsConnected(!1,"websocket not connected yet")})}join(e,t,i,n,r,s,a){return Jt(this,null,function*(){if(!this.isConnected)throw Oi.WebSocketConnectionErrors.WebSocketConnectionLost("JOIN","Failed to send join over WS connection");let o={name:e,disableVidAutoSub:i,data:t,offer:a,server_sub_degrade:n,simulcast:r,onDemandTracks:s},l=yield this.internalCall("join",o);return this.isJoinCompleted=!0,this.pendingTrickle.forEach(e=>{let{target:t,candidate:i}=e;return this.trickle(t,i)}),this.pendingTrickle.length=0,fi.d(this.TAG,"join: response=".concat(JSON.stringify(l,null,1))),l})}trickle(e,t){this.isJoinCompleted?this.notify("trickle",{target:e,candidate:t,sfu_node_id:this.sfuNodeId}):this.pendingTrickle.push({target:e,candidate:t})}offer(e,t){return Jt(this,null,function*(){return yield this.call("offer",{desc:e,tracks:Object.fromEntries(t),sfu_node_id:this.sfuNodeId})})}answer(e){this.notify("answer",{desc:e,sfu_node_id:this.sfuNodeId})}trackUpdate(e){this.notify("track-update",{tracks:Object.fromEntries(e)})}broadcast(e){return Jt(this,null,function*(){return yield this.call("broadcast",e)})}leave(e){this.notify("leave",{client_reason:e})}endRoom(e,t){return Jt(this,null,function*(){yield this.call("end-room",{lock:e,reason:t})})}sendEvent(e){if(!this.isConnected)throw Error("".concat(this.TAG," not connected. Could not send event ").concat(e));this.notify("analytics",e.toSignalParams())}ping(e){let t=Date.now(),i=new Promise(i=>{setTimeout(()=>{i(Date.now()-t)},e+1)}),n=this.internalCall("ping",{timestamp:t}).then(()=>Date.now()-t).catch(()=>Date.now()-t);return Promise.race([i,n])}requestRoleChange(e){return Jt(this,null,function*(){yield this.call("role-change-request",e)})}requestBulkRoleChange(e){return Jt(this,null,function*(){yield this.call("role-change-request",e)})}acceptRoleChangeRequest(e){return Jt(this,null,function*(){yield this.call("role-change",e)})}requestTrackStateChange(e){return Jt(this,null,function*(){yield this.call("track-update-request",e)})}requestMultiTrackStateChange(e){return Jt(this,null,function*(){yield this.call("change-track-mute-state-request",e)})}removePeer(e){return Jt(this,null,function*(){yield this.call("peer-leave-request",e)})}startRTMPOrRecording(e){return Jt(this,null,function*(){yield this.call("rtmp-start",Wt({},e))})}stopRTMPAndRecording(){return Jt(this,null,function*(){yield this.call("rtmp-stop",{})})}startHLSStreaming(e){return Jt(this,null,function*(){yield this.call("hls-start",Wt({},e))})}stopHLSStreaming(e){return Jt(this,null,function*(){yield this.call("hls-stop",Wt({},e))})}startTranscription(e){return Jt(this,null,function*(){yield this.call("transcription-start",Wt({},e))})}stopTranscription(e){return Jt(this,null,function*(){yield this.call("transcription-stop",Wt({},e))})}sendHLSTimedMetadata(e){return Jt(this,null,function*(){yield this.call("hls-timed-metadata",Wt({},e))})}updatePeer(e){return Jt(this,null,function*(){yield this.call("peer-update",Wt({},e))})}getPeer(e){return Jt(this,null,function*(){return yield this.call("get-peer",Wt({},e))})}joinGroup(e){return Jt(this,null,function*(){return yield this.call("group-join",{name:e})})}leaveGroup(e){return Jt(this,null,function*(){return yield this.call("group-leave",{name:e})})}addToGroup(e,t){return Jt(this,null,function*(){yield this.call("group-add",{name:t,peer_id:e})})}removeFromGroup(e,t){return Jt(this,null,function*(){yield this.call("group-remove",{name:t,peer_id:e})})}peerIterNext(e){return Jt(this,null,function*(){return yield this.call("peer-iter-next",e)})}findPeers(e){return Jt(this,null,function*(){return yield this.call("find-peer",e)})}findPeerByName(e){return Jt(this,null,function*(){return yield this.call("peer-name-search",e)})}setSessionMetadata(e){if(!this.isConnected)throw Oi.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to set session store value due to network disconnection");return this.call("set-metadata",Wt({},e))}listenMetadataChange(e){if(!this.isConnected)throw Oi.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to observe session store key due to network disconnection");return this.call("listen-metadata-change",{keys:e})}getSessionMetadata(e){if(!this.isConnected)throw Oi.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to set session store value due to network disconnection");return this.call("get-metadata",{key:e})}setPollInfo(e){return this.call("poll-info-set",Wt({},e))}getPollInfo(e){return this.call("poll-info-get",Wt({},e))}setPollQuestions(e){return this.call("poll-questions-set",Wt({},e))}startPoll(e){return this.call("poll-start",Wt({},e))}stopPoll(e){return this.call("poll-stop",Wt({},e))}getPollQuestions(e){return this.call("poll-questions-get",Wt({},e))}setPollResponses(e){return this.call("poll-response",Wt({},e))}getPollResponses(e){return this.call("poll-responses",Wt({},e))}getPollsList(e){return this.call("poll-list",Wt({},e))}getPollResult(e){return this.call("poll-result",Wt({},e))}createWhiteboard(e){return this.validateConnection(),this.call("whiteboard-create",Wt({},e))}getWhiteboard(e){return this.validateConnection(),this.call("whiteboard-get",Wt({},e))}fetchPollLeaderboard(e){return this.call("poll-leaderboard",Wt({},e))}validateConnection(){if(!this.isConnected)throw Oi.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL","Failed to send message due to network disconnection")}onMessageHandler(e){let t=e.data,i=JSON.parse(t);if(this.resolvePingOnAnyResponse(),i.id)this.handleResponseWithId(i);else{if(!i.method)throw Error("WebSocket message has no 'method' or 'id' field, message=".concat(i));this.handleResponseWithMethod(i)}}handleResponseWithId(e){let t=e,i=t.id;if(this.callbacks.has(i)){let e=this.callbacks.get(i);this.callbacks.delete(i),t.result?e.resolve(t.result):e.reject(t.error)}else this.observer.onNotification(t)}handleResponseWithMethod(e){switch(e.method){case"offer":this.observer.onOffer(e.params);break;case"trickle":this.observer.onTrickle(e.params);break;case"on-error":this.observer.onServerError(Oi.WebsocketMethodErrors.ServerErrors(Number(e.params.code),"on-error",e.params.message));break;case"on-warning":fi.w(this.TAG,e.params);break;default:this.observer.onNotification(e)}}rejectPendingCalls(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.callbacks.forEach((t,i)=>{var n,r,s,a;"ping"!==(null==(n=t.metadata)?void 0:n.method)&&(fi.e(this.TAG,"rejecting pending callback ".concat(null==(r=t.metadata)?void 0:r.method,", id=").concat(i)),t.reject(Oi.WebSocketConnectionErrors.WebSocketConnectionLost(null!=(s=t.metadata)&&s.method?Mi(null==(a=t.metadata)?void 0:a.method):"RECONNECT_SIGNAL",e)),this.callbacks.delete(i))})}pingPongLoop(e){return Jt(this,null,function*(){var t,i;let n=(null==(t=window.HMS)?void 0:t.PING_TIMEOUT)||12e3;if(this.isConnected){let t=yield this.ping(n);this.pongResponseTimes.enqueue(t),t>n?(fi.d(this.TAG,"Pong timeout ".concat(e,", pageHidden=").concat("undefined"!=typeof document&&document.hidden)),this.id===e&&this.setIsConnected(!1,"ping pong failure")):setTimeout(()=>this.pingPongLoop(e),(null==(i=window.HMS)?void 0:i.PING_INTERVAL)||3e3)}})}call(e,t){return Jt(this,null,function*(){let i,n=Oi.WebsocketMethodErrors.ServerErrors(500,e,"Default ".concat(e," error"));for(i=1;i<=3;i++)try{return this.validateConnection(),fi.d(this.TAG,"Try number ".concat(i," sending ").concat(e),t),yield this.internalCall(e,t)}catch(Fe){if(n=Fe,fi.e(this.TAG,"Failed sending ".concat(e," try: ").concat(i),{method:e,params:t,error:n}),5!==parseInt("".concat(n.code/100))&&429!==n.code&&1003!==n.code)break;let s=1e3*(2+2*Math.random());yield mn(s)}throw fi.e("Sending ".concat(e," over WS failed after ").concat(Math.min(i,3)," retries"),{method:e,params:t,error:n}),n})}},ol="[HMSTransport]:",ll=class{constructor(e,t,i,n,r,s,a){this.observer=e,this.deviceManager=t,this.store=i,this.eventBus=n,this.analyticsEventsService=r,this.analyticsTimer=s,this.pluginUsageTracker=a,this.state="Disconnected",this.trackStates=new Map,this.publishConnection=null,this.subscribeConnection=null,this.maxSubscribeBitrate=0,this.joinRetryCount=0,this.publishDisconnectTimer=0,this.onScreenshareStop=()=>{},this.screenStream=new Set,this.callbacks=new Map,this.setListener=e=>{this.listener=e},this.setOnScreenshareStop=e=>{this.onScreenshareStop=e},this.signalObserver={onOffer:e=>Jt(this,null,function*(){try{if(!this.subscribeConnection)return;if(e.sfu_node_id&&this.subscribeConnection.sfuNodeId&&this.subscribeConnection.sfuNodeId!==e.sfu_node_id)return void fi.d(ol,"ignoring old offer");yield this.subscribeConnection.setRemoteDescription(e),fi.d(ol,"[SUBSCRIBE] Adding ".concat(this.subscribeConnection.candidates.length," ice-candidates"),this.subscribeConnection.candidates);for(let e of this.subscribeConnection.candidates)yield this.subscribeConnection.addIceCandidate(e);this.subscribeConnection.candidates.length=0;let t=yield this.subscribeConnection.createAnswer();yield this.subscribeConnection.setLocalDescription(t),this.signal.answer(t),fi.d(ol,"[role=SUBSCRIBE] onOffer renegotiation DONE \u2705")}catch(t){let i;fi.d(ol,"[role=SUBSCRIBE] onOffer renegotiation FAILED \u274c",t),this.state="Failed",i=t instanceof Ri?t:Oi.GenericErrors.Unknown("SUBSCRIBE",t.message),this.observer.onFailure(i),this.eventBus.analytics.publish(Ji.subscribeFail(i))}}),onTrickle:e=>Jt(this,null,function*(){let t=0===e.target?this.publishConnection:this.subscribeConnection;null!=t&&t.remoteDescription?yield t.addIceCandidate(e.candidate):null==t||t.candidates.push(e.candidate)}),onNotification:e=>this.observer.onNotification(e),onServerError:e=>Jt(this,null,function*(){yield this.observer.onStateChange("Failed",e)}),onFailure:e=>{this.joinParameters&&this.retryScheduler.schedule({category:1,error:e,task:this.retrySignalDisconnectTask,originalState:this.state})},onOffline:e=>Jt(this,null,function*(){fi.d(ol,"socket offline",xo[this.state]);try{"Leaving"!==this.state&&this.joinParameters&&this.retryScheduler.schedule({category:1,error:Oi.WebSocketConnectionErrors.WebSocketConnectionLost("RECONNECT_SIGNAL",e),task:this.retrySignalDisconnectTask,originalState:this.state})}catch(t){console.error(t)}}),onOnline:()=>{var e;fi.d(ol,"socket online",xo[this.state]),this.analyticsSignalTransport.flushFailedEvents(null==(e=this.store.getLocalPeer())?void 0:e.peerId)},onNetworkOnline:()=>{this.analyticsEventsService.flushFailedClientEvents()}},this.signal=new al(this.signalObserver),this.analyticsSignalTransport=new Go(this.signal),this.publishDtlsStateTimer=0,this.lastPublishDtlsState="new",this.handleLocalRoleUpdate=e=>Jt(this,[e],function(e){var t=this;let{oldRole:i,newRole:n}=e;return function*(){!t.doesRoleNeedWebRTC(i)&&t.doesRoleNeedWebRTC(n)&&(fi.d(ol,"Local peer role updated to webrtc role, creating PeerConnections and performing inital publish negotiation \u23f3"),t.createPeerConnections(),yield t.negotiateOnFirstPublish())}()}),this.retryPublishIceFailedTask=()=>Jt(this,null,function*(){if(this.publishConnection){let e=new Promise((e,t)=>{this.callbacks.set(ar,{promise:{resolve:e,reject:t},action:"RESTART_ICE",extra:{}})});yield this.performPublishRenegotiation({iceRestart:"connected"!==this.publishConnection.connectionState}),yield e}return!0}),this.retrySubscribeIceFailedTask=()=>Jt(this,null,function*(){if(this.subscribeConnection&&"connected"!==this.subscribeConnection.connectionState){let e=new Promise((e,t)=>{this.callbacks.set(lr,{promise:{resolve:e,reject:t},action:"RESTART_ICE",extra:{}})}),t=new Promise(e=>{setTimeout(e,6e4,!1)});return Promise.race([e,t])}return!0}),this.retrySignalDisconnectTask=()=>Jt(this,null,function*(){var e;fi.d(ol,"retrySignalDisconnectTask",{signalConnected:this.signal.isConnected}),this.signal.isConnected||(yield this.internalConnect(this.joinParameters.authToken,this.joinParameters.endpoint,this.joinParameters.peerId,this.joinParameters.iceServers));let t=null!=(e=this.store.getRoom())&&e.joinedAt?this.signal.isConnected&&(yield this.retryPublishIceFailedTask()):this.signal.isConnected;return this.signal.trackUpdate(this.trackStates),t}),this.webrtcInternals=new Wr(this.store,this.eventBus);this.retryScheduler=new Fo((e,t)=>Jt(this,null,function*(){e!==this.state&&(this.state=e,yield this.observer.onStateChange(this.state,t))}),this.sendErrorAnalyticsEvent.bind(this)),this.eventBus.statsUpdate.subscribe(e=>{var t,i;let n=(null==(i=null==(t=e.getLocalPeerStats())?void 0:t.subscribe)?void 0:i.bitrate)||0;this.maxSubscribeBitrate=Math.max(this.maxSubscribeBitrate,n)}),this.eventBus.localAudioEnabled.subscribe(e=>{let{track:t,enabled:i}=e;return this.trackUpdate(t,i)}),this.eventBus.localVideoEnabled.subscribe(e=>{let{track:t,enabled:i}=e;return this.trackUpdate(t,i)})}getWebsocketEndpoint(){if(this.initConfig)return this.initConfig.endpoint}getWebrtcInternals(){return this.webrtcInternals}isFlagEnabled(e){var t;let i=null==(t=this.initConfig)?void 0:t.config;return((null==i?void 0:i.enabledFlags)||[]).includes(e)}setConnectivityListener(e){this.connectivityListener=e}preview(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;return Jt(this,null,function*(){let a=yield this.connect(e,t,i,n,r,s);return this.state="Preview",this.observer.onStateChange(this.state),a})}join(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;return Jt(this,null,function*(){fi.d(ol,"join: started \u23f0");try{(!this.signal.isConnected||!this.initConfig)&&(yield this.connect(e,n,t,i,r,s)),this.validateNotDisconnected("connect"),this.initConfig&&(yield this.waitForLocalRoleAvailability(),yield this.createConnectionsAndNegotiateJoin(i,r),this.initStatsAnalytics(),fi.d(ol,"\u2705 join: Negotiated over PUBLISH connection"))}catch(a){fi.e(ol,"join: failed \u274c [token=".concat(e,"]"),a),this.state="Failed";let t=a;throw t.isTerminal=t.isTerminal||500===t.code,yield this.observer.onStateChange(this.state,t),t}fi.d(ol,"\u2705 join: successful"),this.state="Joined",this.observer.onStateChange(this.state)})}connect(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;return Jt(this,null,function*(){this.setTransportStateForConnect(),this.joinParameters=new Mo(e,i,n.name,n.metaData,t,r,s);try{return yield this.internalConnect(e,t,i,s)}catch(a){if(!(a instanceof Ri&&([Ai.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,Ai.WebSocketConnectionErrors.FAILED_TO_CONNECT,Ai.WebSocketConnectionErrors.ABNORMAL_CLOSE,Ai.APIErrors.ENDPOINT_UNREACHABLE].includes(a.code)||a.code.toString().startsWith("5")||a.code.toString().startsWith("429"))))throw a;{let n=()=>Jt(this,null,function*(){return yield this.internalConnect(e,t,i,s),!(!this.initConfig||!this.initConfig.endpoint)});yield this.retryScheduler.schedule({category:0,error:a,task:n,originalState:this.state,changeState:!1})}}})}leave(e){return Jt(this,arguments,function(e){var t=this;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user request";return function*(){var n,r,s;t.retryScheduler.reset(),t.joinParameters=void 0,fi.d(ol,"leaving in transport");try{let a=t.pluginUsageTracker.getPluginUsage("HMSKrispPlugin");if(a&&t.eventBus.analytics.publish(Ji.getKrispUsage(a)),t.state="Leaving",null==(n=t.publishStatsAnalytics)||n.stop(),null==(r=t.subscribeStatsAnalytics)||r.stop(),null==(s=t.webrtcInternals)||s.cleanup(),t.clearPeerConnections(),e)try{t.signal.leave(i),fi.d(ol,"signal leave done")}catch(Ke){fi.w(ol,"failed to send leave on websocket to server",Ke)}t.analyticsEventsService.flushFailedClientEvents(),t.analyticsEventsService.reset(),yield t.signal.close()}catch(a){t.eventBus.analytics.publish(Ji.disconnect(a)),fi.e(ol,"leave: FAILED \u274c",a)}finally{t.state="Disconnected",t.observer.onStateChange(t.state)}}()})}publish(e){return Jt(this,null,function*(){var t;for(let n of e)try{yield this.publishTrack(n),null==(t=this.connectivityListener)||t.onMediaPublished(n)}catch(i){this.eventBus.analytics.publish(Ji.publish({devices:this.deviceManager.getDevices(),error:i}))}})}unpublish(e){return Jt(this,null,function*(){for(let t of e)yield this.unpublishTrack(t)})}setSFUNodeId(e){var t,i;this.signal.setSfuNodeId(e),this.sfuNodeId?e&&this.sfuNodeId!==e&&(this.sfuNodeId=e,this.handleSFUMigration()):(this.sfuNodeId=e,null==(t=this.publishConnection)||t.setSfuNodeId(e),null==(i=this.subscribeConnection)||i.setSfuNodeId(e))}handleSFUMigration(){return Jt(this,null,function*(){var e,t;fi.time("sfu migration"),this.clearPeerConnections();let i=this.store.getPeerMap();this.store.removeRemoteTracks();for(let a in i){let e=i[a];e.isLocal||(e.audioTrack=void 0,e.videoTrack=void 0,e.auxiliaryTracks=[])}let n=this.store.getLocalPeer();if(!n)return;this.createPeerConnections(),this.trackStates.clear(),yield this.negotiateOnFirstPublish();let r=new Map;if(n.audioTrack){let e=n.audioTrack.stream;r.get(e.id)||r.set(e.id,new Mr(new MediaStream));let t=n.audioTrack.clone(r.get(e.id));this.store.removeTrack(n.audioTrack),n.audioTrack.cleanup(),yield this.publishTrack(t),n.audioTrack=t}if(n.videoTrack){let e=n.videoTrack.stream;r.get(e.id)||r.set(e.id,new Mr(new MediaStream)),this.store.removeTrack(n.videoTrack);let t=n.videoTrack.clone(r.get(e.id));n.videoTrack.cleanup(),yield this.publishTrack(t),n.videoTrack=t}let s=[];for(;n.auxiliaryTracks.length>0;){let e=n.auxiliaryTracks.shift();if(e){let t=e.stream;r.get(t.id)||r.set(t.id,new Mr("screen"===e.source?t.nativeStream.clone():new MediaStream)),this.store.removeTrack(e);let i=e.clone(r.get(t.id));"video"===i.type&&"screen"===i.source&&(this.screenStream.add(t.nativeStream),this.screenStream.add(i.stream.nativeStream),i.nativeTrack.addEventListener("ended",this.onScreenshareStop)),e.cleanup(),yield this.publishTrack(i),s.push(i)}}n.auxiliaryTracks=s,r.clear(),null==(t=null==(e=this.listener)?void 0:e.onSFUMigration)||t.call(e),fi.timeEnd("sfu migration")})}trackUpdate(e,t){var i;let n=Array.from(this.trackStates.values()).find(t=>e.type===t.type&&e.source===t.source);if(n){let r=new Za(Ht(Wt({},n),{mute:!t}));this.trackStates.set(n.track_id,r),fi.d(ol,"Track Update",this.trackStates,e),this.signal.trackUpdate(new Map([[n.track_id,r]]));let s=this.store.getLocalPeer();s&&t===e.enabled&&(null==(i=this.listener)||i.onTrackUpdate(t?3:2,e,s))}}publishTrack(e){return Jt(this,null,function*(){e.publishedTrackId=e.getTrackIDBeingSent(),fi.d(ol,"\u23f3 publishTrack: trackId=".concat(e.trackId,", toPublishTrackId=").concat(e.publishedTrackId),"".concat(e)),this.trackStates.set(e.publishedTrackId,new Za(e));let t=new Promise((e,t)=>{this.callbacks.set(ar,{promise:{resolve:e,reject:t},action:"PUBLISH",extra:{}})}),i=e.stream;i.setConnection(this.publishConnection);let n=this.store.getSimulcastLayers(e.source);i.addTransceiver(e,n),fi.time("publish-".concat(e.trackId,"-").concat(e.type)),yield t,fi.timeEnd("publish-".concat(e.trackId,"-").concat(e.type)),this.store.addTrack(e),yield i.setMaxBitrateAndFramerate(e).then(()=>{fi.d(ol,"Setting maxBitrate=".concat(e.settings.maxBitrate," kpbs").concat(e instanceof sr?" and maxFramerate=".concat(e.settings.maxFramerate):""," for ").concat(e.source," ").concat(e.type," ").concat(e.trackId))}).catch(e=>fi.w(ol,"Failed setting maxBitrate and maxFramerate",e)),e.isPublished=!0,fi.d(ol,"\u2705 publishTrack: trackId=".concat(e.trackId),"".concat(e),this.callbacks)})}unpublishTrack(e){return Jt(this,null,function*(){if(fi.d(ol,"\u23f3 unpublishTrack: trackId=".concat(e.trackId),"".concat(e)),e.publishedTrackId&&this.trackStates.has(e.publishedTrackId))this.trackStates.delete(e.publishedTrackId);else{let t=Array.from(this.trackStates.values()).find(t=>e.type===t.type&&e.source===t.source);t&&this.trackStates.delete(t.track_id)}let t=new Promise((e,t)=>{this.callbacks.set(ar,{promise:{resolve:e,reject:t},action:"UNPUBLISH",extra:{}})});e.stream.removeSender(e),yield t,yield e.cleanup(),"screen"===e.source&&this.screenStream&&this.screenStream.forEach(e=>{e.getTracks().forEach(e=>{e.stop()}),this.screenStream.delete(e)}),this.store.removeTrack(e),fi.d(ol,"\u2705 unpublishTrack: trackId=".concat(e.trackId),this.callbacks)})}clearPeerConnections(){return Jt(this,null,function*(){var e,t;clearTimeout(this.publishDtlsStateTimer),this.publishDtlsStateTimer=0,clearTimeout(this.publishDisconnectTimer),this.publishDisconnectTimer=0,this.lastPublishDtlsState="new",null==(e=this.publishConnection)||e.close(),null==(t=this.subscribeConnection)||t.close(),this.publishConnection=null,this.subscribeConnection=null})}waitForLocalRoleAvailability(){if(!this.store.hasRoleDetailsArrived())return new Promise(e=>{this.eventBus.policyChange.subscribeOnce(()=>e())})}createConnectionsAndNegotiateJoin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Jt(this,null,function*(){let i=this.doesLocalPeerNeedWebRTC();i&&this.createPeerConnections(),this.analyticsTimer.start("join_response_time"),yield this.negotiateJoinWithRetry({name:e.name,data:e.metaData,autoSubscribeVideo:t,isWebRTC:i}),this.analyticsTimer.end("join_response_time")})}createPeerConnections(){var e,t,i;let n=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(["disconnected","failed"].includes(t)?fi.w.bind(fi):fi.d.bind(fi))(ol,"".concat($o[e]," ").concat(i?"ice":""," connection state change: ").concat(t))};if(this.initConfig){let e={onRenegotiationNeeded:()=>Jt(this,null,function*(){yield this.performPublishRenegotiation()}),onDTLSTransportStateChange:e=>{var t,i,n;if(("failed"===e?fi.w.bind(fi):fi.d.bind(fi))(ol,"Publisher on dtls transport state change: ".concat(e)),!e||this.lastPublishDtlsState===e||(this.lastPublishDtlsState=e,0!==this.publishDtlsStateTimer&&(clearTimeout(this.publishDtlsStateTimer),this.publishDtlsStateTimer=0),"connecting"!==e&&"failed"!==e))return;let r=null==(n=null==(i=null==(t=this.initConfig)?void 0:t.config)?void 0:i.dtlsStateTimeouts)?void 0:n[e];!r||r<=0||(this.publishDtlsStateTimer=window.setTimeout(()=>{var t;let i=null==(t=this.publishConnection)?void 0:t.nativeConnection.connectionState;if(i&&e&&i===e){let t=Oi.WebrtcErrors.ICEFailure("PUBLISH","DTLS transport state ".concat(e," timeout:").concat(r,"ms"),!0);this.eventBus.analytics.publish(Ji.disconnect(t)),this.observer.onFailure(t)}},r))},onDTLSTransportError:e=>{fi.e(ol,"onDTLSTransportError ".concat(e.name," ").concat(e.message),e),this.eventBus.analytics.publish(Ji.disconnect(e))},onIceConnectionChange:e=>Jt(this,null,function*(){n(0,e,!0)}),onConnectionStateChange:e=>Jt(this,null,function*(){var t,i,r,s,a,o,l,c;n(0,e,!1),"new"!==e&&("connected"===e?(null==(t=this.connectivityListener)||t.onICESuccess(!0),null==(i=this.publishConnection)||i.handleSelectedIceCandidatePairs()):"failed"===e?yield this.handleIceConnectionFailure(0,Oi.WebrtcErrors.ICEFailure("PUBLISH","local candidate - ".concat(null==(a=null==(s=null==(r=this.publishConnection)?void 0:r.selectedCandidatePair)?void 0:s.local)?void 0:a.candidate,"; remote candidate - ").concat(null==(c=null==(l=null==(o=this.publishConnection)?void 0:o.selectedCandidatePair)?void 0:l.remote)?void 0:c.candidate))):this.publishDisconnectTimer=window.setTimeout(()=>{var e,t,i,n,r,s,a;"connected"!==(null==(e=this.publishConnection)?void 0:e.connectionState)&&this.handleIceConnectionFailure(0,Oi.WebrtcErrors.ICEDisconnected("PUBLISH","local candidate - ".concat(null==(n=null==(i=null==(t=this.publishConnection)?void 0:t.selectedCandidatePair)?void 0:i.local)?void 0:n.candidate,"; remote candidate - ").concat(null==(a=null==(s=null==(r=this.publishConnection)?void 0:r.selectedCandidatePair)?void 0:s.remote)?void 0:a.candidate)))},5e3))}),onIceCandidate:e=>{var t;null==(t=this.connectivityListener)||t.onICECandidate(e,!0)},onSelectedCandidatePairChange:e=>{var t;null==(t=this.connectivityListener)||t.onSelectedICECandidatePairChange(e,!0)}},t={onApiChannelMessage:e=>{this.observer.onNotification(JSON.parse(e))},onTrackAdd:e=>{fi.d(ol,"[Subscribe] onTrackAdd","".concat(e)),this.observer.onTrackAdd(e)},onTrackRemove:e=>{fi.d(ol,"[Subscribe] onTrackRemove","".concat(e)),this.observer.onTrackRemove(e)},onIceConnectionChange:e=>Jt(this,null,function*(){var t;if(n(1,e,!0),"connected"===e){let e=this.callbacks.get(lr);this.callbacks.delete(lr),null==(t=this.connectivityListener)||t.onICESuccess(!1),e&&e.promise.resolve(!0)}}),onConnectionStateChange:e=>Jt(this,null,function*(){var t,i,r,s,a,o,l;if(n(1,e,!1),"failed"===e)yield this.handleIceConnectionFailure(1,Oi.WebrtcErrors.ICEFailure("SUBSCRIBE","local candidate - ".concat(null==(r=null==(i=null==(t=this.subscribeConnection)?void 0:t.selectedCandidatePair)?void 0:i.local)?void 0:r.candidate,"; remote candidate - ").concat(null==(o=null==(a=null==(s=this.subscribeConnection)?void 0:s.selectedCandidatePair)?void 0:a.remote)?void 0:o.candidate)));else if("disconnected"===e)setTimeout(()=>{var e,t,i,n,r,s,a;"disconnected"===(null==(e=this.subscribeConnection)?void 0:e.connectionState)&&this.handleIceConnectionFailure(1,Oi.WebrtcErrors.ICEDisconnected("SUBSCRIBE","local candidate - ".concat(null==(n=null==(i=null==(t=this.subscribeConnection)?void 0:t.selectedCandidatePair)?void 0:i.local)?void 0:n.candidate,"; remote candidate - ").concat(null==(a=null==(s=null==(r=this.subscribeConnection)?void 0:r.selectedCandidatePair)?void 0:s.remote)?void 0:a.candidate)))},5e3);else if("connected"===e){null==(l=this.subscribeConnection)||l.handleSelectedIceCandidatePairs();let e=this.callbacks.get(lr);this.callbacks.delete(lr),e&&e.promise.resolve(!0)}}),onIceCandidate:e=>{var t;null==(t=this.connectivityListener)||t.onICECandidate(e,!1)},onSelectedCandidatePairChange:e=>{var t;null==(t=this.connectivityListener)||t.onSelectedICECandidatePairChange(e,!1)}};this.publishConnection||(this.publishConnection=new el(this.signal,this.initConfig.rtcConfiguration,e)),this.subscribeConnection||(this.subscribeConnection=new il(this.signal,this.initConfig.rtcConfiguration,this.isFlagEnabled.bind(this),t))}null==(i=this.webrtcInternals)||i.setPeerConnections({publish:null==(e=this.publishConnection)?void 0:e.nativeConnection,subscribe:null==(t=this.subscribeConnection)?void 0:t.nativeConnection})}negotiateJoinWithRetry(e){return Jt(this,arguments,function(e){var t=this;let{name:i,data:n,autoSubscribeVideo:r,isWebRTC:s=!0}=e;return function*(){try{yield t.negotiateJoin({name:i,data:n,autoSubscribeVideo:r,isWebRTC:s})}catch(Fe){fi.e(ol,"Join negotiation failed \u274c",Fe);let a=Fe instanceof Ri?Fe:Oi.WebsocketMethodErrors.ServerErrors(500,"JOIN","Websocket join error - ".concat(Fe.message)),o=5===parseInt("".concat(a.code/100))||[Ai.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,429].includes(a.code);if(410===a.code&&(a.isTerminal=!0),!o)throw Fe;{t.joinRetryCount=0,a.isTerminal=!1;let e=()=>Jt(t,null,function*(){return this.joinRetryCount++,yield this.negotiateJoin({name:i,data:n,autoSubscribeVideo:r,isWebRTC:s})});yield t.retryScheduler.schedule({category:2,error:a,task:e,originalState:"Joined",changeState:!1})}}}()})}negotiateJoin(e){return Jt(this,arguments,function(e){var t=this;let{name:i,data:n,autoSubscribeVideo:r,isWebRTC:s=!0}=e;return function*(){return s?yield t.negotiateJoinWebRTC({name:i,data:n,autoSubscribeVideo:r}):yield t.negotiateJoinNonWebRTC({name:i,data:n,autoSubscribeVideo:r})}()})}negotiateJoinWebRTC(e){return Jt(this,arguments,function(e){var t=this;let{name:i,data:n,autoSubscribeVideo:r}=e;return function*(){if(fi.d(ol,"\u23f3 join: Negotiating over PUBLISH connection"),!t.publishConnection)return fi.e(ol,"Publish peer connection not found, cannot negotiate"),!1;let e=yield t.publishConnection.createOffer();yield t.publishConnection.setLocalDescription(e);let s=t.isFlagEnabled("subscribeDegradation"),a=t.isFlagEnabled("simulcast"),o=t.isFlagEnabled("onDemandTracks"),l=yield t.signal.join(i,n,!r,s,a,o,e);t.setSFUNodeId(null==l?void 0:l.sfu_node_id),yield t.publishConnection.setRemoteDescription(l);for(let i of t.publishConnection.candidates)yield t.publishConnection.addIceCandidate(i);return t.publishConnection.initAfterJoin(),!!l}()})}negotiateJoinNonWebRTC(e){return Jt(this,arguments,function(e){var t=this;let{name:i,data:n,autoSubscribeVideo:r}=e;return function*(){fi.d(ol,"\u23f3 join: Negotiating Non-WebRTC");let e=t.isFlagEnabled("subscribeDegradation"),s=t.isFlagEnabled("simulcast"),a=t.isFlagEnabled("onDemandTracks"),o=yield t.signal.join(i,n,!r,e,s,a);return t.setSFUNodeId(null==o?void 0:o.sfu_node_id),!!o}()})}negotiateOnFirstPublish(){return Jt(this,null,function*(){if(fi.d(ol,"\u23f3 Negotiating offer over PUBLISH connection"),!this.publishConnection)return fi.e(ol,"Publish peer connection not found, cannot negotiate"),!1;try{let e=yield this.publishConnection.createOffer(this.trackStates);yield this.publishConnection.setLocalDescription(e);let t=yield this.signal.offer(e,this.trackStates);yield this.publishConnection.setRemoteDescription(t);for(let i of this.publishConnection.candidates)yield this.publishConnection.addIceCandidate(i);return this.publishConnection.initAfterJoin(),!!t}catch(e){if(e instanceof Ri&&421===e.code)return!0;throw e}})}performPublishRenegotiation(e){return Jt(this,null,function*(){fi.d(ol,"\u23f3 [role=PUBLISH] onRenegotiationNeeded START",this.trackStates);let t=this.callbacks.get(ar);if(t)if(this.publishConnection)try{let i=yield this.publishConnection.createOffer(this.trackStates,e);yield this.publishConnection.setLocalDescription(i),fi.time("renegotiation-offer-exchange");let n=yield this.signal.offer(i,this.trackStates);this.callbacks.delete(ar),fi.timeEnd("renegotiation-offer-exchange"),yield this.publishConnection.setRemoteDescription(n),t.promise.resolve(!0),fi.d(ol,"[role=PUBLISH] onRenegotiationNeeded DONE \u2705")}catch(E){let i;i=E instanceof Ri?E:Oi.GenericErrors.Unknown("PUBLISH",E.message),421===i.code?t.promise.resolve(!0):t.promise.reject(i),fi.d(ol,"[role=PUBLISH] onRenegotiationNeeded FAILED \u274c")}else fi.e(ol,"Publish peer connection not found, cannot renegotiate");else fi.w(ol,"no callback found for renegotiation")})}handleIceConnectionFailure(e,t){return Jt(this,null,function*(){this.retryScheduler.isTaskInProgress(4)||(0===e?this.retryScheduler.schedule({category:3,error:t,task:this.retryPublishIceFailedTask,originalState:"Joined"}):this.retryScheduler.schedule({category:4,error:t,task:this.retrySubscribeIceFailedTask,originalState:"Joined"}))})}internalConnect(e,t,i,n){return Jt(this,null,function*(){var r,s,a;fi.d(ol,"connect: started \u23f0");let o=new Date;try{this.analyticsTimer.start("init_response_time"),this.initConfig=yield sl.fetchInitConfig({token:e,peerId:i,userAgent:this.store.getUserAgent(),initEndpoint:t,iceServers:n}),null==(r=this.connectivityListener)||r.onInitSuccess(this.initConfig.endpoint);let o=this.store.getRoom();return o&&(o.effectsKey=null==(s=this.initConfig.config.vb)?void 0:s.effectsKey,o.isEffectsEnabled=this.isFlagEnabled("effectsSDKEnabled"),o.disableNoneLayerRequest=this.isFlagEnabled("disableNoneLayerRequest"),o.isVBEnabled=this.isFlagEnabled("vb"),o.isHipaaEnabled=this.isFlagEnabled("hipaa"),o.isNoiseCancellationEnabled=this.isFlagEnabled("noiseCancellation")),this.analyticsTimer.end("init_response_time"),Xa.setWebsocketEndpoint(this.initConfig.endpoint),this.validateNotDisconnected("post init"),yield this.openSignal(e,i),this.observer.onConnected(),null==(a=this.connectivityListener)||a.onSignallingSuccess(),this.store.setSimulcastEnabled(this.isFlagEnabled("simulcast")),fi.d(ol,"Adding Analytics Transport: JsonRpcSignal"),this.analyticsEventsService.setTransport(this.analyticsSignalTransport),this.analyticsEventsService.flush(),this.initConfig}catch(l){throw"Reconnecting"!==this.state&&this.eventBus.analytics.publish(Ji.connect(l,this.getAdditionalAnalyticsProperties(),o,new Date,t)),fi.e(ol,"\u274c internal connect: failed",l),l}})}validateNotDisconnected(e){if("Disconnected"===this.state)throw fi.w(ol,"aborting join as transport state is disconnected"),Oi.GenericErrors.ValidationFailed("leave called before join could complete - stage=".concat(e))}openSignal(e,t){return Jt(this,null,function*(){if(!this.initConfig)throw Oi.APIErrors.InitConfigNotAvailable("INIT","Init Config not found");fi.d(ol,"\u23f3 internal connect: connecting to ws endpoint",this.initConfig.endpoint);let i=new URL(this.initConfig.endpoint);i.searchParams.set("peer",t),i.searchParams.set("token",e),i.searchParams.set("user_agent_v2",this.store.getUserAgent()),i.searchParams.set("protocol_version","2.5"),i.searchParams.set("protocol_spec","20250115"),this.endpoint=i.toString(),this.analyticsTimer.start("ws_connect_time"),yield this.signal.open(this.endpoint),this.analyticsTimer.end("ws_connect_time"),this.analyticsTimer.start("on_policy_change_time"),this.analyticsTimer.start("room_state_time"),fi.d(ol,"\u2705 internal connect: connected to ws endpoint")})}initStatsAnalytics(){var e,t;this.isFlagEnabled("publishStats")&&(this.publishStatsAnalytics=new Ko(this.store,this.eventBus,this.getValueFromInitConfig("publishStats","maxSampleWindowSize",30),this.getValueFromInitConfig("publishStats","maxSamplePushInterval",300)),null==(e=this.getWebrtcInternals())||e.start()),this.isFlagEnabled("subscribeStats")&&(this.subscribeStatsAnalytics=new Qo(this.store,this.eventBus,this.getValueFromInitConfig("subscribeStats","maxSampleWindowSize",10),this.getValueFromInitConfig("subscribeStats","maxSamplePushInterval",60)),null==(t=this.getWebrtcInternals())||t.start())}getValueFromInitConfig(e,t,i){var n,r;return(null==(r=null==(n=this.initConfig)?void 0:n.config[e])?void 0:r[t])||i}doesRoleNeedWebRTC(e){var t,i;if(!this.isFlagEnabled("nonWebRTCDisableOffer"))return!0;let n=!!(e.publishParams.allowed&&(null==(t=e.publishParams.allowed)?void 0:t.length)>0),r=!!(e.subscribeParams.subscribeToRoles&&(null==(i=e.subscribeParams.subscribeToRoles)?void 0:i.length)>0);return n||r}doesLocalPeerNeedWebRTC(){var e;let t=null==(e=this.store.getLocalPeer())?void 0:e.role;return!t||this.doesRoleNeedWebRTC(t)}setTransportStateForConnect(){if("Failed"===this.state&&(this.state="Disconnected"),"Disconnected"!==this.state&&"Reconnecting"!==this.state)throw Oi.WebsocketMethodErrors.AlreadyJoined("JOIN","Cannot join a meeting in ".concat(this.state," state"));"Disconnected"===this.state&&(this.state="Connecting",this.observer.onStateChange(this.state))}sendErrorAnalyticsEvent(e,t){let i,n=this.getAdditionalAnalyticsProperties();switch(t){case 0:i=Ji.connect(e,n);break;case 1:i=Ji.disconnect(e,n);break;case 2:i=Ji.join({error:e,time:this.analyticsTimer.getTimeTaken("join_time"),init_response_time:this.analyticsTimer.getTimeTaken("init_response_time"),ws_connect_time:this.analyticsTimer.getTimeTaken("ws_connect_time"),on_policy_change_time:this.analyticsTimer.getTimeTaken("on_policy_change_time"),local_audio_track_time:this.analyticsTimer.getTimeTaken("local_audio_track_time"),local_video_track_time:this.analyticsTimer.getTimeTaken("local_video_track_time"),retries_join:this.joinRetryCount});break;case 3:i=Ji.publish({error:e});break;case 4:i=Ji.subscribeFail(e)}this.eventBus.analytics.publish(i)}getSubscribeConnection(){return this.subscribeConnection}getAdditionalAnalyticsProperties(){var e,t,i,n,r,s,a,o;let l=(()=>{if(!Ti||"undefined"==typeof navigator.connection)return;let e=navigator.connection;return{downlink:e.downlink,downlinkMax:e.downlinkMax,effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,type:e.type}})(),c="undefined"!=typeof document&&document.hidden,u=this.store.getRemoteVideoTracks().filter(e=>e.degraded).length;return{network_info:l,document_hidden:c,num_degraded_tracks:u,bitrate:{publish:null==(n=null==(i=null==(t=null==(e=this.getWebrtcInternals())?void 0:e.getCurrentStats())?void 0:t.getLocalPeerStats())?void 0:i.publish)?void 0:n.bitrate,subscribe:null==(o=null==(a=null==(s=null==(r=this.getWebrtcInternals())?void 0:r.getCurrentStats())?void 0:s.getLocalPeerStats())?void 0:a.subscribe)?void 0:o.bitrate},max_sub_bitrate:this.maxSubscribeBitrate,recent_pong_response_times:this.signal.getPongResponseTimes(),transport_state:this.state}}};function cl(e){if(!e||0===e.length)throw Oi.APIErrors.InvalidTokenFormat("INIT","Token cannot be an empty string or undefined or null");let t=e.split(".");if(3!==t.length)throw Oi.APIErrors.InvalidTokenFormat("INIT","Expected 3 '.' separate fields - header, payload and signature respectively");let i=atob(t[1]);try{let e=JSON.parse(i);return{roomId:e.room_id,userId:e.user_id,role:e.role}}catch(E){throw Oi.APIErrors.InvalidTokenFormat("INIT","couldn't parse to json - ".concat(E.message))}}var ul,dl,hl={published:!1,isInitialised:!1,isReconnecting:!1,isPreviewInProgress:!1,isPreviewCalled:!1,isJoinInProgress:!1,deviceManagersInitialised:!1},pl=class{constructor(){var e=this;this.TAG="[HMSSdk]:",this.transportState="Disconnected",this.analyticsTimer=new tr,this.sdkState=Wt({},hl),this.isDiagnostics=!1,this.playlistSettings={video:{bitrate:1e3},audio:{bitrate:64}},this.handleAutoplayError=e=>{var t,i;null==(i=null==(t=this.errorListener)?void 0:t.onError)||i.call(t,e)},this.observer={onNotification:e=>{var t;if("on-peer-leave-request"!==e.method){switch(e.method){case"on-policy-change":this.analyticsTimer.end("on_policy_change_time");break;case"peer-list":this.analyticsTimer.end("peer_list_time"),this.sendJoinAnalyticsEvent(this.sdkState.isPreviewCalled);break;case"room-state":this.analyticsTimer.end("room_state_time")}null==(t=this.notificationManager)||t.handleNotification(e,this.sdkState.isReconnecting)}else this.handlePeerLeaveRequest(e.params)},onConnected:()=>{this.initNotificationManager()},onTrackAdd:e=>{var t;null==(t=this.notificationManager)||t.handleTrackAdd(e)},onTrackRemove:e=>{var t;null==(t=this.notificationManager)||t.handleTrackRemove(e)},onFailure:e=>{var t;null==(t=this.errorListener)||t.onError(e)},onStateChange:(e,t)=>Jt(this,null,function*(){var i,n;let r=e=>Jt(this,null,function*(){var t,i;yield this.internalLeave(!0,e),!this.sdkState.isPreviewInProgress&&!this.sdkState.isJoinInProgress&&(null==(i=null==(t=this.errorListener)?void 0:t.onError)||i.call(t,e)),this.sdkState.isReconnecting=!1});switch(e){case"Preview":case"Joined":this.initNotificationManager(),"Reconnecting"===this.transportState&&(null==(i=this.listener)||i.onReconnected());break;case"Failed":yield r(t);break;case"Reconnecting":this.sdkState.isReconnecting=!0,null==(n=this.listener)||n.onReconnecting(t)}this.transportState=e,fi.d(this.TAG,"Transport State Change",this.transportState)})},this.handlePeerLeaveRequest=e=>{var t;let i=e.requested_by?this.store.getPeerById(e.requested_by):void 0,n={roomEnded:e.room_end,reason:e.reason,requestedBy:i};null==(t=this.listener)||t.onRemovedFromRoom(n),this.internalLeave(!1)},this.handlePreviewError=e=>{var t;this.analyticsTimer.end("preview_time"),e&&(null==(t=this.errorListener)||t.onError(e)),this.sendPreviewAnalyticsEvent(e),this.sdkState.isPreviewInProgress=!1},this.handleDeviceChange=e=>{var t,i;e.isUserSelection||(fi.d(this.TAG,"Device Change event",e),null==(i=null==(t=this.deviceChangeListener)?void 0:t.onDeviceChange)||i.call(t,e),(()=>{var t,i,n,r;if(e.error&&e.type){let s=e.type.includes("audio")?null==(t=this.localPeer)?void 0:t.audioTrack:null==(i=this.localPeer)?void 0:i.videoTrack;null==(n=this.errorListener)||n.onError(e.error),[Ai.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,Ai.TracksErrors.DEVICE_IN_USE,Ai.TracksErrors.DEVICE_NOT_AVAILABLE].includes(e.error.code)&&s&&(s.setEnabled(!1),null==(r=this.listener)||r.onTrackUpdate(2,s,this.localPeer))}})())},this.handleAudioPluginError=e=>{var t;fi.e(this.TAG,"Audio Plugin Error event",e),null==(t=this.errorListener)||t.onError(e)},this.handleError=e=>{var t;fi.e(this.TAG,e),null==(t=this.errorListener)||t.onError(e)},this.handleLocalRoleUpdate=e=>Jt(this,[e],function(e){var t=this;let{oldRole:i,newRole:n}=e;return function*(){var e;t.deviceManager.currentSelection=t.deviceManager.getCurrentSelection(),yield t.transport.handleLocalRoleUpdate({oldRole:i,newRole:n}),yield null==(e=t.roleChangeManager)?void 0:e.handleLocalPeerRoleUpdate({oldRole:i,newRole:n}),yield t.interactivityCenter.whiteboard.handleLocalRoleUpdate()}()}),this.unpauseRemoteVideoTracks=()=>{this.store.getRemoteVideoTracks().forEach(e=>e.handleTrackUnmute())},this.sendAudioPresenceFailed=()=>{var e;let t=Oi.TracksErrors.NoAudioDetected("PREVIEW");fi.w(this.TAG,"Audio Presence Failure",this.transportState,t),this.isDiagnostics&&(null==(e=this.listener)||e.onError(t))},this.sendJoinAnalyticsEvent=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1?arguments[1]:void 0;e.eventBus.analytics.publish(Ji.join(Ht(Wt({error:i},e.analyticsTimer.getTimes()),{time:e.analyticsTimer.getTimeTaken("join_time"),is_preview_called:t,retries_join:e.transport.joinRetryCount})))},this.sendPreviewAnalyticsEvent=e=>{this.eventBus.analytics.publish(Ji.preview(Ht(Wt({error:e},this.analyticsTimer.getTimes()),{time:this.analyticsTimer.getTimeTaken("preview_time")})))},this.sendAnalyticsEvent=e=>{this.isDiagnostics||this.analyticsEventsService.queue(e).flush()}}setSessionPeerInfo(e,t){var i,n,r,s;let a=this.store.getRoom();t&&a?this.sessionPeerInfo={peer:{peer_id:t.peerId,role:null==(i=t.role)?void 0:i.name,joined_at:(null==(n=t.joinedAt)?void 0:n.valueOf())||0,room_name:a.name,session_started_at:(null==(r=a.startedAt)?void 0:r.valueOf())||0,user_data:t.customerUserId,user_name:t.name,template_id:a.templateId,session_id:a.sessionId,token:null==(s=this.store.getConfig())?void 0:s.authToken},agent:this.store.getUserAgent(),device_id:Fi(),cluster:{websocket_url:e},timestamp:Date.now()}:fi.e(this.TAG,"setSessionPeerInfo> Local peer or room is undefined")}initNotificationManager(){this.notificationManager||(this.notificationManager=new Lo(this.store,this.eventBus,this.transport,this.listener,this.audioListener))}initStoreAndManagers(e){var t,i;if(this.listener=e,this.errorListener=e,this.deviceChangeListener=e,null==(t=this.store)||t.setErrorListener(this.errorListener),this.sdkState.isInitialised)return null==(i=this.notificationManager)||i.setListener(this.listener),this.audioSinkManager.setListener(this.listener),this.interactivityCenter.setListener(this.listener),void this.transport.setListener(this.listener);this.sdkState.isInitialised=!0,this.store=new eo,this.store.setErrorListener(this.errorListener),this.eventBus=new uo,this.pluginUsageTracker=new so(this.eventBus),this.wakeLockManager=new to,this.networkTestManager=new Ya(this.eventBus,this.listener),this.playlistManager=new ns(this,this.eventBus),this.deviceManager=new ao(this.store,this.eventBus),this.audioSinkManager=new ro(this.store,this.deviceManager,this.eventBus),this.audioOutput=new oo(this.deviceManager,this.audioSinkManager),this.audioSinkManager.setListener(this.listener),this.eventBus.autoplayError.subscribe(this.handleAutoplayError),this.localTrackManager=new nr(this.store,this.observer,this.deviceManager,this.eventBus,this.analyticsTimer),this.analyticsEventsService=new io(this.store),this.transport=new ll(this.observer,this.deviceManager,this.store,this.eventBus,this.analyticsEventsService,this.analyticsTimer,this.pluginUsageTracker),"onInitSuccess"in e&&this.transport.setConnectivityListener(e),this.sessionStore=new Do(this.transport),this.interactivityCenter=new Eo(this.transport,this.store,this.listener),this.eventBus.analytics.subscribe(this.sendAnalyticsEvent),this.eventBus.deviceChange.subscribe(this.handleDeviceChange),this.eventBus.localVideoUnmutedNatively.subscribe(this.unpauseRemoteVideoTracks),this.eventBus.localAudioUnmutedNatively.subscribe(this.unpauseRemoteVideoTracks),this.eventBus.audioPluginFailed.subscribe(this.handleAudioPluginError),this.eventBus.error.subscribe(this.handleError)}validateJoined(e){if(!this.localPeer)throw Oi.GenericErrors.NotConnected("VALIDATION","Not connected - ".concat(e))}sendHLSAnalytics(e){this.sendAnalyticsEvent(Ji.hlsPlayerError(e))}refreshDevices(){return Jt(this,null,function*(){this.validateJoined("refreshDevices"),yield this.deviceManager.init(!0)})}getWebrtcInternals(){var e;return null==(e=this.transport)?void 0:e.getWebrtcInternals()}getDebugInfo(){var e;if(!this.transport)throw fi.e(this.TAG,"Transport is not defined"),new Error("getDebugInfo can only be called after join");return{websocketURL:this.transport.getWebsocketEndpoint(),enabledFlags:Object.values(So).filter(e=>this.transport.isFlagEnabled(e)),initEndpoint:null==(e=this.store.getConfig())?void 0:e.initEndpoint}}getSessionStore(){return this.sessionStore}getPlaylistManager(){return this.playlistManager}getRecordingState(){var e;return null==(e=this.store.getRoom())?void 0:e.recording}getRTMPState(){var e;return null==(e=this.store.getRoom())?void 0:e.rtmp}getHLSState(){var e;return null==(e=this.store.getRoom())?void 0:e.hls}getTranscriptionState(){var e;return null==(e=this.store.getRoom())?void 0:e.transcriptions}getTemplateAppData(){return this.store.getTemplateAppData()}getInteractivityCenter(){return this.interactivityCenter}getPeerListIterator(e){return new Yr(this.transport,this.store,e)}updatePlaylistSettings(e){e.video&&Object.assign(this.playlistSettings.video,e.video),e.audio&&Object.assign(this.playlistSettings.audio,e.audio)}get localPeer(){var e;return null==(e=this.store)?void 0:e.getLocalPeer()}preview(e,t){return Jt(this,null,function*(){if(Vi(),Gi(),this.sdkState.isPreviewInProgress)return Promise.reject(Oi.GenericErrors.PreviewAlreadyInProgress("PREVIEW","Preview already called"));if(["Joined","Reconnecting"].includes(this.transportState))return this.midCallPreview(e.asRole,e.settings);this.analyticsTimer.start("preview_time"),this.setUpPreview(e,t);let i=!1,n=!1,r=setTimeout(()=>{var e,t;(!i||!n)&&(null==(t=null==(e=this.listener)?void 0:e.onNetworkQuality)||t.call(e,-1))},3e3);return new Promise((s,a)=>{this.eventBus.policyChange.subscribeOnce(()=>Jt(this,null,function*(){var i;if(this.localPeer){let t=e.asRole&&this.store.getPolicyForRole(e.asRole);this.localPeer.asRole=t||this.localPeer.role}let n=yield this.localTrackManager.getTracksToPublish(e.settings);n.forEach(e=>{var t;if(this.setLocalPeerTrack(e),e.isTrackNotPublishing()){let i=Oi.TracksErrors.NoDataInTrack("".concat(e.type," track has no data. muted: ").concat(e.nativeTrack.muted,", readyState: ").concat(e.nativeTrack.readyState));fi.e(this.TAG,i),this.sendAnalyticsEvent(Ji.publish({devices:this.deviceManager.getDevices(),error:i})),null==(t=this.listener)||t.onError(i)}}),null!=(i=this.localPeer)&&i.audioTrack&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),this.sdkState.isPreviewInProgress=!1,this.analyticsTimer.end("preview_time");let r=this.store.getRoom();r&&t.onPreview(r,n),this.sendPreviewAnalyticsEvent(),s()})),this.eventBus.leave.subscribeOnce(this.handlePreviewError),this.eventBus.leave.subscribeOnce(e=>a(e)),this.transport.preview(e.authToken,e.initEndpoint,this.localPeer.peerId,{name:e.userName,metaData:e.metaData||""},e.autoVideoSubscribe,e.iceServers).then(t=>{var s;i=!0,clearTimeout(r),t&&e.captureNetworkQualityInPreview&&this.networkTestManager.start(null==(s=t.config)?void 0:s.networkHealth).then(()=>{n=!0})}).catch(e=>{this.handlePreviewError(e),a(e)})})})}midCallPreview(e,t){return Jt(this,null,function*(){var i,n;if(!this.localPeer||"Joined"!==this.transportState)throw Oi.GenericErrors.NotConnected("VALIDATION","Not connected - midCallPreview");let r=e&&this.store.getPolicyForRole(e);if(!r)throw Oi.GenericErrors.InvalidRole("PREVIEW","role ".concat(e," does not exist in policy"));this.localPeer.asRole=r;let s=yield this.localTrackManager.getTracksToPublish(t);s.forEach(e=>this.setLocalPeerTrack(e)),null!=(i=this.localPeer)&&i.audioTrack&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),null==(n=this.listener)||n.onPreview(this.store.getRoom(),s)})}cancelMidCallPreview(){return Jt(this,null,function*(){var e,t,i;if((!this.localPeer||!this.localPeer.isInPreview())&&fi.w(this.TAG,"Cannot cancel mid call preview as preview is not in progress"),null!=(e=this.localPeer)&&e.asRole&&this.localPeer.role){let e=this.localPeer.asRole,n=this.localPeer.role;delete this.localPeer.asRole,yield null==(t=this.roleChangeManager)?void 0:t.diffRolesAndPublishTracks({oldRole:e,newRole:n}),null==(i=this.listener)||i.onPeerUpdate(8,this.localPeer)}})}join(e,t){return Jt(this,null,function*(){var i,n,r,s,a,o,l,c;if(Vi(),Gi(),this.sdkState.isPreviewInProgress)throw Oi.GenericErrors.NotReady("JOIN","Preview is in progress, can't join");null==(n=null==(i=this.eventBus)?void 0:i.leave)||n.unsubscribe(this.handlePreviewError),this.analyticsTimer.start("join_time"),this.sdkState.isJoinInProgress=!0;let{roomId:u,userId:d,role:h}=cl(e.authToken),p=(null==(s=null==(r=this.localPeer)?void 0:r.asRole)?void 0:s.name)||(null==(o=null==(a=this.localPeer)?void 0:a.role)?void 0:o.name);null==(l=this.networkTestManager)||l.stop(),this.commonSetup(e,u,t),this.removeDevicesFromConfig(e),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),dn.resumeContext();let f=this.store.getConfig();null!=f&&f.autoManageWakeLock&&this.wakeLockManager.acquireLock(),this.localPeer?(this.localPeer.name=e.userName,this.localPeer.role=this.store.getPolicyForRole(h),this.localPeer.customerUserId=d,this.localPeer.metadata=e.metaData,delete this.localPeer.asRole):this.createAndAddLocalPeerToStore(e,h,d),this.roleChangeManager=new $a(this.store,this.transport,this.deviceManager,this.getAndPublishTracks.bind(this),this.removeTrack.bind(this),this.listener),this.eventBus.localRoleUpdate.subscribe(this.handleLocalRoleUpdate),fi.d(this.TAG,"\u23f3 Joining room ".concat(u)),fi.time("join-room-".concat(u));try{yield this.transport.join(e.authToken,this.localPeer.peerId,{name:e.userName,metaData:e.metaData},e.initEndpoint,e.autoVideoSubscribe,e.iceServers),fi.d(this.TAG,"\u2705 Joined room ".concat(u)),this.analyticsTimer.start("peer_list_time"),yield this.notifyJoin(),this.sdkState.isJoinInProgress=!1,yield this.publish(e.settings,p)}catch(We){throw this.analyticsTimer.end("join_time"),this.sdkState.isJoinInProgress=!1,null==(c=this.listener)||c.onError(We),this.sendJoinAnalyticsEvent(this.sdkState.isPreviewCalled,We),fi.e(this.TAG,"Unable to join room",We),We}fi.timeEnd("join-room-".concat(u))})}stringifyMetadata(e){e.metaData&&"string"!=typeof e.metaData?e.metaData=JSON.stringify(e.metaData):e.metaData||(e.metaData="")}cleanup(){var e,t,i;this.cleanDeviceManagers(),this.eventBus.analytics.unsubscribe(this.sendAnalyticsEvent),this.eventBus.localVideoUnmutedNatively.unsubscribe(this.unpauseRemoteVideoTracks),this.eventBus.localAudioUnmutedNatively.unsubscribe(this.unpauseRemoteVideoTracks),this.eventBus.error.unsubscribe(this.handleError),this.analyticsTimer.cleanup(),Xi.cleanup(),this.playlistManager.cleanup(),null==(e=this.wakeLockManager)||e.cleanup(),nr.cleanup(),this.notificationManager=void 0,fi.cleanup(),this.sdkState=Wt({},hl),this.localPeer&&(null==(t=this.localPeer.audioTrack)||t.cleanup(),this.localPeer.audioTrack=void 0,null==(i=this.localPeer.videoTrack)||i.cleanup(),this.localPeer.videoTrack=void 0),this.store.cleanup(),this.listener=void 0,this.roleChangeManager&&this.eventBus.localRoleUpdate.unsubscribe(this.handleLocalRoleUpdate)}leave(e){return this.internalLeave(e)}internalLeave(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;return Jt(this,null,function*(){var i,n,r,s;let a=null==(i=this.store)?void 0:i.getRoom();if(a){for(;(this.sdkState.isPreviewInProgress||this.sdkState.isJoinInProgress)&&(null==t||!t.isTerminal);)yield mn(100);let i=a.id;this.setSessionPeerInfo(this.transport.getWebsocketEndpoint()||"",this.localPeer),null==(n=this.networkTestManager)||n.stop(),this.eventBus.leave.publish(t);let o=null==(r=this.localPeer)?void 0:r.peerId;fi.d(this.TAG,"\u23f3 Leaving room ".concat(i,", peerId=").concat(o)),yield null==(s=this.transport)?void 0:s.leave(e,t?"sdk request":"user request"),this.cleanup(),fi.d(this.TAG,"\u2705 Left room ".concat(i,", peerId=").concat(o))}})}getAuthTokenByRoomCode(e,t){return Jt(this,null,function*(){let i=(t||{}).endpoint||"https://auth.100ms.live/v2/token";this.analyticsTimer.start("GET_TOKEN");let n=yield qa(i,{method:"POST",body:JSON.stringify({code:e.roomCode,user_id:e.userId})},[429,500,501,502,503,504,505,506,507,508,509,510,511]),r=yield n.json();if(this.analyticsTimer.end("GET_TOKEN"),!n.ok)throw Oi.APIErrors.ServerErrors(r.code,"GET_TOKEN",r.message,!1);let{token:s}=r;if(!s)throw Error(r.message);return s})}getLocalPeer(){return this.store.getLocalPeer()}getPeers(){return this.store.getPeers()}getPeerMap(){return this.store.getPeerMap()}getAudioOutput(){return this.audioOutput}sendMessage(e,t){this.sendMessageInternal({message:t,type:e})}sendBroadcastMessage(e,t){return Jt(this,null,function*(){return yield this.sendMessageInternal({message:e,type:t})})}sendGroupMessage(e,t,i){return Jt(this,null,function*(){let n=this.store.getKnownRoles();if(0===(t.filter(e=>n[e.name])||[]).length)throw Oi.GenericErrors.ValidationFailed("No valid role is present",t);return yield this.sendMessageInternal({message:e,recipientRoles:t,type:i})})}sendDirectMessage(e,t,i){return Jt(this,null,function*(){var n,r;if((null==(n=this.localPeer)?void 0:n.peerId)===t)throw Oi.GenericErrors.ValidationFailed("Cannot send message to self");let s=!(null==(r=this.store.getRoom())||!r.large_room_optimization),a=this.store.getPeerById(t);if(!a){if(!s)throw Oi.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);{let e=yield this.transport.signal.getPeer({peer_id:t});if(!e)throw Oi.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);a=Qr(e,this.store)}}return yield this.sendMessageInternal({message:e,recipientPeer:a,type:i})})}submitSessionFeedback(e,t){return Jt(this,null,function*(){if(!this.sessionPeerInfo)throw fi.e(this.TAG,"submitSessionFeedback> session is undefined"),new Error("session is undefined");let i=this.sessionPeerInfo.peer.token;if(!i)throw fi.e(this.TAG,"submitSessionFeedback> token is undefined"),new Error("Internal error, token is not present");try{yield lo.sendFeedback({token:i,info:this.sessionPeerInfo,feedback:e,eventEndpoint:t}),fi.i(this.TAG,"submitSessionFeedback> submitted feedback"),this.sessionPeerInfo=void 0}catch(n){throw fi.e(this.TAG,"submitSessionFeedback> error occured ",n),new Error("Unable to submit feedback")}})}getPeer(e){return Jt(this,null,function*(){let t=yield this.transport.signal.getPeer({peer_id:e});if(t)return Qr(t,this.store)})}findPeerByName(e){return Jt(this,arguments,function(e){var t=this;let{query:i,limit:n=10,offset:r}=e;return function*(){let{peers:e,offset:s,eof:a}=yield t.transport.signal.findPeerByName({query:null==i?void 0:i.toLowerCase(),limit:n,offset:r});return e.length>0?{offset:s,eof:a,peers:e.map(e=>Qr({peer_id:e.peer_id,role:e.role,groups:[],info:{name:e.name,data:"",user_id:"",type:e.type}},t.store))}:{offset:s,peers:[]}}()})}sendMessageInternal(e){return Jt(this,arguments,function(e){var t=this;let{recipientRoles:i,recipientPeer:n,type:r="chat",message:s}=e;return function*(){if(""===s.replace(/\u200b/g," ").trim())throw fi.w(t.TAG,"sendMessage","Ignoring empty message send"),Oi.GenericErrors.ValidationFailed("Empty message not allowed");let e={info:{message:s,type:r}};return null!=i&&i.length&&(e.roles=i.map(e=>e.name)),null!=n&&n.peerId&&(e.peer_id=n.peerId),fi.d(t.TAG,"Sending Message: ",e),yield t.transport.signal.broadcast(e)}()})}startScreenShare(e,t){return Jt(this,null,function*(){var i,n,r;let s=this.store.getPublishParams();if(!s)return;let{allowed:a}=s;if(!a||!a.includes("screen"))return void fi.e(this.TAG,"Role ".concat(null==(i=this.localPeer)?void 0:i.role," cannot share screen"));if(null!=(r=null==(n=this.localPeer)?void 0:n.auxiliaryTracks)&&r.find(e=>"screen"===e.source))throw Error("Cannot share multiple screens");let o=yield this.getScreenshareTracks(e,t);if(!this.localPeer)return fi.d(this.TAG,"Screenshared when not connected"),void o.forEach(e=>{e.cleanup()});this.transport.setOnScreenshareStop(()=>{this.stopEndedScreenshare(e)}),yield this.transport.publish(o),o.forEach(e=>{var t,i,n;e.peerId=null==(t=this.localPeer)?void 0:t.peerId,null==(i=this.localPeer)||i.auxiliaryTracks.push(e),null==(n=this.listener)||n.onTrackUpdate(0,e,this.localPeer)})})}stopEndedScreenshare(e){return Jt(this,null,function*(){fi.d(this.TAG,"\u2705 Screenshare ended natively"),yield this.stopScreenShare(),e()})}stopScreenShare(){return Jt(this,null,function*(){var e;fi.d(this.TAG,"\u2705 Screenshare ended from app");let t=null==(e=this.localPeer)?void 0:e.auxiliaryTracks.filter(e=>"screen"===e.source);if(t)for(let i of t)yield this.removeTrack(i.trackId)})}addTrack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"regular";return Jt(this,null,function*(){var i,n,r,s;if(!e)return void fi.w(this.TAG,"Please pass a valid MediaStreamTrack");if(!this.localPeer)throw Oi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot addTrack");if(this.localPeer.auxiliaryTracks.find(t=>t.trackId===e.id))return;let a=e.kind,o=new MediaStream([e]),l=new Mr(o),c=new("audio"===a?Fn:sr)(l,e,t,this.eventBus);yield this.applySettings(c),yield this.setPlaylistSettings({track:e,hmsTrack:c,source:t}),yield null==(i=this.transport)?void 0:i.publish([c]),c.peerId=null==(n=this.localPeer)?void 0:n.peerId,null==(r=this.localPeer)||r.auxiliaryTracks.push(c),null==(s=this.listener)||s.onTrackUpdate(0,c,this.localPeer)})}removeTrack(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Jt(this,null,function*(){var i;if(!this.localPeer)throw Oi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot removeTrack");let n=this.localPeer.auxiliaryTracks.findIndex(t=>t.trackId===e);if(n>-1){let e=this.localPeer.auxiliaryTracks[n];e.isPublished?yield this.transport.unpublish([e]):yield e.cleanup(),t||this.stopPlaylist(e),this.localPeer.auxiliaryTracks.splice(n,1),null==(i=this.listener)||i.onTrackUpdate(1,e,this.localPeer)}else fi.w(this.TAG,"No track found for ".concat(e))})}setAnalyticsLevel(e){this.analyticsEventsService.level=e}setLogLevel(e){fi.level=e}autoSelectAudioOutput(e){var t;null==(t=this.deviceManager)||t.autoSelectAudioOutput(e)}addAudioListener(e){var t;this.audioListener=e,null==(t=this.notificationManager)||t.setAudioListener(e)}addConnectionQualityListener(e){var t;null==(t=this.notificationManager)||t.setConnectionQualityListener(e)}setIsDiagnostics(e){this.isDiagnostics=e}changeRole(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Jt(this,null,function*(){var n;yield null==(n=this.transport)?void 0:n.signal.requestRoleChange({requested_for:e,role:t,force:i})})}changeRoleOfPeer(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Jt(this,null,function*(){var n;yield null==(n=this.transport)?void 0:n.signal.requestRoleChange({requested_for:e,role:t,force:i})})}changeRoleOfPeersWithRoles(e,t){return Jt(this,null,function*(){var i;e.length<=0||!t||(yield null==(i=this.transport)?void 0:i.signal.requestBulkRoleChange({roles:e.map(e=>e.name),role:t,force:!0}))})}acceptChangeRole(e){return Jt(this,null,function*(){var t,i;yield null==(i=this.transport)?void 0:i.signal.acceptRoleChangeRequest({requested_by:null==(t=e.requestedBy)?void 0:t.peerId,role:e.role.name,token:e.token})})}endRoom(e,t){return Jt(this,null,function*(){var i;if(!this.localPeer)throw Oi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot end room");yield null==(i=this.transport)?void 0:i.signal.endRoom(e,t),yield this.leave()})}removePeer(e,t){return Jt(this,null,function*(){var i;if(!this.localPeer)throw Oi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot remove peer");yield null==(i=this.transport)?void 0:i.signal.removePeer({requested_for:e,reason:t})})}startRTMPOrRecording(e){return Jt(this,null,function*(){var t,i;if(!this.localPeer)throw Oi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot start streaming or recording");let n={meeting_url:e.meetingURL,record:e.record};null!=(t=e.rtmpURLs)&&t.length&&(n.rtmp_urls=e.rtmpURLs),e.resolution&&(n.resolution=e.resolution),yield null==(i=this.transport)?void 0:i.signal.startRTMPOrRecording(n)})}stopRTMPAndRecording(){return Jt(this,null,function*(){var e;if(!this.localPeer)throw Oi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot stop streaming or recording");yield null==(e=this.transport)?void 0:e.signal.stopRTMPAndRecording()})}startHLSStreaming(e){return Jt(this,null,function*(){var t;if(!this.localPeer)throw Oi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot start HLS streaming");let i={};e&&e.variants&&e.variants.length>0&&(i.variants=e.variants.map(e=>{let t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t})),null!=e&&e.recording&&(i.hls_recording={single_file_per_layer:e.recording.singleFilePerLayer,hls_vod:e.recording.hlsVod}),yield null==(t=this.transport)?void 0:t.signal.startHLSStreaming(i)})}stopHLSStreaming(e){return Jt(this,null,function*(){var t,i,n;if(!this.localPeer)throw Oi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot stop HLS streaming");if(e){let n={variants:null==(t=null==e?void 0:e.variants)?void 0:t.map(e=>{let t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t}),stop_reason:e.stop_reason};yield null==(i=this.transport)?void 0:i.signal.stopHLSStreaming(n)}else yield null==(n=this.transport)?void 0:n.signal.stopHLSStreaming()})}startTranscription(e){return Jt(this,null,function*(){var t;if(!this.localPeer)throw Oi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot start transcriptions");let i={mode:e.mode};yield null==(t=this.transport)?void 0:t.signal.startTranscription(i)})}stopTranscription(e){return Jt(this,null,function*(){var t;if(!this.localPeer)throw Oi.GenericErrors.NotConnected("VALIDATION","No local peer present, cannot stop transcriptions");if(!e)throw Oi.GenericErrors.Signalling("VALIDATION","No mode is passed to stop the transcription");let i={mode:e.mode};yield null==(t=this.transport)?void 0:t.signal.stopTranscription(i)})}sendHLSTimedMetadata(e){return Jt(this,null,function*(){var t;if(this.validateJoined("sendHLSTimedMetadata"),e.length>0){let i={metadata_objs:e};yield null==(t=this.transport)?void 0:t.signal.sendHLSTimedMetadata(i)}})}changeName(e){return Jt(this,null,function*(){var t,i;this.validateJoined("changeName");let n=this.store.getLocalPeer();n&&n.name!==e&&(yield null==(t=this.transport)?void 0:t.signal.updatePeer({name:e}),null==(i=this.notificationManager)||i.updateLocalPeer({name:e}))})}changeMetadata(e){return Jt(this,null,function*(){var t,i;this.validateJoined("changeMetadata"),yield null==(t=this.transport)?void 0:t.signal.updatePeer({data:e}),null==(i=this.notificationManager)||i.updateLocalPeer({metadata:e})})}setSessionMetadata(e){return Jt(this,null,function*(){var t;yield null==(t=this.transport)?void 0:t.signal.setSessionMetadata({key:"default",data:e})})}getSessionMetadata(){return Jt(this,null,function*(){var e;return(yield null==(e=this.transport)?void 0:e.signal.getSessionMetadata("default")).data})}getRoles(){return Object.values(this.store.getKnownRoles())}changeTrackState(e,t){return Jt(this,null,function*(){var i;if("video"===e.type&&"regular"!==e.source)return void fi.w(this.TAG,"Muting non-regular video tracks is currently not supported");if(e.enabled===t)return void fi.w(this.TAG,"Aborting change track state, track already has enabled - ".concat(t),e);if(!this.store.getTrackById(e.trackId))throw Oi.GenericErrors.ValidationFailed("No track found for change track state",e);let n=this.store.getPeerByTrackId(e.trackId);if(!n)throw Oi.GenericErrors.ValidationFailed("No peer found for change track state",e);yield null==(i=this.transport)?void 0:i.signal.requestTrackStateChange({requested_for:n.peerId,track_id:e.trackId,stream_id:e.stream.id,mute:!t})})}changeMultiTrackState(e){return Jt(this,null,function*(){var t;if("boolean"!=typeof e.enabled)throw Oi.GenericErrors.ValidationFailed("Pass a boolean for enabled");let{enabled:i,roles:n,type:r,source:s}=e;yield null==(t=this.transport)?void 0:t.signal.requestMultiTrackStateChange({value:!i,type:r,source:s,roles:null==n?void 0:n.map(e=>null==e?void 0:e.name)})})}raiseLocalPeerHand(){return Jt(this,null,function*(){var e;this.validateJoined("raiseLocalPeerHand"),yield null==(e=this.transport)?void 0:e.signal.joinGroup(Rr)})}lowerLocalPeerHand(){return Jt(this,null,function*(){var e;this.validateJoined("lowerLocalPeerHand"),yield null==(e=this.transport)?void 0:e.signal.leaveGroup(Rr)})}raiseRemotePeerHand(e){return Jt(this,null,function*(){var t;yield null==(t=this.transport)?void 0:t.signal.addToGroup(e,Rr)})}lowerRemotePeerHand(e){return Jt(this,null,function*(){var t;yield null==(t=this.transport)?void 0:t.signal.removeFromGroup(e,Rr)})}setFrameworkInfo(e){this.frameworkInfo=Wt(Wt({},this.frameworkInfo),e)}attachVideo(e,t){return Jt(this,null,function*(){let i=this.store.getConfig();null!=i&&i.autoManageVideo?e.attach(t):yield e.addSink(t)})}detachVideo(e,t){return Jt(this,null,function*(){let i=this.store.getConfig();null!=i&&i.autoManageVideo?e.detach(t):yield e.removeSink(t)})}publish(e,t){return Jt(this,null,function*(){var i,n,r;if([this.store.getPublishParams(),!this.sdkState.published,!wi].every(e=>!!e)){let s=t&&t!==(null==(n=null==(i=this.localPeer)?void 0:i.role)?void 0:n.name)?()=>{var e;return null==(e=this.roleChangeManager)?void 0:e.diffRolesAndPublishTracks({oldRole:this.store.getPolicyForRole(t),newRole:this.localPeer.role})}:()=>this.getAndPublishTracks(e);yield null==(r=null==s?void 0:s())?void 0:r.catch(e=>{var t;fi.e(this.TAG,"Error in publish",e),null==(t=this.listener)||t.onError(e)})}})}getAndPublishTracks(e){return Jt(this,null,function*(){var t,i;let n=yield this.localTrackManager.getTracksToPublish(e);yield this.initDeviceManagers(),yield this.setAndPublishTracks(n),null==(i=null==(t=this.localPeer)?void 0:t.audioTrack)||i.initAudioLevelMonitor(),this.sdkState.published=!0})}setAndPublishTracks(e){return Jt(this,null,function*(){var t,i;for(let n of e){if(yield this.transport.publish([n]),n.isTrackNotPublishing()){let e=Oi.TracksErrors.NoDataInTrack("".concat(n.type," track has no data. muted: ").concat(n.nativeTrack.muted,", readyState: ").concat(n.nativeTrack.readyState));fi.e(this.TAG,e),this.sendAnalyticsEvent(Ji.publish({devices:this.deviceManager.getDevices(),error:e})),null==(t=this.listener)||t.onError(e)}yield this.setLocalPeerTrack(n),null==(i=this.listener)||i.onTrackUpdate(0,n,this.localPeer)}})}setLocalPeerTrack(e){return Jt(this,null,function*(){var t;switch(e.peerId=null==(t=this.localPeer)?void 0:t.peerId,e.type){case"audio":this.localPeer.audioTrack=e,yield this.deviceManager.autoSelectAudioOutput();break;case"video":this.localPeer.videoTrack=e}})}initDeviceManagers(){return Jt(this,null,function*(){var e,t,i,n,r;this.sdkState.deviceManagersInitialised||(this.sdkState.deviceManagersInitialised=!0,yield this.deviceManager.init(),(yield this.deviceManager.updateOutputDevice(null==(t=null==(e=this.store.getConfig())?void 0:e.settings)?void 0:t.audioOutputDeviceId))||(yield this.deviceManager.updateOutputDevice(null==(n=null==(i=Xi.getSelection())?void 0:i.audioOutput)?void 0:n.deviceId)),this.audioSinkManager.init(null==(r=this.store.getConfig())?void 0:r.audioSinkElementId))})}cleanDeviceManagers(){this.eventBus.deviceChange.unsubscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.unsubscribe(this.handleAudioPluginError),this.eventBus.autoplayError.unsubscribe(this.handleAutoplayError),this.deviceManager.cleanup(),this.audioSinkManager.cleanup()}initPreviewTrackAudioLevelMonitor(){var e;let t=null==(e=this.localPeer)?void 0:e.audioTrack;null==t||t.initAudioLevelMonitor(),this.eventBus.trackAudioLevelUpdate.subscribe(e=>{var i;let n=e&&e.track.trackId===(null==t?void 0:t.trackId)?[{audioLevel:e.audioLevel,peer:this.localPeer,track:t}]:[];this.store.updateSpeakers(n),null==(i=this.audioListener)||i.onAudioLevelUpdate(n)}),this.eventBus.localAudioSilence.subscribe(this.sendAudioPresenceFailed)}notifyJoin(){var e;let t=this.store.getLocalPeer(),i=this.store.getRoom();if(i)return i.joinedAt=new Date,t&&(t.joinedAt=i.joinedAt),null!=t&&t.role?(this.analyticsTimer.end("join_time"),void(null==(e=this.listener)||e.onJoin(i))):new Promise((e,t)=>{this.eventBus.policyChange.subscribeOnce(()=>{var t;this.analyticsTimer.end("join_time"),null==(t=this.listener)||t.onJoin(i),e()}),this.eventBus.leave.subscribeOnce(e=>{t(e)})});fi.w(this.TAG,"notify join - room not present")}setUpPreview(e,t){this.sdkState.isPreviewCalled=!0,this.sdkState.isPreviewInProgress=!0;let{roomId:i,userId:n,role:r}=cl(e.authToken);this.commonSetup(e,i,t),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.createAndAddLocalPeerToStore(e,r,n,e.asRole)}setPlaylistSettings(e){return Jt(this,arguments,function(e){var t=this;let{track:i,hmsTrack:n,source:r}=e;return function*(){var e,s;if("videoplaylist"===r){let r={};if("audio"===i.kind)r.maxBitrate=(null==(e=t.playlistSettings.audio)?void 0:e.bitrate)||64;else{r.maxBitrate=(null==(s=t.playlistSettings.video)?void 0:s.bitrate)||1e3;let{width:e,height:n}=i.getSettings();r.width=e,r.height=n}yield n.setSettings(r)}else"audioplaylist"===r&&(yield n.setSettings({maxBitrate:64}))}()})}createAndAddLocalPeerToStore(e,t,i,n){let r=this.store.getPolicyForRole(t),s=n?this.store.getPolicyForRole(n):void 0,a=new Kr({name:e.userName||"",customerUserId:i,metadata:e.metaData||"",role:r,asRole:s||r,type:"regular"});this.store.addPeer(a)}commonSetup(e,t,i){this.stringifyMetadata(e),e.initEndpoint||(e.initEndpoint="https://prod-init.100ms.live"),this.initStoreAndManagers(i),this.store.getRoom()||this.store.setRoom(new Ha(t))}removeDevicesFromConfig(e){this.store.getConfig()&&e.settings&&(delete e.settings.audioOutputDeviceId,delete e.settings.videoDeviceId,delete e.settings.audioInputDeviceId)}getScreenshareTracks(e,t){return Jt(this,null,function*(){let i=this.transport.isFlagEnabled("scaleScreenshareBasedOnPixels"),[n,r]=yield this.localTrackManager.getLocalScreen(t,i),s=()=>{this.stopEndedScreenshare(e)},a=[];if(null!=t&&t.audioOnly){if(n.nativeTrack.stop(),!r)throw Oi.TracksErrors.NothingToReturn("TRACK","Select share audio when sharing screen","No audio found");a.push(r),r.nativeTrack.addEventListener("ended",s)}else a.push(n),n.nativeTrack.addEventListener("ended",s),r&&a.push(r);return a})}stopPlaylist(e){"audioplaylist"===e.source?this.playlistManager.stop("audio"):"videoplaylist"===e.source&&this.playlistManager.stop("video")}applySettings(e){return Jt(this,null,function*(){(e=>{if(!e.getPublishParams())throw Oi.GenericErrors.NotConnected("VALIDATION","call addTrack after preview or join is successful")})(this.store);let t=this.store.getPublishParams();if(t)if(e instanceof sr){let i="regular"===e.source?"video":"screen"===e.source?"screen":"";if(!i||!t.allowed.includes(i))return;let n=t[i];if(!n)return;let r=(new Ln).codec(n.codec).maxBitrate(n.bitRate).maxFramerate(n.frameRate).setWidth(n.width).setHeight(n.height).build();yield e.setSettings(r)}else if(e instanceof Fn){if(!t.allowed.includes("audio"))return;let i=(new An).codec(t.audio.codec).maxBitrate(t.audio.bitRate).build();yield e.setSettings(i)}})}},fl=class e{constructor(t,i,n){this.getStats=()=>(this.stats||(this.stats=new bl(this.store,this.sdk)),this.stats),this.getDiagnosticsSDK=()=>(this.diagnostics||(this.diagnostics=this.actions.initDiagnostics()),this.diagnostics),this.store=t||e.createNewHMSStore(Qa("HMSStore"),$t),this.notifications=n||new Ta(this.store),i?this.actions=i:(this.sdk=new pl,this.actions=new Ja(this.store,this.sdk,this.notifications)),this.actions.setFrameworkInfo({type:"js",sdkVersion:Qt().version}),this.initialTriggerOnSubscribe=!1,Ti&&(window.__hms=this)}triggerOnSubscribe(){this.initialTriggerOnSubscribe||(e.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}getStore(){return this.store}getHMSActions(){return this.actions}getActions(){return this.actions}getNotifications(){return{onNotification:this.notifications.onNotification}}static createNewHMSStore(t,i){let n=Mt(()=>i()),r=n.setState;n.setState=e=>{let t="function"==typeof e?Lt(e):e;r(t)};let s=n.getState;n.getState=e=>e?e(s()):s(),e.compareWithShallowCheckInSubscribe(n);let a=e.setUpDevtools(n,t);return Ht(Wt({},n),{namedSetState:a})}static makeStoreTriggerOnSubscribe(e){let t=e.subscribe;e.subscribe=(i,n,r)=>(i(e.getState(n),void 0),t(i,n,r))}static compareWithShallowCheckInSubscribe(e){let t=e.subscribe;e.subscribe=(e,i,n)=>(i||(i=e=>e),t(e,i,n=n||Dt))}static setUpDevtools(t,i){let n;try{n=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch(Fe){}if(!n)return e=>{t.setState(e)};let r=n.connect(e.devtoolsOptions(i));r.prefix=i?"".concat(i," > "):"";let s=t.setState;return t.setState=e=>{s(e),r.send("".concat(r.prefix,"setState"),t.getState())},r.subscribe(e.devtoolsSubscribe(r,t,s)),r.send("setUpStore",t.getState()),(e,i)=>{s(e);let n=i||"".concat(r.prefix,"action");r.send(n,t.getState())}}static devtoolsOptions(e){return{name:e,actionsBlacklist:["audioLevel","playlistProgress","connectionQuality"]}}static devtoolsSubscribe(e,t,i){return n=>{var r,s,a,o;if("DISPATCH"===n.type&&n.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(n.payload.type)?i(JSON.parse(n.state)):t.setState(JSON.parse(n.state));else if("DISPATCH"===n.type&&"COMMIT"===(null==(r=n.payload)?void 0:r.type))e.init(t.getState());else if("DISPATCH"===n.type&&"IMPORT_STATE"===(null==(s=n.payload)?void 0:s.type)){let r=null==(a=n.payload.nextLiftedState)?void 0:a.actionsById;((null==(o=n.payload.nextLiftedState)?void 0:o.computedStates)||[]).forEach((n,s)=>{let{state:a}=n,o=r[s]||"".concat(e.prefix,"setState");0===s?e.init(a):(i(a),e.send(o,t.getState()))})}}}},vl=(e,t,i)=>{var n,r;let s=gl(i,t);null==(n=e.getWebrtcInternals())||n.start();let a=null==(r=e.getWebrtcInternals())?void 0:r.onStatsChange(n=>ml(t,n,i,e));return()=>{s(),a&&a()}},gl=(e,t)=>{let i,n,r;return e.getState(vs)?t.namedSetState(t=>{t.localPeer.id=e.getState(vs)},"localpeer-id"):i=e.subscribe(e=>{e&&t.namedSetState(t=>{t.localPeer.id=e},"localpeer-id")},vs),e.getState(ms)?t.namedSetState(t=>{t.localPeer.videoTrack=e.getState(ms)},"localpeer-videotrack-id"):n=e.subscribe(e=>{e&&t.namedSetState(t=>{t.localPeer.videoTrack=e},"localpeer-videotrack-id")},ms),e.getState(gs)?t.namedSetState(t=>{t.localPeer.audioTrack=e.getState(gs)},"localpeer-audiotrack-id"):r=e.subscribe(e=>{e&&t.namedSetState(t=>{t.localPeer.audioTrack=e},"localpeer-audiotrack-id")},gs),()=>{null==i||i(),null==n||n(),null==r||r()}},ml=(e,t,i,n)=>{let r=i.getState(ls);e.namedSetState(e=>{let s=i.getState(vs),a={},o=Object.keys(r).filter(e=>r[e].peerId!==s);for(let i of o){let e=t.getRemoteTrackStats(i);e&&(a[i]=e)}Ca(e.remoteTrackStats,a);let l={[s]:t.getLocalPeerStats()};Ca(e.peerStats,l),((e,t,i)=>{let n=i.reduce((e,i)=>(e[i.firstTrackId]=Object.values(t[i.getTrackIDBeingSent()]||{}).sort((e,t)=>e.rid&&t.rid?e.rid<t.rid?-1:1:0),e),{}),r=Da(Object.keys(e),Object.keys(n));for(let s of r)n[s]?e[s]=n[s]:delete e[s]})(e.localTrackStats,t.getLocalTrackStats(),n.store.getLocalPeerTracks())},"webrtc-stats")},yl=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"resetState";e.namedSetState(e=>{Object.assign(e,{peerStats:{},remoteTrackStats:{},localTrackStats:{},localPeer:{id:""}})},t)},bl=class{constructor(e,t){this.hmsStore=e,this.sdk=t,this.store=fl.createNewHMSStore(Qa("HMSStatsStore"),Xt),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=()=>new Promise(e=>{var t,i;"Connected"===this.hmsStore.getState(Is)?e(null==(i=null==(t=this.sdk)?void 0:t.getWebrtcInternals())?void 0:i.getPublishPeerConnection()):this.hmsStore.subscribe(t=>{var i,n;"Connected"===t&&e(null==(n=null==(i=this.sdk)?void 0:i.getWebrtcInternals())?void 0:n.getPublishPeerConnection())},Is)}),this.getSubscribePeerConnection=()=>new Promise(e=>{var t,i;"Connected"===this.hmsStore.getState(Is)?e(null==(i=null==(t=this.sdk)?void 0:t.getWebrtcInternals())?void 0:i.getSubscribePeerConnection()):this.hmsStore.subscribe(t=>{var i,n;"Connected"===t&&e(null==(n=null==(i=this.sdk)?void 0:i.getWebrtcInternals())?void 0:n.getSubscribePeerConnection())},Is)}),this.sdk&&((e,t,i)=>{let n;"Connected"===i.getState(Is)&&(n=vl(e,t,i)),i.subscribe(r=>{["Connected","Reconnecting"].includes(r)?n||(n=vl(e,t,i)):["Disconnected","Failed"].includes(r)&&n&&(yl(t,r),n(),n=void 0)},Is)})(this.sdk,this.store,this.hmsStore)}},kl=(e,t)=>t,Sl=e=>e.peerStats,Tl=e=>e.localTrackStats,wl=g([Sl,e=>e.localPeer.id],(e,t)=>e[t]),El=(g(wl,e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.packetsLost}),g(wl,e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.jitter}),g(wl,e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bitrate}),g(wl,e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bitrate}),g(wl,e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.availableOutgoingBitrate}),g(wl,e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.availableIncomingBitrate}),g(wl,e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bytesSent}),g(wl,e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bytesReceived}),g([Sl,(e,t)=>t],(e,t)=>t?e[t]:void 0)),Pl=g([e=>e.remoteTrackStats,kl],(e,t)=>t?e[t]:void 0),Cl=g([Tl,kl],(e,t)=>t?e[t]:void 0);zs(El),zs(Pl),g([Tl,e=>e.localPeer.audioTrack],(e,t)=>{var i;return t?null==(i=e[t])?void 0:i[0]:void 0}),zs(g(Cl,e=>null==e?void 0:e[0])),g([Tl,e=>e.localPeer.videoTrack],(e,t)=>{var i;return t?null==(i=e[t])?void 0:i[0]:void 0}),zs(g(Cl,e=>e));function Il(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(let n=0;n<i.length;n++)if(!Object.prototype.hasOwnProperty.call(t,i[n])||!Object.is(e[i[n]],t[i[n]]))return!1;return!0}(dl=ul||(ul={}))[dl.VERBOSE=0]="VERBOSE",dl[dl.DEBUG=1]="DEBUG",dl[dl.INFO=2]="INFO",dl[dl.WARN=3]="WARN",dl[dl.ERROR=4]="ERROR",dl[dl.NONE=5]="NONE";class _l{static v(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.log(ul.VERBOSE,e,...i)}static d(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.log(ul.DEBUG,e,...i)}static i(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.log(ul.INFO,e,...i)}static w(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.log(ul.WARN,e,...i)}static e(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.log(ul.ERROR,e,...i)}static log(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];if(!(this.level.valueOf()>e.valueOf()))switch(e){case ul.VERBOSE:console.log("HMSui-components: ",t,...n);break;case ul.DEBUG:console.debug("HMSui-components: ",t,...n);break;case ul.INFO:console.info("HMSui-components: ",t,...n);break;case ul.WARN:console.warn("HMSui-components: ",t,...n);break;case ul.ERROR:console.error("HMSui-components: ",t,...n)}}}_l.level=ul.VERBOSE;var Al=_l;const Rl="It seems like you forgot to add your component within a top level HMSRoomProvider, please refer to 100ms react docs(https://www.100ms.live/docs/javascript/v2/how-to-guides/install-the-sdk/integration#react-hooks) to check on the required steps for using this hook. If the provider is present\n  at the top level, check the yarn.lock/package-lock.json, if there are multiple versions of @100mslive/react-sdk. Please ensure the versions of @100mslive/react-sdk and @100mslive/roomkit-react are the same versions from the release notes(https://www.100ms.live/docs/javascript/v2/changelog/release-notes) that you are trying to update to.";const Ll="undefined"!=typeof window,Dl=(0,s.createContext)(null),Ml=e=>{let{children:t,actions:i,store:n,notifications:r,stats:a,isHMSStatsOn:o=!1,leaveOnUnload:l=!0}=e;const c=(0,s.useMemo)(()=>{let e;const t=()=>{throw new Error("modifying store is not allowed")};if(i&&n)e={actions:i,store:f(Object.assign(Object.assign({},n),{setState:t,destroy:t}))},r&&(e.notifications=r),a&&(e.statsStore=f({getState:a.getState,subscribe:a.subscribe,setState:t,destroy:t}));else{const i=new fl;if(e={actions:i.getActions(),store:f(Object.assign(Object.assign({},i.getStore()),{setState:t,destroy:t})),notifications:i.getNotifications()},o){const n=i.getStats();e.statsStore=f({getState:n.getState,subscribe:n.subscribe,setState:t,destroy:t})}}return e.actions.setFrameworkInfo({type:"react-web",version:s.version,sdkVersion:"0.10.36"}),e},[i,n,r,a,o]);return(0,s.useEffect)(()=>{if(Ll&&l){const e=()=>c.actions.leave();return window.addEventListener("unload",e),()=>{window.removeEventListener("unload",e)}}return()=>{}},[l,c]),s.createElement(Dl.Provider,{value:c},t)},Nl=function(e){return function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Il;t||Al.w("fetching full store without passing any selector may have a heavy performance impact on your website.");const n=(0,s.useContext)(e);if(!n)throw new Error(Rl);return(0,n.store)(t,i)}}(Dl),Ol=(function(e){}(Dl),()=>{const e=(0,s.useContext)(Dl);if(!e)throw new Error(Rl);return e.actions});var xl=i(579);const Ul="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ2ZXJzaW9uIjoyLCJ0eXBlIjoiYXBwIiwiYXBwX2RhdGEiOm51bGwsImFjY2Vzc19rZXkiOiI2ODdmZDFkMmJkMGRhYjVmOWEwMTMxZmYiLCJyb2xlIjoiaG9zdCIsInJvb21faWQiOiI2ODliOWMyYWE1YmE4MzI2ZTZlYjYyZjMiLCJ1c2VyX2lkIjoiYTY3YmMxNDctNGFlNS00NDhmLWI5NmMtZTJjNDdiOWZjZDRkIiwiZXhwIjoxNzU1MTc3MTgyLCJqdGkiOiI2MTQ2NjVkMy0xZTQ5LTQ0YmEtYWQ1My0zYzg5OTUyYjVkNWUiLCJpYXQiOjE3NTUwOTA3ODIsImlzcyI6IjY4N2ZkMWQyYmQwZGFiNWY5YTAxMzFmZCIsIm5iZiI6MTc1NTA5MDc4Miwic3ViIjoiYXBpIn0.mD2gWPa6_OBzawjm1Ay0Y7efzR36toNbqeb5DiHOM90";function Fl(e){let{peer:t}=e;const i=(0,s.useRef)(null),n=Ol();return(0,s.useEffect)(()=>((async()=>{if(null!==t&&void 0!==t&&t.videoTrack&&i.current)try{await n.attachVideo(t.videoTrack,i.current)}catch(e){console.error("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u0440\u0438\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0438\u0434\u0435\u043e:",e)}})(),()=>(async()=>{if(null!==t&&void 0!==t&&t.videoTrack&&i.current)try{await n.detachVideo(t.videoTrack,i.current)}catch(e){}})()),[null===t||void 0===t?void 0:t.videoTrack,n]),(0,xl.jsxs)("div",{style:Wl.tile,children:[(0,xl.jsx)("video",{ref:i,autoPlay:!0,playsInline:!0,muted:t.isLocal,style:Wl.video}),(0,xl.jsxs)("div",{style:Wl.caption,children:[t.name||"\u0413\u043e\u0441\u0442\u044c"," \u2022 ",t.roleName,t.isLocal?" \u2022 \u0412\u044b":""]})]})}function jl(){const e=Nl(hs);return e.length?(0,xl.jsx)("div",{style:Wl.grid,children:e.map(e=>(0,xl.jsx)(Fl,{peer:e},e.id))}):(0,xl.jsx)("div",{style:{color:"#666"},children:"\u041e\u0436\u0438\u0434\u0430\u043d\u0438\u0435 \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432\u2026"})}function Bl(){const e=Ol(),t=Nl(ds),[i,n]=(0,s.useState)("host");return t?null:(0,xl.jsxs)("div",{style:Wl.joinBox,children:[(0,xl.jsx)("h1",{style:{margin:0},children:"\u0412\u0438\u0434\u0435\u043e\u0443\u0440\u043e\u043a"}),(0,xl.jsxs)("div",{style:{marginTop:12},children:[(0,xl.jsxs)("label",{style:Wl.radio,children:[(0,xl.jsx)("input",{type:"radio",value:"host",checked:"host"===i,onChange:()=>n("host")}),"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c"]}),(0,xl.jsxs)("label",{style:Wl.radio,children:[(0,xl.jsx)("input",{type:"radio",value:"guest",checked:"guest"===i,onChange:()=>n("guest")}),"\u0423\u0447\u0435\u043d\u0438\u043a"]})]}),(0,xl.jsx)("button",{style:Wl.primaryBtn,onClick:async()=>{try{const t="host"===i?Ul:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ2ZXJzaW9uIjoyLCJ0eXBlIjoiYXBwIiwiYXBwX2RhdGEiOm51bGwsImFjY2Vzc19rZXkiOiI2ODdmZDFkMmJkMGRhYjVmOWEwMTMxZmYiLCJyb2xlIjoic3R1ZGVudCIsInJvb21faWQiOiI2ODliOWMyYWE1YmE4MzI2ZTZlYjYyZjMiLCJ1c2VyX2lkIjoiY2MxNWNkMjEtZjI5OS00MmQzLWI0MTktOGRmZDczZGJlZjJkIiwiZXhwIjoxNzU1MTc3MTk0LCJqdGkiOiIxOGJiYzZiMC0yZjlhLTRiNmItYmM1NS1lNGQxYzY3YjE3ZDEiLCJpYXQiOjE3NTUwOTA3OTQsImlzcyI6IjY4N2ZkMWQyYmQwZGFiNWY5YTAxMzFmZCIsIm5iZiI6MTc1NTA5MDc5NCwic3ViIjoiYXBpIn0.Jl4ndD-Da8aIzR6BpfZS7unWAGsepJyrYkHNzsFzbR0";if(!t)return void alert("\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0442\u043e\u043a\u0435\u043d. \u0417\u0430\u043f\u043e\u043b\u043d\u0438 .env: REACT_APP_100MS_HOST_TOKEN \u0438/\u0438\u043b\u0438 REACT_APP_100MS_GUEST_TOKEN, \u0437\u0430\u0442\u0435\u043c \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438 npm start.");await e.join({userName:"host"===i?"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c":"\u0423\u0447\u0435\u043d\u0438\u043a",authToken:t,settings:{isAudioMuted:!1,isVideoMuted:!1}}),await e.setLocalVideoEnabled(!0),await e.setLocalAudioEnabled(!0)}catch(t){console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f:",t),alert("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f. \u041f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0441\u0442\u0438 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438.")}},children:"\u041f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f"})]})}function Gl(){const e=Ol(),t=Nl(ds),i=Nl(Ss),n=Nl(ks);if(!t)return null;return(0,xl.jsxs)("div",{style:Wl.controls,children:[(0,xl.jsx)("button",{style:Wl.ctrlBtn,onClick:async()=>{await e.setLocalAudioEnabled(!n)},children:n?"\u041c\u0438\u043a\u0440\u043e\u0444\u043e\u043d: \u0432\u044b\u043a\u043b":"\u041c\u0438\u043a\u0440\u043e\u0444\u043e\u043d: \u0432\u043a\u043b"}),(0,xl.jsx)("button",{style:Wl.ctrlBtn,onClick:async()=>{await e.setLocalVideoEnabled(!i)},children:i?"\u041a\u0430\u043c\u0435\u0440\u0430: \u0432\u044b\u043a\u043b":"\u041a\u0430\u043c\u0435\u0440\u0430: \u0432\u043a\u043b"}),(0,xl.jsx)("button",{style:d(d({},Wl.ctrlBtn),{},{background:"#e53935"}),onClick:async()=>{await e.leave()},children:"\u0412\u044b\u0439\u0442\u0438"})]})}function Vl(){const e=Nl(ds);return(0,xl.jsxs)("div",{style:Wl.wrapper,children:[(0,xl.jsx)(Bl,{}),e?(0,xl.jsxs)(xl.Fragment,{children:[(0,xl.jsx)(jl,{}),(0,xl.jsx)(Gl,{})]}):(0,xl.jsx)("div",{style:{color:"#777"},children:"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e\u0431\u044b \u0443\u0432\u0438\u0434\u0435\u0442\u044c \u0432\u0438\u0434\u0435\u043e\u2026"})]})}function zl(){return(0,xl.jsx)(Ml,{children:(0,xl.jsx)(Vl,{})})}const Wl={wrapper:{minHeight:"100vh",display:"flex",flexDirection:"column",gap:16,padding:16,background:"#0e0e12",color:"white",boxSizing:"border-box"},joinBox:{background:"#17171d",border:"1px solid #2b2b33",borderRadius:12,padding:16,display:"inline-block"},radio:{marginRight:16},primaryBtn:{marginTop:12,padding:"10px 16px",background:"#3b82f6",color:"white",border:"none",borderRadius:8,cursor:"pointer"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:12,width:"100%"},tile:{position:"relative",background:"#111117",borderRadius:12,overflow:"hidden",border:"1px solid #2b2b33",height:180},video:{width:"100%",height:"100%",objectFit:"cover",background:"#000"},caption:{position:"absolute",left:8,bottom:8,padding:"4px 8px",background:"rgba(0,0,0,0.55)",borderRadius:6,fontSize:12},controls:{display:"flex",gap:8,marginTop:"auto"},ctrlBtn:{padding:"8px 12px",background:"#2b2b33",color:"white",border:"none",borderRadius:8,cursor:"pointer"}};(0,a.H)(document.getElementById("root")).render((0,xl.jsx)(zl,{}))})()})();
//# sourceMappingURL=main.79da3b3d.js.map